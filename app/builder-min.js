/*! Storymaps-Shortlist - v2.9.0 - 2020-01-22, 03:11:47 PM - This application is released under the Apache License V2.0 by Esri http://www.esri.com/ - https://github.com/Esri/map-series-storytelling-template-js */ function FastClick(
  t
) {
  "use strict";
  var e,
    i = this;
  if (
    ((this.trackingClick = !1),
    (this.trackingClickStart = 0),
    (this.targetElement = null),
    (this.touchStartX = 0),
    (this.touchStartY = 0),
    (this.lastTouchIdentifier = 0),
    (this.touchBoundary = 10),
    (this.layer = t),
    !t || !t.nodeType)
  )
    throw new TypeError("Layer must be a document node");
  (this.onClick = function () {
    return FastClick.prototype.onClick.apply(i, arguments);
  }),
    (this.onMouse = function () {
      return FastClick.prototype.onMouse.apply(i, arguments);
    }),
    (this.onTouchStart = function () {
      return FastClick.prototype.onTouchStart.apply(i, arguments);
    }),
    (this.onTouchMove = function () {
      return FastClick.prototype.onTouchMove.apply(i, arguments);
    }),
    (this.onTouchEnd = function () {
      return FastClick.prototype.onTouchEnd.apply(i, arguments);
    }),
    (this.onTouchCancel = function () {
      return FastClick.prototype.onTouchCancel.apply(i, arguments);
    }),
    FastClick.notNeeded(t) ||
      (this.deviceIsAndroid &&
        (t.addEventListener("mouseover", this.onMouse, !0),
        t.addEventListener("mousedown", this.onMouse, !0),
        t.addEventListener("mouseup", this.onMouse, !0)),
      t.addEventListener("click", this.onClick, !0),
      t.addEventListener("touchstart", this.onTouchStart, !1),
      t.addEventListener("touchmove", this.onTouchMove, !1),
      t.addEventListener("touchend", this.onTouchEnd, !1),
      t.addEventLiEstener("touchcancel", this.onTouchCancel, !1),
      Event.prototype.stopImmediatePropagation ||
        ((t.removeEventListener = function (e, i, n) {
          var a = Node.prototype.removeEventListener;
          "click" === e ? a.call(t, e, i.hijacked || i, n) : a.call(t, e, i, n);
        }),
        (t.addEventListener = function (e, i, n) {
          var a = Node.prototype.addEventListener;
          "click" === e
            ? a.call(
                t,
                e,
                i.hijacked ||
                  (i.hijacked = function (t) {
                    t.propagationStopped || i(t);
                  }),
                n
              )
            : a.call(t, e, i, n);
        })),
      "function" == typeof t.onclick &&
        ((e = t.onclick),
        t.addEventListener(
          "click",
          function (t) {
            e(t);
          },
          !1
        ),
        (t.onclick = null)));
}
if (
  (define("lib-build/css", [], function () {
    if ("undefined" == typeof window)
      return {
        load: function (t, e, i) {
          i();
        },
      };
    var t = document.getElementsByTagName("head")[0],
      e =
        window.navigator.userAgent.match(
          /Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/
        ) || 0,
      i = !1,
      n = !0;
    e[1] || e[7]
      ? (i = parseInt(e[1]) < 6 || parseInt(e[7]) <= 9)
      : e[2]
      ? (n = !1)
      : e[4] && (i = parseInt(e[4]) < 18);
    var a = {};
    a.pluginBuilder = "./css-builder";
    var o,
      r = function () {
        (o = document.createElement("style")), t.appendChild(o);
      },
      s = function (t, e) {
        r();
        var i = o.styleSheet || o.sheet;
        if (i && i.addImport) i.addImport(t), (o.onload = e);
        else {
          o.textContent = '@import "' + t + '";';
          var n = setInterval(function () {
            try {
              o.sheet.cssRules, clearInterval(n), e();
            } catch (t) {}
          }, 10);
        }
      },
      l = function (e, i) {
        var a = document.createElement("link");
        if (((a.type = "text/css"), (a.rel = "stylesheet"), n))
          a.onload = function () {
            (a.onload = function () {}), setTimeout(i, 7);
          };
        else
          var o = setInterval(function () {
            for (var t = 0; t < document.styleSheets.length; t++) {
              if (document.styleSheets[t].href == a.href)
                return clearInterval(o), i();
            }
          }, 10);
        (a.href = e), t.appendChild(a);
      };
    return (
      (a.normalize = function (t, e) {
        return (
          ".css" == t.substr(t.length - 4, 4) &&
            (t = t.substr(0, t.length - 4)),
          e(t)
        );
      }),
      (a.load = function (t, e, n, a) {
        (i ? s : l)(e.toUrl(t + ".css"), n);
      }),
      a
    );
  }),
  define(
    "lib-build/css!lib-app/bootstrap/css/bootstrap.min",
    [],
    function () {}
  ),
  define("lib-build/css!storymaps/common/ui/Modal", [], function () {}),
  define("lib-build/css!storymaps/common/Core", [], function () {}),
  (function (t, e) {
    "object" == typeof module && "object" == typeof module.exports
      ? (module.exports = t.document
          ? e(t, !0)
          : function (t) {
              if (!t.document)
                throw new Error("jQuery requires a window with a document");
              return e(t);
            })
      : e(t);
  })("undefined" != typeof window ? window : this, function (t, e) {
    function i(t) {
      var e = t.length,
        i = ot.type(t);
      return (
        "function" !== i &&
        !ot.isWindow(t) &&
        (!(1 !== t.nodeType || !e) ||
          "array" === i ||
          0 === e ||
          ("number" == typeof e && e > 0 && e - 1 in t))
      );
    }
    function n(t, e, i) {
      if (ot.isFunction(e))
        return ot.grep(t, function (t, n) {
          return !!e.call(t, n, t) !== i;
        });
      if (e.nodeType)
        return ot.grep(t, function (t) {
          return (t === e) !== i;
        });
      if ("string" == typeof e) {
        if (ht.test(e)) return ot.filter(e, t, i);
        e = ot.filter(e, t);
      }
      return ot.grep(t, function (t) {
        return ot.inArray(t, e) >= 0 !== i;
      });
    }
    function a(t, e) {
      do {
        t = t[e];
      } while (t && 1 !== t.nodeType);
      return t;
    }
    function o(t) {
      var e = (wt[t] = {});
      return (
        ot.each(t.match(yt) || [], function (t, i) {
          e[i] = !0;
        }),
        e
      );
    }
    function r() {
      mt.addEventListener
        ? (mt.removeEventListener("DOMContentLoaded", s, !1),
          t.removeEventListener("load", s, !1))
        : (mt.detachEvent("onreadystatechange", s), t.detachEvent("onload", s));
    }
    function s() {
      (mt.addEventListener ||
        "load" === event.type ||
        "complete" === mt.readyState) &&
        (r(), ot.ready());
    }
    function l(t, e, i) {
      if (void 0 === i && 1 === t.nodeType) {
        var n = "data-" + e.replace(Tt, "-$1").toLowerCase();
        if ("string" == typeof (i = t.getAttribute(n))) {
          try {
            i =
              "true" === i ||
              ("false" !== i &&
                ("null" === i
                  ? null
                  : +i + "" === i
                  ? +i
                  : St.test(i)
                  ? ot.parseJSON(i)
                  : i));
          } catch (t) {}
          ot.data(t, e, i);
        } else i = void 0;
      }
      return i;
    }
    function d(t) {
      var e;
      for (e in t)
        if (("data" !== e || !ot.isEmptyObject(t[e])) && "toJSON" !== e)
          return !1;
      return !0;
    }
    function p(t, e, i, n) {
      if (ot.acceptData(t)) {
        var a,
          o,
          r = ot.expando,
          s = t.nodeType,
          l = s ? ot.cache : t,
          d = s ? t[r] : t[r] && r;
        if (
          (d && l[d] && (n || l[d].data)) ||
          void 0 !== i ||
          "string" != typeof e
        )
          return (
            d || (d = s ? (t[r] = K.pop() || ot.guid++) : r),
            l[d] || (l[d] = s ? {} : { toJSON: ot.noop }),
            ("object" == typeof e || "function" == typeof e) &&
              (n
                ? (l[d] = ot.extend(l[d], e))
                : (l[d].data = ot.extend(l[d].data, e))),
            (o = l[d]),
            n || (o.data || (o.data = {}), (o = o.data)),
            void 0 !== i && (o[ot.camelCase(e)] = i),
            "string" == typeof e
              ? null == (a = o[e]) && (a = o[ot.camelCase(e)])
              : (a = o),
            a
          );
      }
    }
    function c(t, e, i) {
      if (ot.acceptData(t)) {
        var n,
          a,
          o = t.nodeType,
          r = o ? ot.cache : t,
          s = o ? t[ot.expando] : ot.expando;
        if (r[s]) {
          if (e && (n = i ? r[s] : r[s].data)) {
            ot.isArray(e)
              ? (e = e.concat(ot.map(e, ot.camelCase)))
              : e in n
              ? (e = [e])
              : ((e = ot.camelCase(e)), (e = e in n ? [e] : e.split(" "))),
              (a = e.length);
            for (; a--; ) delete n[e[a]];
            if (i ? !d(n) : !ot.isEmptyObject(n)) return;
          }
          (i || (delete r[s].data, d(r[s]))) &&
            (o
              ? ot.cleanData([t], !0)
              : nt.deleteExpando || r != r.window
              ? delete r[s]
              : (r[s] = null));
        }
      }
    }
    function u() {
      return !0;
    }
    function h() {
      return !1;
    }
    function f() {
      try {
        return mt.activeElement;
      } catch (t) {}
    }
    function m(t) {
      var e = Rt.split("|"),
        i = t.createDocumentFragment();
      if (i.createElement) for (; e.length; ) i.createElement(e.pop());
      return i;
    }
    function g(t, e) {
      var i,
        n,
        a = 0,
        o =
          typeof t.getElementsByTagName !== xt
            ? t.getElementsByTagName(e || "*")
            : typeof t.querySelectorAll !== xt
            ? t.querySelectorAll(e || "*")
            : void 0;
      if (!o)
        for (o = [], i = t.childNodes || t; null != (n = i[a]); a++)
          !e || ot.nodeName(n, e) ? o.push(n) : ot.merge(o, g(n, e));
      return void 0 === e || (e && ot.nodeName(t, e)) ? ot.merge([t], o) : o;
    }
    function b(t) {
      Lt.test(t.type) && (t.defaultChecked = t.checked);
    }
    function v(t, e) {
      return ot.nodeName(t, "table") &&
        ot.nodeName(11 !== e.nodeType ? e : e.firstChild, "tr")
        ? t.getElementsByTagName("tbody")[0] ||
            t.appendChild(t.ownerDocument.createElement("tbody"))
        : t;
    }
    function y(t) {
      return (t.type = (null !== ot.find.attr(t, "type")) + "/" + t.type), t;
    }
    function w(t) {
      var e = qt.exec(t.type);
      return e ? (t.type = e[1]) : t.removeAttribute("type"), t;
    }
    function C(t, e) {
      for (var i, n = 0; null != (i = t[n]); n++)
        ot._data(i, "globalEval", !e || ot._data(e[n], "globalEval"));
    }
    function _(t, e) {
      if (1 === e.nodeType && ot.hasData(t)) {
        var i,
          n,
          a,
          o = ot._data(t),
          r = ot._data(e, o),
          s = o.events;
        if (s) {
          delete r.handle, (r.events = {});
          for (i in s)
            for (n = 0, a = s[i].length; a > n; n++)
              ot.event.add(e, i, s[i][n]);
        }
        r.data && (r.data = ot.extend({}, r.data));
      }
    }
    function x(t, e) {
      var i, n, a;
      if (1 === e.nodeType) {
        if (
          ((i = e.nodeName.toLowerCase()), !nt.noCloneEvent && e[ot.expando])
        ) {
          a = ot._data(e);
          for (n in a.events) ot.removeEvent(e, n, a.handle);
          e.removeAttribute(ot.expando);
        }
        "script" === i && e.text !== t.text
          ? ((y(e).text = t.text), w(e))
          : "object" === i
          ? (e.parentNode && (e.outerHTML = t.outerHTML),
            nt.html5Clone &&
              t.innerHTML &&
              !ot.trim(e.innerHTML) &&
              (e.innerHTML = t.innerHTML))
          : "input" === i && Lt.test(t.type)
          ? ((e.defaultChecked = e.checked = t.checked),
            e.value !== t.value && (e.value = t.value))
          : "option" === i
          ? (e.defaultSelected = e.selected = t.defaultSelected)
          : ("input" === i || "textarea" === i) &&
            (e.defaultValue = t.defaultValue);
      }
    }
    function S(e, i) {
      var n = ot(i.createElement(e)).appendTo(i.body),
        a = t.getDefaultComputedStyle
          ? t.getDefaultComputedStyle(n[0]).display
          : ot.css(n[0], "display");
      return n.detach(), a;
    }
    function T(t) {
      var e = mt,
        i = Zt[t];
      return (
        i ||
          ((i = S(t, e)),
          ("none" !== i && i) ||
            ((Jt = (
              Jt || ot("<iframe frameborder='0' width='0' height='0'/>")
            ).appendTo(e.documentElement)),
            (e = (Jt[0].contentWindow || Jt[0].contentDocument).document),
            e.write(),
            e.close(),
            (i = S(t, e)),
            Jt.detach()),
          (Zt[t] = i)),
        i
      );
    }
    function k(t, e) {
      return {
        get: function () {
          var i = t();
          if (null != i)
            return i
              ? void delete this.get
              : (this.get = e).apply(this, arguments);
        },
      };
    }
    function E(t, e) {
      if (e in t) return e;
      for (
        var i = e.charAt(0).toUpperCase() + e.slice(1), n = e, a = ue.length;
        a--;

      )
        if ((e = ue[a] + i) in t) return e;
      return n;
    }
    function A(t, e) {
      for (var i, n, a, o = [], r = 0, s = t.length; s > r; r++)
        (n = t[r]),
          n.style &&
            ((o[r] = ot._data(n, "olddisplay")),
            (i = n.style.display),
            e
              ? (o[r] || "none" !== i || (n.style.display = ""),
                "" === n.style.display &&
                  At(n) &&
                  (o[r] = ot._data(n, "olddisplay", T(n.nodeName))))
              : o[r] ||
                ((a = At(n)),
                ((i && "none" !== i) || !a) &&
                  ot._data(n, "olddisplay", a ? i : ot.css(n, "display"))));
      for (r = 0; s > r; r++)
        (n = t[r]),
          n.style &&
            ((e && "none" !== n.style.display && "" !== n.style.display) ||
              (n.style.display = e ? o[r] || "" : "none"));
      return t;
    }
    function I(t, e, i) {
      var n = le.exec(e);
      return n ? Math.max(0, n[1] - (i || 0)) + (n[2] || "px") : e;
    }
    function L(t, e, i, n, a) {
      for (
        var o = i === (n ? "border" : "content") ? 4 : "width" === e ? 1 : 0,
          r = 0;
        4 > o;
        o += 2
      )
        "margin" === i && (r += ot.css(t, i + Et[o], !0, a)),
          n
            ? ("content" === i && (r -= ot.css(t, "padding" + Et[o], !0, a)),
              "margin" !== i &&
                (r -= ot.css(t, "border" + Et[o] + "Width", !0, a)))
            : ((r += ot.css(t, "padding" + Et[o], !0, a)),
              "padding" !== i &&
                (r += ot.css(t, "border" + Et[o] + "Width", !0, a)));
      return r;
    }
    function P(t, e, i) {
      var n = !0,
        a = "width" === e ? t.offsetWidth : t.offsetHeight,
        o = te(t),
        r = nt.boxSizing() && "border-box" === ot.css(t, "boxSizing", !1, o);
      if (0 >= a || null == a) {
        if (
          ((a = ee(t, e, o)),
          (0 > a || null == a) && (a = t.style[e]),
          ne.test(a))
        )
          return a;
        (n = r && (nt.boxSizingReliable() || a === t.style[e])),
          (a = parseFloat(a) || 0);
      }
      return a + L(t, e, i || (r ? "border" : "content"), n, o) + "px";
    }
    function D(t, e, i, n, a) {
      return new D.prototype.init(t, e, i, n, a);
    }
    function $() {
      return (
        setTimeout(function () {
          he = void 0;
        }),
        (he = ot.now())
      );
    }
    function M(t, e) {
      var i,
        n = { height: t },
        a = 0;
      for (e = e ? 1 : 0; 4 > a; a += 2 - e)
        (i = Et[a]), (n["margin" + i] = n["padding" + i] = t);
      return e && (n.opacity = n.width = t), n;
    }
    function O(t, e, i) {
      for (
        var n, a = (ye[e] || []).concat(ye["*"]), o = 0, r = a.length;
        r > o;
        o++
      )
        if ((n = a[o].call(i, e, t))) return n;
    }
    function R(t, e, i) {
      var n,
        a,
        o,
        r,
        s,
        l,
        d,
        p,
        c = this,
        u = {},
        h = t.style,
        f = t.nodeType && At(t),
        m = ot._data(t, "fxshow");
      i.queue ||
        ((s = ot._queueHooks(t, "fx")),
        null == s.unqueued &&
          ((s.unqueued = 0),
          (l = s.empty.fire),
          (s.empty.fire = function () {
            s.unqueued || l();
          })),
        s.unqueued++,
        c.always(function () {
          c.always(function () {
            s.unqueued--, ot.queue(t, "fx").length || s.empty.fire();
          });
        })),
        1 === t.nodeType &&
          ("height" in e || "width" in e) &&
          ((i.overflow = [h.overflow, h.overflowX, h.overflowY]),
          (d = ot.css(t, "display")),
          (p = T(t.nodeName)),
          "none" === d && (d = p),
          "inline" === d &&
            "none" === ot.css(t, "float") &&
            (nt.inlineBlockNeedsLayout && "inline" !== p
              ? (h.zoom = 1)
              : (h.display = "inline-block"))),
        i.overflow &&
          ((h.overflow = "hidden"),
          nt.shrinkWrapBlocks() ||
            c.always(function () {
              (h.overflow = i.overflow[0]),
                (h.overflowX = i.overflow[1]),
                (h.overflowY = i.overflow[2]);
            }));
      for (n in e)
        if (((a = e[n]), me.exec(a))) {
          if (
            (delete e[n],
            (o = o || "toggle" === a),
            a === (f ? "hide" : "show"))
          ) {
            if ("show" !== a || !m || void 0 === m[n]) continue;
            f = !0;
          }
          u[n] = (m && m[n]) || ot.style(t, n);
        }
      if (!ot.isEmptyObject(u)) {
        m ? "hidden" in m && (f = m.hidden) : (m = ot._data(t, "fxshow", {})),
          o && (m.hidden = !f),
          f
            ? ot(t).show()
            : c.done(function () {
                ot(t).hide();
              }),
          c.done(function () {
            var e;
            ot._removeData(t, "fxshow");
            for (e in u) ot.style(t, e, u[e]);
          });
        for (n in u)
          (r = O(f ? m[n] : 0, n, c)),
            n in m ||
              ((m[n] = r.start),
              f &&
                ((r.end = r.start),
                (r.start = "width" === n || "height" === n ? 1 : 0)));
      }
    }
    function N(t, e) {
      var i, n, a, o, r;
      for (i in t)
        if (
          ((n = ot.camelCase(i)),
          (a = e[n]),
          (o = t[i]),
          ot.isArray(o) && ((a = o[1]), (o = t[i] = o[0])),
          i !== n && ((t[n] = o), delete t[i]),
          (r = ot.cssHooks[n]) && "expand" in r)
        ) {
          (o = r.expand(o)), delete t[n];
          for (i in o) i in t || ((t[i] = o[i]), (e[i] = a));
        } else e[n] = a;
    }
    function B(t, e, i) {
      var n,
        a,
        o = 0,
        r = ve.length,
        s = ot.Deferred().always(function () {
          delete l.elem;
        }),
        l = function () {
          if (a) return !1;
          for (
            var e = he || $(),
              i = Math.max(0, d.startTime + d.duration - e),
              n = i / d.duration || 0,
              o = 1 - n,
              r = 0,
              l = d.tweens.length;
            l > r;
            r++
          )
            d.tweens[r].run(o);
          return (
            s.notifyWith(t, [d, o, i]),
            1 > o && l ? i : (s.resolveWith(t, [d]), !1)
          );
        },
        d = s.promise({
          elem: t,
          props: ot.extend({}, e),
          opts: ot.extend(!0, { specialEasing: {} }, i),
          originalProperties: e,
          originalOptions: i,
          startTime: he || $(),
          duration: i.duration,
          tweens: [],
          createTween: function (e, i) {
            var n = ot.Tween(
              t,
              d.opts,
              e,
              i,
              d.opts.specialEasing[e] || d.opts.easing
            );
            return d.tweens.push(n), n;
          },
          stop: function (e) {
            var i = 0,
              n = e ? d.tweens.length : 0;
            if (a) return this;
            for (a = !0; n > i; i++) d.tweens[i].run(1);
            return e ? s.resolveWith(t, [d, e]) : s.rejectWith(t, [d, e]), this;
          },
        }),
        p = d.props;
      for (N(p, d.opts.specialEasing); r > o; o++)
        if ((n = ve[o].call(d, t, p, d.opts))) return n;
      return (
        ot.map(p, O, d),
        ot.isFunction(d.opts.start) && d.opts.start.call(t, d),
        ot.fx.timer(ot.extend(l, { elem: t, anim: d, queue: d.opts.queue })),
        d
          .progress(d.opts.progress)
          .done(d.opts.done, d.opts.complete)
          .fail(d.opts.fail)
          .always(d.opts.always)
      );
    }
    function F(t) {
      return function (e, i) {
        "string" != typeof e && ((i = e), (e = "*"));
        var n,
          a = 0,
          o = e.toLowerCase().match(yt) || [];
        if (ot.isFunction(i))
          for (; (n = o[a++]); )
            "+" === n.charAt(0)
              ? ((n = n.slice(1) || "*"), (t[n] = t[n] || []).unshift(i))
              : (t[n] = t[n] || []).push(i);
      };
    }
    function W(t, e, i, n) {
      function a(s) {
        var l;
        return (
          (o[s] = !0),
          ot.each(t[s] || [], function (t, s) {
            var d = s(e, i, n);
            return "string" != typeof d || r || o[d]
              ? r
                ? !(l = d)
                : void 0
              : (e.dataTypes.unshift(d), a(d), !1);
          }),
          l
        );
      }
      var o = {},
        r = t === ze;
      return a(e.dataTypes[0]) || (!o["*"] && a("*"));
    }
    function j(t, e) {
      var i,
        n,
        a = ot.ajaxSettings.flatOptions || {};
      for (n in e) void 0 !== e[n] && ((a[n] ? t : i || (i = {}))[n] = e[n]);
      return i && ot.extend(!0, t, i), t;
    }
    function H(t, e, i) {
      for (var n, a, o, r, s = t.contents, l = t.dataTypes; "*" === l[0]; )
        l.shift(),
          void 0 === a &&
            (a = t.mimeType || e.getResponseHeader("Content-Type"));
      if (a)
        for (r in s)
          if (s[r] && s[r].test(a)) {
            l.unshift(r);
            break;
          }
      if (l[0] in i) o = l[0];
      else {
        for (r in i) {
          if (!l[0] || t.converters[r + " " + l[0]]) {
            o = r;
            break;
          }
          n || (n = r);
        }
        o = o || n;
      }
      return o ? (o !== l[0] && l.unshift(o), i[o]) : void 0;
    }
    function z(t, e, i, n) {
      var a,
        o,
        r,
        s,
        l,
        d = {},
        p = t.dataTypes.slice();
      if (p[1]) for (r in t.converters) d[r.toLowerCase()] = t.converters[r];
      for (o = p.shift(); o; )
        if (
          (t.responseFields[o] && (i[t.responseFields[o]] = e),
          !l && n && t.dataFilter && (e = t.dataFilter(e, t.dataType)),
          (l = o),
          (o = p.shift()))
        )
          if ("*" === o) o = l;
          else if ("*" !== l && l !== o) {
            if (!(r = d[l + " " + o] || d["* " + o]))
              for (a in d)
                if (
                  ((s = a.split(" ")),
                  s[1] === o && (r = d[l + " " + s[0]] || d["* " + s[0]]))
                ) {
                  !0 === r
                    ? (r = d[a])
                    : !0 !== d[a] && ((o = s[0]), p.unshift(s[1]));
                  break;
                }
            if (!0 !== r)
              if (r && t.throws) e = r(e);
              else
                try {
                  e = r(e);
                } catch (t) {
                  return {
                    state: "parsererror",
                    error: r ? t : "No conversion from " + l + " to " + o,
                  };
                }
          }
      return { state: "success", data: e };
    }
    function U(t, e, i, n) {
      var a;
      if (ot.isArray(e))
        ot.each(e, function (e, a) {
          i || Ve.test(t)
            ? n(t, a)
            : U(t + "[" + ("object" == typeof a ? e : "") + "]", a, i, n);
        });
      else if (i || "object" !== ot.type(e)) n(t, e);
      else for (a in e) U(t + "[" + a + "]", e[a], i, n);
    }
    function G() {
      try {
        return new t.XMLHttpRequest();
      } catch (t) {}
    }
    function V() {
      try {
        return new t.ActiveXObject("Microsoft.XMLHTTP");
      } catch (t) {}
    }
    function q(t) {
      return ot.isWindow(t)
        ? t
        : 9 === t.nodeType && (t.defaultView || t.parentWindow);
    }
    var K = [],
      Y = K.slice,
      Q = K.concat,
      X = K.push,
      J = K.indexOf,
      Z = {},
      tt = Z.toString,
      et = Z.hasOwnProperty,
      it = "".trim,
      nt = {},
      at = "1.11.0",
      ot = function (t, e) {
        return new ot.fn.init(t, e);
      },
      rt = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
      st = /^-ms-/,
      lt = /-([\da-z])/gi,
      dt = function (t, e) {
        return e.toUpperCase();
      };
    (ot.fn = ot.prototype =
      {
        jquery: at,
        constructor: ot,
        selector: "",
        length: 0,
        toArray: function () {
          return Y.call(this);
        },
        get: function (t) {
          return null != t
            ? 0 > t
              ? this[t + this.length]
              : this[t]
            : Y.call(this);
        },
        pushStack: function (t) {
          var e = ot.merge(this.constructor(), t);
          return (e.prevObject = this), (e.context = this.context), e;
        },
        each: function (t, e) {
          return ot.each(this, t, e);
        },
        map: function (t) {
          return this.pushStack(
            ot.map(this, function (e, i) {
              return t.call(e, i, e);
            })
          );
        },
        slice: function () {
          return this.pushStack(Y.apply(this, arguments));
        },
        first: function () {
          return this.eq(0);
        },
        last: function () {
          return this.eq(-1);
        },
        eq: function (t) {
          var e = this.length,
            i = +t + (0 > t ? e : 0);
          return this.pushStack(i >= 0 && e > i ? [this[i]] : []);
        },
        end: function () {
          return this.prevObject || this.constructor(null);
        },
        push: X,
        sort: K.sort,
        splice: K.splice,
      }),
      (ot.extend = ot.fn.extend =
        function () {
          var t,
            e,
            i,
            n,
            a,
            o,
            r = arguments[0] || {},
            s = 1,
            l = arguments.length,
            d = !1;
          for (
            "boolean" == typeof r && ((d = r), (r = arguments[s] || {}), s++),
              "object" == typeof r || ot.isFunction(r) || (r = {}),
              s === l && ((r = this), s--);
            l > s;
            s++
          )
            if (null != (a = arguments[s]))
              for (n in a)
                (t = r[n]),
                  (i = a[n]),
                  r !== i &&
                    (d && i && (ot.isPlainObject(i) || (e = ot.isArray(i)))
                      ? (e
                          ? ((e = !1), (o = t && ot.isArray(t) ? t : []))
                          : (o = t && ot.isPlainObject(t) ? t : {}),
                        (r[n] = ot.extend(d, o, i)))
                      : void 0 !== i && (r[n] = i));
          return r;
        }),
      ot.extend({
        expando: "jQuery" + (at + Math.random()).replace(/\D/g, ""),
        isReady: !0,
        error: function (t) {
          throw new Error(t);
        },
        noop: function () {},
        isFunction: function (t) {
          return "function" === ot.type(t);
        },
        isArray:
          Array.isArray ||
          function (t) {
            return "array" === ot.type(t);
          },
        isWindow: function (t) {
          return null != t && t == t.window;
        },
        isNumeric: function (t) {
          return t - parseFloat(t) >= 0;
        },
        isEmptyObject: function (t) {
          var e;
          for (e in t) return !1;
          return !0;
        },
        isPlainObject: function (t) {
          var e;
          if (!t || "object" !== ot.type(t) || t.nodeType || ot.isWindow(t))
            return !1;
          try {
            if (
              t.constructor &&
              !et.call(t, "constructor") &&
              !et.call(t.constructor.prototype, "isPrototypeOf")
            )
              return !1;
          } catch (t) {
            return !1;
          }
          if (nt.ownLast) for (e in t) return et.call(t, e);
          for (e in t);
          return void 0 === e || et.call(t, e);
        },
        type: function (t) {
          return null == t
            ? t + ""
            : "object" == typeof t || "function" == typeof t
            ? Z[tt.call(t)] || "object"
            : typeof t;
        },
        globalEval: function (e) {
          e &&
            ot.trim(e) &&
            (
              t.execScript ||
              function (e) {
                t.eval.call(t, e);
              }
            )(e);
        },
        camelCase: function (t) {
          return t.replace(st, "ms-").replace(lt, dt);
        },
        nodeName: function (t, e) {
          return t.nodeName && t.nodeName.toLowerCase() === e.toLowerCase();
        },
        each: function (t, e, n) {
          var a = 0,
            o = t.length,
            r = i(t);
          if (n) {
            if (r) for (; o > a && !1 !== e.apply(t[a], n); a++);
            else for (a in t) if (!1 === e.apply(t[a], n)) break;
          } else if (r) for (; o > a && !1 !== e.call(t[a], a, t[a]); a++);
          else for (a in t) if (!1 === e.call(t[a], a, t[a])) break;
          return t;
        },
        trim:
          it && !it.call("\ufeff ")
            ? function (t) {
                return null == t ? "" : it.call(t);
              }
            : function (t) {
                return null == t ? "" : (t + "").replace(rt, "");
              },
        makeArray: function (t, e) {
          var n = e || [];
          return (
            null != t &&
              (i(Object(t))
                ? ot.merge(n, "string" == typeof t ? [t] : t)
                : X.call(n, t)),
            n
          );
        },
        inArray: function (t, e, i) {
          var n;
          if (e) {
            if (J) return J.call(e, t, i);
            for (
              n = e.length, i = i ? (0 > i ? Math.max(0, n + i) : i) : 0;
              n > i;
              i++
            )
              if (i in e && e[i] === t) return i;
          }
          return -1;
        },
        merge: function (t, e) {
          for (var i = +e.length, n = 0, a = t.length; i > n; ) t[a++] = e[n++];
          if (i !== i) for (; void 0 !== e[n]; ) t[a++] = e[n++];
          return (t.length = a), t;
        },
        grep: function (t, e, i) {
          for (var n = [], a = 0, o = t.length, r = !i; o > a; a++)
            !e(t[a], a) !== r && n.push(t[a]);
          return n;
        },
        map: function (t, e, n) {
          var a,
            o = 0,
            r = t.length,
            s = i(t),
            l = [];
          if (s) for (; r > o; o++) null != (a = e(t[o], o, n)) && l.push(a);
          else for (o in t) null != (a = e(t[o], o, n)) && l.push(a);
          return Q.apply([], l);
        },
        guid: 1,
        proxy: function (t, e) {
          var i, n, a;
          return (
            "string" == typeof e && ((a = t[e]), (e = t), (t = a)),
            ot.isFunction(t)
              ? ((i = Y.call(arguments, 2)),
                (n = function () {
                  return t.apply(e || this, i.concat(Y.call(arguments)));
                }),
                (n.guid = t.guid = t.guid || ot.guid++),
                n)
              : void 0
          );
        },
        now: function () {
          return +new Date();
        },
        support: nt,
      }),
      ot.each(
        "Boolean Number String Function Array Date RegExp Object Error".split(
          " "
        ),
        function (t, e) {
          Z["[object " + e + "]"] = e.toLowerCase();
        }
      );
    var pt = (function (t) {
      function e(t, e, i, n) {
        var a, o, r, s, d, u, h, f, m, g;
        if (
          ((e ? e.ownerDocument || e : B) !== L && I(e),
          (e = e || L),
          (i = i || []),
          !t || "string" != typeof t)
        )
          return i;
        if (1 !== (s = e.nodeType) && 9 !== s) return [];
        if (D && !n) {
          if ((a = gt.exec(t)))
            if ((r = a[1])) {
              if (9 === s) {
                if (!(o = e.getElementById(r)) || !o.parentNode) return i;
                if (o.id === r) return i.push(o), i;
              } else if (
                e.ownerDocument &&
                (o = e.ownerDocument.getElementById(r)) &&
                R(e, o) &&
                o.id === r
              )
                return i.push(o), i;
            } else {
              if (a[2]) return X.apply(i, e.getElementsByTagName(t)), i;
              if (
                (r = a[3]) &&
                C.getElementsByClassName &&
                e.getElementsByClassName
              )
                return X.apply(i, e.getElementsByClassName(r)), i;
            }
          if (C.qsa && (!$ || !$.test(t))) {
            if (
              ((f = h = N),
              (m = e),
              (g = 9 === s && t),
              1 === s && "object" !== e.nodeName.toLowerCase())
            ) {
              for (
                u = p(t),
                  (h = e.getAttribute("id"))
                    ? (f = h.replace(vt, "\\$&"))
                    : e.setAttribute("id", f),
                  f = "[id='" + f + "'] ",
                  d = u.length;
                d--;

              )
                u[d] = f + c(u[d]);
              (m = (bt.test(t) && l(e.parentNode)) || e), (g = u.join(","));
            }
            if (g)
              try {
                return X.apply(i, m.querySelectorAll(g)), i;
              } catch (t) {
              } finally {
                h || e.removeAttribute("id");
              }
          }
        }
        return y(t.replace(rt, "$1"), e, i, n);
      }
      function i() {
        function t(i, n) {
          return (
            e.push(i + " ") > _.cacheLength && delete t[e.shift()],
            (t[i + " "] = n)
          );
        }
        var e = [];
        return t;
      }
      function n(t) {
        return (t[N] = !0), t;
      }
      function a(t) {
        var e = L.createElement("div");
        try {
          return !!t(e);
        } catch (t) {
          return !1;
        } finally {
          e.parentNode && e.parentNode.removeChild(e), (e = null);
        }
      }
      function o(t, e) {
        for (var i = t.split("|"), n = t.length; n--; ) _.attrHandle[i[n]] = e;
      }
      function r(t, e) {
        var i = e && t,
          n =
            i &&
            1 === t.nodeType &&
            1 === e.nodeType &&
            (~e.sourceIndex || V) - (~t.sourceIndex || V);
        if (n) return n;
        if (i) for (; (i = i.nextSibling); ) if (i === e) return -1;
        return t ? 1 : -1;
      }
      function s(t) {
        return n(function (e) {
          return (
            (e = +e),
            n(function (i, n) {
              for (var a, o = t([], i.length, e), r = o.length; r--; )
                i[(a = o[r])] && (i[a] = !(n[a] = i[a]));
            })
          );
        });
      }
      function l(t) {
        return t && typeof t.getElementsByTagName !== G && t;
      }
      function d() {}
      function p(t, i) {
        var n,
          a,
          o,
          r,
          s,
          l,
          d,
          p = H[t + " "];
        if (p) return i ? 0 : p.slice(0);
        for (s = t, l = [], d = _.preFilter; s; ) {
          (!n || (a = st.exec(s))) &&
            (a && (s = s.slice(a[0].length) || s), l.push((o = []))),
            (n = !1),
            (a = lt.exec(s)) &&
              ((n = a.shift()),
              o.push({ value: n, type: a[0].replace(rt, " ") }),
              (s = s.slice(n.length)));
          for (r in _.filter)
            !(a = ut[r].exec(s)) ||
              (d[r] && !(a = d[r](a))) ||
              ((n = a.shift()),
              o.push({ value: n, type: r, matches: a }),
              (s = s.slice(n.length)));
          if (!n) break;
        }
        return i ? s.length : s ? e.error(t) : H(t, l).slice(0);
      }
      function c(t) {
        for (var e = 0, i = t.length, n = ""; i > e; e++) n += t[e].value;
        return n;
      }
      function u(t, e, i) {
        var n = e.dir,
          a = i && "parentNode" === n,
          o = W++;
        return e.first
          ? function (e, i, o) {
              for (; (e = e[n]); ) if (1 === e.nodeType || a) return t(e, i, o);
            }
          : function (e, i, r) {
              var s,
                l,
                d = [F, o];
              if (r) {
                for (; (e = e[n]); )
                  if ((1 === e.nodeType || a) && t(e, i, r)) return !0;
              } else
                for (; (e = e[n]); )
                  if (1 === e.nodeType || a) {
                    if (
                      ((l = e[N] || (e[N] = {})),
                      (s = l[n]) && s[0] === F && s[1] === o)
                    )
                      return (d[2] = s[2]);
                    if (((l[n] = d), (d[2] = t(e, i, r)))) return !0;
                  }
            };
      }
      function h(t) {
        return t.length > 1
          ? function (e, i, n) {
              for (var a = t.length; a--; ) if (!t[a](e, i, n)) return !1;
              return !0;
            }
          : t[0];
      }
      function f(t, e, i, n, a) {
        for (var o, r = [], s = 0, l = t.length, d = null != e; l > s; s++)
          (o = t[s]) && (!i || i(o, n, a)) && (r.push(o), d && e.push(s));
        return r;
      }
      function m(t, e, i, a, o, r) {
        return (
          a && !a[N] && (a = m(a)),
          o && !o[N] && (o = m(o, r)),
          n(function (n, r, s, l) {
            var d,
              p,
              c,
              u = [],
              h = [],
              m = r.length,
              g = n || v(e || "*", s.nodeType ? [s] : s, []),
              b = !t || (!n && e) ? g : f(g, u, t, s, l),
              y = i ? (o || (n ? t : m || a) ? [] : r) : b;
            if ((i && i(b, y, s, l), a))
              for (d = f(y, h), a(d, [], s, l), p = d.length; p--; )
                (c = d[p]) && (y[h[p]] = !(b[h[p]] = c));
            if (n) {
              if (o || t) {
                if (o) {
                  for (d = [], p = y.length; p--; )
                    (c = y[p]) && d.push((b[p] = c));
                  o(null, (y = []), d, l);
                }
                for (p = y.length; p--; )
                  (c = y[p]) &&
                    (d = o ? Z.call(n, c) : u[p]) > -1 &&
                    (n[d] = !(r[d] = c));
              }
            } else (y = f(y === r ? y.splice(m, y.length) : y)), o ? o(null, r, y, l) : X.apply(r, y);
          })
        );
      }
      function g(t) {
        for (
          var e,
            i,
            n,
            a = t.length,
            o = _.relative[t[0].type],
            r = o || _.relative[" "],
            s = o ? 1 : 0,
            l = u(
              function (t) {
                return t === e;
              },
              r,
              !0
            ),
            d = u(
              function (t) {
                return Z.call(e, t) > -1;
              },
              r,
              !0
            ),
            p = [
              function (t, i, n) {
                return (
                  (!o && (n || i !== k)) ||
                  ((e = i).nodeType ? l(t, i, n) : d(t, i, n))
                );
              },
            ];
          a > s;
          s++
        )
          if ((i = _.relative[t[s].type])) p = [u(h(p), i)];
          else {
            if (((i = _.filter[t[s].type].apply(null, t[s].matches)), i[N])) {
              for (n = ++s; a > n && !_.relative[t[n].type]; n++);
              return m(
                s > 1 && h(p),
                s > 1 &&
                  c(
                    t
                      .slice(0, s - 1)
                      .concat({ value: " " === t[s - 2].type ? "*" : "" })
                  ).replace(rt, "$1"),
                i,
                n > s && g(t.slice(s, n)),
                a > n && g((t = t.slice(n))),
                a > n && c(t)
              );
            }
            p.push(i);
          }
        return h(p);
      }
      function b(t, i) {
        var a = i.length > 0,
          o = t.length > 0,
          r = function (n, r, s, l, d) {
            var p,
              c,
              u,
              h = 0,
              m = "0",
              g = n && [],
              b = [],
              v = k,
              y = n || (o && _.find.TAG("*", d)),
              w = (F += null == v ? 1 : Math.random() || 0.1),
              C = y.length;
            for (d && (k = r !== L && r); m !== C && null != (p = y[m]); m++) {
              if (o && p) {
                for (c = 0; (u = t[c++]); )
                  if (u(p, r, s)) {
                    l.push(p);
                    break;
                  }
                d && (F = w);
              }
              a && ((p = !u && p) && h--, n && g.push(p));
            }
            if (((h += m), a && m !== h)) {
              for (c = 0; (u = i[c++]); ) u(g, b, r, s);
              if (n) {
                if (h > 0) for (; m--; ) g[m] || b[m] || (b[m] = Y.call(l));
                b = f(b);
              }
              X.apply(l, b),
                d && !n && b.length > 0 && h + i.length > 1 && e.uniqueSort(l);
            }
            return d && ((F = w), (k = v)), g;
          };
        return a ? n(r) : r;
      }
      function v(t, i, n) {
        for (var a = 0, o = i.length; o > a; a++) e(t, i[a], n);
        return n;
      }
      function y(t, e, i, n) {
        var a,
          o,
          r,
          s,
          d,
          u = p(t);
        if (!n && 1 === u.length) {
          if (
            ((o = u[0] = u[0].slice(0)),
            o.length > 2 &&
              "ID" === (r = o[0]).type &&
              C.getById &&
              9 === e.nodeType &&
              D &&
              _.relative[o[1].type])
          ) {
            if (!(e = (_.find.ID(r.matches[0].replace(yt, wt), e) || [])[0]))
              return i;
            t = t.slice(o.shift().value.length);
          }
          for (
            a = ut.needsContext.test(t) ? 0 : o.length;
            a-- && ((r = o[a]), !_.relative[(s = r.type)]);

          )
            if (
              (d = _.find[s]) &&
              (n = d(
                r.matches[0].replace(yt, wt),
                (bt.test(o[0].type) && l(e.parentNode)) || e
              ))
            ) {
              if ((o.splice(a, 1), !(t = n.length && c(o))))
                return X.apply(i, n), i;
              break;
            }
        }
        return T(t, u)(n, e, !D, i, (bt.test(t) && l(e.parentNode)) || e), i;
      }
      var w,
        C,
        _,
        x,
        S,
        T,
        k,
        E,
        A,
        I,
        L,
        P,
        D,
        $,
        M,
        O,
        R,
        N = "sizzle" + -new Date(),
        B = t.document,
        F = 0,
        W = 0,
        j = i(),
        H = i(),
        z = i(),
        U = function (t, e) {
          return t === e && (A = !0), 0;
        },
        G = "undefined",
        V = 1 << 31,
        q = {}.hasOwnProperty,
        K = [],
        Y = K.pop,
        Q = K.push,
        X = K.push,
        J = K.slice,
        Z =
          K.indexOf ||
          function (t) {
            for (var e = 0, i = this.length; i > e; e++)
              if (this[e] === t) return e;
            return -1;
          },
        tt =
          "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
        et = "[\\x20\\t\\r\\n\\f]",
        it = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",
        nt = it.replace("w", "w#"),
        at =
          "\\[" +
          et +
          "*(" +
          it +
          ")" +
          et +
          "*(?:([*^$|!~]?=)" +
          et +
          "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" +
          nt +
          ")|)|)" +
          et +
          "*\\]",
        ot =
          ":(" +
          it +
          ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" +
          at.replace(3, 8) +
          ")*)|.*)\\)|)",
        rt = new RegExp(
          "^" + et + "+|((?:^|[^\\\\])(?:\\\\.)*)" + et + "+$",
          "g"
        ),
        st = new RegExp("^" + et + "*," + et + "*"),
        lt = new RegExp("^" + et + "*([>+~]|" + et + ")" + et + "*"),
        dt = new RegExp("=" + et + "*([^\\]'\"]*?)" + et + "*\\]", "g"),
        pt = new RegExp(ot),
        ct = new RegExp("^" + nt + "$"),
        ut = {
          ID: new RegExp("^#(" + it + ")"),
          CLASS: new RegExp("^\\.(" + it + ")"),
          TAG: new RegExp("^(" + it.replace("w", "w*") + ")"),
          ATTR: new RegExp("^" + at),
          PSEUDO: new RegExp("^" + ot),
          CHILD: new RegExp(
            "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" +
              et +
              "*(even|odd|(([+-]|)(\\d*)n|)" +
              et +
              "*(?:([+-]|)" +
              et +
              "*(\\d+)|))" +
              et +
              "*\\)|)",
            "i"
          ),
          bool: new RegExp("^(?:" + tt + ")$", "i"),
          needsContext: new RegExp(
            "^" +
              et +
              "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
              et +
              "*((?:-\\d)?\\d*)" +
              et +
              "*\\)|)(?=[^-]|$)",
            "i"
          ),
        },
        ht = /^(?:input|select|textarea|button)$/i,
        ft = /^h\d$/i,
        mt = /^[^{]+\{\s*\[native \w/,
        gt = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
        bt = /[+~]/,
        vt = /'|\\/g,
        yt = new RegExp("\\\\([\\da-f]{1,6}" + et + "?|(" + et + ")|.)", "ig"),
        wt = function (t, e, i) {
          var n = "0x" + e - 65536;
          return n !== n || i
            ? e
            : 0 > n
            ? String.fromCharCode(n + 65536)
            : String.fromCharCode((n >> 10) | 55296, (1023 & n) | 56320);
        };
      try {
        X.apply((K = J.call(B.childNodes)), B.childNodes),
          K[B.childNodes.length].nodeType;
      } catch (t) {
        X = {
          apply: K.length
            ? function (t, e) {
                Q.apply(t, J.call(e));
              }
            : function (t, e) {
                for (var i = t.length, n = 0; (t[i++] = e[n++]); );
                t.length = i - 1;
              },
        };
      }
      (C = e.support = {}),
        (S = e.isXML =
          function (t) {
            var e = t && (t.ownerDocument || t).documentElement;
            return !!e && "HTML" !== e.nodeName;
          }),
        (I = e.setDocument =
          function (t) {
            var e,
              i = t ? t.ownerDocument || t : B,
              n = i.defaultView;
            return i !== L && 9 === i.nodeType && i.documentElement
              ? ((L = i),
                (P = i.documentElement),
                (D = !S(i)),
                n &&
                  n !== n.top &&
                  (n.addEventListener
                    ? n.addEventListener(
                        "unload",
                        function () {
                          I();
                        },
                        !1
                      )
                    : n.attachEvent &&
                      n.attachEvent("onunload", function () {
                        I();
                      })),
                (C.attributes = a(function (t) {
                  return (t.className = "i"), !t.getAttribute("className");
                })),
                (C.getElementsByTagName = a(function (t) {
                  return (
                    t.appendChild(i.createComment("")),
                    !t.getElementsByTagName("*").length
                  );
                })),
                (C.getElementsByClassName =
                  mt.test(i.getElementsByClassName) &&
                  a(function (t) {
                    return (
                      (t.innerHTML =
                        "<div class='a'></div><div class='a i'></div>"),
                      (t.firstChild.className = "i"),
                      2 === t.getElementsByClassName("i").length
                    );
                  })),
                (C.getById = a(function (t) {
                  return (
                    (P.appendChild(t).id = N),
                    !i.getElementsByName || !i.getElementsByName(N).length
                  );
                })),
                C.getById
                  ? ((_.find.ID = function (t, e) {
                      if (typeof e.getElementById !== G && D) {
                        var i = e.getElementById(t);
                        return i && i.parentNode ? [i] : [];
                      }
                    }),
                    (_.filter.ID = function (t) {
                      var e = t.replace(yt, wt);
                      return function (t) {
                        return t.getAttribute("id") === e;
                      };
                    }))
                  : (delete _.find.ID,
                    (_.filter.ID = function (t) {
                      var e = t.replace(yt, wt);
                      return function (t) {
                        var i =
                          typeof t.getAttributeNode !== G &&
                          t.getAttributeNode("id");
                        return i && i.value === e;
                      };
                    })),
                (_.find.TAG = C.getElementsByTagName
                  ? function (t, e) {
                      return typeof e.getElementsByTagName !== G
                        ? e.getElementsByTagName(t)
                        : void 0;
                    }
                  : function (t, e) {
                      var i,
                        n = [],
                        a = 0,
                        o = e.getElementsByTagName(t);
                      if ("*" === t) {
                        for (; (i = o[a++]); ) 1 === i.nodeType && n.push(i);
                        return n;
                      }
                      return o;
                    }),
                (_.find.CLASS =
                  C.getElementsByClassName &&
                  function (t, e) {
                    return typeof e.getElementsByClassName !== G && D
                      ? e.getElementsByClassName(t)
                      : void 0;
                  }),
                (M = []),
                ($ = []),
                (C.qsa = mt.test(i.querySelectorAll)) &&
                  (a(function (t) {
                    (t.innerHTML =
                      "<select t=''><option selected=''></option></select>"),
                      t.querySelectorAll("[t^='']").length &&
                        $.push("[*^$]=" + et + "*(?:''|\"\")"),
                      t.querySelectorAll("[selected]").length ||
                        $.push("\\[" + et + "*(?:value|" + tt + ")"),
                      t.querySelectorAll(":checked").length ||
                        $.push(":checked");
                  }),
                  a(function (t) {
                    var e = i.createElement("input");
                    e.setAttribute("type", "hidden"),
                      t.appendChild(e).setAttribute("name", "D"),
                      t.querySelectorAll("[name=d]").length &&
                        $.push("name" + et + "*[*^$|!~]?="),
                      t.querySelectorAll(":enabled").length ||
                        $.push(":enabled", ":disabled"),
                      t.querySelectorAll("*,:x"),
                      $.push(",.*:");
                  })),
                (C.matchesSelector = mt.test(
                  (O =
                    P.webkitMatchesSelector ||
                    P.mozMatchesSelector ||
                    P.oMatchesSelector ||
                    P.msMatchesSelector)
                )) &&
                  a(function (t) {
                    (C.disconnectedMatch = O.call(t, "div")),
                      O.call(t, "[s!='']:x"),
                      M.push("!=", ot);
                  }),
                ($ = $.length && new RegExp($.join("|"))),
                (M = M.length && new RegExp(M.join("|"))),
                (e = mt.test(P.compareDocumentPosition)),
                (R =
                  e || mt.test(P.contains)
                    ? function (t, e) {
                        var i = 9 === t.nodeType ? t.documentElement : t,
                          n = e && e.parentNode;
                        return (
                          t === n ||
                          !(
                            !n ||
                            1 !== n.nodeType ||
                            !(i.contains
                              ? i.contains(n)
                              : t.compareDocumentPosition &&
                                16 & t.compareDocumentPosition(n))
                          )
                        );
                      }
                    : function (t, e) {
                        if (e)
                          for (; (e = e.parentNode); ) if (e === t) return !0;
                        return !1;
                      }),
                (U = e
                  ? function (t, e) {
                      if (t === e) return (A = !0), 0;
                      var n =
                        !t.compareDocumentPosition - !e.compareDocumentPosition;
                      return (
                        n ||
                        ((n =
                          (t.ownerDocument || t) === (e.ownerDocument || e)
                            ? t.compareDocumentPosition(e)
                            : 1),
                        1 & n ||
                        (!C.sortDetached && e.compareDocumentPosition(t) === n)
                          ? t === i || (t.ownerDocument === B && R(B, t))
                            ? -1
                            : e === i || (e.ownerDocument === B && R(B, e))
                            ? 1
                            : E
                            ? Z.call(E, t) - Z.call(E, e)
                            : 0
                          : 4 & n
                          ? -1
                          : 1)
                      );
                    }
                  : function (t, e) {
                      if (t === e) return (A = !0), 0;
                      var n,
                        a = 0,
                        o = t.parentNode,
                        s = e.parentNode,
                        l = [t],
                        d = [e];
                      if (!o || !s)
                        return t === i
                          ? -1
                          : e === i
                          ? 1
                          : o
                          ? -1
                          : s
                          ? 1
                          : E
                          ? Z.call(E, t) - Z.call(E, e)
                          : 0;
                      if (o === s) return r(t, e);
                      for (n = t; (n = n.parentNode); ) l.unshift(n);
                      for (n = e; (n = n.parentNode); ) d.unshift(n);
                      for (; l[a] === d[a]; ) a++;
                      return a
                        ? r(l[a], d[a])
                        : l[a] === B
                        ? -1
                        : d[a] === B
                        ? 1
                        : 0;
                    }),
                i)
              : L;
          }),
        (e.matches = function (t, i) {
          return e(t, null, null, i);
        }),
        (e.matchesSelector = function (t, i) {
          if (
            ((t.ownerDocument || t) !== L && I(t),
            (i = i.replace(dt, "='$1']")),
            !(!C.matchesSelector || !D || (M && M.test(i)) || ($ && $.test(i))))
          )
            try {
              var n = O.call(t, i);
              if (
                n ||
                C.disconnectedMatch ||
                (t.document && 11 !== t.document.nodeType)
              )
                return n;
            } catch (t) {}
          return e(i, L, null, [t]).length > 0;
        }),
        (e.contains = function (t, e) {
          return (t.ownerDocument || t) !== L && I(t), R(t, e);
        }),
        (e.attr = function (t, e) {
          (t.ownerDocument || t) !== L && I(t);
          var i = _.attrHandle[e.toLowerCase()],
            n =
              i && q.call(_.attrHandle, e.toLowerCase()) ? i(t, e, !D) : void 0;
          return void 0 !== n
            ? n
            : C.attributes || !D
            ? t.getAttribute(e)
            : (n = t.getAttributeNode(e)) && n.specified
            ? n.value
            : null;
        }),
        (e.error = function (t) {
          throw new Error("Syntax error, unrecognized expression: " + t);
        }),
        (e.uniqueSort = function (t) {
          var e,
            i = [],
            n = 0,
            a = 0;
          if (
            ((A = !C.detectDuplicates),
            (E = !C.sortStable && t.slice(0)),
            t.sort(U),
            A)
          ) {
            for (; (e = t[a++]); ) e === t[a] && (n = i.push(a));
            for (; n--; ) t.splice(i[n], 1);
          }
          return (E = null), t;
        }),
        (x = e.getText =
          function (t) {
            var e,
              i = "",
              n = 0,
              a = t.nodeType;
            if (a) {
              if (1 === a || 9 === a || 11 === a) {
                if ("string" == typeof t.textContent) return t.textContent;
                for (t = t.firstChild; t; t = t.nextSibling) i += x(t);
              } else if (3 === a || 4 === a) return t.nodeValue;
            } else for (; (e = t[n++]); ) i += x(e);
            return i;
          }),
        (_ = e.selectors =
          {
            cacheLength: 50,
            createPseudo: n,
            match: ut,
            attrHandle: {},
            find: {},
            relative: {
              ">": { dir: "parentNode", first: !0 },
              " ": { dir: "parentNode" },
              "+": { dir: "previousSibling", first: !0 },
              "~": { dir: "previousSibling" },
            },
            preFilter: {
              ATTR: function (t) {
                return (
                  (t[1] = t[1].replace(yt, wt)),
                  (t[3] = (t[4] || t[5] || "").replace(yt, wt)),
                  "~=" === t[2] && (t[3] = " " + t[3] + " "),
                  t.slice(0, 4)
                );
              },
              CHILD: function (t) {
                return (
                  (t[1] = t[1].toLowerCase()),
                  "nth" === t[1].slice(0, 3)
                    ? (t[3] || e.error(t[0]),
                      (t[4] = +(t[4]
                        ? t[5] + (t[6] || 1)
                        : 2 * ("even" === t[3] || "odd" === t[3]))),
                      (t[5] = +(t[7] + t[8] || "odd" === t[3])))
                    : t[3] && e.error(t[0]),
                  t
                );
              },
              PSEUDO: function (t) {
                var e,
                  i = !t[5] && t[2];
                return ut.CHILD.test(t[0])
                  ? null
                  : (t[3] && void 0 !== t[4]
                      ? (t[2] = t[4])
                      : i &&
                        pt.test(i) &&
                        (e = p(i, !0)) &&
                        (e = i.indexOf(")", i.length - e) - i.length) &&
                        ((t[0] = t[0].slice(0, e)), (t[2] = i.slice(0, e))),
                    t.slice(0, 3));
              },
            },
            filter: {
              TAG: function (t) {
                var e = t.replace(yt, wt).toLowerCase();
                return "*" === t
                  ? function () {
                      return !0;
                    }
                  : function (t) {
                      return t.nodeName && t.nodeName.toLowerCase() === e;
                    };
              },
              CLASS: function (t) {
                var e = j[t + " "];
                return (
                  e ||
                  ((e = new RegExp("(^|" + et + ")" + t + "(" + et + "|$)")) &&
                    j(t, function (t) {
                      return e.test(
                        ("string" == typeof t.className && t.className) ||
                          (typeof t.getAttribute !== G &&
                            t.getAttribute("class")) ||
                          ""
                      );
                    }))
                );
              },
              ATTR: function (t, i, n) {
                return function (a) {
                  var o = e.attr(a, t);
                  return null == o
                    ? "!=" === i
                    : !i ||
                        ((o += ""),
                        "=" === i
                          ? o === n
                          : "!=" === i
                          ? o !== n
                          : "^=" === i
                          ? n && 0 === o.indexOf(n)
                          : "*=" === i
                          ? n && o.indexOf(n) > -1
                          : "$=" === i
                          ? n && o.slice(-n.length) === n
                          : "~=" === i
                          ? (" " + o + " ").indexOf(n) > -1
                          : "|=" === i &&
                            (o === n || o.slice(0, n.length + 1) === n + "-"));
                };
              },
              CHILD: function (t, e, i, n, a) {
                var o = "nth" !== t.slice(0, 3),
                  r = "last" !== t.slice(-4),
                  s = "of-type" === e;
                return 1 === n && 0 === a
                  ? function (t) {
                      return !!t.parentNode;
                    }
                  : function (e, i, l) {
                      var d,
                        p,
                        c,
                        u,
                        h,
                        f,
                        m = o !== r ? "nextSibling" : "previousSibling",
                        g = e.parentNode,
                        b = s && e.nodeName.toLowerCase(),
                        v = !l && !s;
                      if (g) {
                        if (o) {
                          for (; m; ) {
                            for (c = e; (c = c[m]); )
                              if (
                                s
                                  ? c.nodeName.toLowerCase() === b
                                  : 1 === c.nodeType
                              )
                                return !1;
                            f = m = "only" === t && !f && "nextSibling";
                          }
                          return !0;
                        }
                        if (((f = [r ? g.firstChild : g.lastChild]), r && v)) {
                          for (
                            p = g[N] || (g[N] = {}),
                              d = p[t] || [],
                              h = d[0] === F && d[1],
                              u = d[0] === F && d[2],
                              c = h && g.childNodes[h];
                            (c = (++h && c && c[m]) || (u = h = 0) || f.pop());

                          )
                            if (1 === c.nodeType && ++u && c === e) {
                              p[t] = [F, h, u];
                              break;
                            }
                        } else if (
                          v &&
                          (d = (e[N] || (e[N] = {}))[t]) &&
                          d[0] === F
                        )
                          u = d[1];
                        else
                          for (
                            ;
                            (c =
                              (++h && c && c[m]) || (u = h = 0) || f.pop()) &&
                            ((s
                              ? c.nodeName.toLowerCase() !== b
                              : 1 !== c.nodeType) ||
                              !++u ||
                              (v && ((c[N] || (c[N] = {}))[t] = [F, u]),
                              c !== e));

                          );
                        return (u -= a) === n || (u % n == 0 && u / n >= 0);
                      }
                    };
              },
              PSEUDO: function (t, i) {
                var a,
                  o =
                    _.pseudos[t] ||
                    _.setFilters[t.toLowerCase()] ||
                    e.error("unsupported pseudo: " + t);
                return o[N]
                  ? o(i)
                  : o.length > 1
                  ? ((a = [t, t, "", i]),
                    _.setFilters.hasOwnProperty(t.toLowerCase())
                      ? n(function (t, e) {
                          for (var n, a = o(t, i), r = a.length; r--; )
                            (n = Z.call(t, a[r])), (t[n] = !(e[n] = a[r]));
                        })
                      : function (t) {
                          return o(t, 0, a);
                        })
                  : o;
              },
            },
            pseudos: {
              not: n(function (t) {
                var e = [],
                  i = [],
                  a = T(t.replace(rt, "$1"));
                return a[N]
                  ? n(function (t, e, i, n) {
                      for (var o, r = a(t, null, n, []), s = t.length; s--; )
                        (o = r[s]) && (t[s] = !(e[s] = o));
                    })
                  : function (t, n, o) {
                      return (e[0] = t), a(e, null, o, i), !i.pop();
                    };
              }),
              has: n(function (t) {
                return function (i) {
                  return e(t, i).length > 0;
                };
              }),
              contains: n(function (t) {
                return function (e) {
                  return (e.textContent || e.innerText || x(e)).indexOf(t) > -1;
                };
              }),
              lang: n(function (t) {
                return (
                  ct.test(t || "") || e.error("unsupported lang: " + t),
                  (t = t.replace(yt, wt).toLowerCase()),
                  function (e) {
                    var i;
                    do {
                      if (
                        (i = D
                          ? e.lang
                          : e.getAttribute("xml:lang") ||
                            e.getAttribute("lang"))
                      )
                        return (
                          (i = i.toLowerCase()) === t ||
                          0 === i.indexOf(t + "-")
                        );
                    } while ((e = e.parentNode) && 1 === e.nodeType);
                    return !1;
                  }
                );
              }),
              target: function (e) {
                var i = t.location && t.location.hash;
                return i && i.slice(1) === e.id;
              },
              root: function (t) {
                return t === P;
              },
              focus: function (t) {
                return (
                  t === L.activeElement &&
                  (!L.hasFocus || L.hasFocus()) &&
                  !!(t.type || t.href || ~t.tabIndex)
                );
              },
              enabled: function (t) {
                return !1 === t.disabled;
              },
              disabled: function (t) {
                return !0 === t.disabled;
              },
              checked: function (t) {
                var e = t.nodeName.toLowerCase();
                return (
                  ("input" === e && !!t.checked) ||
                  ("option" === e && !!t.selected)
                );
              },
              selected: function (t) {
                return (
                  t.parentNode && t.parentNode.selectedIndex, !0 === t.selected
                );
              },
              empty: function (t) {
                for (t = t.firstChild; t; t = t.nextSibling)
                  if (t.nodeType < 6) return !1;
                return !0;
              },
              parent: function (t) {
                return !_.pseudos.empty(t);
              },
              header: function (t) {
                return ft.test(t.nodeName);
              },
              input: function (t) {
                return ht.test(t.nodeName);
              },
              button: function (t) {
                var e = t.nodeName.toLowerCase();
                return ("input" === e && "button" === t.type) || "button" === e;
              },
              text: function (t) {
                var e;
                return (
                  "input" === t.nodeName.toLowerCase() &&
                  "text" === t.type &&
                  (null == (e = t.getAttribute("type")) ||
                    "text" === e.toLowerCase())
                );
              },
              first: s(function () {
                return [0];
              }),
              last: s(function (t, e) {
                return [e - 1];
              }),
              eq: s(function (t, e, i) {
                return [0 > i ? i + e : i];
              }),
              even: s(function (t, e) {
                for (var i = 0; e > i; i += 2) t.push(i);
                return t;
              }),
              odd: s(function (t, e) {
                for (var i = 1; e > i; i += 2) t.push(i);
                return t;
              }),
              lt: s(function (t, e, i) {
                for (var n = 0 > i ? i + e : i; --n >= 0; ) t.push(n);
                return t;
              }),
              gt: s(function (t, e, i) {
                for (var n = 0 > i ? i + e : i; ++n < e; ) t.push(n);
                return t;
              }),
            },
          }),
        (_.pseudos.nth = _.pseudos.eq);
      for (w in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 })
        _.pseudos[w] = (function (t) {
          return function (e) {
            return "input" === e.nodeName.toLowerCase() && e.type === t;
          };
        })(w);
      for (w in { submit: !0, reset: !0 })
        _.pseudos[w] = (function (t) {
          return function (e) {
            var i = e.nodeName.toLowerCase();
            return ("input" === i || "button" === i) && e.type === t;
          };
        })(w);
      return (
        (d.prototype = _.filters = _.pseudos),
        (_.setFilters = new d()),
        (T = e.compile =
          function (t, e) {
            var i,
              n = [],
              a = [],
              o = z[t + " "];
            if (!o) {
              for (e || (e = p(t)), i = e.length; i--; )
                (o = g(e[i])), o[N] ? n.push(o) : a.push(o);
              o = z(t, b(a, n));
            }
            return o;
          }),
        (C.sortStable = N.split("").sort(U).join("") === N),
        (C.detectDuplicates = !!A),
        I(),
        (C.sortDetached = a(function (t) {
          return 1 & t.compareDocumentPosition(L.createElement("div"));
        })),
        a(function (t) {
          return (
            (t.innerHTML = "<a href='#'></a>"),
            "#" === t.firstChild.getAttribute("href")
          );
        }) ||
          o("type|href|height|width", function (t, e, i) {
            return i
              ? void 0
              : t.getAttribute(e, "type" === e.toLowerCase() ? 1 : 2);
          }),
        (C.attributes &&
          a(function (t) {
            return (
              (t.innerHTML = "<input/>"),
              t.firstChild.setAttribute("value", ""),
              "" === t.firstChild.getAttribute("value")
            );
          })) ||
          o("value", function (t, e, i) {
            return i || "input" !== t.nodeName.toLowerCase()
              ? void 0
              : t.defaultValue;
          }),
        a(function (t) {
          return null == t.getAttribute("disabled");
        }) ||
          o(tt, function (t, e, i) {
            var n;
            return i
              ? void 0
              : !0 === t[e]
              ? e.toLowerCase()
              : (n = t.getAttributeNode(e)) && n.specified
              ? n.value
              : null;
          }),
        e
      );
    })(t);
    (ot.find = pt),
      (ot.expr = pt.selectors),
      (ot.expr[":"] = ot.expr.pseudos),
      (ot.unique = pt.uniqueSort),
      (ot.text = pt.getText),
      (ot.isXMLDoc = pt.isXML),
      (ot.contains = pt.contains);
    var ct = ot.expr.match.needsContext,
      ut = /^<(\w+)\s*\/?>(?:<\/\1>|)$/,
      ht = /^.[^:#\[\.,]*$/;
    (ot.filter = function (t, e, i) {
      var n = e[0];
      return (
        i && (t = ":not(" + t + ")"),
        1 === e.length && 1 === n.nodeType
          ? ot.find.matchesSelector(n, t)
            ? [n]
            : []
          : ot.find.matches(
              t,
              ot.grep(e, function (t) {
                return 1 === t.nodeType;
              })
            )
      );
    }),
      ot.fn.extend({
        find: function (t) {
          var e,
            i = [],
            n = this,
            a = n.length;
          if ("string" != typeof t)
            return this.pushStack(
              ot(t).filter(function () {
                for (e = 0; a > e; e++) if (ot.contains(n[e], this)) return !0;
              })
            );
          for (e = 0; a > e; e++) ot.find(t, n[e], i);
          return (
            (i = this.pushStack(a > 1 ? ot.unique(i) : i)),
            (i.selector = this.selector ? this.selector + " " + t : t),
            i
          );
        },
        filter: function (t) {
          return this.pushStack(n(this, t || [], !1));
        },
        not: function (t) {
          return this.pushStack(n(this, t || [], !0));
        },
        is: function (t) {
          return !!n(
            this,
            "string" == typeof t && ct.test(t) ? ot(t) : t || [],
            !1
          ).length;
        },
      });
    var ft,
      mt = t.document,
      gt = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;
    ((ot.fn.init = function (t, e) {
      var i, n;
      if (!t) return this;
      if ("string" == typeof t) {
        if (
          !(i =
            "<" === t.charAt(0) &&
            ">" === t.charAt(t.length - 1) &&
            t.length >= 3
              ? [null, t, null]
              : gt.exec(t)) ||
          (!i[1] && e)
        )
          return !e || e.jquery
            ? (e || ft).find(t)
            : this.constructor(e).find(t);
        if (i[1]) {
          if (
            ((e = e instanceof ot ? e[0] : e),
            ot.merge(
              this,
              ot.parseHTML(
                i[1],
                e && e.nodeType ? e.ownerDocument || e : mt,
                !0
              )
            ),
            ut.test(i[1]) && ot.isPlainObject(e))
          )
            for (i in e)
              ot.isFunction(this[i]) ? this[i](e[i]) : this.attr(i, e[i]);
          return this;
        }
        if ((n = mt.getElementById(i[2])) && n.parentNode) {
          if (n.id !== i[2]) return ft.find(t);
          (this.length = 1), (this[0] = n);
        }
        return (this.context = mt), (this.selector = t), this;
      }
      return t.nodeType
        ? ((this.context = this[0] = t), (this.length = 1), this)
        : ot.isFunction(t)
        ? void 0 !== ft.ready
          ? ft.ready(t)
          : t(ot)
        : (void 0 !== t.selector &&
            ((this.selector = t.selector), (this.context = t.context)),
          ot.makeArray(t, this));
    }).prototype = ot.fn),
      (ft = ot(mt));
    var bt = /^(?:parents|prev(?:Until|All))/,
      vt = { children: !0, contents: !0, next: !0, prev: !0 };
    ot.extend({
      dir: function (t, e, i) {
        for (
          var n = [], a = t[e];
          a &&
          9 !== a.nodeType &&
          (void 0 === i || 1 !== a.nodeType || !ot(a).is(i));

        )
          1 === a.nodeType && n.push(a), (a = a[e]);
        return n;
      },
      sibling: function (t, e) {
        for (var i = []; t; t = t.nextSibling)
          1 === t.nodeType && t !== e && i.push(t);
        return i;
      },
    }),
      ot.fn.extend({
        has: function (t) {
          var e,
            i = ot(t, this),
            n = i.length;
          return this.filter(function () {
            for (e = 0; n > e; e++) if (ot.contains(this, i[e])) return !0;
          });
        },
        closest: function (t, e) {
          for (
            var i,
              n = 0,
              a = this.length,
              o = [],
              r =
                ct.test(t) || "string" != typeof t
                  ? ot(t, e || this.context)
                  : 0;
            a > n;
            n++
          )
            for (i = this[n]; i && i !== e; i = i.parentNode)
              if (
                i.nodeType < 11 &&
                (r
                  ? r.index(i) > -1
                  : 1 === i.nodeType && ot.find.matchesSelector(i, t))
              ) {
                o.push(i);
                break;
              }
          return this.pushStack(o.length > 1 ? ot.unique(o) : o);
        },
        index: function (t) {
          return t
            ? "string" == typeof t
              ? ot.inArray(this[0], ot(t))
              : ot.inArray(t.jquery ? t[0] : t, this)
            : this[0] && this[0].parentNode
            ? this.first().prevAll().length
            : -1;
        },
        add: function (t, e) {
          return this.pushStack(ot.unique(ot.merge(this.get(), ot(t, e))));
        },
        addBack: function (t) {
          return this.add(
            null == t ? this.prevObject : this.prevObject.filter(t)
          );
        },
      }),
      ot.each(
        {
          parent: function (t) {
            var e = t.parentNode;
            return e && 11 !== e.nodeType ? e : null;
          },
          parents: function (t) {
            return ot.dir(t, "parentNode");
          },
          parentsUntil: function (t, e, i) {
            return ot.dir(t, "parentNode", i);
          },
          next: function (t) {
            return a(t, "nextSibling");
          },
          prev: function (t) {
            return a(t, "previousSibling");
          },
          nextAll: function (t) {
            return ot.dir(t, "nextSibling");
          },
          prevAll: function (t) {
            return ot.dir(t, "previousSibling");
          },
          nextUntil: function (t, e, i) {
            return ot.dir(t, "nextSibling", i);
          },
          prevUntil: function (t, e, i) {
            return ot.dir(t, "previousSibling", i);
          },
          siblings: function (t) {
            return ot.sibling((t.parentNode || {}).firstChild, t);
          },
          children: function (t) {
            return ot.sibling(t.firstChild);
          },
          contents: function (t) {
            return ot.nodeName(t, "iframe")
              ? t.contentDocument || t.contentWindow.document
              : ot.merge([], t.childNodes);
          },
        },
        function (t, e) {
          ot.fn[t] = function (i, n) {
            var a = ot.map(this, e, i);
            return (
              "Until" !== t.slice(-5) && (n = i),
              n && "string" == typeof n && (a = ot.filter(n, a)),
              this.length > 1 &&
                (vt[t] || (a = ot.unique(a)), bt.test(t) && (a = a.reverse())),
              this.pushStack(a)
            );
          };
        }
      );
    var yt = /\S+/g,
      wt = {};
    (ot.Callbacks = function (t) {
      t = "string" == typeof t ? wt[t] || o(t) : ot.extend({}, t);
      var e,
        i,
        n,
        a,
        r,
        s,
        l = [],
        d = !t.once && [],
        p = function (o) {
          for (
            i = t.memory && o, n = !0, r = s || 0, s = 0, a = l.length, e = !0;
            l && a > r;
            r++
          )
            if (!1 === l[r].apply(o[0], o[1]) && t.stopOnFalse) {
              i = !1;
              break;
            }
          (e = !1),
            l && (d ? d.length && p(d.shift()) : i ? (l = []) : c.disable());
        },
        c = {
          add: function () {
            if (l) {
              var n = l.length;
              !(function e(i) {
                ot.each(i, function (i, n) {
                  var a = ot.type(n);
                  "function" === a
                    ? (t.unique && c.has(n)) || l.push(n)
                    : n && n.length && "string" !== a && e(n);
                });
              })(arguments),
                e ? (a = l.length) : i && ((s = n), p(i));
            }
            return this;
          },
          remove: function () {
            return (
              l &&
                ot.each(arguments, function (t, i) {
                  for (var n; (n = ot.inArray(i, l, n)) > -1; )
                    l.splice(n, 1), e && (a >= n && a--, r >= n && r--);
                }),
              this
            );
          },
          has: function (t) {
            return t ? ot.inArray(t, l) > -1 : !(!l || !l.length);
          },
          empty: function () {
            return (l = []), (a = 0), this;
          },
          disable: function () {
            return (l = d = i = void 0), this;
          },
          disabled: function () {
            return !l;
          },
          lock: function () {
            return (d = void 0), i || c.disable(), this;
          },
          locked: function () {
            return !d;
          },
          fireWith: function (t, i) {
            return (
              !l ||
                (n && !d) ||
                ((i = i || []),
                (i = [t, i.slice ? i.slice() : i]),
                e ? d.push(i) : p(i)),
              this
            );
          },
          fire: function () {
            return c.fireWith(this, arguments), this;
          },
          fired: function () {
            return !!n;
          },
        };
      return c;
    }),
      ot.extend({
        Deferred: function (t) {
          var e = [
              ["resolve", "done", ot.Callbacks("once memory"), "resolved"],
              ["reject", "fail", ot.Callbacks("once memory"), "rejected"],
              ["notify", "progress", ot.Callbacks("memory")],
            ],
            i = "pending",
            n = {
              state: function () {
                return i;
              },
              always: function () {
                return a.done(arguments).fail(arguments), this;
              },
              then: function () {
                var t = arguments;
                return ot
                  .Deferred(function (i) {
                    ot.each(e, function (e, o) {
                      var r = ot.isFunction(t[e]) && t[e];
                      a[o[1]](function () {
                        var t = r && r.apply(this, arguments);
                        t && ot.isFunction(t.promise)
                          ? t
                              .promise()
                              .done(i.resolve)
                              .fail(i.reject)
                              .progress(i.notify)
                          : i[o[0] + "With"](
                              this === n ? i.promise() : this,
                              r ? [t] : arguments
                            );
                      });
                    }),
                      (t = null);
                  })
                  .promise();
              },
              promise: function (t) {
                return null != t ? ot.extend(t, n) : n;
              },
            },
            a = {};
          return (
            (n.pipe = n.then),
            ot.each(e, function (t, o) {
              var r = o[2],
                s = o[3];
              (n[o[1]] = r.add),
                s &&
                  r.add(
                    function () {
                      i = s;
                    },
                    e[1 ^ t][2].disable,
                    e[2][2].lock
                  ),
                (a[o[0]] = function () {
                  return (
                    a[o[0] + "With"](this === a ? n : this, arguments), this
                  );
                }),
                (a[o[0] + "With"] = r.fireWith);
            }),
            n.promise(a),
            t && t.call(a, a),
            a
          );
        },
        when: function (t) {
          var e,
            i,
            n,
            a = 0,
            o = Y.call(arguments),
            r = o.length,
            s = 1 !== r || (t && ot.isFunction(t.promise)) ? r : 0,
            l = 1 === s ? t : ot.Deferred(),
            d = function (t, i, n) {
              return function (a) {
                (i[t] = this),
                  (n[t] = arguments.length > 1 ? Y.call(arguments) : a),
                  n === e ? l.notifyWith(i, n) : --s || l.resolveWith(i, n);
              };
            };
          if (r > 1)
            for (
              e = new Array(r), i = new Array(r), n = new Array(r);
              r > a;
              a++
            )
              o[a] && ot.isFunction(o[a].promise)
                ? o[a]
                    .promise()
                    .done(d(a, n, o))
                    .fail(l.reject)
                    .progress(d(a, i, e))
                : --s;
          return s || l.resolveWith(n, o), l.promise();
        },
      });
    var Ct;
    (ot.fn.ready = function (t) {
      return ot.ready.promise().done(t), this;
    }),
      ot.extend({
        isReady: !1,
        readyWait: 1,
        holdReady: function (t) {
          t ? ot.readyWait++ : ot.ready(!0);
        },
        ready: function (t) {
          if (!0 === t ? !--ot.readyWait : !ot.isReady) {
            if (!mt.body) return setTimeout(ot.ready);
            (ot.isReady = !0),
              (!0 !== t && --ot.readyWait > 0) ||
                (Ct.resolveWith(mt, [ot]),
                ot.fn.trigger && ot(mt).trigger("ready").off("ready"));
          }
        },
      }),
      (ot.ready.promise = function (e) {
        if (!Ct)
          if (((Ct = ot.Deferred()), "complete" === mt.readyState))
            setTimeout(ot.ready);
          else if (mt.addEventListener)
            mt.addEventListener("DOMContentLoaded", s, !1),
              t.addEventListener("load", s, !1);
          else {
            mt.attachEvent("onreadystatechange", s), t.attachEvent("onload", s);
            var i = !1;
            try {
              i = null == t.frameElement && mt.documentElement;
            } catch (t) {}
            i &&
              i.doScroll &&
              (function t() {
                if (!ot.isReady) {
                  try {
                    i.doScroll("left");
                  } catch (e) {
                    return setTimeout(t, 50);
                  }
                  r(), ot.ready();
                }
              })();
          }
        return Ct.promise(e);
      });
    var _t,
      xt = "undefined";
    for (_t in ot(nt)) break;
    (nt.ownLast = "0" !== _t),
      (nt.inlineBlockNeedsLayout = !1),
      ot(function () {
        var t,
          e,
          i = mt.getElementsByTagName("body")[0];
        i &&
          ((t = mt.createElement("div")),
          (t.style.cssText =
            "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px"),
          (e = mt.createElement("div")),
          i.appendChild(t).appendChild(e),
          typeof e.style.zoom !== xt &&
            ((e.style.cssText =
              "border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1"),
            (nt.inlineBlockNeedsLayout = 3 === e.offsetWidth) &&
              (i.style.zoom = 1)),
          i.removeChild(t),
          (t = e = null));
      }),
      (function () {
        var t = mt.createElement("div");
        if (null == nt.deleteExpando) {
          nt.deleteExpando = !0;
          try {
            delete t.test;
          } catch (t) {
            nt.deleteExpando = !1;
          }
        }
        t = null;
      })(),
      (ot.acceptData = function (t) {
        var e = ot.noData[(t.nodeName + " ").toLowerCase()],
          i = +t.nodeType || 1;
        return (
          (1 === i || 9 === i) &&
          (!e || (!0 !== e && t.getAttribute("classid") === e))
        );
      });
    var St = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
      Tt = /([A-Z])/g;
    ot.extend({
      cache: {},
      noData: {
        "applet ": !0,
        "embed ": !0,
        "object ": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",
      },
      hasData: function (t) {
        return (
          !!(t = t.nodeType ? ot.cache[t[ot.expando]] : t[ot.expando]) && !d(t)
        );
      },
      data: function (t, e, i) {
        return p(t, e, i);
      },
      removeData: function (t, e) {
        return c(t, e);
      },
      _data: function (t, e, i) {
        return p(t, e, i, !0);
      },
      _removeData: function (t, e) {
        return c(t, e, !0);
      },
    }),
      ot.fn.extend({
        data: function (t, e) {
          var i,
            n,
            a,
            o = this[0],
            r = o && o.attributes;
          if (void 0 === t) {
            if (
              this.length &&
              ((a = ot.data(o)),
              1 === o.nodeType && !ot._data(o, "parsedAttrs"))
            ) {
              for (i = r.length; i--; )
                (n = r[i].name),
                  0 === n.indexOf("data-") &&
                    ((n = ot.camelCase(n.slice(5))), l(o, n, a[n]));
              ot._data(o, "parsedAttrs", !0);
            }
            return a;
          }
          return "object" == typeof t
            ? this.each(function () {
                ot.data(this, t);
              })
            : arguments.length > 1
            ? this.each(function () {
                ot.data(this, t, e);
              })
            : o
            ? l(o, t, ot.data(o, t))
            : void 0;
        },
        removeData: function (t) {
          return this.each(function () {
            ot.removeData(this, t);
          });
        },
      }),
      ot.extend({
        queue: function (t, e, i) {
          var n;
          return t
            ? ((e = (e || "fx") + "queue"),
              (n = ot._data(t, e)),
              i &&
                (!n || ot.isArray(i)
                  ? (n = ot._data(t, e, ot.makeArray(i)))
                  : n.push(i)),
              n || [])
            : void 0;
        },
        dequeue: function (t, e) {
          e = e || "fx";
          var i = ot.queue(t, e),
            n = i.length,
            a = i.shift(),
            o = ot._queueHooks(t, e),
            r = function () {
              ot.dequeue(t, e);
            };
          "inprogress" === a && ((a = i.shift()), n--),
            a &&
              ("fx" === e && i.unshift("inprogress"),
              delete o.stop,
              a.call(t, r, o)),
            !n && o && o.empty.fire();
        },
        _queueHooks: function (t, e) {
          var i = e + "queueHooks";
          return (
            ot._data(t, i) ||
            ot._data(t, i, {
              empty: ot.Callbacks("once memory").add(function () {
                ot._removeData(t, e + "queue"), ot._removeData(t, i);
              }),
            })
          );
        },
      }),
      ot.fn.extend({
        queue: function (t, e) {
          var i = 2;
          return (
            "string" != typeof t && ((e = t), (t = "fx"), i--),
            arguments.length < i
              ? ot.queue(this[0], t)
              : void 0 === e
              ? this
              : this.each(function () {
                  var i = ot.queue(this, t, e);
                  ot._queueHooks(this, t),
                    "fx" === t && "inprogress" !== i[0] && ot.dequeue(this, t);
                })
          );
        },
        dequeue: function (t) {
          return this.each(function () {
            ot.dequeue(this, t);
          });
        },
        clearQueue: function (t) {
          return this.queue(t || "fx", []);
        },
        promise: function (t, e) {
          var i,
            n = 1,
            a = ot.Deferred(),
            o = this,
            r = this.length,
            s = function () {
              --n || a.resolveWith(o, [o]);
            };
          for (
            "string" != typeof t && ((e = t), (t = void 0)), t = t || "fx";
            r--;

          )
            (i = ot._data(o[r], t + "queueHooks")) &&
              i.empty &&
              (n++, i.empty.add(s));
          return s(), a.promise(e);
        },
      });
    var kt = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,
      Et = ["Top", "Right", "Bottom", "Left"],
      At = function (t, e) {
        return (
          (t = e || t),
          "none" === ot.css(t, "display") || !ot.contains(t.ownerDocument, t)
        );
      },
      It = (ot.access = function (t, e, i, n, a, o, r) {
        var s = 0,
          l = t.length,
          d = null == i;
        if ("object" === ot.type(i)) {
          a = !0;
          for (s in i) ot.access(t, e, s, i[s], !0, o, r);
        } else if (
          void 0 !== n &&
          ((a = !0),
          ot.isFunction(n) || (r = !0),
          d &&
            (r
              ? (e.call(t, n), (e = null))
              : ((d = e),
                (e = function (t, e, i) {
                  return d.call(ot(t), i);
                }))),
          e)
        )
          for (; l > s; s++) e(t[s], i, r ? n : n.call(t[s], s, e(t[s], i)));
        return a ? t : d ? e.call(t) : l ? e(t[0], i) : o;
      }),
      Lt = /^(?:checkbox|radio)$/i;
    !(function () {
      var t = mt.createDocumentFragment(),
        e = mt.createElement("div"),
        i = mt.createElement("input");
      if (
        (e.setAttribute("className", "t"),
        (e.innerHTML = "  <link/><table></table><a href='/a'>a</a>"),
        (nt.leadingWhitespace = 3 === e.firstChild.nodeType),
        (nt.tbody = !e.getElementsByTagName("tbody").length),
        (nt.htmlSerialize = !!e.getElementsByTagName("link").length),
        (nt.html5Clone =
          "<:nav></:nav>" !== mt.createElement("nav").cloneNode(!0).outerHTML),
        (i.type = "checkbox"),
        (i.checked = !0),
        t.appendChild(i),
        (nt.appendChecked = i.checked),
        (e.innerHTML = "<textarea>x</textarea>"),
        (nt.noCloneChecked = !!e.cloneNode(!0).lastChild.defaultValue),
        t.appendChild(e),
        (e.innerHTML = "<input type='radio' checked='checked' name='t'/>"),
        (nt.checkClone = e.cloneNode(!0).cloneNode(!0).lastChild.checked),
        (nt.noCloneEvent = !0),
        e.attachEvent &&
          (e.attachEvent("onclick", function () {
            nt.noCloneEvent = !1;
          }),
          e.cloneNode(!0).click()),
        null == nt.deleteExpando)
      ) {
        nt.deleteExpando = !0;
        try {
          delete e.test;
        } catch (t) {
          nt.deleteExpando = !1;
        }
      }
      t = e = i = null;
    })(),
      (function () {
        var e,
          i,
          n = mt.createElement("div");
        for (e in { submit: !0, change: !0, focusin: !0 })
          (i = "on" + e),
            (nt[e + "Bubbles"] = i in t) ||
              (n.setAttribute(i, "t"),
              (nt[e + "Bubbles"] = !1 === n.attributes[i].expando));
        n = null;
      })();
    var Pt = /^(?:input|select|textarea)$/i,
      Dt = /^key/,
      $t = /^(?:mouse|contextmenu)|click/,
      Mt = /^(?:focusinfocus|focusoutblur)$/,
      Ot = /^([^.]*)(?:\.(.+)|)$/;
    (ot.event = {
      global: {},
      add: function (t, e, i, n, a) {
        var o,
          r,
          s,
          l,
          d,
          p,
          c,
          u,
          h,
          f,
          m,
          g = ot._data(t);
        if (g) {
          for (
            i.handler && ((l = i), (i = l.handler), (a = l.selector)),
              i.guid || (i.guid = ot.guid++),
              (r = g.events) || (r = g.events = {}),
              (p = g.handle) ||
                ((p = g.handle =
                  function (t) {
                    return typeof ot === xt ||
                      (t && ot.event.triggered === t.type)
                      ? void 0
                      : ot.event.dispatch.apply(p.elem, arguments);
                  }),
                (p.elem = t)),
              e = (e || "").match(yt) || [""],
              s = e.length;
            s--;

          )
            (o = Ot.exec(e[s]) || []),
              (h = m = o[1]),
              (f = (o[2] || "").split(".").sort()),
              h &&
                ((d = ot.event.special[h] || {}),
                (h = (a ? d.delegateType : d.bindType) || h),
                (d = ot.event.special[h] || {}),
                (c = ot.extend(
                  {
                    type: h,
                    origType: m,
                    data: n,
                    handler: i,
                    guid: i.guid,
                    selector: a,
                    needsContext: a && ot.expr.match.needsContext.test(a),
                    namespace: f.join("."),
                  },
                  l
                )),
                (u = r[h]) ||
                  ((u = r[h] = []),
                  (u.delegateCount = 0),
                  (d.setup && !1 !== d.setup.call(t, n, f, p)) ||
                    (t.addEventListener
                      ? t.addEventListener(h, p, !1)
                      : t.attachEvent && t.attachEvent("on" + h, p))),
                d.add &&
                  (d.add.call(t, c),
                  c.handler.guid || (c.handler.guid = i.guid)),
                a ? u.splice(u.delegateCount++, 0, c) : u.push(c),
                (ot.event.global[h] = !0));
          t = null;
        }
      },
      remove: function (t, e, i, n, a) {
        var o,
          r,
          s,
          l,
          d,
          p,
          c,
          u,
          h,
          f,
          m,
          g = ot.hasData(t) && ot._data(t);
        if (g && (p = g.events)) {
          for (e = (e || "").match(yt) || [""], d = e.length; d--; )
            if (
              ((s = Ot.exec(e[d]) || []),
              (h = m = s[1]),
              (f = (s[2] || "").split(".").sort()),
              h)
            ) {
              for (
                c = ot.event.special[h] || {},
                  h = (n ? c.delegateType : c.bindType) || h,
                  u = p[h] || [],
                  s =
                    s[2] &&
                    new RegExp("(^|\\.)" + f.join("\\.(?:.*\\.|)") + "(\\.|$)"),
                  l = o = u.length;
                o--;

              )
                (r = u[o]),
                  (!a && m !== r.origType) ||
                    (i && i.guid !== r.guid) ||
                    (s && !s.test(r.namespace)) ||
                    (n && n !== r.selector && ("**" !== n || !r.selector)) ||
                    (u.splice(o, 1),
                    r.selector && u.delegateCount--,
                    c.remove && c.remove.call(t, r));
              l &&
                !u.length &&
                ((c.teardown && !1 !== c.teardown.call(t, f, g.handle)) ||
                  ot.removeEvent(t, h, g.handle),
                delete p[h]);
            } else for (h in p) ot.event.remove(t, h + e[d], i, n, !0);
          ot.isEmptyObject(p) && (delete g.handle, ot._removeData(t, "events"));
        }
      },
      trigger: function (e, i, n, a) {
        var o,
          r,
          s,
          l,
          d,
          p,
          c,
          u = [n || mt],
          h = et.call(e, "type") ? e.type : e,
          f = et.call(e, "namespace") ? e.namespace.split(".") : [];
        if (
          ((s = p = n = n || mt),
          3 !== n.nodeType &&
            8 !== n.nodeType &&
            !Mt.test(h + ot.event.triggered) &&
            (h.indexOf(".") >= 0 &&
              ((f = h.split(".")), (h = f.shift()), f.sort()),
            (r = h.indexOf(":") < 0 && "on" + h),
            (e = e[ot.expando]
              ? e
              : new ot.Event(h, "object" == typeof e && e)),
            (e.isTrigger = a ? 2 : 3),
            (e.namespace = f.join(".")),
            (e.namespace_re = e.namespace
              ? new RegExp("(^|\\.)" + f.join("\\.(?:.*\\.|)") + "(\\.|$)")
              : null),
            (e.result = void 0),
            e.target || (e.target = n),
            (i = null == i ? [e] : ot.makeArray(i, [e])),
            (d = ot.event.special[h] || {}),
            a || !d.trigger || !1 !== d.trigger.apply(n, i)))
        ) {
          if (!a && !d.noBubble && !ot.isWindow(n)) {
            for (
              l = d.delegateType || h, Mt.test(l + h) || (s = s.parentNode);
              s;
              s = s.parentNode
            )
              u.push(s), (p = s);
            p === (n.ownerDocument || mt) &&
              u.push(p.defaultView || p.parentWindow || t);
          }
          for (c = 0; (s = u[c++]) && !e.isPropagationStopped(); )
            (e.type = c > 1 ? l : d.bindType || h),
              (o =
                (ot._data(s, "events") || {})[e.type] && ot._data(s, "handle")),
              o && o.apply(s, i),
              (o = r && s[r]) &&
                o.apply &&
                ot.acceptData(s) &&
                ((e.result = o.apply(s, i)),
                !1 === e.result && e.preventDefault());
          if (
            ((e.type = h),
            !a &&
              !e.isDefaultPrevented() &&
              (!d._default || !1 === d._default.apply(u.pop(), i)) &&
              ot.acceptData(n) &&
              r &&
              n[h] &&
              !ot.isWindow(n))
          ) {
            (p = n[r]), p && (n[r] = null), (ot.event.triggered = h);
            try {
              n[h]();
            } catch (t) {}
            (ot.event.triggered = void 0), p && (n[r] = p);
          }
          return e.result;
        }
      },
      dispatch: function (t) {
        t = ot.event.fix(t);
        var e,
          i,
          n,
          a,
          o,
          r = [],
          s = Y.call(arguments),
          l = (ot._data(this, "events") || {})[t.type] || [],
          d = ot.event.special[t.type] || {};
        if (
          ((s[0] = t),
          (t.delegateTarget = this),
          !d.preDispatch || !1 !== d.preDispatch.call(this, t))
        ) {
          for (
            r = ot.event.handlers.call(this, t, l), e = 0;
            (a = r[e++]) && !t.isPropagationStopped();

          )
            for (
              t.currentTarget = a.elem, o = 0;
              (n = a.handlers[o++]) && !t.isImmediatePropagationStopped();

            )
              (!t.namespace_re || t.namespace_re.test(n.namespace)) &&
                ((t.handleObj = n),
                (t.data = n.data),
                void 0 !==
                  (i = (
                    (ot.event.special[n.origType] || {}).handle || n.handler
                  ).apply(a.elem, s)) &&
                  !1 === (t.result = i) &&
                  (t.preventDefault(), t.stopPropagation()));
          return d.postDispatch && d.postDispatch.call(this, t), t.result;
        }
      },
      handlers: function (t, e) {
        var i,
          n,
          a,
          o,
          r = [],
          s = e.delegateCount,
          l = t.target;
        if (s && l.nodeType && (!t.button || "click" !== t.type))
          for (; l != this; l = l.parentNode || this)
            if (1 === l.nodeType && (!0 !== l.disabled || "click" !== t.type)) {
              for (a = [], o = 0; s > o; o++)
                (n = e[o]),
                  (i = n.selector + " "),
                  void 0 === a[i] &&
                    (a[i] = n.needsContext
                      ? ot(i, this).index(l) >= 0
                      : ot.find(i, this, null, [l]).length),
                  a[i] && a.push(n);
              a.length && r.push({ elem: l, handlers: a });
            }
        return s < e.length && r.push({ elem: this, handlers: e.slice(s) }), r;
      },
      fix: function (t) {
        if (t[ot.expando]) return t;
        var e,
          i,
          n,
          a = t.type,
          o = t,
          r = this.fixHooks[a];
        for (
          r ||
            (this.fixHooks[a] = r =
              $t.test(a) ? this.mouseHooks : Dt.test(a) ? this.keyHooks : {}),
            n = r.props ? this.props.concat(r.props) : this.props,
            t = new ot.Event(o),
            e = n.length;
          e--;

        )
          (i = n[e]), (t[i] = o[i]);
        return (
          t.target || (t.target = o.srcElement || mt),
          3 === t.target.nodeType && (t.target = t.target.parentNode),
          (t.metaKey = !!t.metaKey),
          r.filter ? r.filter(t, o) : t
        );
      },
      props:
        "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(
          " "
        ),
      fixHooks: {},
      keyHooks: {
        props: "char charCode key keyCode".split(" "),
        filter: function (t, e) {
          return (
            null == t.which &&
              (t.which = null != e.charCode ? e.charCode : e.keyCode),
            t
          );
        },
      },
      mouseHooks: {
        props:
          "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(
            " "
          ),
        filter: function (t, e) {
          var i,
            n,
            a,
            o = e.button,
            r = e.fromElement;
          return (
            null == t.pageX &&
              null != e.clientX &&
              ((n = t.target.ownerDocument || mt),
              (a = n.documentElement),
              (i = n.body),
              (t.pageX =
                e.clientX +
                ((a && a.scrollLeft) || (i && i.scrollLeft) || 0) -
                ((a && a.clientLeft) || (i && i.clientLeft) || 0)),
              (t.pageY =
                e.clientY +
                ((a && a.scrollTop) || (i && i.scrollTop) || 0) -
                ((a && a.clientTop) || (i && i.clientTop) || 0))),
            !t.relatedTarget &&
              r &&
              (t.relatedTarget = r === t.target ? e.toElement : r),
            t.which ||
              void 0 === o ||
              (t.which = 1 & o ? 1 : 2 & o ? 3 : 4 & o ? 2 : 0),
            t
          );
        },
      },
      special: {
        load: { noBubble: !0 },
        focus: {
          trigger: function () {
            if (this !== f() && this.focus)
              try {
                return this.focus(), !1;
              } catch (t) {}
          },
          delegateType: "focusin",
        },
        blur: {
          trigger: function () {
            return this === f() && this.blur ? (this.blur(), !1) : void 0;
          },
          delegateType: "focusout",
        },
        click: {
          trigger: function () {
            return ot.nodeName(this, "input") &&
              "checkbox" === this.type &&
              this.click
              ? (this.click(), !1)
              : void 0;
          },
          _default: function (t) {
            return ot.nodeName(t.target, "a");
          },
        },
        beforeunload: {
          postDispatch: function (t) {
            void 0 !== t.result && (t.originalEvent.returnValue = t.result);
          },
        },
      },
      simulate: function (t, e, i, n) {
        var a = ot.extend(new ot.Event(), i, {
          type: t,
          isSimulated: !0,
          originalEvent: {},
        });
        n ? ot.event.trigger(a, null, e) : ot.event.dispatch.call(e, a),
          a.isDefaultPrevented() && i.preventDefault();
      },
    }),
      (ot.removeEvent = mt.removeEventListener
        ? function (t, e, i) {
            t.removeEventListener && t.removeEventListener(e, i, !1);
          }
        : function (t, e, i) {
            var n = "on" + e;
            t.detachEvent &&
              (typeof t[n] === xt && (t[n] = null), t.detachEvent(n, i));
          }),
      (ot.Event = function (t, e) {
        return this instanceof ot.Event
          ? (t && t.type
              ? ((this.originalEvent = t),
                (this.type = t.type),
                (this.isDefaultPrevented =
                  t.defaultPrevented ||
                  (void 0 === t.defaultPrevented &&
                    (!1 === t.returnValue ||
                      (t.getPreventDefault && t.getPreventDefault())))
                    ? u
                    : h))
              : (this.type = t),
            e && ot.extend(this, e),
            (this.timeStamp = (t && t.timeStamp) || ot.now()),
            void (this[ot.expando] = !0))
          : new ot.Event(t, e);
      }),
      (ot.Event.prototype = {
        isDefaultPrevented: h,
        isPropagationStopped: h,
        isImmediatePropagationStopped: h,
        preventDefault: function () {
          var t = this.originalEvent;
          (this.isDefaultPrevented = u),
            t && (t.preventDefault ? t.preventDefault() : (t.returnValue = !1));
        },
        stopPropagation: function () {
          var t = this.originalEvent;
          (this.isPropagationStopped = u),
            t &&
              (t.stopPropagation && t.stopPropagation(), (t.cancelBubble = !0));
        },
        stopImmediatePropagation: function () {
          (this.isImmediatePropagationStopped = u), this.stopPropagation();
        },
      }),
      ot.each(
        { mouseenter: "mouseover", mouseleave: "mouseout" },
        function (t, e) {
          ot.event.special[t] = {
            delegateType: e,
            bindType: e,
            handle: function (t) {
              var i,
                n = this,
                a = t.relatedTarget,
                o = t.handleObj;
              return (
                (!a || (a !== n && !ot.contains(n, a))) &&
                  ((t.type = o.origType),
                  (i = o.handler.apply(this, arguments)),
                  (t.type = e)),
                i
              );
            },
          };
        }
      ),
      nt.submitBubbles ||
        (ot.event.special.submit = {
          setup: function () {
            return (
              !ot.nodeName(this, "form") &&
              void ot.event.add(
                this,
                "click._submit keypress._submit",
                function (t) {
                  var e = t.target,
                    i =
                      ot.nodeName(e, "input") || ot.nodeName(e, "button")
                        ? e.form
                        : void 0;
                  i &&
                    !ot._data(i, "submitBubbles") &&
                    (ot.event.add(i, "submit._submit", function (t) {
                      t._submit_bubble = !0;
                    }),
                    ot._data(i, "submitBubbles", !0));
                }
              )
            );
          },
          postDispatch: function (t) {
            t._submit_bubble &&
              (delete t._submit_bubble,
              this.parentNode &&
                !t.isTrigger &&
                ot.event.simulate("submit", this.parentNode, t, !0));
          },
          teardown: function () {
            return (
              !ot.nodeName(this, "form") &&
              void ot.event.remove(this, "._submit")
            );
          },
        }),
      nt.changeBubbles ||
        (ot.event.special.change = {
          setup: function () {
            return Pt.test(this.nodeName)
              ? (("checkbox" === this.type || "radio" === this.type) &&
                  (ot.event.add(this, "propertychange._change", function (t) {
                    "checked" === t.originalEvent.propertyName &&
                      (this._just_changed = !0);
                  }),
                  ot.event.add(this, "click._change", function (t) {
                    this._just_changed &&
                      !t.isTrigger &&
                      (this._just_changed = !1),
                      ot.event.simulate("change", this, t, !0);
                  })),
                !1)
              : void ot.event.add(this, "beforeactivate._change", function (t) {
                  var e = t.target;
                  Pt.test(e.nodeName) &&
                    !ot._data(e, "changeBubbles") &&
                    (ot.event.add(e, "change._change", function (t) {
                      !this.parentNode ||
                        t.isSimulated ||
                        t.isTrigger ||
                        ot.event.simulate("change", this.parentNode, t, !0);
                    }),
                    ot._data(e, "changeBubbles", !0));
                });
          },
          handle: function (t) {
            var e = t.target;
            return this !== e ||
              t.isSimulated ||
              t.isTrigger ||
              ("radio" !== e.type && "checkbox" !== e.type)
              ? t.handleObj.handler.apply(this, arguments)
              : void 0;
          },
          teardown: function () {
            return ot.event.remove(this, "._change"), !Pt.test(this.nodeName);
          },
        }),
      nt.focusinBubbles ||
        ot.each({ focus: "focusin", blur: "focusout" }, function (t, e) {
          var i = function (t) {
            ot.event.simulate(e, t.target, ot.event.fix(t), !0);
          };
          ot.event.special[e] = {
            setup: function () {
              var n = this.ownerDocument || this,
                a = ot._data(n, e);
              a || n.addEventListener(t, i, !0), ot._data(n, e, (a || 0) + 1);
            },
            teardown: function () {
              var n = this.ownerDocument || this,
                a = ot._data(n, e) - 1;
              a
                ? ot._data(n, e, a)
                : (n.removeEventListener(t, i, !0), ot._removeData(n, e));
            },
          };
        }),
      ot.fn.extend({
        on: function (t, e, i, n, a) {
          var o, r;
          if ("object" == typeof t) {
            "string" != typeof e && ((i = i || e), (e = void 0));
            for (o in t) this.on(o, e, i, t[o], a);
            return this;
          }
          if (
            (null == i && null == n
              ? ((n = e), (i = e = void 0))
              : null == n &&
                ("string" == typeof e
                  ? ((n = i), (i = void 0))
                  : ((n = i), (i = e), (e = void 0))),
            !1 === n)
          )
            n = h;
          else if (!n) return this;
          return (
            1 === a &&
              ((r = n),
              (n = function (t) {
                return ot().off(t), r.apply(this, arguments);
              }),
              (n.guid = r.guid || (r.guid = ot.guid++))),
            this.each(function () {
              ot.event.add(this, t, n, i, e);
            })
          );
        },
        one: function (t, e, i, n) {
          return this.on(t, e, i, n, 1);
        },
        off: function (t, e, i) {
          var n, a;
          if (t && t.preventDefault && t.handleObj)
            return (
              (n = t.handleObj),
              ot(t.delegateTarget).off(
                n.namespace ? n.origType + "." + n.namespace : n.origType,
                n.selector,
                n.handler
              ),
              this
            );
          if ("object" == typeof t) {
            for (a in t) this.off(a, e, t[a]);
            return this;
          }
          return (
            (!1 === e || "function" == typeof e) && ((i = e), (e = void 0)),
            !1 === i && (i = h),
            this.each(function () {
              ot.event.remove(this, t, i, e);
            })
          );
        },
        trigger: function (t, e) {
          return this.each(function () {
            ot.event.trigger(t, e, this);
          });
        },
        triggerHandler: function (t, e) {
          var i = this[0];
          return i ? ot.event.trigger(t, e, i, !0) : void 0;
        },
      });
    var Rt =
        "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
      Nt = / jQuery\d+="(?:null|\d+)"/g,
      Bt = new RegExp("<(?:" + Rt + ")[\\s/>]", "i"),
      Ft = /^\s+/,
      Wt =
        /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
      jt = /<([\w:]+)/,
      Ht = /<tbody/i,
      zt = /<|&#?\w+;/,
      Ut = /<(?:script|style|link)/i,
      Gt = /checked\s*(?:[^=]|=\s*.checked.)/i,
      Vt = /^$|\/(?:java|ecma)script/i,
      qt = /^true\/(.*)/,
      Kt = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,
      Yt = {
        option: [1, "<select multiple='multiple'>", "</select>"],
        legend: [1, "<fieldset>", "</fieldset>"],
        area: [1, "<map>", "</map>"],
        param: [1, "<object>", "</object>"],
        thead: [1, "<table>", "</table>"],
        tr: [2, "<table><tbody>", "</tbody></table>"],
        col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"],
        td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
        _default: nt.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"],
      },
      Qt = m(mt),
      Xt = Qt.appendChild(mt.createElement("div"));
    (Yt.optgroup = Yt.option),
      (Yt.tbody = Yt.tfoot = Yt.colgroup = Yt.caption = Yt.thead),
      (Yt.th = Yt.td),
      ot.extend({
        clone: function (t, e, i) {
          var n,
            a,
            o,
            r,
            s,
            l = ot.contains(t.ownerDocument, t);
          if (
            (nt.html5Clone || ot.isXMLDoc(t) || !Bt.test("<" + t.nodeName + ">")
              ? (o = t.cloneNode(!0))
              : ((Xt.innerHTML = t.outerHTML),
                Xt.removeChild((o = Xt.firstChild))),
            !(
              (nt.noCloneEvent && nt.noCloneChecked) ||
              (1 !== t.nodeType && 11 !== t.nodeType) ||
              ot.isXMLDoc(t)
            ))
          )
            for (n = g(o), s = g(t), r = 0; null != (a = s[r]); ++r)
              n[r] && x(a, n[r]);
          if (e)
            if (i)
              for (s = s || g(t), n = n || g(o), r = 0; null != (a = s[r]); r++)
                _(a, n[r]);
            else _(t, o);
          return (
            (n = g(o, "script")),
            n.length > 0 && C(n, !l && g(t, "script")),
            (n = s = a = null),
            o
          );
        },
        buildFragment: function (t, e, i, n) {
          for (
            var a, o, r, s, l, d, p, c = t.length, u = m(e), h = [], f = 0;
            c > f;
            f++
          )
            if ((o = t[f]) || 0 === o)
              if ("object" === ot.type(o)) ot.merge(h, o.nodeType ? [o] : o);
              else if (zt.test(o)) {
                for (
                  s = s || u.appendChild(e.createElement("div")),
                    l = (jt.exec(o) || ["", ""])[1].toLowerCase(),
                    p = Yt[l] || Yt._default,
                    s.innerHTML = p[1] + o.replace(Wt, "<$1></$2>") + p[2],
                    a = p[0];
                  a--;

                )
                  s = s.lastChild;
                if (
                  (!nt.leadingWhitespace &&
                    Ft.test(o) &&
                    h.push(e.createTextNode(Ft.exec(o)[0])),
                  !nt.tbody)
                )
                  for (
                    o =
                      "table" !== l || Ht.test(o)
                        ? "<table>" !== p[1] || Ht.test(o)
                          ? 0
                          : s
                        : s.firstChild,
                      a = o && o.childNodes.length;
                    a--;

                  )
                    ot.nodeName((d = o.childNodes[a]), "tbody") &&
                      !d.childNodes.length &&
                      o.removeChild(d);
                for (
                  ot.merge(h, s.childNodes), s.textContent = "";
                  s.firstChild;

                )
                  s.removeChild(s.firstChild);
                s = u.lastChild;
              } else h.push(e.createTextNode(o));
          for (
            s && u.removeChild(s),
              nt.appendChecked || ot.grep(g(h, "input"), b),
              f = 0;
            (o = h[f++]);

          )
            if (
              (!n || -1 === ot.inArray(o, n)) &&
              ((r = ot.contains(o.ownerDocument, o)),
              (s = g(u.appendChild(o), "script")),
              r && C(s),
              i)
            )
              for (a = 0; (o = s[a++]); ) Vt.test(o.type || "") && i.push(o);
          return (s = null), u;
        },
        cleanData: function (t, e) {
          for (
            var i,
              n,
              a,
              o,
              r = 0,
              s = ot.expando,
              l = ot.cache,
              d = nt.deleteExpando,
              p = ot.event.special;
            null != (i = t[r]);
            r++
          )
            if ((e || ot.acceptData(i)) && ((a = i[s]), (o = a && l[a]))) {
              if (o.events)
                for (n in o.events)
                  p[n] ? ot.event.remove(i, n) : ot.removeEvent(i, n, o.handle);
              l[a] &&
                (delete l[a],
                d
                  ? delete i[s]
                  : typeof i.removeAttribute !== xt
                  ? i.removeAttribute(s)
                  : (i[s] = null),
                K.push(a));
            }
        },
      }),
      ot.fn.extend({
        text: function (t) {
          return It(
            this,
            function (t) {
              return void 0 === t
                ? ot.text(this)
                : this.empty().append(
                    ((this[0] && this[0].ownerDocument) || mt).createTextNode(t)
                  );
            },
            null,
            t,
            arguments.length
          );
        },
        append: function () {
          return this.domManip(arguments, function (t) {
            if (
              1 === this.nodeType ||
              11 === this.nodeType ||
              9 === this.nodeType
            ) {
              v(this, t).appendChild(t);
            }
          });
        },
        prepend: function () {
          return this.domManip(arguments, function (t) {
            if (
              1 === this.nodeType ||
              11 === this.nodeType ||
              9 === this.nodeType
            ) {
              var e = v(this, t);
              e.insertBefore(t, e.firstChild);
            }
          });
        },
        before: function () {
          return this.domManip(arguments, function (t) {
            this.parentNode && this.parentNode.insertBefore(t, this);
          });
        },
        after: function () {
          return this.domManip(arguments, function (t) {
            this.parentNode &&
              this.parentNode.insertBefore(t, this.nextSibling);
          });
        },
        remove: function (t, e) {
          for (
            var i, n = t ? ot.filter(t, this) : this, a = 0;
            null != (i = n[a]);
            a++
          )
            e || 1 !== i.nodeType || ot.cleanData(g(i)),
              i.parentNode &&
                (e && ot.contains(i.ownerDocument, i) && C(g(i, "script")),
                i.parentNode.removeChild(i));
          return this;
        },
        empty: function () {
          for (var t, e = 0; null != (t = this[e]); e++) {
            for (1 === t.nodeType && ot.cleanData(g(t, !1)); t.firstChild; )
              t.removeChild(t.firstChild);
            t.options && ot.nodeName(t, "select") && (t.options.length = 0);
          }
          return this;
        },
        clone: function (t, e) {
          return (
            (t = null != t && t),
            (e = null == e ? t : e),
            this.map(function () {
              return ot.clone(this, t, e);
            })
          );
        },
        html: function (t) {
          return It(
            this,
            function (t) {
              var e = this[0] || {},
                i = 0,
                n = this.length;
              if (void 0 === t)
                return 1 === e.nodeType ? e.innerHTML.replace(Nt, "") : void 0;
              if (
                !(
                  "string" != typeof t ||
                  Ut.test(t) ||
                  (!nt.htmlSerialize && Bt.test(t)) ||
                  (!nt.leadingWhitespace && Ft.test(t)) ||
                  Yt[(jt.exec(t) || ["", ""])[1].toLowerCase()]
                )
              ) {
                t = t.replace(Wt, "<$1></$2>");
                try {
                  for (; n > i; i++)
                    (e = this[i] || {}),
                      1 === e.nodeType &&
                        (ot.cleanData(g(e, !1)), (e.innerHTML = t));
                  e = 0;
                } catch (t) {}
              }
              e && this.empty().append(t);
            },
            null,
            t,
            arguments.length
          );
        },
        replaceWith: function () {
          var t = arguments[0];
          return (
            this.domManip(arguments, function (e) {
              (t = this.parentNode),
                ot.cleanData(g(this)),
                t && t.replaceChild(e, this);
            }),
            t && (t.length || t.nodeType) ? this : this.remove()
          );
        },
        detach: function (t) {
          return this.remove(t, !0);
        },
        domManip: function (t, e) {
          t = Q.apply([], t);
          var i,
            n,
            a,
            o,
            r,
            s,
            l = 0,
            d = this.length,
            p = this,
            c = d - 1,
            u = t[0],
            h = ot.isFunction(u);
          if (
            h ||
            (d > 1 && "string" == typeof u && !nt.checkClone && Gt.test(u))
          )
            return this.each(function (i) {
              var n = p.eq(i);
              h && (t[0] = u.call(this, i, n.html())), n.domManip(t, e);
            });
          if (
            d &&
            ((s = ot.buildFragment(t, this[0].ownerDocument, !1, this)),
            (i = s.firstChild),
            1 === s.childNodes.length && (s = i),
            i)
          ) {
            for (o = ot.map(g(s, "script"), y), a = o.length; d > l; l++)
              (n = s),
                l !== c &&
                  ((n = ot.clone(n, !0, !0)), a && ot.merge(o, g(n, "script"))),
                e.call(this[l], n, l);
            if (a)
              for (
                r = o[o.length - 1].ownerDocument, ot.map(o, w), l = 0;
                a > l;
                l++
              )
                (n = o[l]),
                  Vt.test(n.type || "") &&
                    !ot._data(n, "globalEval") &&
                    ot.contains(r, n) &&
                    (n.src
                      ? ot._evalUrl && ot._evalUrl(n.src)
                      : ot.globalEval(
                          (
                            n.text ||
                            n.textContent ||
                            n.innerHTML ||
                            ""
                          ).replace(Kt, "")
                        ));
            s = i = null;
          }
          return this;
        },
      }),
      ot.each(
        {
          appendTo: "append",
          prependTo: "prepend",
          insertBefore: "before",
          insertAfter: "after",
          replaceAll: "replaceWith",
        },
        function (t, e) {
          ot.fn[t] = function (t) {
            for (var i, n = 0, a = [], o = ot(t), r = o.length - 1; r >= n; n++)
              (i = n === r ? this : this.clone(!0)),
                ot(o[n])[e](i),
                X.apply(a, i.get());
            return this.pushStack(a);
          };
        }
      );
    var Jt,
      Zt = {};
    !(function () {
      var t,
        e,
        i = mt.createElement("div");
      (i.innerHTML =
        "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>"),
        (t = i.getElementsByTagName("a")[0]),
        (t.style.cssText = "float:left;opacity:.5"),
        (nt.opacity = /^0.5/.test(t.style.opacity)),
        (nt.cssFloat = !!t.style.cssFloat),
        (i.style.backgroundClip = "content-box"),
        (i.cloneNode(!0).style.backgroundClip = ""),
        (nt.clearCloneStyle = "content-box" === i.style.backgroundClip),
        (t = i = null),
        (nt.shrinkWrapBlocks = function () {
          var t, i, n;
          if (null == e) {
            if (!(t = mt.getElementsByTagName("body")[0])) return;
            "border:0;width:0;height:0;position:absolute;top:0;left:-9999px",
              (i = mt.createElement("div")),
              (n = mt.createElement("div")),
              t.appendChild(i).appendChild(n),
              (e = !1),
              typeof n.style.zoom !== xt &&
                ((n.style.cssText =
                  "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0;width:1px;padding:1px;zoom:1"),
                (n.innerHTML = "<div></div>"),
                (n.firstChild.style.width = "5px"),
                (e = 3 !== n.offsetWidth)),
              t.removeChild(i),
              (t = i = n = null);
          }
          return e;
        });
    })();
    var te,
      ee,
      ie = /^margin/,
      ne = new RegExp("^(" + kt + ")(?!px)[a-z%]+$", "i"),
      ae = /^(top|right|bottom|left)$/;
    t.getComputedStyle
      ? ((te = function (t) {
          return t.ownerDocument.defaultView.getComputedStyle(t, null);
        }),
        (ee = function (t, e, i) {
          var n,
            a,
            o,
            r,
            s = t.style;
          return (
            (i = i || te(t)),
            (r = i ? i.getPropertyValue(e) || i[e] : void 0),
            i &&
              ("" !== r ||
                ot.contains(t.ownerDocument, t) ||
                (r = ot.style(t, e)),
              ne.test(r) &&
                ie.test(e) &&
                ((n = s.width),
                (a = s.minWidth),
                (o = s.maxWidth),
                (s.minWidth = s.maxWidth = s.width = r),
                (r = i.width),
                (s.width = n),
                (s.minWidth = a),
                (s.maxWidth = o))),
            void 0 === r ? r : r + ""
          );
        }))
      : mt.documentElement.currentStyle &&
        ((te = function (t) {
          return t.currentStyle;
        }),
        (ee = function (t, e, i) {
          var n,
            a,
            o,
            r,
            s = t.style;
          return (
            (i = i || te(t)),
            (r = i ? i[e] : void 0),
            null == r && s && s[e] && (r = s[e]),
            ne.test(r) &&
              !ae.test(e) &&
              ((n = s.left),
              (a = t.runtimeStyle),
              (o = a && a.left),
              o && (a.left = t.currentStyle.left),
              (s.left = "fontSize" === e ? "1em" : r),
              (r = s.pixelLeft + "px"),
              (s.left = n),
              o && (a.left = o)),
            void 0 === r ? r : r + "" || "auto"
          );
        })),
      !(function () {
        function e() {
          var e,
            i,
            n = mt.getElementsByTagName("body")[0];
          n &&
            ((e = mt.createElement("div")),
            (i = mt.createElement("div")),
            (e.style.cssText = d),
            n.appendChild(e).appendChild(i),
            (i.style.cssText =
              "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%"),
            ot.swap(n, null != n.style.zoom ? { zoom: 1 } : {}, function () {
              a = 4 === i.offsetWidth;
            }),
            (o = !0),
            (r = !1),
            (s = !0),
            t.getComputedStyle &&
              ((r = "1%" !== (t.getComputedStyle(i, null) || {}).top),
              (o =
                "4px" ===
                (t.getComputedStyle(i, null) || { width: "4px" }).width)),
            n.removeChild(e),
            (i = n = null));
        }
        var i,
          n,
          a,
          o,
          r,
          s,
          l = mt.createElement("div"),
          d = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px";
        (l.innerHTML =
          "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>"),
          (i = l.getElementsByTagName("a")[0]),
          (i.style.cssText = "float:left;opacity:.5"),
          (nt.opacity = /^0.5/.test(i.style.opacity)),
          (nt.cssFloat = !!i.style.cssFloat),
          (l.style.backgroundClip = "content-box"),
          (l.cloneNode(!0).style.backgroundClip = ""),
          (nt.clearCloneStyle = "content-box" === l.style.backgroundClip),
          (i = l = null),
          ot.extend(nt, {
            reliableHiddenOffsets: function () {
              if (null != n) return n;
              var t,
                e,
                i,
                a = mt.createElement("div"),
                o = mt.getElementsByTagName("body")[0];
              return o
                ? (a.setAttribute("className", "t"),
                  (a.innerHTML =
                    "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>"),
                  (t = mt.createElement("div")),
                  (t.style.cssText = d),
                  o.appendChild(t).appendChild(a),
                  (a.innerHTML = "<table><tr><td></td><td>t</td></tr></table>"),
                  (e = a.getElementsByTagName("td")),
                  (e[0].style.cssText =
                    "padding:0;margin:0;border:0;display:none"),
                  (i = 0 === e[0].offsetHeight),
                  (e[0].style.display = ""),
                  (e[1].style.display = "none"),
                  (n = i && 0 === e[0].offsetHeight),
                  o.removeChild(t),
                  (a = o = null),
                  n)
                : void 0;
            },
            boxSizing: function () {
              return null == a && e(), a;
            },
            boxSizingReliable: function () {
              return null == o && e(), o;
            },
            pixelPosition: function () {
              return null == r && e(), r;
            },
            reliableMarginRight: function () {
              var e, i, n, a;
              if (null == s && t.getComputedStyle) {
                if (!(e = mt.getElementsByTagName("body")[0])) return;
                (i = mt.createElement("div")),
                  (n = mt.createElement("div")),
                  (i.style.cssText = d),
                  e.appendChild(i).appendChild(n),
                  (a = n.appendChild(mt.createElement("div"))),
                  (a.style.cssText = n.style.cssText =
                    "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0"),
                  (a.style.marginRight = a.style.width = "0"),
                  (n.style.width = "1px"),
                  (s = !parseFloat(
                    (t.getComputedStyle(a, null) || {}).marginRight
                  )),
                  e.removeChild(i);
              }
              return s;
            },
          });
      })(),
      (ot.swap = function (t, e, i, n) {
        var a,
          o,
          r = {};
        for (o in e) (r[o] = t.style[o]), (t.style[o] = e[o]);
        a = i.apply(t, n || []);
        for (o in e) t.style[o] = r[o];
        return a;
      });
    var oe = /alpha\([^)]*\)/i,
      re = /opacity\s*=\s*([^)]*)/,
      se = /^(none|table(?!-c[ea]).+)/,
      le = new RegExp("^(" + kt + ")(.*)$", "i"),
      de = new RegExp("^([+-])=(" + kt + ")", "i"),
      pe = { position: "absolute", visibility: "hidden", display: "block" },
      ce = { letterSpacing: 0, fontWeight: 400 },
      ue = ["Webkit", "O", "Moz", "ms"];
    ot.extend({
      cssHooks: {
        opacity: {
          get: function (t, e) {
            if (e) {
              var i = ee(t, "opacity");
              return "" === i ? "1" : i;
            }
          },
        },
      },
      cssNumber: {
        columnCount: !0,
        fillOpacity: !0,
        fontWeight: !0,
        lineHeight: !0,
        opacity: !0,
        order: !0,
        orphans: !0,
        widows: !0,
        zIndex: !0,
        zoom: !0,
      },
      cssProps: { float: nt.cssFloat ? "cssFloat" : "styleFloat" },
      style: function (t, e, i, n) {
        if (t && 3 !== t.nodeType && 8 !== t.nodeType && t.style) {
          var a,
            o,
            r,
            s = ot.camelCase(e),
            l = t.style;
          if (
            ((e = ot.cssProps[s] || (ot.cssProps[s] = E(l, s))),
            (r = ot.cssHooks[e] || ot.cssHooks[s]),
            void 0 === i)
          )
            return r && "get" in r && void 0 !== (a = r.get(t, !1, n))
              ? a
              : l[e];
          if (
            ((o = typeof i),
            "string" === o &&
              (a = de.exec(i)) &&
              ((i = (a[1] + 1) * a[2] + parseFloat(ot.css(t, e))),
              (o = "number")),
            null != i &&
              i === i &&
              ("number" !== o || ot.cssNumber[s] || (i += "px"),
              nt.clearCloneStyle ||
                "" !== i ||
                0 !== e.indexOf("background") ||
                (l[e] = "inherit"),
              !(r && "set" in r && void 0 === (i = r.set(t, i, n)))))
          )
            try {
              (l[e] = ""), (l[e] = i);
            } catch (t) {}
        }
      },
      css: function (t, e, i, n) {
        var a,
          o,
          r,
          s = ot.camelCase(e);
        return (
          (e = ot.cssProps[s] || (ot.cssProps[s] = E(t.style, s))),
          (r = ot.cssHooks[e] || ot.cssHooks[s]),
          r && "get" in r && (o = r.get(t, !0, i)),
          void 0 === o && (o = ee(t, e, n)),
          "normal" === o && e in ce && (o = ce[e]),
          "" === i || i
            ? ((a = parseFloat(o)), !0 === i || ot.isNumeric(a) ? a || 0 : o)
            : o
        );
      },
    }),
      ot.each(["height", "width"], function (t, e) {
        ot.cssHooks[e] = {
          get: function (t, i, n) {
            return i
              ? 0 === t.offsetWidth && se.test(ot.css(t, "display"))
                ? ot.swap(t, pe, function () {
                    return P(t, e, n);
                  })
                : P(t, e, n)
              : void 0;
          },
          set: function (t, i, n) {
            var a = n && te(t);
            return I(
              t,
              i,
              n
                ? L(
                    t,
                    e,
                    n,
                    nt.boxSizing() &&
                      "border-box" === ot.css(t, "boxSizing", !1, a),
                    a
                  )
                : 0
            );
          },
        };
      }),
      nt.opacity ||
        (ot.cssHooks.opacity = {
          get: function (t, e) {
            return re.test(
              (e && t.currentStyle ? t.currentStyle.filter : t.style.filter) ||
                ""
            )
              ? 0.01 * parseFloat(RegExp.$1) + ""
              : e
              ? "1"
              : "";
          },
          set: function (t, e) {
            var i = t.style,
              n = t.currentStyle,
              a = ot.isNumeric(e) ? "alpha(opacity=" + 100 * e + ")" : "",
              o = (n && n.filter) || i.filter || "";
            (i.zoom = 1),
              ((e >= 1 || "" === e) &&
                "" === ot.trim(o.replace(oe, "")) &&
                i.removeAttribute &&
                (i.removeAttribute("filter"), "" === e || (n && !n.filter))) ||
                (i.filter = oe.test(o) ? o.replace(oe, a) : o + " " + a);
          },
        }),
      (ot.cssHooks.marginRight = k(nt.reliableMarginRight, function (t, e) {
        return e
          ? ot.swap(t, { display: "inline-block" }, ee, [t, "marginRight"])
          : void 0;
      })),
      ot.each({ margin: "", padding: "", border: "Width" }, function (t, e) {
        (ot.cssHooks[t + e] = {
          expand: function (i) {
            for (
              var n = 0, a = {}, o = "string" == typeof i ? i.split(" ") : [i];
              4 > n;
              n++
            )
              a[t + Et[n] + e] = o[n] || o[n - 2] || o[0];
            return a;
          },
        }),
          ie.test(t) || (ot.cssHooks[t + e].set = I);
      }),
      ot.fn.extend({
        css: function (t, e) {
          return It(
            this,
            function (t, e, i) {
              var n,
                a,
                o = {},
                r = 0;
              if (ot.isArray(e)) {
                for (n = te(t), a = e.length; a > r; r++)
                  o[e[r]] = ot.css(t, e[r], !1, n);
                return o;
              }
              return void 0 !== i ? ot.style(t, e, i) : ot.css(t, e);
            },
            t,
            e,
            arguments.length > 1
          );
        },
        show: function () {
          return A(this, !0);
        },
        hide: function () {
          return A(this);
        },
        toggle: function (t) {
          return "boolean" == typeof t
            ? t
              ? this.show()
              : this.hide()
            : this.each(function () {
                At(this) ? ot(this).show() : ot(this).hide();
              });
        },
      }),
      (ot.Tween = D),
      (D.prototype = {
        constructor: D,
        init: function (t, e, i, n, a, o) {
          (this.elem = t),
            (this.prop = i),
            (this.easing = a || "swing"),
            (this.options = e),
            (this.start = this.now = this.cur()),
            (this.end = n),
            (this.unit = o || (ot.cssNumber[i] ? "" : "px"));
        },
        cur: function () {
          var t = D.propHooks[this.prop];
          return t && t.get ? t.get(this) : D.propHooks._default.get(this);
        },
        run: function (t) {
          var e,
            i = D.propHooks[this.prop];
          return (
            (this.pos = e =
              this.options.duration
                ? ot.easing[this.easing](
                    t,
                    this.options.duration * t,
                    0,
                    1,
                    this.options.duration
                  )
                : t),
            (this.now = (this.end - this.start) * e + this.start),
            this.options.step &&
              this.options.step.call(this.elem, this.now, this),
            i && i.set ? i.set(this) : D.propHooks._default.set(this),
            this
          );
        },
      }),
      (D.prototype.init.prototype = D.prototype),
      (D.propHooks = {
        _default: {
          get: function (t) {
            var e;
            return null == t.elem[t.prop] ||
              (t.elem.style && null != t.elem.style[t.prop])
              ? ((e = ot.css(t.elem, t.prop, "")), e && "auto" !== e ? e : 0)
              : t.elem[t.prop];
          },
          set: function (t) {
            ot.fx.step[t.prop]
              ? ot.fx.step[t.prop](t)
              : t.elem.style &&
                (null != t.elem.style[ot.cssProps[t.prop]] ||
                  ot.cssHooks[t.prop])
              ? ot.style(t.elem, t.prop, t.now + t.unit)
              : (t.elem[t.prop] = t.now);
          },
        },
      }),
      (D.propHooks.scrollTop = D.propHooks.scrollLeft =
        {
          set: function (t) {
            t.elem.nodeType && t.elem.parentNode && (t.elem[t.prop] = t.now);
          },
        }),
      (ot.easing = {
        linear: function (t) {
          return t;
        },
        swing: function (t) {
          return 0.5 - Math.cos(t * Math.PI) / 2;
        },
      }),
      (ot.fx = D.prototype.init),
      (ot.fx.step = {});
    var he,
      fe,
      me = /^(?:toggle|show|hide)$/,
      ge = new RegExp("^(?:([+-])=|)(" + kt + ")([a-z%]*)$", "i"),
      be = /queueHooks$/,
      ve = [R],
      ye = {
        "*": [
          function (t, e) {
            var i = this.createTween(t, e),
              n = i.cur(),
              a = ge.exec(e),
              o = (a && a[3]) || (ot.cssNumber[t] ? "" : "px"),
              r =
                (ot.cssNumber[t] || ("px" !== o && +n)) &&
                ge.exec(ot.css(i.elem, t)),
              s = 1,
              l = 20;
            if (r && r[3] !== o) {
              (o = o || r[3]), (a = a || []), (r = +n || 1);
              do {
                (s = s || ".5"), (r /= s), ot.style(i.elem, t, r + o);
              } while (s !== (s = i.cur() / n) && 1 !== s && --l);
            }
            return (
              a &&
                ((r = i.start = +r || +n || 0),
                (i.unit = o),
                (i.end = a[1] ? r + (a[1] + 1) * a[2] : +a[2])),
              i
            );
          },
        ],
      };
    (ot.Animation = ot.extend(B, {
      tweener: function (t, e) {
        ot.isFunction(t) ? ((e = t), (t = ["*"])) : (t = t.split(" "));
        for (var i, n = 0, a = t.length; a > n; n++)
          (i = t[n]), (ye[i] = ye[i] || []), ye[i].unshift(e);
      },
      prefilter: function (t, e) {
        e ? ve.unshift(t) : ve.push(t);
      },
    })),
      (ot.speed = function (t, e, i) {
        var n =
          t && "object" == typeof t
            ? ot.extend({}, t)
            : {
                complete: i || (!i && e) || (ot.isFunction(t) && t),
                duration: t,
                easing: (i && e) || (e && !ot.isFunction(e) && e),
              };
        return (
          (n.duration = ot.fx.off
            ? 0
            : "number" == typeof n.duration
            ? n.duration
            : n.duration in ot.fx.speeds
            ? ot.fx.speeds[n.duration]
            : ot.fx.speeds._default),
          (null == n.queue || !0 === n.queue) && (n.queue = "fx"),
          (n.old = n.complete),
          (n.complete = function () {
            ot.isFunction(n.old) && n.old.call(this),
              n.queue && ot.dequeue(this, n.queue);
          }),
          n
        );
      }),
      ot.fn.extend({
        fadeTo: function (t, e, i, n) {
          return this.filter(At)
            .css("opacity", 0)
            .show()
            .end()
            .animate({ opacity: e }, t, i, n);
        },
        animate: function (t, e, i, n) {
          var a = ot.isEmptyObject(t),
            o = ot.speed(e, i, n),
            r = function () {
              var e = B(this, ot.extend({}, t), o);
              (a || ot._data(this, "finish")) && e.stop(!0);
            };
          return (
            (r.finish = r),
            a || !1 === o.queue ? this.each(r) : this.queue(o.queue, r)
          );
        },
        stop: function (t, e, i) {
          var n = function (t) {
            var e = t.stop;
            delete t.stop, e(i);
          };
          return (
            "string" != typeof t && ((i = e), (e = t), (t = void 0)),
            e && !1 !== t && this.queue(t || "fx", []),
            this.each(function () {
              var e = !0,
                a = null != t && t + "queueHooks",
                o = ot.timers,
                r = ot._data(this);
              if (a) r[a] && r[a].stop && n(r[a]);
              else for (a in r) r[a] && r[a].stop && be.test(a) && n(r[a]);
              for (a = o.length; a--; )
                o[a].elem !== this ||
                  (null != t && o[a].queue !== t) ||
                  (o[a].anim.stop(i), (e = !1), o.splice(a, 1));
              (e || !i) && ot.dequeue(this, t);
            })
          );
        },
        finish: function (t) {
          return (
            !1 !== t && (t = t || "fx"),
            this.each(function () {
              var e,
                i = ot._data(this),
                n = i[t + "queue"],
                a = i[t + "queueHooks"],
                o = ot.timers,
                r = n ? n.length : 0;
              for (
                i.finish = !0,
                  ot.queue(this, t, []),
                  a && a.stop && a.stop.call(this, !0),
                  e = o.length;
                e--;

              )
                o[e].elem === this &&
                  o[e].queue === t &&
                  (o[e].anim.stop(!0), o.splice(e, 1));
              for (e = 0; r > e; e++)
                n[e] && n[e].finish && n[e].finish.call(this);
              delete i.finish;
            })
          );
        },
      }),
      ot.each(["toggle", "show", "hide"], function (t, e) {
        var i = ot.fn[e];
        ot.fn[e] = function (t, n, a) {
          return null == t || "boolean" == typeof t
            ? i.apply(this, arguments)
            : this.animate(M(e, !0), t, n, a);
        };
      }),
      ot.each(
        {
          slideDown: M("show"),
          slideUp: M("hide"),
          slideToggle: M("toggle"),
          fadeIn: { opacity: "show" },
          fadeOut: { opacity: "hide" },
          fadeToggle: { opacity: "toggle" },
        },
        function (t, e) {
          ot.fn[t] = function (t, i, n) {
            return this.animate(e, t, i, n);
          };
        }
      ),
      (ot.timers = []),
      (ot.fx.tick = function () {
        var t,
          e = ot.timers,
          i = 0;
        for (he = ot.now(); i < e.length; i++)
          (t = e[i])() || e[i] !== t || e.splice(i--, 1);
        e.length || ot.fx.stop(), (he = void 0);
      }),
      (ot.fx.timer = function (t) {
        ot.timers.push(t), t() ? ot.fx.start() : ot.timers.pop();
      }),
      (ot.fx.interval = 13),
      (ot.fx.start = function () {
        fe || (fe = setInterval(ot.fx.tick, ot.fx.interval));
      }),
      (ot.fx.stop = function () {
        clearInterval(fe), (fe = null);
      }),
      (ot.fx.speeds = { slow: 600, fast: 200, _default: 400 }),
      (ot.fn.delay = function (t, e) {
        return (
          (t = ot.fx ? ot.fx.speeds[t] || t : t),
          (e = e || "fx"),
          this.queue(e, function (e, i) {
            var n = setTimeout(e, t);
            i.stop = function () {
              clearTimeout(n);
            };
          })
        );
      }),
      (function () {
        var t,
          e,
          i,
          n,
          a = mt.createElement("div");
        a.setAttribute("className", "t"),
          (a.innerHTML =
            "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>"),
          (t = a.getElementsByTagName("a")[0]),
          (i = mt.createElement("select")),
          (n = i.appendChild(mt.createElement("option"))),
          (e = a.getElementsByTagName("input")[0]),
          (t.style.cssText = "top:1px"),
          (nt.getSetAttribute = "t" !== a.className),
          (nt.style = /top/.test(t.getAttribute("style"))),
          (nt.hrefNormalized = "/a" === t.getAttribute("href")),
          (nt.checkOn = !!e.value),
          (nt.optSelected = n.selected),
          (nt.enctype = !!mt.createElement("form").enctype),
          (i.disabled = !0),
          (nt.optDisabled = !n.disabled),
          (e = mt.createElement("input")),
          e.setAttribute("value", ""),
          (nt.input = "" === e.getAttribute("value")),
          (e.value = "t"),
          e.setAttribute("type", "radio"),
          (nt.radioValue = "t" === e.value),
          (t = e = i = n = a = null);
      })();
    var we = /\r/g;
    ot.fn.extend({
      val: function (t) {
        var e,
          i,
          n,
          a = this[0];
        return arguments.length
          ? ((n = ot.isFunction(t)),
            this.each(function (i) {
              var a;
              1 === this.nodeType &&
                ((a = n ? t.call(this, i, ot(this).val()) : t),
                null == a
                  ? (a = "")
                  : "number" == typeof a
                  ? (a += "")
                  : ot.isArray(a) &&
                    (a = ot.map(a, function (t) {
                      return null == t ? "" : t + "";
                    })),
                ((e =
                  ot.valHooks[this.type] ||
                  ot.valHooks[this.nodeName.toLowerCase()]) &&
                  "set" in e &&
                  void 0 !== e.set(this, a, "value")) ||
                  (this.value = a));
            }))
          : a
          ? ((e = ot.valHooks[a.type] || ot.valHooks[a.nodeName.toLowerCase()]),
            e && "get" in e && void 0 !== (i = e.get(a, "value"))
              ? i
              : ((i = a.value),
                "string" == typeof i ? i.replace(we, "") : null == i ? "" : i))
          : void 0;
      },
    }),
      ot.extend({
        valHooks: {
          option: {
            get: function (t) {
              var e = ot.find.attr(t, "value");
              return null != e ? e : ot.text(t);
            },
          },
          select: {
            get: function (t) {
              for (
                var e,
                  i,
                  n = t.options,
                  a = t.selectedIndex,
                  o = "select-one" === t.type || 0 > a,
                  r = o ? null : [],
                  s = o ? a + 1 : n.length,
                  l = 0 > a ? s : o ? a : 0;
                s > l;
                l++
              )
                if (
                  ((i = n[l]),
                  !(
                    (!i.selected && l !== a) ||
                    (nt.optDisabled
                      ? i.disabled
                      : null !== i.getAttribute("disabled")) ||
                    (i.parentNode.disabled &&
                      ot.nodeName(i.parentNode, "optgroup"))
                  ))
                ) {
                  if (((e = ot(i).val()), o)) return e;
                  r.push(e);
                }
              return r;
            },
            set: function (t, e) {
              for (
                var i, n, a = t.options, o = ot.makeArray(e), r = a.length;
                r--;

              )
                if (((n = a[r]), ot.inArray(ot.valHooks.option.get(n), o) >= 0))
                  try {
                    n.selected = i = !0;
                  } catch (t) {
                    n.scrollHeight;
                  }
                else n.selected = !1;
              return i || (t.selectedIndex = -1), a;
            },
          },
        },
      }),
      ot.each(["radio", "checkbox"], function () {
        (ot.valHooks[this] = {
          set: function (t, e) {
            return ot.isArray(e)
              ? (t.checked = ot.inArray(ot(t).val(), e) >= 0)
              : void 0;
          },
        }),
          nt.checkOn ||
            (ot.valHooks[this].get = function (t) {
              return null === t.getAttribute("value") ? "on" : t.value;
            });
      });
    var Ce,
      _e,
      xe = ot.expr.attrHandle,
      Se = /^(?:checked|selected)$/i,
      Te = nt.getSetAttribute,
      ke = nt.input;
    ot.fn.extend({
      attr: function (t, e) {
        return It(this, ot.attr, t, e, arguments.length > 1);
      },
      removeAttr: function (t) {
        return this.each(function () {
          ot.removeAttr(this, t);
        });
      },
    }),
      ot.extend({
        attr: function (t, e, i) {
          var n,
            a,
            o = t.nodeType;
          if (t && 3 !== o && 8 !== o && 2 !== o)
            return typeof t.getAttribute === xt
              ? ot.prop(t, e, i)
              : ((1 === o && ot.isXMLDoc(t)) ||
                  ((e = e.toLowerCase()),
                  (n =
                    ot.attrHooks[e] || (ot.expr.match.bool.test(e) ? _e : Ce))),
                void 0 === i
                  ? n && "get" in n && null !== (a = n.get(t, e))
                    ? a
                    : ((a = ot.find.attr(t, e)), null == a ? void 0 : a)
                  : null !== i
                  ? n && "set" in n && void 0 !== (a = n.set(t, i, e))
                    ? a
                    : (t.setAttribute(e, i + ""), i)
                  : void ot.removeAttr(t, e));
        },
        removeAttr: function (t, e) {
          var i,
            n,
            a = 0,
            o = e && e.match(yt);
          if (o && 1 === t.nodeType)
            for (; (i = o[a++]); )
              (n = ot.propFix[i] || i),
                ot.expr.match.bool.test(i)
                  ? (ke && Te) || !Se.test(i)
                    ? (t[n] = !1)
                    : (t[ot.camelCase("default-" + i)] = t[n] = !1)
                  : ot.attr(t, i, ""),
                t.removeAttribute(Te ? i : n);
        },
        attrHooks: {
          type: {
            set: function (t, e) {
              if (!nt.radioValue && "radio" === e && ot.nodeName(t, "input")) {
                var i = t.value;
                return t.setAttribute("type", e), i && (t.value = i), e;
              }
            },
          },
        },
      }),
      (_e = {
        set: function (t, e, i) {
          return (
            !1 === e
              ? ot.removeAttr(t, i)
              : (ke && Te) || !Se.test(i)
              ? t.setAttribute((!Te && ot.propFix[i]) || i, i)
              : (t[ot.camelCase("default-" + i)] = t[i] = !0),
            i
          );
        },
      }),
      ot.each(ot.expr.match.bool.source.match(/\w+/g), function (t, e) {
        var i = xe[e] || ot.find.attr;
        xe[e] =
          (ke && Te) || !Se.test(e)
            ? function (t, e, n) {
                var a, o;
                return (
                  n ||
                    ((o = xe[e]),
                    (xe[e] = a),
                    (a = null != i(t, e, n) ? e.toLowerCase() : null),
                    (xe[e] = o)),
                  a
                );
              }
            : function (t, e, i) {
                return i
                  ? void 0
                  : t[ot.camelCase("default-" + e)]
                  ? e.toLowerCase()
                  : null;
              };
      }),
      (ke && Te) ||
        (ot.attrHooks.value = {
          set: function (t, e, i) {
            return ot.nodeName(t, "input")
              ? void (t.defaultValue = e)
              : Ce && Ce.set(t, e, i);
          },
        }),
      Te ||
        ((Ce = {
          set: function (t, e, i) {
            var n = t.getAttributeNode(i);
            return (
              n || t.setAttributeNode((n = t.ownerDocument.createAttribute(i))),
              (n.value = e += ""),
              "value" === i || e === t.getAttribute(i) ? e : void 0
            );
          },
        }),
        (xe.id =
          xe.name =
          xe.coords =
            function (t, e, i) {
              var n;
              return i
                ? void 0
                : (n = t.getAttributeNode(e)) && "" !== n.value
                ? n.value
                : null;
            }),
        (ot.valHooks.button = {
          get: function (t, e) {
            var i = t.getAttributeNode(e);
            return i && i.specified ? i.value : void 0;
          },
          set: Ce.set,
        }),
        (ot.attrHooks.contenteditable = {
          set: function (t, e, i) {
            Ce.set(t, "" !== e && e, i);
          },
        }),
        ot.each(["width", "height"], function (t, e) {
          ot.attrHooks[e] = {
            set: function (t, i) {
              return "" === i ? (t.setAttribute(e, "auto"), i) : void 0;
            },
          };
        })),
      nt.style ||
        (ot.attrHooks.style = {
          get: function (t) {
            return t.style.cssText || void 0;
          },
          set: function (t, e) {
            return (t.style.cssText = e + "");
          },
        });
    var Ee = /^(?:input|select|textarea|button|object)$/i,
      Ae = /^(?:a|area)$/i;
    ot.fn.extend({
      prop: function (t, e) {
        return It(this, ot.prop, t, e, arguments.length > 1);
      },
      removeProp: function (t) {
        return (
          (t = ot.propFix[t] || t),
          this.each(function () {
            try {
              (this[t] = void 0), delete this[t];
            } catch (t) {}
          })
        );
      },
    }),
      ot.extend({
        propFix: { for: "htmlFor", class: "className" },
        prop: function (t, e, i) {
          var n,
            a,
            o,
            r = t.nodeType;
          if (t && 3 !== r && 8 !== r && 2 !== r)
            return (
              (o = 1 !== r || !ot.isXMLDoc(t)),
              o && ((e = ot.propFix[e] || e), (a = ot.propHooks[e])),
              void 0 !== i
                ? a && "set" in a && void 0 !== (n = a.set(t, i, e))
                  ? n
                  : (t[e] = i)
                : a && "get" in a && null !== (n = a.get(t, e))
                ? n
                : t[e]
            );
        },
        propHooks: {
          tabIndex: {
            get: function (t) {
              var e = ot.find.attr(t, "tabindex");
              return e
                ? parseInt(e, 10)
                : Ee.test(t.nodeName) || (Ae.test(t.nodeName) && t.href)
                ? 0
                : -1;
            },
          },
        },
      }),
      nt.hrefNormalized ||
        ot.each(["href", "src"], function (t, e) {
          ot.propHooks[e] = {
            get: function (t) {
              return t.getAttribute(e, 4);
            },
          };
        }),
      nt.optSelected ||
        (ot.propHooks.selected = {
          get: function (t) {
            var e = t.parentNode;
            return (
              e &&
                (e.selectedIndex, e.parentNode && e.parentNode.selectedIndex),
              null
            );
          },
        }),
      ot.each(
        [
          "tabIndex",
          "readOnly",
          "maxLength",
          "cellSpacing",
          "cellPadding",
          "rowSpan",
          "colSpan",
          "useMap",
          "frameBorder",
          "contentEditable",
        ],
        function () {
          ot.propFix[this.toLowerCase()] = this;
        }
      ),
      nt.enctype || (ot.propFix.enctype = "encoding");
    var Ie = /[\t\r\n\f]/g;
    ot.fn.extend({
      addClass: function (t) {
        var e,
          i,
          n,
          a,
          o,
          r,
          s = 0,
          l = this.length,
          d = "string" == typeof t && t;
        if (ot.isFunction(t))
          return this.each(function (e) {
            ot(this).addClass(t.call(this, e, this.className));
          });
        if (d)
          for (e = (t || "").match(yt) || []; l > s; s++)
            if (
              ((i = this[s]),
              (n =
                1 === i.nodeType &&
                (i.className
                  ? (" " + i.className + " ").replace(Ie, " ")
                  : " ")))
            ) {
              for (o = 0; (a = e[o++]); )
                n.indexOf(" " + a + " ") < 0 && (n += a + " ");
              (r = ot.trim(n)), i.className !== r && (i.className = r);
            }
        return this;
      },
      removeClass: function (t) {
        var e,
          i,
          n,
          a,
          o,
          r,
          s = 0,
          l = this.length,
          d = 0 === arguments.length || ("string" == typeof t && t);
        if (ot.isFunction(t))
          return this.each(function (e) {
            ot(this).removeClass(t.call(this, e, this.className));
          });
        if (d)
          for (e = (t || "").match(yt) || []; l > s; s++)
            if (
              ((i = this[s]),
              (n =
                1 === i.nodeType &&
                (i.className
                  ? (" " + i.className + " ").replace(Ie, " ")
                  : "")))
            ) {
              for (o = 0; (a = e[o++]); )
                for (; n.indexOf(" " + a + " ") >= 0; )
                  n = n.replace(" " + a + " ", " ");
              (r = t ? ot.trim(n) : ""), i.className !== r && (i.className = r);
            }
        return this;
      },
      toggleClass: function (t, e) {
        var i = typeof t;
        return "boolean" == typeof e && "string" === i
          ? e
            ? this.addClass(t)
            : this.removeClass(t)
          : this.each(
              ot.isFunction(t)
                ? function (i) {
                    ot(this).toggleClass(t.call(this, i, this.className, e), e);
                  }
                : function () {
                    if ("string" === i)
                      for (
                        var e, n = 0, a = ot(this), o = t.match(yt) || [];
                        (e = o[n++]);

                      )
                        a.hasClass(e) ? a.removeClass(e) : a.addClass(e);
                    else
                      (i === xt || "boolean" === i) &&
                        (this.className &&
                          ot._data(this, "__className__", this.className),
                        (this.className =
                          this.className || !1 === t
                            ? ""
                            : ot._data(this, "__className__") || ""));
                  }
            );
      },
      hasClass: function (t) {
        for (var e = " " + t + " ", i = 0, n = this.length; n > i; i++)
          if (
            1 === this[i].nodeType &&
            (" " + this[i].className + " ").replace(Ie, " ").indexOf(e) >= 0
          )
            return !0;
        return !1;
      },
    }),
      ot.each(
        "blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(
          " "
        ),
        function (t, e) {
          ot.fn[e] = function (t, i) {
            return arguments.length > 0
              ? this.on(e, null, t, i)
              : this.trigger(e);
          };
        }
      ),
      ot.fn.extend({
        hover: function (t, e) {
          return this.mouseenter(t).mouseleave(e || t);
        },
        bind: function (t, e, i) {
          return this.on(t, null, e, i);
        },
        unbind: function (t, e) {
          return this.off(t, null, e);
        },
        delegate: function (t, e, i, n) {
          return this.on(e, t, i, n);
        },
        undelegate: function (t, e, i) {
          return 1 === arguments.length
            ? this.off(t, "**")
            : this.off(e, t || "**", i);
        },
      });
    var Le = ot.now(),
      Pe = /\?/,
      De =
        /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;
    (ot.parseJSON = function (e) {
      if (t.JSON && t.JSON.parse) return t.JSON.parse(e + "");
      var i,
        n = null,
        a = ot.trim(e + "");
      return a &&
        !ot.trim(
          a.replace(De, function (t, e, a, o) {
            return (
              i && e && (n = 0),
              0 === n ? t : ((i = a || e), (n += !o - !a), "")
            );
          })
        )
        ? Function("return " + a)()
        : ot.error("Invalid JSON: " + e);
    }),
      (ot.parseXML = function (e) {
        var i, n;
        if (!e || "string" != typeof e) return null;
        try {
          t.DOMParser
            ? ((n = new DOMParser()), (i = n.parseFromString(e, "text/xml")))
            : ((i = new ActiveXObject("Microsoft.XMLDOM")),
              (i.async = "false"),
              i.loadXML(e));
        } catch (t) {
          i = void 0;
        }
        return (
          (i &&
            i.documentElement &&
            !i.getElementsByTagName("parsererror").length) ||
            ot.error("Invalid XML: " + e),
          i
        );
      });
    var $e,
      Me,
      Oe = /#.*$/,
      Re = /([?&])_=[^&]*/,
      Ne = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm,
      Be = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,
      Fe = /^(?:GET|HEAD)$/,
      We = /^\/\//,
      je = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
      He = {},
      ze = {},
      Ue = "*/".concat("*");
    try {
      Me = location.href;
    } catch (t) {
      (Me = mt.createElement("a")), (Me.href = ""), (Me = Me.href);
    }
    ($e = je.exec(Me.toLowerCase()) || []),
      ot.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
          url: Me,
          type: "GET",
          isLocal: Be.test($e[1]),
          global: !0,
          processData: !0,
          async: !0,
          contentType: "application/x-www-form-urlencoded; charset=UTF-8",
          accepts: {
            "*": Ue,
            text: "text/plain",
            html: "text/html",
            xml: "application/xml, text/xml",
            json: "application/json, text/javascript",
          },
          contents: { xml: /xml/, html: /html/, json: /json/ },
          responseFields: {
            xml: "responseXML",
            text: "responseText",
            json: "responseJSON",
          },
          converters: {
            "* text": String,
            "text html": !0,
            "text json": ot.parseJSON,
            "text xml": ot.parseXML,
          },
          flatOptions: { url: !0, context: !0 },
        },
        ajaxSetup: function (t, e) {
          return e ? j(j(t, ot.ajaxSettings), e) : j(ot.ajaxSettings, t);
        },
        ajaxPrefilter: F(He),
        ajaxTransport: F(ze),
        ajax: function (t, e) {
          function i(t, e, i, n) {
            var a,
              p,
              b,
              v,
              w,
              _ = e;
            2 !== y &&
              ((y = 2),
              s && clearTimeout(s),
              (d = void 0),
              (r = n || ""),
              (C.readyState = t > 0 ? 4 : 0),
              (a = (t >= 200 && 300 > t) || 304 === t),
              i && (v = H(c, C, i)),
              (v = z(c, v, C, a)),
              a
                ? (c.ifModified &&
                    ((w = C.getResponseHeader("Last-Modified")),
                    w && (ot.lastModified[o] = w),
                    (w = C.getResponseHeader("etag")) && (ot.etag[o] = w)),
                  204 === t || "HEAD" === c.type
                    ? (_ = "nocontent")
                    : 304 === t
                    ? (_ = "notmodified")
                    : ((_ = v.state), (p = v.data), (b = v.error), (a = !b)))
                : ((b = _), (t || !_) && ((_ = "error"), 0 > t && (t = 0))),
              (C.status = t),
              (C.statusText = (e || _) + ""),
              a ? f.resolveWith(u, [p, _, C]) : f.rejectWith(u, [C, _, b]),
              C.statusCode(g),
              (g = void 0),
              l &&
                h.trigger(a ? "ajaxSuccess" : "ajaxError", [C, c, a ? p : b]),
              m.fireWith(u, [C, _]),
              l &&
                (h.trigger("ajaxComplete", [C, c]),
                --ot.active || ot.event.trigger("ajaxStop")));
          }
          "object" == typeof t && ((e = t), (t = void 0)), (e = e || {});
          var n,
            a,
            o,
            r,
            s,
            l,
            d,
            p,
            c = ot.ajaxSetup({}, e),
            u = c.context || c,
            h = c.context && (u.nodeType || u.jquery) ? ot(u) : ot.event,
            f = ot.Deferred(),
            m = ot.Callbacks("once memory"),
            g = c.statusCode || {},
            b = {},
            v = {},
            y = 0,
            w = "canceled",
            C = {
              readyState: 0,
              getResponseHeader: function (t) {
                var e;
                if (2 === y) {
                  if (!p)
                    for (p = {}; (e = Ne.exec(r)); )
                      p[e[1].toLowerCase()] = e[2];
                  e = p[t.toLowerCase()];
                }
                return null == e ? null : e;
              },
              getAllResponseHeaders: function () {
                return 2 === y ? r : null;
              },
              setRequestHeader: function (t, e) {
                var i = t.toLowerCase();
                return y || ((t = v[i] = v[i] || t), (b[t] = e)), this;
              },
              overrideMimeType: function (t) {
                return y || (c.mimeType = t), this;
              },
              statusCode: function (t) {
                var e;
                if (t)
                  if (2 > y) for (e in t) g[e] = [g[e], t[e]];
                  else C.always(t[C.status]);
                return this;
              },
              abort: function (t) {
                var e = t || w;
                return d && d.abort(e), i(0, e), this;
              },
            };
          if (
            ((f.promise(C).complete = m.add),
            (C.success = C.done),
            (C.error = C.fail),
            (c.url = ((t || c.url || Me) + "")
              .replace(Oe, "")
              .replace(We, $e[1] + "//")),
            (c.type = e.method || e.type || c.method || c.type),
            (c.dataTypes = ot
              .trim(c.dataType || "*")
              .toLowerCase()
              .match(yt) || [""]),
            null == c.crossDomain &&
              ((n = je.exec(c.url.toLowerCase())),
              (c.crossDomain = !(
                !n ||
                (n[1] === $e[1] &&
                  n[2] === $e[2] &&
                  (n[3] || ("http:" === n[1] ? "80" : "443")) ===
                    ($e[3] || ("http:" === $e[1] ? "80" : "443")))
              ))),
            c.data &&
              c.processData &&
              "string" != typeof c.data &&
              (c.data = ot.param(c.data, c.traditional)),
            W(He, c, e, C),
            2 === y)
          )
            return C;
          (l = c.global),
            l && 0 == ot.active++ && ot.event.trigger("ajaxStart"),
            (c.type = c.type.toUpperCase()),
            (c.hasContent = !Fe.test(c.type)),
            (o = c.url),
            c.hasContent ||
              (c.data &&
                ((o = c.url += (Pe.test(o) ? "&" : "?") + c.data),
                delete c.data),
              !1 === c.cache &&
                (c.url = Re.test(o)
                  ? o.replace(Re, "$1_=" + Le++)
                  : o + (Pe.test(o) ? "&" : "?") + "_=" + Le++)),
            c.ifModified &&
              (ot.lastModified[o] &&
                C.setRequestHeader("If-Modified-Since", ot.lastModified[o]),
              ot.etag[o] && C.setRequestHeader("If-None-Match", ot.etag[o])),
            ((c.data && c.hasContent && !1 !== c.contentType) ||
              e.contentType) &&
              C.setRequestHeader("Content-Type", c.contentType),
            C.setRequestHeader(
              "Accept",
              c.dataTypes[0] && c.accepts[c.dataTypes[0]]
                ? c.accepts[c.dataTypes[0]] +
                    ("*" !== c.dataTypes[0] ? ", " + Ue + "; q=0.01" : "")
                : c.accepts["*"]
            );
          for (a in c.headers) C.setRequestHeader(a, c.headers[a]);
          if (c.beforeSend && (!1 === c.beforeSend.call(u, C, c) || 2 === y))
            return C.abort();
          w = "abort";
          for (a in { success: 1, error: 1, complete: 1 }) C[a](c[a]);
          if ((d = W(ze, c, e, C))) {
            (C.readyState = 1),
              l && h.trigger("ajaxSend", [C, c]),
              c.async &&
                c.timeout > 0 &&
                (s = setTimeout(function () {
                  C.abort("timeout");
                }, c.timeout));
            try {
              (y = 1), d.send(b, i);
            } catch (t) {
              if (!(2 > y)) throw t;
              i(-1, t);
            }
          } else i(-1, "No Transport");
          return C;
        },
        getJSON: function (t, e, i) {
          return ot.get(t, e, i, "json");
        },
        getScript: function (t, e) {
          return ot.get(t, void 0, e, "script");
        },
      }),
      ot.each(["get", "post"], function (t, e) {
        ot[e] = function (t, i, n, a) {
          return (
            ot.isFunction(i) && ((a = a || n), (n = i), (i = void 0)),
            ot.ajax({ url: t, type: e, dataType: a, data: i, success: n })
          );
        };
      }),
      ot.each(
        [
          "ajaxStart",
          "ajaxStop",
          "ajaxComplete",
          "ajaxError",
          "ajaxSuccess",
          "ajaxSend",
        ],
        function (t, e) {
          ot.fn[e] = function (t) {
            return this.on(e, t);
          };
        }
      ),
      (ot._evalUrl = function (t) {
        return ot.ajax({
          url: t,
          type: "GET",
          dataType: "script",
          async: !1,
          global: !1,
          throws: !0,
        });
      }),
      ot.fn.extend({
        wrapAll: function (t) {
          if (ot.isFunction(t))
            return this.each(function (e) {
              ot(this).wrapAll(t.call(this, e));
            });
          if (this[0]) {
            var e = ot(t, this[0].ownerDocument).eq(0).clone(!0);
            this[0].parentNode && e.insertBefore(this[0]),
              e
                .map(function () {
                  for (
                    var t = this;
                    t.firstChild && 1 === t.firstChild.nodeType;

                  )
                    t = t.firstChild;
                  return t;
                })
                .append(this);
          }
          return this;
        },
        wrapInner: function (t) {
          return this.each(
            ot.isFunction(t)
              ? function (e) {
                  ot(this).wrapInner(t.call(this, e));
                }
              : function () {
                  var e = ot(this),
                    i = e.contents();
                  i.length ? i.wrapAll(t) : e.append(t);
                }
          );
        },
        wrap: function (t) {
          var e = ot.isFunction(t);
          return this.each(function (i) {
            ot(this).wrapAll(e ? t.call(this, i) : t);
          });
        },
        unwrap: function () {
          return this.parent()
            .each(function () {
              ot.nodeName(this, "body") ||
                ot(this).replaceWith(this.childNodes);
            })
            .end();
        },
      }),
      (ot.expr.filters.hidden = function (t) {
        return (
          (t.offsetWidth <= 0 && t.offsetHeight <= 0) ||
          (!nt.reliableHiddenOffsets() &&
            "none" === ((t.style && t.style.display) || ot.css(t, "display")))
        );
      }),
      (ot.expr.filters.visible = function (t) {
        return !ot.expr.filters.hidden(t);
      });
    var Ge = /%20/g,
      Ve = /\[\]$/,
      qe = /\r?\n/g,
      Ke = /^(?:submit|button|image|reset|file)$/i,
      Ye = /^(?:input|select|textarea|keygen)/i;
    (ot.param = function (t, e) {
      var i,
        n = [],
        a = function (t, e) {
          (e = ot.isFunction(e) ? e() : null == e ? "" : e),
            (n[n.length] = encodeURIComponent(t) + "=" + encodeURIComponent(e));
        };
      if (
        (void 0 === e && (e = ot.ajaxSettings && ot.ajaxSettings.traditional),
        ot.isArray(t) || (t.jquery && !ot.isPlainObject(t)))
      )
        ot.each(t, function () {
          a(this.name, this.value);
        });
      else for (i in t) U(i, t[i], e, a);
      return n.join("&").replace(Ge, "+");
    }),
      ot.fn.extend({
        serialize: function () {
          return ot.param(this.serializeArray());
        },
        serializeArray: function () {
          return this.map(function () {
            var t = ot.prop(this, "elements");
            return t ? ot.makeArray(t) : this;
          })
            .filter(function () {
              var t = this.type;
              return (
                this.name &&
                !ot(this).is(":disabled") &&
                Ye.test(this.nodeName) &&
                !Ke.test(t) &&
                (this.checked || !Lt.test(t))
              );
            })
            .map(function (t, e) {
              var i = ot(this).val();
              return null == i
                ? null
                : ot.isArray(i)
                ? ot.map(i, function (t) {
                    return { name: e.name, value: t.replace(qe, "\r\n") };
                  })
                : { name: e.name, value: i.replace(qe, "\r\n") };
            })
            .get();
        },
      }),
      (ot.ajaxSettings.xhr =
        void 0 !== t.ActiveXObject
          ? function () {
              return (
                (!this.isLocal &&
                  /^(get|post|head|put|delete|options)$/i.test(this.type) &&
                  G()) ||
                V()
              );
            }
          : G);
    var Qe = 0,
      Xe = {},
      Je = ot.ajaxSettings.xhr();
    t.ActiveXObject &&
      ot(t).on("unload", function () {
        for (var t in Xe) Xe[t](void 0, !0);
      }),
      (nt.cors = !!Je && "withCredentials" in Je),
      (Je = nt.ajax = !!Je) &&
        ot.ajaxTransport(function (t) {
          if (!t.crossDomain || nt.cors) {
            var e;
            return {
              send: function (i, n) {
                var a,
                  o = t.xhr(),
                  r = ++Qe;
                if (
                  (o.open(t.type, t.url, t.async, t.username, t.password),
                  t.xhrFields)
                )
                  for (a in t.xhrFields) o[a] = t.xhrFields[a];
                t.mimeType &&
                  o.overrideMimeType &&
                  o.overrideMimeType(t.mimeType),
                  t.crossDomain ||
                    i["X-Requested-With"] ||
                    (i["X-Requested-With"] = "XMLHttpRequest");
                for (a in i)
                  void 0 !== i[a] && o.setRequestHeader(a, i[a] + "");
                o.send((t.hasContent && t.data) || null),
                  (e = function (i, a) {
                    var s, l, d;
                    if (e && (a || 4 === o.readyState))
                      if (
                        (delete Xe[r],
                        (e = void 0),
                        (o.onreadystatechange = ot.noop),
                        a)
                      )
                        4 !== o.readyState && o.abort();
                      else {
                        (d = {}),
                          (s = o.status),
                          "string" == typeof o.responseText &&
                            (d.text = o.responseText);
                        try {
                          l = o.statusText;
                        } catch (t) {
                          l = "";
                        }
                        s || !t.isLocal || t.crossDomain
                          ? 1223 === s && (s = 204)
                          : (s = d.text ? 200 : 404);
                      }
                    d && n(s, l, d, o.getAllResponseHeaders());
                  }),
                  t.async
                    ? 4 === o.readyState
                      ? setTimeout(e)
                      : (o.onreadystatechange = Xe[r] = e)
                    : e();
              },
              abort: function () {
                e && e(void 0, !0);
              },
            };
          }
        }),
      ot.ajaxSetup({
        accepts: {
          script:
            "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",
        },
        contents: { script: /(?:java|ecma)script/ },
        converters: {
          "text script": function (t) {
            return ot.globalEval(t), t;
          },
        },
      }),
      ot.ajaxPrefilter("script", function (t) {
        void 0 === t.cache && (t.cache = !1),
          t.crossDomain && ((t.type = "GET"), (t.global = !1));
      }),
      ot.ajaxTransport("script", function (t) {
        if (t.crossDomain) {
          var e,
            i = mt.head || ot("head")[0] || mt.documentElement;
          return {
            send: function (n, a) {
              (e = mt.createElement("script")),
                (e.async = !0),
                t.scriptCharset && (e.charset = t.scriptCharset),
                (e.src = t.url),
                (e.onload = e.onreadystatechange =
                  function (t, i) {
                    (i ||
                      !e.readyState ||
                      /loaded|complete/.test(e.readyState)) &&
                      ((e.onload = e.onreadystatechange = null),
                      e.parentNode && e.parentNode.removeChild(e),
                      (e = null),
                      i || a(200, "success"));
                  }),
                i.insertBefore(e, i.firstChild);
            },
            abort: function () {
              e && e.onload(void 0, !0);
            },
          };
        }
      });
    var Ze = [],
      ti = /(=)\?(?=&|$)|\?\?/;
    ot.ajaxSetup({
      jsonp: "callback",
      jsonpCallback: function () {
        var t = Ze.pop() || ot.expando + "_" + Le++;
        return (this[t] = !0), t;
      },
    }),
      ot.ajaxPrefilter("json jsonp", function (e, i, n) {
        var a,
          o,
          r,
          s =
            !1 !== e.jsonp &&
            (ti.test(e.url)
              ? "url"
              : "string" == typeof e.data &&
                !(e.contentType || "").indexOf(
                  "application/x-www-form-urlencoded"
                ) &&
                ti.test(e.data) &&
                "data");
        return s || "jsonp" === e.dataTypes[0]
          ? ((a = e.jsonpCallback =
              ot.isFunction(e.jsonpCallback)
                ? e.jsonpCallback()
                : e.jsonpCallback),
            s
              ? (e[s] = e[s].replace(ti, "$1" + a))
              : !1 !== e.jsonp &&
                (e.url += (Pe.test(e.url) ? "&" : "?") + e.jsonp + "=" + a),
            (e.converters["script json"] = function () {
              return r || ot.error(a + " was not called"), r[0];
            }),
            (e.dataTypes[0] = "json"),
            (o = t[a]),
            (t[a] = function () {
              r = arguments;
            }),
            n.always(function () {
              (t[a] = o),
                e[a] && ((e.jsonpCallback = i.jsonpCallback), Ze.push(a)),
                r && ot.isFunction(o) && o(r[0]),
                (r = o = void 0);
            }),
            "script")
          : void 0;
      }),
      (ot.parseHTML = function (t, e, i) {
        if (!t || "string" != typeof t) return null;
        "boolean" == typeof e && ((i = e), (e = !1)), (e = e || mt);
        var n = ut.exec(t),
          a = !i && [];
        return n
          ? [e.createElement(n[1])]
          : ((n = ot.buildFragment([t], e, a)),
            a && a.length && ot(a).remove(),
            ot.merge([], n.childNodes));
      });
    var ei = ot.fn.load;
    (ot.fn.load = function (t, e, i) {
      if ("string" != typeof t && ei) return ei.apply(this, arguments);
      var n,
        a,
        o,
        r = this,
        s = t.indexOf(" ");
      return (
        s >= 0 && ((n = t.slice(s, t.length)), (t = t.slice(0, s))),
        ot.isFunction(e)
          ? ((i = e), (e = void 0))
          : e && "object" == typeof e && (o = "POST"),
        r.length > 0 &&
          ot
            .ajax({ url: t, type: o, dataType: "html", data: e })
            .done(function (t) {
              (a = arguments),
                r.html(n ? ot("<div>").append(ot.parseHTML(t)).find(n) : t);
            })
            .complete(
              i &&
                function (t, e) {
                  r.each(i, a || [t.responseText, e, t]);
                }
            ),
        this
      );
    }),
      (ot.expr.filters.animated = function (t) {
        return ot.grep(ot.timers, function (e) {
          return t === e.elem;
        }).length;
      });
    var ii = t.document.documentElement;
    (ot.offset = {
      setOffset: function (t, e, i) {
        var n,
          a,
          o,
          r,
          s,
          l,
          d,
          p = ot.css(t, "position"),
          c = ot(t),
          u = {};
        "static" === p && (t.style.position = "relative"),
          (s = c.offset()),
          (o = ot.css(t, "top")),
          (l = ot.css(t, "left")),
          (d =
            ("absolute" === p || "fixed" === p) &&
            ot.inArray("auto", [o, l]) > -1),
          d
            ? ((n = c.position()), (r = n.top), (a = n.left))
            : ((r = parseFloat(o) || 0), (a = parseFloat(l) || 0)),
          ot.isFunction(e) && (e = e.call(t, i, s)),
          null != e.top && (u.top = e.top - s.top + r),
          null != e.left && (u.left = e.left - s.left + a),
          "using" in e ? e.using.call(t, u) : c.css(u);
      },
    }),
      ot.fn.extend({
        offset: function (t) {
          if (arguments.length)
            return void 0 === t
              ? this
              : this.each(function (e) {
                  ot.offset.setOffset(this, t, e);
                });
          var e,
            i,
            n = { top: 0, left: 0 },
            a = this[0],
            o = a && a.ownerDocument;
          return o
            ? ((e = o.documentElement),
              ot.contains(e, a)
                ? (typeof a.getBoundingClientRect !== xt &&
                    (n = a.getBoundingClientRect()),
                  (i = q(o)),
                  {
                    top:
                      n.top +
                      (i.pageYOffset || e.scrollTop) -
                      (e.clientTop || 0),
                    left:
                      n.left +
                      (i.pageXOffset || e.scrollLeft) -
                      (e.clientLeft || 0),
                  })
                : n)
            : void 0;
        },
        position: function () {
          if (this[0]) {
            var t,
              e,
              i = { top: 0, left: 0 },
              n = this[0];
            return (
              "fixed" === ot.css(n, "position")
                ? (e = n.getBoundingClientRect())
                : ((t = this.offsetParent()),
                  (e = this.offset()),
                  ot.nodeName(t[0], "html") || (i = t.offset()),
                  (i.top += ot.css(t[0], "borderTopWidth", !0)),
                  (i.left += ot.css(t[0], "borderLeftWidth", !0))),
              {
                top: e.top - i.top - ot.css(n, "marginTop", !0),
                left: e.left - i.left - ot.css(n, "marginLeft", !0),
              }
            );
          }
        },
        offsetParent: function () {
          return this.map(function () {
            for (
              var t = this.offsetParent || ii;
              t &&
              !ot.nodeName(t, "html") &&
              "static" === ot.css(t, "position");

            )
              t = t.offsetParent;
            return t || ii;
          });
        },
      }),
      ot.each(
        { scrollLeft: "pageXOffset", scrollTop: "pageYOffset" },
        function (t, e) {
          var i = /Y/.test(e);
          ot.fn[t] = function (n) {
            return It(
              this,
              function (t, n, a) {
                var o = q(t);
                return void 0 === a
                  ? o
                    ? e in o
                      ? o[e]
                      : o.document.documentElement[n]
                    : t[n]
                  : void (o
                      ? o.scrollTo(
                          i ? ot(o).scrollLeft() : a,
                          i ? a : ot(o).scrollTop()
                        )
                      : (t[n] = a));
              },
              t,
              n,
              arguments.length,
              null
            );
          };
        }
      ),
      ot.each(["top", "left"], function (t, e) {
        ot.cssHooks[e] = k(nt.pixelPosition, function (t, i) {
          return i
            ? ((i = ee(t, e)), ne.test(i) ? ot(t).position()[e] + "px" : i)
            : void 0;
        });
      }),
      ot.each({ Height: "height", Width: "width" }, function (t, e) {
        ot.each(
          { padding: "inner" + t, content: e, "": "outer" + t },
          function (i, n) {
            ot.fn[n] = function (n, a) {
              var o = arguments.length && (i || "boolean" != typeof n),
                r = i || (!0 === n || !0 === a ? "margin" : "border");
              return It(
                this,
                function (e, i, n) {
                  var a;
                  return ot.isWindow(e)
                    ? e.document.documentElement["client" + t]
                    : 9 === e.nodeType
                    ? ((a = e.documentElement),
                      Math.max(
                        e.body["scroll" + t],
                        a["scroll" + t],
                        e.body["offset" + t],
                        a["offset" + t],
                        a["client" + t]
                      ))
                    : void 0 === n
                    ? ot.css(e, i, r)
                    : ot.style(e, i, n, r);
                },
                e,
                o ? n : void 0,
                o,
                null
              );
            };
          }
        );
      }),
      (ot.fn.size = function () {
        return this.length;
      }),
      (ot.fn.andSelf = ot.fn.addBack),
      "function" == typeof define &&
        define.amd &&
        define("jquery", [], function () {
          return ot;
        });
    var ni = t.jQuery,
      ai = t.$;
    return (
      (ot.noConflict = function (e) {
        return (
          t.$ === ot && (t.$ = ai), e && t.jQuery === ot && (t.jQuery = ni), ot
        );
      }),
      typeof e === xt && (t.jQuery = t.$ = ot),
      ot
    );
  }),
  define("lib-app/jquery", function () {}),
  define("storymaps/common/utils/Polyfills", [], function () {
    return {
      apply: function () {
        "function" != typeof String.prototype.trim &&
          (String.prototype.trim = function () {
            return this.replace(/^\s+|\s+$/g, "");
          }),
          Date.now ||
            (Date.now = function () {
              return new Date().valueOf();
            }),
          (Object.keys =
            Object.keys ||
            function (t, e, i) {
              i = [];
              for (e in t) i.hasOwnProperty.call(t, e) && i.push(e);
              return i;
            }),
          (function () {
            function t(t) {
              this.message = t;
            }
            var e = "undefined" != typeof exports ? exports : this,
              i =
                "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
            (t.prototype = new Error()),
              (t.prototype.name = "InvalidCharacterError"),
              e.btoa ||
                (e.btoa = function (e) {
                  for (
                    var n, a, o = String(e), r = 0, s = i, l = "";
                    o.charAt(0 | r) || ((s = "="), r % 1);
                    l += s.charAt(63 & (n >> (8 - (r % 1) * 8)))
                  ) {
                    if ((a = o.charCodeAt((r += 0.75))) > 255)
                      throw new t(
                        "'btoa' failed: The string to be encoded contains characters outside of the Latin1 range."
                      );
                    n = (n << 8) | a;
                  }
                  return l;
                }),
              e.atob ||
                (e.atob = function (e) {
                  var n = String(e).replace(/=+$/, "");
                  if (n.length % 4 == 1)
                    throw new t(
                      "'atob' failed: The string to be decoded is not correctly encoded."
                    );
                  for (
                    var a, o, r = 0, s = 0, l = "";
                    (o = n.charAt(s++));
                    ~o && ((a = r % 4 ? 64 * a + o : o), r++ % 4)
                      ? (l += String.fromCharCode(255 & (a >> ((-2 * r) & 6))))
                      : 0
                  )
                    o = i.indexOf(o);
                  return l;
                });
          })();
      },
    };
  }),
  define(
    "storymaps/common/utils/SocialSharing",
    ["dojo/Deferred", "esri/urlUtils"],
    function (t, e) {
      return {
        shareFacebook: function (t, e, i, n) {
          var a = this.cleanURL(n || document.location.href);
          window.open(
            "http://www.facebook.com/sharer/sharer.php?u=" + a,
            "",
            "toolbar=0,status=0,width=626,height=436"
          );
        },
        shareTwitter: function (t, e) {
          var i =
            "text=" +
            encodeURIComponent(t || "") +
            "&url=" +
            this.cleanURL(e || document.location.href) +
            "&related=EsriStoryMaps&hashtags=StoryMaps";
          window.open(
            "https://twitter.com/intent/tweet?" + i,
            "",
            "toolbar=0,status=0,width=626,height=436"
          );
        },
        requestShortUrl: function (e) {
          var i = e || document.location.href,
            n = new t();
          return (
            $.getJSON(
              "https://arcg.is/prod/shorten?callback=?",
              { longUrl: i },
              function (t) {
                console.log(t),
                  t && t && t.data.url ? n.resolve(t.data.url) : n.reject();
              }
            ),
            n
          );
        },
        cleanURL: function (t, i) {
          var n = e.urlToObject(t),
            a = n.path;
          return (
            n.query &&
              (delete n.query.edit,
              delete n.query.locale,
              delete n.query.folderId,
              delete n.query.webmap,
              delete n.query.autoplay,
              $.each(Object.keys(n.query), function (t, e) {
                (a += 0 === t ? "?" : "&"),
                  void 0 !== n.query[e] && "" !== n.query[e]
                    ? (a += e + "=" + n.query[e])
                    : (a += e);
              })),
            i ? a : encodeURIComponent(a)
          );
        },
      };
    }
  ),
  define(
    "storymaps/common/utils/CommonHelper",
    [
      "dojo/cookie",
      "dojo/has",
      "dojo/_base/lang",
      "dojo/_base/Color",
      "dojo/Deferred",
      "dojo/DeferredList",
      "./SocialSharing",
      "esri/IdentityManager",
      "esri/request",
      "esri/dijit/Search",
      "esri/tasks/locator",
      "esri/urlUtils",
      "esri/arcgis/utils",
      "esri/geometry/webMercatorUtils",
      "esri/geometry/Point",
      "esri/geometry/Extent",
      "esri/geometry/Polygon",
      "esri/layers/FeatureLayer",
      "esri/layers/ArcGISDynamicMapServiceLayer",
      "esri/layers/ArcGISTiledMapServiceLayer",
      "esri/layers/OpenStreetMapLayer",
      "dojo/i18n!commonResources/nls/webmap.js?v=" + app.version,
      "dojo/i18n!commonResources/nls/media.js?v=" + app.version,
    ],
    function (
      t,
      e,
      i,
      n,
      a,
      o,
      r,
      s,
      l,
      d,
      p,
      c,
      u,
      h,
      f,
      m,
      g,
      b,
      v,
      y,
      w,
      C,
      _
    ) {
      return {
        isMobile: function () {
          return (
            navigator.userAgent.match(/iPhone|iPad|iPod/i) ||
            navigator.userAgent.match(/Android/i) ||
            navigator.userAgent.match(/BlackBerry/i) ||
            navigator.userAgent.match(/IEMobile/i)
          );
        },
        switchToBuilder: function () {
          document.location.search.match(/appid/)
            ? (document.location =
                r.cleanURL(
                  document.location.protocol +
                    "//" +
                    document.location.host +
                    document.location.pathname +
                    document.location.search,
                  !0
                ) +
                "&edit" +
                document.location.hash)
            : (document.location.search.slice(-1),
              (document.location =
                r.cleanURL(
                  document.location.protocol +
                    "//" +
                    document.location.host +
                    document.location.pathname,
                  !0
                ) +
                "?edit" +
                document.location.hash));
        },
        isArcGISHosted: function () {
          return /(\/)([a-zA-Z0-9]+(\/))*(apps\/|home\/)([a-zA-Z0-9\-\_]+\/)/.test(
            document.location.pathname
          );
        },
        browserSupportHistory: function () {
          return !(!window.history || !history.pushState);
        },
        getUrlParams: function () {
          var t = c.urlToObject(document.location.search).query;
          return (
            t ||
            (this.browserSupportHistory() || t
              ? {}
              : c.urlToObject(document.location.hash).query || {})
          );
        },
        getWebmapID: function (t) {
          var e = this.getUrlParams();
          return app.indexCfg && app.indexCfg.webmap
            ? app.indexCfg.webmap
            : this.isArcGISHosted() || !t
            ? e.webmap
            : app.indexCfg.authorizedOwners &&
              app.indexCfg.authorizedOwners.length > 0 &&
              app.indexCfg.authorizedOwners[0]
            ? e.webmap
            : void 0;
        },
        getAppID: function (t) {
          var e = this.getUrlParams();
          return app.indexCfg && app.indexCfg.appid
            ? app.indexCfg.appid
            : this.isArcGISHosted() || !t
            ? e.appid
            : app.indexCfg.authorizedOwners &&
              app.indexCfg.authorizedOwners.length > 0 &&
              app.indexCfg.authorizedOwners[0]
            ? e.appid
            : void 0;
        },
        getGraphicsLayerByName: function (t, e) {
          for (var i, n = 0; n < t.graphicsLayerIds.length; n++)
            if (((i = t.getLayer(t.graphicsLayerIds[n])), i.name == e))
              return i;
          return null;
        },
        getWebMapExtentFromItem: function (t) {
          if (!t.extent || 2 != t.extent.length) return null;
          var e = h.geographicToWebMercator(
              new f(t.extent[0][0], t.extent[0][1])
            ),
            i = h.geographicToWebMercator(
              new f(t.extent[1][0], t.extent[1][1])
            );
          return new m({
            xmax: i.x,
            xmin: e.x,
            ymax: i.y,
            ymin: e.y,
            spatialReference: { wkid: 102100 },
          });
        },
        serializeExtentToItem: function (t) {
          if (!t || !t.spatialReference) return null;
          var e =
            4326 == t.spatialReference.wkid ? t : h.webMercatorToGeographic(t);
          return [
            [Math.round(1e4 * e.xmin) / 1e4, Math.round(1e4 * e.ymin) / 1e4],
            [Math.round(1e4 * e.xmax) / 1e4, Math.round(1e4 * e.ymax) / 1e4],
          ];
        },
        serializedExtentEquals: function (t, e) {
          return (
            t &&
            e &&
            t.length == e.length &&
            2 == t.length &&
            t[0][0] == e[0][0] &&
            t[0][1] == e[0][1] &&
            t[1][0] == e[1][0] &&
            t[1][1] == e[1][1]
          );
        },
        extentsAreCloseEnough: function (t, e, i, n) {
          if ((i = i || app.map)) {
            void 0 === n && (n = 30);
            var a = i.toScreen(
                new f({
                  x: t.xmin,
                  y: t.ymin,
                  spatialReference: t.spatialReference,
                })
              ),
              o = i.toScreen(
                new f({
                  x: e.xmin,
                  y: e.ymin,
                  spatialReference: e.spatialReference,
                })
              );
            if (Math.abs(a.x - o.x) > n || Math.abs(a.y - o.y) > n) return !1;
            var r = i.toScreen(
                new f({
                  x: t.xmax,
                  y: t.ymax,
                  spatialReference: t.spatialReference,
                })
              ),
              s = i.toScreen(
                new f({
                  x: e.xmax,
                  y: e.ymax,
                  spatialReference: e.spatialReference,
                })
              );
            return !(Math.abs(r.x - s.x) > n || Math.abs(r.y - s.y) > n);
          }
        },
        cloneLayer: function (t) {
          return t.url && t.url.match(/virtualearth\./)
            ? new y(
                "http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"
              )
            : t instanceof y
            ? new y(t.url)
            : t instanceof v
            ? new v(t.url)
            : "OpenStreetMap" == t.id
            ? new w()
            : new y(
                "http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"
              );
        },
        extentToPolygon: function (t) {
          var e = new g(t.spatialReference);
          return (
            e.addRing([
              [t.xmin, t.ymin],
              [t.xmin, t.ymax],
              [t.xmax, t.ymax],
              [t.xmax, t.ymin],
              [t.xmin, t.ymin],
            ]),
            e
          );
        },
        getFirstLevelWhereExtentFit: function (t, e) {
          var i = e.width,
            n = e.height,
            a = e._params.lods;
          if (!a) return -1;
          for (var o = a.length - 1; o >= 0; o--)
            if (
              i * e._params.lods[o].resolution > t.getWidth() &&
              n * e._params.lods[o].resolution > t.getHeight()
            )
              return o;
          return -1;
        },
        getPortalUser: function () {
          var e = t("esri_auth");
          if (
            e &&
            ((e = JSON.parse(e.replace('"ssl":undefined', '"ssl":""'))),
            !e.urlKey ||
              !e.customBaseUrl ||
              (e.urlKey + "." + e.customBaseUrl).toLowerCase() ==
                document.location.hostname.toLowerCase())
          )
            return e ? e.email : null;
        },
        getPortalRole: function () {
          var e = t("esri_auth");
          if (
            e &&
            ((e = JSON.parse(e.replace('"ssl":undefined', '"ssl":""'))),
            !e.urlKey ||
              !e.customBaseUrl ||
              (e.urlKey + "." + e.customBaseUrl).toLowerCase() ==
                document.location.hostname.toLowerCase())
          )
            return e ? e.role : null;
        },
        getAppViewModeURL: function () {
          return (
            document.location.protocol +
            "//" +
            document.location.host +
            document.location.pathname +
            "?appid=" +
            app.data.getWebAppItem().id
          );
        },
        getWebmapViewerLinkFromSharingURL: function (t) {
          return t.split("/sharing/")[0] + "/home/webmap/viewer.html";
        },
        getPortalURL: function () {
          return u.arcgisUrl.split("/sharing/")[0];
        },
        getItemURL: function (t) {
          return this.getPortalURL() + "/home/item.html?id=" + t;
        },
        getItemId: function () {
          return (
            app.data && app.data.getWebAppItem && app.data.getWebAppItem().id
          );
        },
        getMyContentURL: function () {
          return this.getPortalURL() + "/home/content.html";
        },
        getMyStoriesURL: function () {
          return app.isPortal
            ? this.getPortalURL() + "/apps/MyStories/"
            : "//storymaps.arcgis.com/en/my-stories/";
        },
        browserSupportAttachementUsingFileReader: function () {
          return !!(
            window.FileReader &&
            window.FormData &&
            this.browserSupportCanvas() &&
            window.Blob
          );
        },
        browserSupportCanvas: function () {
          var t = document.createElement("canvas");
          return !(!t.getContext || !t.getContext("2d"));
        },
        browserSupportFileReaderBinaryString: function () {
          return (
            !!window.FileReader &&
            !!("readAsArrayBuffer" in new window.FileReader())
          );
        },
        getBinaryStringFromArrayBuffer: function (t) {
          for (var e = new Uint8Array(t), i = "", n = 0; n < e.length; n++)
            i += String.fromCharCode(e[n]);
          return i;
        },
        addCSSRule: function (t, i, n) {
          var a = "head";
          if (!(e("ie") <= 8)) {
            if ((n && (a = n.contents().find("head")), i)) {
              var o = $(a)
                .find("#" + i)
                .eq(0);
              if (o.length) return void o.html(t);
            }
            $("<style>")
              .prop("type", "text/css")
              .attr("id", i)
              .html(t)
              .appendTo(a);
          }
        },
        hex2rgba: function (t, e) {
          if (!t || "" === t) return "";
          var i,
            n = t.replace("#", "").match(/../g),
            a = [];
          for (i in n) a.push(parseInt(n[i], 16));
          return a.push(e), "rgba(" + a.join() + ")";
        },
        prependURLHTTP: function (t) {
          return !t || "" === t || t.match(/^mailto:/)
            ? t
            : /^(https?:\/\/)|^(\/\/)/i.test(t)
            ? t
            : "http://" + t;
        },
        convertURLHTTPS: function (t) {
          return !t || "" === t || t.match(/^mailto:/)
            ? t
            : ((t = t.replace(/http:\/\//, "https://")),
              (t = t.replace(/^\/\//, "https://")),
              /^(https:\/\/)/i.test(t) ? t : "https://" + t);
        },
        convertURLHTTP: function (t) {
          return !t || "" === t || t.match(/^mailto:/)
            ? t
            : ((t = t.replace(/https:\/\//, "http://")),
              (t = t.replace(/^\/\//, "http://")),
              /^(http:\/\/)/i.test(t) ? t : "http://" + t);
        },
        checkImageURL: function (t) {
          return t && t.match(/((\.png)|(\.jp(e)?g))$/i);
        },
        createGeocoder: function (t) {
          var e = new a();
          if (!t || !t.map || !t.domNode) return e.resolve(), e;
          if (!app.cfg.HELPER_SERVICES.geocode) return e.resolve(), e;
          var i = [],
            n = [],
            r = [],
            s = this;
          t.searchOptions &&
            t.searchOptions.layers &&
            t.searchOptions.layers.length &&
            t.searchOptions.enabled &&
            (n = this.getLayerSources(
              t.searchOptions.layers,
              t.map,
              t.searchOptions.hintText
            ));
          var l = s.processAppDataGeocoders(t.placeHolder);
          if (
            (n.length && (r = n),
            (!t.searchOptions ||
              (t.searchOptions && !t.searchOptions.disablePlaceFinder)) &&
              ((r = r.concat(l || [])),
              $.each(app.cfg.HELPER_SERVICES.geocode, function (t, e) {
                i.push(s.getGeocoderRequest(e));
              })),
            t.searchOptions && t.searchOptions.disablePlaceFinder && !r.length)
          )
            if (l && l.length) r.push(l[0]);
            else if (
              app.cfg.HELPER_SERVICES.geocode &&
              app.cfg.HELPER_SERVICES.geocode.length
            ) {
              var p = !1;
              $.each(app.cfg.HELPER_SERVICES.geocode, function (t, e) {
                !p && e.url && (i.push(s.getGeocoderRequest(e)), (p = !0));
              });
            } else r = null;
          var c = {
            map: t.map,
            allPlaceholder: t.placeHolder,
            enableButtonMode: t.enableButtonMode,
          };
          r && r.length
            ? (this.checkForSourceNameDuplicates(r), (c.sources = r))
            : (c.placeholder =
                t.placeHolder || _.commonMedia.editorActionGeocode.lblTitle);
          var u = new d(c, t.domNode);
          if (i.length) {
            new o(i).then(function (i) {
              var n = s.processGeocoderRequestReturn(i, t.placeHolder),
                a = u.get("sources").concat(n || []);
              a.length && (s.setGeocodeSources(u, a), e.resolve(u));
            });
          } else {
            var h = u.get("sources");
            h.length && (s.setGeocodeSources(u, h), e.resolve(u));
          }
          return e;
        },
        getGeocoderRequest: function (t) {
          var e = { url: t.url, content: { f: "json" }, handleAs: "json" };
          return (
            app.isInBuilder || app.portal.user
              ? (e.callbackParamName = "callback")
              : (e.disableIdentityLookup = !0),
            l(e)
          );
        },
        getLayerSources: function (t, e, i) {
          var n = this;
          return $.map(t, function (t) {
            var a = e.getLayer(t.id),
              o = {
                featureLayer: a,
                searchFields: [t.field.name],
                displayField: t.field.name,
                exactMatch: t.field.exactMatch,
                outFields: ["*"],
                maxResults: 6,
                name: n.findGeocoderName(a, t),
                placeholder: i,
              };
            if (t.subLayer || 0 === t.subLayer) {
              var r;
              t.subLayer;
              (r = a.dynamicLayerInfos) &&
                (r = r[t.subLayer]) &&
                (r = r.source) &&
                r.mapLayerId,
                (o.featureLayer = new b(a.url + "/" + t.subLayer));
            }
            return o;
          });
        },
        processGeocoderRequestReturn: function (t, e) {
          var i = [],
            n = this;
          return (
            $.each(t, function (t, a) {
              if (a[0] && a[1] && a[1].singleLineAddressField) {
                var o = app.cfg.HELPER_SERVICES.geocode[t],
                  r = new p(o.url),
                  s = {
                    singleLineFieldName: a[1].singleLineAddressField.name,
                    name: o.name ? o.name : a[1].name,
                    placeholder:
                      o.placeholder ||
                      e ||
                      _.commonMedia.editorActionGeocode.lblTitle,
                    locator: r,
                  };
                (s.name = s.name || n.findGeocoderName({ url: r.url })),
                  n.isEsriGeocoder({ url: o.url }) &&
                    (s.placeholder =
                      _.commonMedia.editorActionGeocode.lblTitle),
                  (!a[1].capabilities ||
                    a[1].capabilities.toLowerCase().indexOf("suggest") < 0) &&
                    (s.enableSuggestions = !1),
                  i.push(s);
              }
            }),
            i
          );
        },
        processAppDataGeocoders: function (t) {
          if (app.data.getWebAppData().getAppGeocoders) {
            var e = app.data.getWebAppData().getAppGeocoders();
            if (
              (e ||
                (e = [
                  {
                    name: "Esri World Geocoder",
                    url: "//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",
                    singleLineFieldName: "SingleLine",
                  },
                ]),
              !e.length)
            )
              return [];
            e = e.slice();
            var n = [],
              a = this;
            return (
              $.each(e, function (e, o) {
                if (o.url) {
                  var r = i.mixin({}, o);
                  (r.locator = new p(r.url)),
                    a.isEsriGeocoder({ url: r.url })
                      ? ((r.placeholder =
                          _.commonMedia.editorActionGeocode.lblTitle),
                        (r.name = C.commonWebmap.selector.lblEsriGeocoder))
                      : ((r.placeholder = r.placeholder || t),
                        (r.name =
                          r.name || a.findGeocoderName({ url: r.url }))),
                    n.push(r);
                }
              }),
              n
            );
          }
        },
        setGeocodeSources: function (t, e) {
          this.checkForSourceNameDuplicates(e),
            t.set("sources", e),
            t.set("activeSourceIndex", 0),
            t.startup(),
            app.data.getWebAppData().getAppGeocoders &&
              !app.data.getWebAppData().getAppGeocoders() &&
              t._allIndex &&
              t.set("activeSourceIndex", t._allIndex);
        },
        checkForSourceNameDuplicates: function (t) {
          var e = [],
            i = this;
          $.each(t, function (t, n) {
            e.indexOf(n.name) >= 0 &&
              (n.name = i.getAdjustedSourceName(e, n.name)),
              e.push(n.name);
          });
        },
        getAdjustedSourceName: function (t, e) {
          for (var i = 2, n = e + " - " + i; t.indexOf(n) >= 0; )
            i++, (n = e + " - " + i);
          return n;
        },
        isEsriGeocoder: function (t) {
          return t.url
            ? t.url.match(
                /geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g
              )
            : (console.warn("no url on locator", t), !1);
        },
        findGeocoderName: function (t, e) {
          var i = e ? e.name || e.title : "";
          if (!i) {
            (app.mapItem ? app.mapItem.itemData.operationalLayers : []).some(
              function (e) {
                return e.id === t.id && ((i = e.title), !0);
              }
            );
          }
          if (!(i = i || t.name || t.title)) {
            if (!this.isEsriGeocoder(t)) {
              if ("string" == typeof t.url && t.url.split) {
                var n = t.url.split("/"),
                  a = n[n.length - 2];
                return void (a && (i = a));
              }
              return;
            }
            i = C.commonWebmap.selector.lblEsriGeocoder;
          }
          if (e && (e.subLayer || 0 === e.subLayer)) {
            var o = t.dynamicLayerInfos || t.layerInfos,
              r = o[e.subLayer];
            r && r.name && (i += " - " + r.name);
          }
          return i.replace(/_/g, " ");
        },
        colorsAreSimilar: function (t, e, i) {
          var n = this.getLuminance(t),
            a = this.getLuminance(e),
            o = (n + 0.05) / (a + 0.05);
          return a > n && (o = 1 / o), !(o >= 2.85 || (i && o >= 2.2));
        },
        getLuminance: function (t) {
          var e = new n(t),
            i = e.toRgb().map(function (t) {
              return (
                (t /= 255),
                t < 0.03928 ? t / 12.92 : Math.pow((t + 0.055) / 1.055, 2.4)
              );
            });
          return 0.2126 * i[0] + 0.7152 * i[1] + 0.0722 * i[2];
        },
        convertToDegrees: function (t) {
          var e = t[0].numerator,
            i = t[0].denominator,
            n = parseFloat(e) / parseFloat(i),
            a = t[1].numerator,
            o = t[1].denominator,
            r = parseFloat(a) / parseFloat(o),
            s = t[2].numerator,
            l = t[2].denominator;
          return n + r / 60 + parseFloat(s) / parseFloat(l) / 3600;
        },
        debounce: function (t, e, i) {
          var n;
          return function () {
            var a = this,
              o = arguments;
            clearTimeout(n),
              (n = setTimeout(function () {
                (n = null), i || t.apply(a, o);
              }, e)),
              i && !n && t.apply(a, o);
          };
        },
        findDifferences: function (t, e) {
          var i = [],
            n = ["this"];
          return (
            (function (t, e) {
              if (t.constructor == Array)
                if (e && e.constructor == Array && e.length == t.length)
                  for (var a = 0; a < t.length; a++)
                    n.push("[" + a.toString() + "]"),
                      arguments.callee(t[a], e[a]),
                      n.pop();
                else i.push({ Property: n.join(""), ObjectA: t, ObjectB: e });
              else if (
                t.constructor == Object ||
                (t.constructor != Number &&
                  t.constructor != String &&
                  t.constructor != Date &&
                  t.constructor != RegExp &&
                  t.constructor != Function &&
                  t.constructor != Boolean)
              )
                for (var o in t)
                  n.push("." + o),
                    e[o]
                      ? t[o] &&
                        t[o].constructor != Function &&
                        arguments.callee(t[o], e[o])
                      : i.push({
                          Property: n.join(""),
                          ObjectA: t[o],
                          ObjectB: null,
                        }),
                    n.pop();
              else
                t.constructor != Function &&
                  t != e &&
                  i.push({ Property: n.join(""), ObjectA: t, ObjectB: e });
            })(t, e),
            i
          );
        },
        possiblyAddToken: function (t) {
          if (!this.isAppResource(t)) return t;
          if (((t = this.removeToken(t)), !this.needsTokenAdded(t))) return t;
          var e = "";
          return (
            (e =
              app.portal && app.portal.getPortalUser()
                ? app.portal.getPortalUser().credential.token
                : s.findCredential(document.location.origin)
                ? s.findCredential(document.location.origin).token
                : s.findCredential(app.portal.url)
                ? s.findCredential(app.portal.url).token
                : this.getCookieToken()),
            this.forceHttps(t) + "?token=" + e
          );
        },
        forceHttps: function (t) {
          return "https://" + t.replace(/^.*?\/\//, "");
        },
        isAppResource: function (t, e) {
          return (
            e ||
              (e =
                app.data && app.data.getWebAppItem && app.data.getWebAppItem()),
            !!e &&
              e &&
              e.id &&
              t &&
              t.match(
                new RegExp(
                  "/sharing/rest/content/items/" + e.id + "/resources/"
                )
              )
          );
        },
        needsTokenAdded: function (t) {
          var e =
            app.data && app.data.getWebAppItem && app.data.getWebAppItem();
          return !!e && this.isAppResource(t, e) && "public" !== e.access;
        },
        getCookieToken: function () {
          var e = t("esri_auth");
          if (
            e &&
            ((e = JSON.parse(e.replace('"ssl":undefined', '"ssl":""'))),
            !e.urlKey ||
              !e.customBaseUrl ||
              (e.urlKey + "." + e.customBaseUrl).toLowerCase() ==
                document.location.hostname.toLowerCase())
          )
            return e ? e.token : null;
        },
        possiblyRemoveToken: function (t) {
          return this.isAppResource(t) ? this.removeToken(t) : t;
        },
        removeToken: function (t) {
          return t.split("?token=")[0];
        },
      };
    }
  ),
  define("storymaps/common/ui/EmbedBar/EmbedBar", [], function () {
    "use strict";
    return function (t) {
      function e() {
        var e = document.location.href;
        $.getJSON(
          "https://arcg.is/prod/shorten?callback=?",
          {
            format: "json",
            apiKey: t.bitlyCreds[0],
            login: t.bitlyCreds[1],
            longUrl: e,
          },
          function (t) {
            t &&
              t &&
              t.data.url &&
              (document.querySelector(".embed-bitlylink").value = t.data.url);
          }
        );
      }
      if (
        ((this.initiated = !1),
        !(
          t.isBuilder ||
          t.classicEmbedMode ||
          t.appCreationDate < t.june2018ReleaseDate
        ) && ((window.app.isEsriStoryMap = !0), window.top !== window.self))
      ) {
        try {
          parent.window.app.isEsriStoryMap &&
            (window.app.isEmbeddedInEsriStoryMap = !0);
        } catch (t) {
          window.app.isEmbeddedInEsriStoryMap = !1;
        }
        if (!window.app.isEmbeddedInEsriStoryMap) {
          var i =
              '      <div class="embed-left">        <div class="esri-logo-embed">          <a target="_blank" href="https://www.esri.com">\t\t\t\t\t\t<img alt="Esri logo" class="embedLogoImg" src=' +
              t.logoPath +
              ' style="outline: none;">          </a>        </div>        <div class="esri-tagline-embed"><a href="https://storymaps.arcgis.com" target="_blank">' +
              t.strings.tagline +
              '</a></div>      </div>      <div class="embed-right">        <div class="share-embed" title="' +
              t.strings.share +
              '">          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path id="shareIcon" fill="#505050" d="M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z"/></svg>        </div>        <div class="open-newtab-embed" title="' +
              t.strings.newTab +
              '">          <a href=' +
              window.location.href +
              ' target="_blank">            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 577 512"><path id="newTabIcon" fill="#505050" d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"/></svg>          </a>        </div>        <div class="fullscreen-embed " title="' +
              t.strings.fullScreen +
              '">          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path id="fullscreenIcon" fill="#505050" d="M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z"/></svg>          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path id="compressIcon" fill="#505050" d="M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"/></svg>        </div>      </div>    ',
            n =
              '      <div class="embed-share-modal">        <div class="embed-modal-content">          <div class="embed-modal-logo">            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path id="shareIconLogo" fill="#fff" d="M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z"/></svg>          </div>          <div class="embed-modal-header">            <h4 class="embed-modal-title">' +
              t.strings.share +
              '</h4>          </div>          <div class="embed-modal-body">            <div class="embed-share-url-social">              <div class="embed-share-url-panel">                <div class="embed-share-url-container">                  <input type="text" id="embed-bitlylink" class="form-control embed-bitlylink" aria-label="bitly link">                  <a class="btn embed-bar-btn btn-primary btn-bitlylink-open" target="_blank" href="' +
              window.location.href +
              '">' +
              t.strings.open +
              '</a>                </div>              </div>            </div>            <div class="embed-share-social-container">              <div class="social-icon embed-share-facebook" title="' +
              t.strings.shareFacebook +
              '" aria-label="Share on Facebook button">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path id="facebookIcon" fill="#505050" d="M448 80v352c0 26.5-21.5 48-48 48h-85.3V302.8h60.6l8.7-67.6h-69.3V192c0-19.6 5.4-32.9 33.5-32.9H384V98.7c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9H184v67.6h60.9V480H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48z"/></svg>              </div>              <div class="social-icon embed-share-twitter" title="' +
              t.strings.shareTwitter +
              '" aria-label="Share on Twitter button">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path id="twitterIcon" fill="#505050" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>              </div>            </div>          </div>          <div class="embed-modal-footer">            <button type="button" class="btn embed-bar-btn btnCancel btn-naked btn-close" data-dismiss="modal">' +
              t.strings.close +
              "</button>          </div>        </div>      </div>    ",
            a = !1,
            o = null,
            r = function () {
              document.querySelector("body").appendChild(_),
                document.querySelector("body").appendChild(S),
                s()
                  ? (document.querySelector(
                      ".open-newtab-embed"
                    ).style.display = "none")
                  : (document.querySelector(".fullscreen-embed").style.display =
                      "none"),
                d(),
                p();
            },
            s = function () {
              return (
                document.fullscreenEnabled ||
                document.webkitFullscreenEnabled ||
                document.mozFullScreenEnabled ||
                document.msFullscreenEnabled
              );
            },
            l = function () {
              return (
                document.fullscreenElement ||
                document.webkitFullscreenElement ||
                document.mozFullScreenElement ||
                document.msFullscreenElement
              );
            },
            d = function () {
              if (t.isEsriLogo)
                for (var e = 0; e < t.logoElements.length; e++)
                  document.querySelector(
                    t.logoElements[e].selector
                  ).style.display = "none";
              for (var i = 0; i < t.shareElements.length; i++)
                if (t.shareElements[i].length > 1)
                  for (var n = 0; n < t.shareElements[i].length; n++)
                    t.shareElements[i][n].style.display = "none";
                else
                  document.querySelector(
                    t.shareElements[i].selector
                  ).style.display = "none";
              for (var a = 0; a < t.taglineElements.length; a++)
                if (t.taglineElements[a].length > 1)
                  for (var o = 0; o < t.taglineElements[a].length; o++)
                    t.taglineElements[a][o].textContent &&
                      "a story map" ==
                        t.taglineElements[a][o].textContent.toLowerCase() &&
                      (t.taglineElements[a][o].style.display = "none");
                else
                  t.taglineElements[a].text() &&
                    "a story map" ==
                      t.taglineElements[a].text().toLowerCase() &&
                    (document.querySelector(
                      t.taglineElements[a].selector
                    ).style.display = "none");
            },
            p = function () {
              document
                .querySelector(".fullscreen-embed")
                .addEventListener("click", u),
                document
                  .querySelector(".share-embed")
                  .addEventListener("click", b),
                document
                  .querySelector(".embed-modal-footer .btn-close")
                  .addEventListener("click", v),
                document
                  .querySelector(".embed-share-facebook")
                  .addEventListener("click", y),
                document
                  .querySelector(".embed-share-twitter")
                  .addEventListener("click", w),
                window.addEventListener("fullscreenchange", c),
                window.addEventListener("webkitfullscreenchange", c),
                window.addEventListener("mozfullscreenchange", c),
                window.addEventListener("msfullscreenchange", c);
            },
            c = function () {
              s() &&
                (l()
                  ? h()
                  : (document
                      .querySelector("body")
                      .classList.contains("fullscreen") &&
                      document
                        .querySelector("body")
                        .classList.toggle("fullscreen"),
                    (document.querySelectorAll(
                      ".fullscreen-embed svg"
                    )[0].style.display = "block"),
                    (document.querySelectorAll(
                      ".fullscreen-embed svg"
                    )[1].style.display = "none"),
                    a || f()));
            },
            u = function () {
              var e = document.querySelector("body");
              s()
                ? (m(),
                  e.classList.contains("fullscreen")
                    ? (document.exitFullscreen
                        ? document.exitFullscreen()
                        : document.webkitExitFullscreen
                        ? document.webkitExitFullscreen()
                        : document.mozCancelFullScreen
                        ? document.mozCancelFullScreen()
                        : document.msExitFullscreen &&
                          document.msExitFullscreen(),
                      (document.querySelector(".fullscreen-embed").title =
                        t.strings.fullScreen),
                      (document.querySelectorAll(
                        ".fullscreen-embed svg"
                      )[0].style.display = "block"),
                      (document.querySelectorAll(
                        ".fullscreen-embed svg"
                      )[1].style.display = "none"))
                    : (e.requestFullscreen
                        ? e.requestFullscreen()
                        : e.webkitRequestFullscreen
                        ? e.webkitRequestFullscreen()
                        : e.mozRequestFullScreen
                        ? e.mozRequestFullScreen()
                        : e.msRequestFullscreen && e.msRequestFullscreen(),
                      e.classList.toggle("fullscreen"),
                      (document.querySelector(".fullscreen-embed").title =
                        t.strings.exitFullScreen),
                      (document.querySelectorAll(
                        ".fullscreen-embed svg"
                      )[1].style.display = "block"),
                      (document.querySelectorAll(
                        ".fullscreen-embed svg"
                      )[0].style.display = "none")))
                : ((document.querySelector(".fullscreen-embed").style.display =
                    "none"),
                  (document.querySelector(".open-newtab-embed").style.display =
                    "block"),
                  console.log("Full screen not available"));
            },
            h = function () {
              var t = app && app.map;
              t && (o = { height: t.height, width: t.width });
            },
            f = function () {
              var t = app && app.map ? app.map.extent.getCenter() : null;
              if (t && o) {
                var e = app.map.toScreen(t);
                (e.x = o.width / 2),
                  (e.y = o.height / 2),
                  app.map.centerAt(app.map.toMap(e));
              }
            },
            m = function () {
              var t = app && app.map ? app.map.extent.getCenter() : null;
              if (t) {
                a = !0;
                var e = g(function () {
                    app.map.centerAt(t), i.remove(), (a = !1);
                  }, 250),
                  i = app.map.on("resize", e);
              }
            },
            g = function (t, e, i) {
              var n;
              return function () {
                var a = this,
                  o = arguments,
                  r = function () {
                    (n = null), i || t.apply(a, o);
                  },
                  s = i && !n;
                clearTimeout(n), (n = setTimeout(r, e)), s && t.apply(a, o);
              };
            },
            b = function () {
              "block" ==
              document.querySelector(".embed-share-modal").style.display
                ? (document.querySelector(".embed-share-modal").style.display =
                    "none")
                : (document.querySelector(".embed-share-modal").style.display =
                    "block"),
                e();
            },
            v = function () {
              document.querySelector(".embed-share-modal").style.display =
                "none";
            },
            y = function () {
              window.open(
                "http://www.facebook.com/sharer/sharer.php?u=" +
                  document.location.href,
                "",
                "toolbar=0,status=0,width=626,height=436"
              );
            },
            w = function () {
              var e =
                "text=" +
                t.appTitle +
                "&url=" +
                document.location.href +
                "&related=EsriStoryMaps&hashtags=StoryMaps";
              window.open(
                "https://twitter.com/intent/tweet?" + e,
                "",
                "toolbar=0,status=0,width=626,height=436"
              );
            },
            C =
              '      <style type="text/css">        .embed-bar {          position: absolute;          bottom: 0;          left: 0;          width: 100%;          height: 26px;          font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;          background-color: #f1f1f1;          color: #505050;          z-index: 99999;          line-height: normal;        }        .embed-left {          position: absolute;          left: 10px;          margin-top: 5px;        }        .embed-right {          position: absolute;          right: 10px;          margin-top: 4px;        }        .embedLogoImg {          position: absolute;          top: 50%;          bottom: 50%;          left: 0px;          max-width: 250px;          max-height: 20px;          margin: auto 0;        }        .esri-tagline-embed {          margin-left: 70px;        }        .esri-tagline-embed :hover{          color: #036765;        }        .esri-tagline-embed a {          font-size: 15px;          font-weight: normal;          color: #505050;        }        .share-embed {          position: absolute;          top: 2px;          right: 22px;          padding-right: 8px;          outline: none;          cursor: pointer;        }        .open-newtab-embed {          position: absolute;          top: 2px;          right: 0px;          outline: none;        }        .fullscreen-embed {          position: absolute;          top: 2px;          right: 0px;          outline: none;          cursor: pointer;        }        .fullScreen {          width: 100%;          height: 100%;          position: absolute;          top: 0;          left: 0;        }        .embed-right svg {          width: 16px;          height: 16px;          cursor: pointer;        }        svg:hover #shareIcon,        svg:hover #newTabIcon,        svg:hover #fullscreenIcon,        svg:hover #compressIcon {          fill: #036765;        }      </style>    ' +
              i,
            _ = document.createElement("div");
          (_.className = "embed-bar"), (_.innerHTML = C);
          var x =
              '      <style type="text/css">        .embed-share-modal {          display: none;          position: fixed;          z-index: 999;          left: 0;          top: 0;          width: 100%;          height: 100%;          overflow: auto;          background-color: rgba(0,0,0, 0.4);        }        .embed-modal-content {          background-color: #fff;          margin: 15% auto;          padding: 20px;          border: 1px solid #888;          width: 80%;          max-width: 500px;          display: flex;          flex-direction: column;        }        .embed-modal-logo {          margin-top: -40px;          margin-left: -40px;          width: 40px;          height: 40px;          border: 4px solid #FFF;          border-radius: 24px;          background-color: #196fa6;          color: white;          font-size: 16px;          box-sizing: content-box;        }        .embed-modal-logo i{          margin-left: 8px;          margin-top: 7px;          font-size: 24px;        }        .embed-modal-header {          padding-bottom: 15px;        }        .embed-modal-title {          line-height: 1.1;          font-size: 19px;          font-weight: 200;          margin-top: -4px;        }        .embed-modal-body {          height: 60px;        }        .embed-share-url-social {          font-size: 10px;        }        .embed-share-social-container {          font-size: 2.5em;          color: #4c4c4c;        }        .embed-share-social-container i:hover {          cursor: pointer;          color: #036765;        }        .embed-share-facebook {          float: left;        }        .embed-share-twitter {          margin-left: 5px;          float: left;        }        #embed-bitlylink {          display: inline-block;          height: 38px;          width: 240px;          text-align: left;          font-size: 20px;          cursor: text;          padding: 0 0 0 10px;          line-height: 20px;          border: 1px solid #959595;          border-radius: 0;          background-color: #f8f8f8;          opacity: 1;        }        .embed-bar-btn {          background-image: none;          border: 1px solid transparent;          padding: 6px 12px;          font-size: 15px;          line-height: 1.5;          border-radius: 0;          margin-bottom: 0;          font-weight: 400;        }        .btn-bitlylink-open {          margin-top: 1px;          margin-bottom: 11px;          margin-left: 10px;          color: #fff;          background-color: #196fa6;          border-color: #166090;          text-transform: uppercase;        }        .btn-bitlylink-open:hover {          background-color: #005e95;          border-color: #005e95;        }        .embed-modal-footer {          margin-left: auto;          text-align: right;        }        .embed-modal-footer .btn-close {          background-color: #eee;          color: #6e6e6e;          margin-top: 20px;        }        .embed-modal-footer .btn-close:hover {          background-color: #ccc;          color: #6e6e6e;        }        .embed-modal-body svg {          width: 36px;          height: 36px;          cursor: pointer;        }        svg:hover #facebookIcon,        svg:hover #twitterIcon {          fill: #036765;        }        .embed-modal-logo svg  {          width: 24px;          height: 24px;          margin-top: 8px;          margin-left: 6px;        }        @media(max-width: 530px) {          .embed-share-url-container {            display: flex;            justify-content: flex-start;            align-items: stretch;            margin-bottom: 11px;          }          #embed-bitlylink {            width: auto;            min-width: 0;            max-width: 200px;            flex-grow: 1;            flex-shrink: 1;            flex-basis: 0;            padding-right: 10px;          }          .btn-bitlylink-open {            flex: 0 0 auto;          }        }      </style>    ' +
              n,
            S = document.createElement("div");
          (S.className = "embedbar-share-modal"),
            (S.innerHTML = x),
            setTimeout(function () {
              r();
            }, 0),
            (this.initiated = !0);
        }
      }
    };
  }),
  define(
    "storymaps/common/builder/PortalVersionTest",
    ["esri/arcgis/utils", "dojo/Deferred"],
    function (t, e) {
      function i() {
        return t.arcgisUrl.split("/sharing/")[0];
      }
      return {
        run: function () {
          var t = new e(),
            n = null;
          app.portal.hasMyStories = null;
          var a = new Image(),
            o = app.isProduction ? i() + "/apps/" : "../";
          return (
            (a.src = o + "MyStories/assets/my-stories-portal-detector.png"),
            (a.onload = function () {
              (app.portal.hasMyStories = !0), n && clearTimeout(n), t.resolve();
            }),
            (a.onerror = a.onabort =
              function () {
                (app.portal.hasMyStories = !1),
                  n && clearTimeout(n),
                  t.reject();
              }),
            (n = setTimeout(function () {
              t.reject();
            }, 2e3)),
            t
          );
        },
      };
    }
  ),
  define(
    "storymaps/common/builder/MyStoriesWrapper",
    [
      "./PortalVersionTest",
      "esri/IdentityManager",
      "storymaps/common/utils/CommonHelper",
      "dojo/topic",
    ],
    function (t, e, i, n) {
      function a() {
        t.run().then(function () {
          app.isProduction && !d() ? o() : r();
        }, o);
      }
      function o() {
        $(".check-story").hide(), $(window).resize();
      }
      function r() {
        (window.myStoriesInit = s), n.publish("MYSTORIES_SCAN", "start");
        var t = "../MyStories/index.html?fromBuilder";
        (t += "&locale=" + dojo.locale),
          setTimeout(function () {
            $("#my-stories-frame").attr("src", t);
          }, 1e3);
      }
      function s() {
        var t = $("#my-stories-frame")[0].contentWindow;
        return t && t.init && t.check && t.share
          ? app.data.getStoryLength() || app.appCfg.noStoryLengthRequired
            ? ((app.mystories = {
                init: t.init,
                check: t.check,
                share: t.share,
                isChecking: !1,
                hasCheckErrors: !1,
                hasScanErrors: !1,
              }),
              void app.mystories
                .init(
                  app.isInBuilder ? e.toJson() : null,
                  app.isDirectCreationFirstSave || app.isGalleryCreation
                    ? null
                    : app.data.getWebAppItem(),
                  app.cfg.TPL_ID,
                  app.isPortal,
                  function (t, e, i) {
                    n.publish("MY-STORIES-EDIT-MEDIA", {
                      index: t,
                      type: e,
                      actionId: i,
                    });
                  },
                  function (t) {
                    n.publish("MY-STORIES-EDIT-MAP", { id: t });
                  },
                  function () {
                    (app.mystories.hasCheckErrors = !1),
                      n.publish("MY-STORIES-REFRESH");
                  },
                  function (t) {
                    (t = t || { completed: !1, ignoreAllIssues: !1 }),
                      (app.mystories.hasCheckErrors = !t.ignoreAllIssues),
                      (app.mystories.forcedIgnoreIssues = t.ignoreAllIssues),
                      n.publish("MY-STORIES-REFRESH");
                  }
                )
                .then(l, function () {
                  console.error("Failed to initialize My Stories");
                }))
            : void console.log(
                "Skipping the initialization of My Stories until the story has content"
              )
          : void console.error("Failed to load My Stories");
      }
      function l() {
        if (app.mystories)
          return app.mystories.init
            ? void (
                app.mystories.check &&
                ((app.mystories.isChecking = !0),
                (app.mystories.hasCheckErrors = !1),
                n.publish("MYSTORIES_SCAN", "start"),
                app.mystories.check(app.data.getWebAppData().get()).then(
                  function (t) {
                    (t = t || { ignoreAllIssues: !1 }),
                      (app.mystories.isChecking = !1),
                      (app.mystories.hasCheckErrors = !1),
                      (app.mystories.forcedIgnoreIssues = t.ignoreAllIssues),
                      n.publish("MYSTORIES_SCAN", "success"),
                      $("#sharePopup").is(":visible") &&
                        app.builder.openSharePopup();
                  },
                  function (t) {
                    (t = t || { completed: !1, ignoreAllIssues: !1 }),
                      (app.mystories.isChecking = !1),
                      (app.mystories.hasCheckErrors = !0),
                      (app.mystories.forcedIgnoreIssues = t.ignoreAllIssues),
                      n.publish("MYSTORIES_SCAN", "error"),
                      $("#sharePopup").is(":visible") &&
                        app.builder.openSharePopup();
                  }
                ))
              )
            : void s();
      }
      function d() {
        var t = i.getPortalURL().split("//").slice(-1)[0],
          e = t.split("."),
          n = document.location.host,
          a = n.split(".");
        return (
          t == n ||
          (t.split("/").length > 1 && t.split("/")[0] == n) ||
          (a.length < 3
            ? n == t
            : a.slice(1).join(".") == e.slice(-2).join("."))
        );
      }
      return { loadMyStories: a, scanStory: l, myStoriesIsSameDomain: d };
    }
  ),
  (FastClick.prototype.deviceIsAndroid =
    navigator.userAgent.indexOf("Android") > 0),
  (FastClick.prototype.deviceIsIOS = /iP(ad|hone|od)/.test(
    navigator.userAgent
  )),
  (FastClick.prototype.deviceIsIOS4 =
    FastClick.prototype.deviceIsIOS &&
    /OS 4_\d(_\d)?/.test(navigator.userAgent)),
  (FastClick.prototype.deviceIsIOSWithBadTarget =
    FastClick.prototype.deviceIsIOS &&
    /OS ([6-9]|\d{2})_\d/.test(navigator.userAgent)),
  (FastClick.prototype.needsClick = function (t) {
    "use strict";
    switch (t.nodeName.toLowerCase()) {
      case "button":
      case "select":
      case "textarea":
        if (t.disabled) return !0;
        break;
      case "input":
        if ((this.deviceIsIOS && "file" === t.type) || t.disabled) return !0;
        break;
      case "label":
      case "video":
        return !0;
    }
    return /\bneedsclick\b/.test(t.className);
  }),
  (FastClick.prototype.needsFocus = function (t) {
    "use strict";
    switch (t.nodeName.toLowerCase()) {
      case "textarea":
        return !0;
      case "select":
        return !this.deviceIsAndroid;
      case "input":
        switch (t.type) {
          case "button":
          case "checkbox":
          case "file":
          case "image":
          case "radio":
          case "submit":
            return !1;
        }
        return !t.disabled && !t.readOnly;
      default:
        return /\bneedsfocus\b/.test(t.className);
    }
  }),
  (FastClick.prototype.sendClick = function (t, e) {
    "use strict";
    var i, n;
    document.activeElement &&
      document.activeElement !== t &&
      document.activeElement.blur(),
      (n = e.changedTouches[0]),
      (i = document.createEvent("MouseEvents")),
      i.initMouseEvent(
        this.determineEventType(t),
        !0,
        !0,
        window,
        1,
        n.screenX,
        n.screenY,
        n.clientX,
        n.clientY,
        !1,
        !1,
        !1,
        !1,
        0,
        null
      ),
      (i.forwardedTouchEvent = !0),
      t.dispatchEvent(i);
  }),
  (FastClick.prototype.determineEventType = function (t) {
    "use strict";
    return this.deviceIsAndroid && "select" === t.tagName.toLowerCase()
      ? "mousedown"
      : "click";
  }),
  (FastClick.prototype.focus = function (t) {
    "use strict";
    var e;
    this.deviceIsIOS &&
    t.setSelectionRange &&
    0 !== t.type.indexOf("date") &&
    "time" !== t.type
      ? ((e = t.value.length), t.setSelectionRange(e, e))
      : t.focus();
  }),
  (FastClick.prototype.updateScrollParent = function (t) {
    "use strict";
    var e, i;
    if (!(e = t.fastClickScrollParent) || !e.contains(t)) {
      i = t;
      do {
        if (i.scrollHeight > i.offsetHeight) {
          (e = i), (t.fastClickScrollParent = i);
          break;
        }
        i = i.parentElement;
      } while (i);
    }
    e && (e.fastClickLastScrollTop = e.scrollTop);
  }),
  (FastClick.prototype.getTargetElementFromEventTarget = function (t) {
    "use strict";
    return t.nodeType === Node.TEXT_NODE ? t.parentNode : t;
  }),
  (FastClick.prototype.onTouchStart = function (t) {
    "use strict";
    var e, i, n;
    if (t.targetTouches.length > 1) return !0;
    if (
      ((e = this.getTargetElementFromEventTarget(t.target)),
      (i = t.targetTouches[0]),
      this.deviceIsIOS)
    ) {
      if (((n = window.getSelection()), n.rangeCount && !n.isCollapsed))
        return !0;
      if (!this.deviceIsIOS4) {
        if (i.identifier === this.lastTouchIdentifier)
          return t.preventDefault(), !1;
        (this.lastTouchIdentifier = i.identifier), this.updateScrollParent(e);
      }
    }
    return (
      (this.trackingClick = !0),
      (this.trackingClickStart = t.timeStamp),
      (this.targetElement = e),
      (this.touchStartX = i.pageX),
      (this.touchStartY = i.pageY),
      t.timeStamp - this.lastClickTime < 200 && t.preventDefault(),
      !0
    );
  }),
  (FastClick.prototype.touchHasMoved = function (t) {
    "use strict";
    var e = t.changedTouches[0],
      i = this.touchBoundary;
    return (
      Math.abs(e.pageX - this.touchStartX) > i ||
      Math.abs(e.pageY - this.touchStartY) > i
    );
  }),
  (FastClick.prototype.onTouchMove = function (t) {
    "use strict";
    return (
      !this.trackingClick ||
      ((this.targetElement !== this.getTargetElementFromEventTarget(t.target) ||
        this.touchHasMoved(t)) &&
        ((this.trackingClick = !1), (this.targetElement = null)),
      !0)
    );
  }),
  (FastClick.prototype.findControl = function (t) {
    "use strict";
    return void 0 !== t.control
      ? t.control
      : t.htmlFor
      ? document.getElementById(t.htmlFor)
      : t.querySelector(
          "button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea"
        );
  }),
  (FastClick.prototype.onTouchEnd = function (t) {
    "use strict";
    var e,
      i,
      n,
      a,
      o,
      r = this.targetElement;
    if (!this.trackingClick) return !0;
    if (t.timeStamp - this.lastClickTime < 200)
      return (this.cancelNextClick = !0), !0;
    if (
      ((this.cancelNextClick = !1),
      (this.lastClickTime = t.timeStamp),
      (i = this.trackingClickStart),
      (this.trackingClick = !1),
      (this.trackingClickStart = 0),
      this.deviceIsIOSWithBadTarget &&
        ((o = t.changedTouches[0]),
        (r =
          document.elementFromPoint(
            o.pageX - window.pageXOffset,
            o.pageY - window.pageYOffset
          ) || r),
        (r.fastClickScrollParent = this.targetElement.fastClickScrollParent)),
      "label" === (n = r.tagName.toLowerCase()))
    ) {
      if ((e = this.findControl(r))) {
        if ((this.focus(r), this.deviceIsAndroid)) return !1;
        r = e;
      }
    } else if (this.needsFocus(r))
      return t.timeStamp - i > 100 ||
        (this.deviceIsIOS && window.top !== window && "input" === n)
        ? ((this.targetElement = null), !1)
        : (this.focus(r),
          (this.deviceIsIOS4 && "select" === n) ||
            ((this.targetElement = null), t.preventDefault()),
          !1);
    return (
      !(
        !this.deviceIsIOS ||
        this.deviceIsIOS4 ||
        !(a = r.fastClickScrollParent) ||
        a.fastClickLastScrollTop === a.scrollTop
      ) ||
      (this.needsClick(r) || (t.preventDefault(), this.sendClick(r, t)), !1)
    );
  }),
  (FastClick.prototype.onTouchCancel = function () {
    "use strict";
    (this.trackingClick = !1), (this.targetElement = null);
  }),
  (FastClick.prototype.onMouse = function (t) {
    "use strict";
    return (
      !this.targetElement ||
      !!t.forwardedTouchEvent ||
      !t.cancelable ||
      !(!this.needsClick(this.targetElement) || this.cancelNextClick) ||
      (t.stopImmediatePropagation
        ? t.stopImmediatePropagation()
        : (t.propagationStopped = !0),
      t.stopPropagation(),
      t.preventDefault(),
      !1)
    );
  }),
  (FastClick.prototype.onClick = function (t) {
    "use strict";
    var e;
    return this.trackingClick
      ? ((this.targetElement = null), (this.trackingClick = !1), !0)
      : ("submit" === t.target.type && 0 === t.detail) ||
          ((e = this.onMouse(t)), e || (this.targetElement = null), e);
  }),
  (FastClick.prototype.destroy = function () {
    "use strict";
    var t = this.layer;
    this.deviceIsAndroid &&
      (t.removeEventListener("mouseover", this.onMouse, !0),
      t.removeEventListener("mousedown", this.onMouse, !0),
      t.removeEventListener("mouseup", this.onMouse, !0)),
      t.removeEventListener("click", this.onClick, !0),
      t.removeEventListener("touchstart", this.onTouchStart, !1),
      t.removeEventListener("touchmove", this.onTouchMove, !1),
      t.removeEventListener("touchend", this.onTouchEnd, !1),
      t.removeEventListener("touchcancel", this.onTouchCancel, !1);
  }),
  (FastClick.notNeeded = function (t) {
    "use strict";
    var e, i;
    if (void 0 === window.ontouchstart) return !0;
    if ((i = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [, 0])[1])) {
      if (!FastClick.prototype.deviceIsAndroid) return !0;
      if ((e = document.querySelector("meta[name=viewport]"))) {
        if (-1 !== e.content.indexOf("user-scalable=no")) return !0;
        if (i > 31 && window.innerWidth <= window.screen.width) return !0;
      }
    }
    return "none" === t.style.msTouchAction;
  }),
  (FastClick.attach = function (t) {
    "use strict";
    return new FastClick(t);
  }),
  "undefined" != typeof define && define.amd
    ? define("lib-app/jquery.fastClick", [], function () {
        "use strict";
        return FastClick;
      })
    : "undefined" != typeof module && module.exports
    ? ((module.exports = FastClick.attach),
      (module.exports.FastClick = FastClick))
    : (window.FastClick = FastClick),
  "undefined" == typeof jQuery)
)
  throw new Error("Bootstrap's JavaScript requires jQuery");
+(function (t) {
  "use strict";
  var e = t.fn.jquery.split(" ")[0].split(".");
  if ((e[0] < 2 && e[1] < 9) || (1 == e[0] && 9 == e[1] && e[2] < 1))
    throw new Error(
      "Bootstrap's JavaScript requires jQuery version 1.9.1 or higher"
    );
})(jQuery),
  (function (t) {
    "use strict";
    function e(e) {
      var i = e.attr("data-target");
      i ||
        ((i = e.attr("href")),
        (i = i && /#[A-Za-z]/.test(i) && i.replace(/.*(?=#[^\s]*$)/, "")));
      var n = i && t(i);
      return n && n.length ? n : e.parent();
    }
    function i(i) {
      (i && 3 === i.which) ||
        (t(a).remove(),
        t(o).each(function () {
          var n = t(this),
            a = e(n),
            o = { relatedTarget: this };
          a.hasClass("open") &&
            ((i &&
              "click" == i.type &&
              /input|textarea/i.test(i.target.tagName) &&
              t.contains(a[0], i.target)) ||
              (a.trigger((i = t.Event("hide.bs.dropdown", o))),
              i.isDefaultPrevented() ||
                (n.attr("aria-expanded", "false"),
                a.removeClass("open").trigger("hidden.bs.dropdown", o))));
        }));
    }
    function n(e) {
      return this.each(function () {
        var i = t(this),
          n = i.data("bs.dropdown");
        n || i.data("bs.dropdown", (n = new r(this))),
          "string" == typeof e && n[e].call(i);
      });
    }
    var a = ".dropdown-backdrop",
      o = '[data-toggle="dropdown"]',
      r = function (e) {
        t(e).on("click.bs.dropdown", this.toggle);
      };
    (r.VERSION = "3.3.5"),
      (r.prototype.toggle = function (n) {
        var a = t(this);
        if (!a.is(".disabled, :disabled")) {
          var o = e(a),
            r = o.hasClass("open");
          if ((i(), !r)) {
            "ontouchstart" in document.documentElement &&
              !o.closest(".navbar-nav").length &&
              t(document.createElement("div"))
                .addClass("dropdown-backdrop")
                .insertAfter(t(this))
                .on("click", i);
            var s = { relatedTarget: this };
            if (
              (o.trigger((n = t.Event("show.bs.dropdown", s))),
              n.isDefaultPrevented())
            )
              return;
            a.trigger("focus").attr("aria-expanded", "true"),
              o.toggleClass("open").trigger("shown.bs.dropdown", s);
          }
          return !1;
        }
      }),
      (r.prototype.keydown = function (i) {
        if (
          /(38|40|27|32)/.test(i.which) &&
          !/input|textarea/i.test(i.target.tagName)
        ) {
          var n = t(this);
          if (
            (i.preventDefault(),
            i.stopPropagation(),
            !n.is(".disabled, :disabled"))
          ) {
            var a = e(n),
              r = a.hasClass("open");
            if ((!r && 27 != i.which) || (r && 27 == i.which))
              return (
                27 == i.which && a.find(o).trigger("focus"), n.trigger("click")
              );
            var s = a.find(".dropdown-menu li:not(.disabled):visible a");
            if (s.length) {
              var l = s.index(i.target);
              38 == i.which && l > 0 && l--,
                40 == i.which && l < s.length - 1 && l++,
                ~l || (l = 0),
                s.eq(l).trigger("focus");
            }
          }
        }
      });
    var s = t.fn.dropdown;
    (t.fn.dropdown = n),
      (t.fn.dropdown.Constructor = r),
      (t.fn.dropdown.noConflict = function () {
        return (t.fn.dropdown = s), this;
      }),
      t(document)
        .on("click.bs.dropdown.data-api", i)
        .on("click.bs.dropdown.data-api", ".dropdown form", function (t) {
          t.stopPropagation();
        })
        .on("click.bs.dropdown.data-api", o, r.prototype.toggle)
        .on("keydown.bs.dropdown.data-api", o, r.prototype.keydown)
        .on(
          "keydown.bs.dropdown.data-api",
          ".dropdown-menu",
          r.prototype.keydown
        );
  })(jQuery),
  (function (t) {
    "use strict";
    function e(e, n) {
      return this.each(function () {
        var a = t(this),
          o = a.data("bs.modal"),
          r = t.extend({}, i.DEFAULTS, a.data(), "object" == typeof e && e);
        o || a.data("bs.modal", (o = new i(this, r))),
          "string" == typeof e ? o[e](n) : r.show && o.show(n);
      });
    }
    var i = function (e, i) {
      (this.options = i),
        (this.$body = t(document.body)),
        (this.$element = t(e)),
        (this.$dialog = this.$element.find(".modal-dialog")),
        (this.$backdrop = null),
        (this.isShown = null),
        (this.originalBodyPad = null),
        (this.scrollbarWidth = 0),
        (this.ignoreBackdropClick = !1),
        this.options.remote &&
          this.$element.find(".modal-content").load(
            this.options.remote,
            t.proxy(function () {
              this.$element.trigger("loaded.bs.modal");
            }, this)
          );
    };
    (i.VERSION = "3.3.5"),
      (i.TRANSITION_DURATION = 300),
      (i.BACKDROP_TRANSITION_DURATION = 150),
      (i.DEFAULTS = { backdrop: !0, keyboard: !0, show: !0 }),
      (i.prototype.toggle = function (t) {
        return this.isShown ? this.hide() : this.show(t);
      }),
      (i.prototype.show = function (e) {
        var n = this,
          a = t.Event("show.bs.modal", { relatedTarget: e });
        this.$element.trigger(a),
          this.isShown ||
            a.isDefaultPrevented() ||
            ((this.isShown = !0),
            this.checkScrollbar(),
            this.setScrollbar(),
            this.$body.addClass("modal-open"),
            this.escape(),
            this.resize(),
            this.$element.on(
              "click.dismiss.bs.modal",
              '[data-dismiss="modal"]',
              t.proxy(this.hide, this)
            ),
            this.$dialog.on("mousedown.dismiss.bs.modal", function () {
              n.$element.one("mouseup.dismiss.bs.modal", function (e) {
                t(e.target).is(n.$element) && (n.ignoreBackdropClick = !0);
              });
            }),
            this.backdrop(function () {
              var a = t.support.transition && n.$element.hasClass("fade");
              n.$element.parent().length || n.$element.appendTo(n.$body),
                n.$element.show().scrollTop(0),
                n.adjustDialog(),
                a && n.$element[0].offsetWidth,
                n.$element.addClass("in"),
                n.enforceFocus();
              var o = t.Event("shown.bs.modal", { relatedTarget: e });
              a
                ? n.$dialog
                    .one("bsTransitionEnd", function () {
                      n.$element.trigger("focus").trigger(o);
                    })
                    .emulateTransitionEnd(i.TRANSITION_DURATION)
                : n.$element.trigger("focus").trigger(o);
            }));
      }),
      (i.prototype.hide = function (e) {
        e && e.preventDefault(),
          (e = t.Event("hide.bs.modal")),
          this.$element.trigger(e),
          this.isShown &&
            !e.isDefaultPrevented() &&
            ((this.isShown = !1),
            this.escape(),
            this.resize(),
            t(document).off("focusin.bs.modal"),
            this.$element
              .removeClass("in")
              .off("click.dismiss.bs.modal")
              .off("mouseup.dismiss.bs.modal"),
            this.$dialog.off("mousedown.dismiss.bs.modal"),
            t.support.transition && this.$element.hasClass("fade")
              ? this.$element
                  .one("bsTransitionEnd", t.proxy(this.hideModal, this))
                  .emulateTransitionEnd(i.TRANSITION_DURATION)
              : this.hideModal());
      }),
      (i.prototype.enforceFocus = function () {
        t(document)
          .off("focusin.bs.modal")
          .on(
            "focusin.bs.modal",
            t.proxy(function (t) {
              this.$element[0] === t.target ||
                this.$element.has(t.target).length ||
                this.$element.trigger("focus");
            }, this)
          );
      }),
      (i.prototype.escape = function () {
        this.isShown && this.options.keyboard
          ? this.$element.on(
              "keydown.dismiss.bs.modal",
              t.proxy(function (t) {
                27 == t.which && this.hide();
              }, this)
            )
          : this.isShown || this.$element.off("keydown.dismiss.bs.modal");
      }),
      (i.prototype.resize = function () {
        this.isShown
          ? t(window).on("resize.bs.modal", t.proxy(this.handleUpdate, this))
          : t(window).off("resize.bs.modal");
      }),
      (i.prototype.hideModal = function () {
        var t = this;
        this.$element.hide(),
          this.backdrop(function () {
            t.$body.removeClass("modal-open"),
              t.resetAdjustments(),
              t.resetScrollbar(),
              t.$element.trigger("hidden.bs.modal");
          });
      }),
      (i.prototype.removeBackdrop = function () {
        this.$backdrop && this.$backdrop.remove(), (this.$backdrop = null);
      }),
      (i.prototype.backdrop = function (e) {
        var n = this,
          a = this.$element.hasClass("fade") ? "fade" : "";
        if (this.isShown && this.options.backdrop) {
          var o = t.support.transition && a;
          if (
            ((this.$backdrop = t(document.createElement("div"))
              .addClass("modal-backdrop " + a)
              .appendTo(this.$body)),
            this.$element.on(
              "click.dismiss.bs.modal",
              t.proxy(function (t) {
                return this.ignoreBackdropClick
                  ? void (this.ignoreBackdropClick = !1)
                  : void (
                      t.target === t.currentTarget &&
                      ("static" == this.options.backdrop
                        ? this.$element[0].focus()
                        : this.hide())
                    );
              }, this)
            ),
            o && this.$backdrop[0].offsetWidth,
            this.$backdrop.addClass("in"),
            !e)
          )
            return;
          o
            ? this.$backdrop
                .one("bsTransitionEnd", e)
                .emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION)
            : e();
        } else if (!this.isShown && this.$backdrop) {
          this.$backdrop.removeClass("in");
          var r = function () {
            n.removeBackdrop(), e && e();
          };
          t.support.transition && this.$element.hasClass("fade")
            ? this.$backdrop
                .one("bsTransitionEnd", r)
                .emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION)
            : r();
        } else e && e();
      }),
      (i.prototype.handleUpdate = function () {
        this.adjustDialog();
      }),
      (i.prototype.adjustDialog = function () {
        var t =
          this.$element[0].scrollHeight > document.documentElement.clientHeight;
        this.$element.css({
          paddingLeft: !this.bodyIsOverflowing && t ? this.scrollbarWidth : "",
          paddingRight: this.bodyIsOverflowing && !t ? this.scrollbarWidth : "",
        });
      }),
      (i.prototype.resetAdjustments = function () {
        this.$element.css({ paddingLeft: "", paddingRight: "" });
      }),
      (i.prototype.checkScrollbar = function () {
        var t = window.innerWidth;
        if (!t) {
          var e = document.documentElement.getBoundingClientRect();
          t = e.right - Math.abs(e.left);
        }
        (this.bodyIsOverflowing = document.body.clientWidth < t),
          (this.scrollbarWidth = this.measureScrollbar());
      }),
      (i.prototype.setScrollbar = function () {
        var t = parseInt(this.$body.css("padding-right") || 0, 10);
        (this.originalBodyPad = document.body.style.paddingRight || ""),
          this.bodyIsOverflowing &&
            this.$body.css("padding-right", t + this.scrollbarWidth);
      }),
      (i.prototype.resetScrollbar = function () {
        this.$body.css("padding-right", this.originalBodyPad);
      }),
      (i.prototype.measureScrollbar = function () {
        var t = document.createElement("div");
        (t.className = "modal-scrollbar-measure"), this.$body.append(t);
        var e = t.offsetWidth - t.clientWidth;
        return this.$body[0].removeChild(t), e;
      });
    var n = t.fn.modal;
    (t.fn.modal = e),
      (t.fn.modal.Constructor = i),
      (t.fn.modal.noConflict = function () {
        return (t.fn.modal = n), this;
      }),
      t(document).on(
        "click.bs.modal.data-api",
        '[data-toggle="modal"]',
        function (i) {
          var n = t(this),
            a = n.attr("href"),
            o = t(
              n.attr("data-target") || (a && a.replace(/.*(?=#[^\s]+$)/, ""))
            ),
            r = o.data("bs.modal")
              ? "toggle"
              : t.extend({ remote: !/#/.test(a) && a }, o.data(), n.data());
          n.is("a") && i.preventDefault(),
            o.one("show.bs.modal", function (t) {
              t.isDefaultPrevented() ||
                o.one("hidden.bs.modal", function () {
                  n.is(":visible") && n.trigger("focus");
                });
            }),
            e.call(o, r, this);
        }
      );
  })(jQuery),
  (function (t) {
    "use strict";
    function e(e) {
      return this.each(function () {
        var n = t(this),
          a = n.data("bs.tooltip"),
          o = "object" == typeof e && e;
        (a || !/destroy|hide/.test(e)) &&
          (a || n.data("bs.tooltip", (a = new i(this, o))),
          "string" == typeof e && a[e]());
      });
    }
    var i = function (t, e) {
      (this.type = null),
        (this.options = null),
        (this.enabled = null),
        (this.timeout = null),
        (this.hoverState = null),
        (this.$element = null),
        (this.inState = null),
        this.init("tooltip", t, e);
    };
    (i.VERSION = "3.3.5"),
      (i.TRANSITION_DURATION = 150),
      (i.DEFAULTS = {
        animation: !0,
        placement: "top",
        selector: !1,
        template:
          '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
        trigger: "hover focus",
        title: "",
        delay: 0,
        html: !1,
        container: !1,
        viewport: { selector: "body", padding: 0 },
      }),
      (i.prototype.init = function (e, i, n) {
        if (
          ((this.enabled = !0),
          (this.type = e),
          (this.$element = t(i)),
          (this.options = this.getOptions(n)),
          (this.$viewport =
            this.options.viewport &&
            t(
              t.isFunction(this.options.viewport)
                ? this.options.viewport.call(this, this.$element)
                : this.options.viewport.selector || this.options.viewport
            )),
          (this.inState = { click: !1, hover: !1, focus: !1 }),
          this.$element[0] instanceof document.constructor &&
            !this.options.selector)
        )
          throw new Error(
            "`selector` option must be specified when initializing " +
              this.type +
              " on the window.document object!"
          );
        for (var a = this.options.trigger.split(" "), o = a.length; o--; ) {
          var r = a[o];
          if ("click" == r)
            this.$element.on(
              "click." + this.type,
              this.options.selector,
              t.proxy(this.toggle, this)
            );
          else if ("manual" != r) {
            var s = "hover" == r ? "mouseenter" : "focusin",
              l = "hover" == r ? "mouseleave" : "focusout";
            this.$element.on(
              s + "." + this.type,
              this.options.selector,
              t.proxy(this.enter, this)
            ),
              this.$element.on(
                l + "." + this.type,
                this.options.selector,
                t.proxy(this.leave, this)
              );
          }
        }
        this.options.selector
          ? (this._options = t.extend({}, this.options, {
              trigger: "manual",
              selector: "",
            }))
          : this.fixTitle();
      }),
      (i.prototype.getDefaults = function () {
        return i.DEFAULTS;
      }),
      (i.prototype.getOptions = function (e) {
        return (
          (e = t.extend({}, this.getDefaults(), this.$element.data(), e)),
          e.delay &&
            "number" == typeof e.delay &&
            (e.delay = { show: e.delay, hide: e.delay }),
          e
        );
      }),
      (i.prototype.getDelegateOptions = function () {
        var e = {},
          i = this.getDefaults();
        return (
          this._options &&
            t.each(this._options, function (t, n) {
              i[t] != n && (e[t] = n);
            }),
          e
        );
      }),
      (i.prototype.enter = function (e) {
        var i =
          e instanceof this.constructor
            ? e
            : t(e.currentTarget).data("bs." + this.type);
        return (
          i ||
            ((i = new this.constructor(
              e.currentTarget,
              this.getDelegateOptions()
            )),
            t(e.currentTarget).data("bs." + this.type, i)),
          e instanceof t.Event &&
            (i.inState["focusin" == e.type ? "focus" : "hover"] = !0),
          i.tip().hasClass("in") || "in" == i.hoverState
            ? void (i.hoverState = "in")
            : (clearTimeout(i.timeout),
              (i.hoverState = "in"),
              i.options.delay && i.options.delay.show
                ? void (i.timeout = setTimeout(function () {
                    "in" == i.hoverState && i.show();
                  }, i.options.delay.show))
                : i.show())
        );
      }),
      (i.prototype.isInStateTrue = function () {
        for (var t in this.inState) if (this.inState[t]) return !0;
        return !1;
      }),
      (i.prototype.leave = function (e) {
        var i =
          e instanceof this.constructor
            ? e
            : t(e.currentTarget).data("bs." + this.type);
        return (
          i ||
            ((i = new this.constructor(
              e.currentTarget,
              this.getDelegateOptions()
            )),
            t(e.currentTarget).data("bs." + this.type, i)),
          e instanceof t.Event &&
            (i.inState["focusout" == e.type ? "focus" : "hover"] = !1),
          i.isInStateTrue()
            ? void 0
            : (clearTimeout(i.timeout),
              (i.hoverState = "out"),
              i.options.delay && i.options.delay.hide
                ? void (i.timeout = setTimeout(function () {
                    "out" == i.hoverState && i.hide();
                  }, i.options.delay.hide))
                : i.hide())
        );
      }),
      (i.prototype.show = function () {
        var e = t.Event("show.bs." + this.type);
        if (this.hasContent() && this.enabled) {
          this.$element.trigger(e);
          var n = t.contains(
            this.$element[0].ownerDocument.documentElement,
            this.$element[0]
          );
          if (e.isDefaultPrevented() || !n) return;
          var a = this,
            o = this.tip(),
            r = this.getUID(this.type);
          this.setContent(),
            o.attr("id", r),
            this.$element.attr("aria-describedby", r),
            this.options.animation && o.addClass("fade");
          var s =
              "function" == typeof this.options.placement
                ? this.options.placement.call(this, o[0], this.$element[0])
                : this.options.placement,
            l = /\s?auto?\s?/i,
            d = l.test(s);
          d && (s = s.replace(l, "") || "top"),
            o
              .detach()
              .css({ top: 0, left: 0, display: "block" })
              .addClass(s)
              .data("bs." + this.type, this),
            this.options.container
              ? o.appendTo(this.options.container)
              : o.insertAfter(this.$element),
            this.$element.trigger("inserted.bs." + this.type);
          var p = this.getPosition(),
            c = o[0].offsetWidth,
            u = o[0].offsetHeight;
          if (d) {
            var h = s,
              f = this.getPosition(this.$viewport);
            (s =
              "bottom" == s && p.bottom + u > f.bottom
                ? "top"
                : "top" == s && p.top - u < f.top
                ? "bottom"
                : "right" == s && p.right + c > f.width
                ? "left"
                : "left" == s && p.left - c < f.left
                ? "right"
                : s),
              o.removeClass(h).addClass(s);
          }
          var m = this.getCalculatedOffset(s, p, c, u);
          this.applyPlacement(m, s);
          var g = function () {
            var t = a.hoverState;
            a.$element.trigger("shown.bs." + a.type),
              (a.hoverState = null),
              "out" == t && a.leave(a);
          };
          t.support.transition && this.$tip.hasClass("fade")
            ? o
                .one("bsTransitionEnd", g)
                .emulateTransitionEnd(i.TRANSITION_DURATION)
            : g();
        }
      }),
      (i.prototype.applyPlacement = function (e, i) {
        var n = this.tip(),
          a = n[0].offsetWidth,
          o = n[0].offsetHeight,
          r = parseInt(n.css("margin-top"), 10),
          s = parseInt(n.css("margin-left"), 10);
        isNaN(r) && (r = 0),
          isNaN(s) && (s = 0),
          (e.top += r),
          (e.left += s),
          t.offset.setOffset(
            n[0],
            t.extend(
              {
                using: function (t) {
                  n.css({ top: Math.round(t.top), left: Math.round(t.left) });
                },
              },
              e
            ),
            0
          ),
          n.addClass("in");
        var l = n[0].offsetWidth,
          d = n[0].offsetHeight;
        "top" == i && d != o && (e.top = e.top + o - d);
        var p = this.getViewportAdjustedDelta(i, e, l, d);
        p.left ? (e.left += p.left) : (e.top += p.top);
        var c = /top|bottom/.test(i),
          u = c ? 2 * p.left - a + l : 2 * p.top - o + d,
          h = c ? "offsetWidth" : "offsetHeight";
        n.offset(e), this.replaceArrow(u, n[0][h], c);
      }),
      (i.prototype.replaceArrow = function (t, e, i) {
        this.arrow()
          .css(i ? "left" : "top", 50 * (1 - t / e) + "%")
          .css(i ? "top" : "left", "");
      }),
      (i.prototype.setContent = function () {
        var t = this.tip(),
          e = this.getTitle();
        t.find(".tooltip-inner")[this.options.html ? "html" : "text"](e),
          t.removeClass("fade in top bottom left right");
      }),
      (i.prototype.hide = function (e) {
        function n() {
          "in" != a.hoverState && o.detach(),
            a.$element
              .removeAttr("aria-describedby")
              .trigger("hidden.bs." + a.type),
            e && e();
        }
        var a = this,
          o = t(this.$tip),
          r = t.Event("hide.bs." + this.type);
        return (
          this.$element.trigger(r),
          r.isDefaultPrevented()
            ? void 0
            : (o.removeClass("in"),
              t.support.transition && o.hasClass("fade")
                ? o
                    .one("bsTransitionEnd", n)
                    .emulateTransitionEnd(i.TRANSITION_DURATION)
                : n(),
              (this.hoverState = null),
              this)
        );
      }),
      (i.prototype.fixTitle = function () {
        var t = this.$element;
        (t.attr("title") || "string" != typeof t.attr("data-original-title")) &&
          t
            .attr("data-original-title", t.attr("title") || "")
            .attr("title", "");
      }),
      (i.prototype.hasContent = function () {
        return this.getTitle();
      }),
      (i.prototype.getPosition = function (e) {
        e = e || this.$element;
        var i = e[0],
          n = "BODY" == i.tagName,
          a = i.getBoundingClientRect();
        null == a.width &&
          (a = t.extend({}, a, {
            width: a.right - a.left,
            height: a.bottom - a.top,
          }));
        var o = n ? { top: 0, left: 0 } : e.offset(),
          r = {
            scroll: n
              ? document.documentElement.scrollTop || document.body.scrollTop
              : e.scrollTop(),
          },
          s = n
            ? { width: t(window).width(), height: t(window).height() }
            : null;
        return t.extend({}, a, r, s, o);
      }),
      (i.prototype.getCalculatedOffset = function (t, e, i, n) {
        return "bottom" == t
          ? { top: e.top + e.height, left: e.left + e.width / 2 - i / 2 }
          : "top" == t
          ? { top: e.top - n, left: e.left + e.width / 2 - i / 2 }
          : "left" == t
          ? { top: e.top + e.height / 2 - n / 2, left: e.left - i }
          : { top: e.top + e.height / 2 - n / 2, left: e.left + e.width };
      }),
      (i.prototype.getViewportAdjustedDelta = function (t, e, i, n) {
        var a = { top: 0, left: 0 };
        if (!this.$viewport) return a;
        var o = (this.options.viewport && this.options.viewport.padding) || 0,
          r = this.getPosition(this.$viewport);
        if (/right|left/.test(t)) {
          var s = e.top - o - r.scroll,
            l = e.top + o - r.scroll + n;
          s < r.top
            ? (a.top = r.top - s)
            : l > r.top + r.height && (a.top = r.top + r.height - l);
        } else {
          var d = e.left - o,
            p = e.left + o + i;
          d < r.left
            ? (a.left = r.left - d)
            : p > r.right && (a.left = r.left + r.width - p);
        }
        return a;
      }),
      (i.prototype.getTitle = function () {
        var t = this.$element,
          e = this.options;
        return (
          t.attr("data-original-title") ||
          ("function" == typeof e.title ? e.title.call(t[0]) : e.title)
        );
      }),
      (i.prototype.getUID = function (t) {
        do {
          t += ~~(1e6 * Math.random());
        } while (document.getElementById(t));
        return t;
      }),
      (i.prototype.tip = function () {
        if (
          !this.$tip &&
          ((this.$tip = t(this.options.template)), 1 != this.$tip.length)
        )
          throw new Error(
            this.type +
              " `template` option must consist of exactly 1 top-level element!"
          );
        return this.$tip;
      }),
      (i.prototype.arrow = function () {
        return (this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow"));
      }),
      (i.prototype.enable = function () {
        this.enabled = !0;
      }),
      (i.prototype.disable = function () {
        this.enabled = !1;
      }),
      (i.prototype.toggleEnabled = function () {
        this.enabled = !this.enabled;
      }),
      (i.prototype.toggle = function (e) {
        var i = this;
        e &&
          ((i = t(e.currentTarget).data("bs." + this.type)) ||
            ((i = new this.constructor(
              e.currentTarget,
              this.getDelegateOptions()
            )),
            t(e.currentTarget).data("bs." + this.type, i))),
          e
            ? ((i.inState.click = !i.inState.click),
              i.isInStateTrue() ? i.enter(i) : i.leave(i))
            : i.tip().hasClass("in")
            ? i.leave(i)
            : i.enter(i);
      }),
      (i.prototype.destroy = function () {
        var t = this;
        clearTimeout(this.timeout),
          this.hide(function () {
            t.$element.off("." + t.type).removeData("bs." + t.type),
              t.$tip && t.$tip.detach(),
              (t.$tip = null),
              (t.$arrow = null),
              (t.$viewport = null);
          });
      });
    var n = t.fn.tooltip;
    (t.fn.tooltip = e),
      (t.fn.tooltip.Constructor = i),
      (t.fn.tooltip.noConflict = function () {
        return (t.fn.tooltip = n), this;
      });
  })(jQuery),
  (function (t) {
    "use strict";
    function e(e) {
      return this.each(function () {
        var n = t(this),
          a = n.data("bs.popover"),
          o = "object" == typeof e && e;
        (a || !/destroy|hide/.test(e)) &&
          (a || n.data("bs.popover", (a = new i(this, o))),
          "string" == typeof e && a[e]());
      });
    }
    var i = function (t, e) {
      this.init("popover", t, e);
    };
    if (!t.fn.tooltip) throw new Error("Popover requires tooltip.js");
    (i.VERSION = "3.3.5"),
      (i.DEFAULTS = t.extend({}, t.fn.tooltip.Constructor.DEFAULTS, {
        placement: "right",
        trigger: "click",
        content: "",
        template:
          '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',
      })),
      (i.prototype = t.extend({}, t.fn.tooltip.Constructor.prototype)),
      (i.prototype.constructor = i),
      (i.prototype.getDefaults = function () {
        return i.DEFAULTS;
      }),
      (i.prototype.setContent = function () {
        var t = this.tip(),
          e = this.getTitle(),
          i = this.getContent();
        t.find(".popover-title")[this.options.html ? "html" : "text"](e),
          t
            .find(".popover-content")
            .children()
            .detach()
            .end()
            [
              this.options.html
                ? "string" == typeof i
                  ? "html"
                  : "append"
                : "text"
            ](i),
          t.removeClass("fade top bottom left right in"),
          t.find(".popover-title").html() || t.find(".popover-title").hide();
      }),
      (i.prototype.hasContent = function () {
        return this.getTitle() || this.getContent();
      }),
      (i.prototype.getContent = function () {
        var t = this.$element,
          e = this.options;
        return (
          t.attr("data-content") ||
          ("function" == typeof e.content ? e.content.call(t[0]) : e.content)
        );
      }),
      (i.prototype.arrow = function () {
        return (this.$arrow = this.$arrow || this.tip().find(".arrow"));
      });
    var n = t.fn.popover;
    (t.fn.popover = e),
      (t.fn.popover.Constructor = i),
      (t.fn.popover.noConflict = function () {
        return (t.fn.popover = n), this;
      });
  })(jQuery),
  (function (t) {
    "use strict";
    function e(e) {
      return this.each(function () {
        var n = t(this),
          a = n.data("bs.tab");
        a || n.data("bs.tab", (a = new i(this))),
          "string" == typeof e && a[e]();
      });
    }
    var i = function (e) {
      this.element = t(e);
    };
    (i.VERSION = "3.3.5"),
      (i.TRANSITION_DURATION = 150),
      (i.prototype.show = function () {
        var e = this.element,
          i = e.closest("ul:not(.dropdown-menu)"),
          n = e.data("target");
        if (
          (n ||
            ((n = e.attr("href")), (n = n && n.replace(/.*(?=#[^\s]*$)/, ""))),
          !e.parent("li").hasClass("active"))
        ) {
          var a = i.find(".active:last a"),
            o = t.Event("hide.bs.tab", { relatedTarget: e[0] }),
            r = t.Event("show.bs.tab", { relatedTarget: a[0] });
          if (
            (a.trigger(o),
            e.trigger(r),
            !r.isDefaultPrevented() && !o.isDefaultPrevented())
          ) {
            var s = t(n);
            this.activate(e.closest("li"), i),
              this.activate(s, s.parent(), function () {
                a.trigger({ type: "hidden.bs.tab", relatedTarget: e[0] }),
                  e.trigger({ type: "shown.bs.tab", relatedTarget: a[0] });
              });
          }
        }
      }),
      (i.prototype.activate = function (e, n, a) {
        function o() {
          r
            .removeClass("active")
            .find("> .dropdown-menu > .active")
            .removeClass("active")
            .end()
            .find('[data-toggle="tab"]')
            .attr("aria-expanded", !1),
            e
              .addClass("active")
              .find('[data-toggle="tab"]')
              .attr("aria-expanded", !0),
            s ? (e[0].offsetWidth, e.addClass("in")) : e.removeClass("fade"),
            e.parent(".dropdown-menu").length &&
              e
                .closest("li.dropdown")
                .addClass("active")
                .end()
                .find('[data-toggle="tab"]')
                .attr("aria-expanded", !0),
            a && a();
        }
        var r = n.find("> .active"),
          s =
            a &&
            t.support.transition &&
            ((r.length && r.hasClass("fade")) || !!n.find("> .fade").length);
        r.length && s
          ? r
              .one("bsTransitionEnd", o)
              .emulateTransitionEnd(i.TRANSITION_DURATION)
          : o(),
          r.removeClass("in");
      });
    var n = t.fn.tab;
    (t.fn.tab = e),
      (t.fn.tab.Constructor = i),
      (t.fn.tab.noConflict = function () {
        return (t.fn.tab = n), this;
      });
    var a = function (i) {
      i.preventDefault(), e.call(t(this), "show");
    };
    t(document)
      .on("click.bs.tab.data-api", '[data-toggle="tab"]', a)
      .on("click.bs.tab.data-api", '[data-toggle="pill"]', a);
  })(jQuery),
  (function (t) {
    "use strict";
    function e(e) {
      var i,
        n =
          e.attr("data-target") ||
          ((i = e.attr("href")) && i.replace(/.*(?=#[^\s]+$)/, ""));
      return t(n);
    }
    function i(e) {
      return this.each(function () {
        var i = t(this),
          a = i.data("bs.collapse"),
          o = t.extend({}, n.DEFAULTS, i.data(), "object" == typeof e && e);
        !a && o.toggle && /show|hide/.test(e) && (o.toggle = !1),
          a || i.data("bs.collapse", (a = new n(this, o))),
          "string" == typeof e && a[e]();
      });
    }
    var n = function (e, i) {
      (this.$element = t(e)),
        (this.options = t.extend({}, n.DEFAULTS, i)),
        (this.$trigger = t(
          '[data-toggle="collapse"][href="#' +
            e.id +
            '"],[data-toggle="collapse"][data-target="#' +
            e.id +
            '"]'
        )),
        (this.transitioning = null),
        this.options.parent
          ? (this.$parent = this.getParent())
          : this.addAriaAndCollapsedClass(this.$element, this.$trigger),
        this.options.toggle && this.toggle();
    };
    (n.VERSION = "3.3.5"),
      (n.TRANSITION_DURATION = 350),
      (n.DEFAULTS = { toggle: !0 }),
      (n.prototype.dimension = function () {
        return this.$element.hasClass("width") ? "width" : "height";
      }),
      (n.prototype.show = function () {
        if (!this.transitioning && !this.$element.hasClass("in")) {
          var e,
            a =
              this.$parent &&
              this.$parent.children(".panel").children(".in, .collapsing");
          if (
            !(a && a.length && (e = a.data("bs.collapse")) && e.transitioning)
          ) {
            var o = t.Event("show.bs.collapse");
            if ((this.$element.trigger(o), !o.isDefaultPrevented())) {
              a &&
                a.length &&
                (i.call(a, "hide"), e || a.data("bs.collapse", null));
              var r = this.dimension();
              this.$element
                .removeClass("collapse")
                .addClass("collapsing")
                [r](0)
                .attr("aria-expanded", !0),
                this.$trigger
                  .removeClass("collapsed")
                  .attr("aria-expanded", !0),
                (this.transitioning = 1);
              var s = function () {
                this.$element
                  .removeClass("collapsing")
                  .addClass("collapse in")
                  [r](""),
                  (this.transitioning = 0),
                  this.$element.trigger("shown.bs.collapse");
              };
              if (!t.support.transition) return s.call(this);
              var l = t.camelCase(["scroll", r].join("-"));
              this.$element
                .one("bsTransitionEnd", t.proxy(s, this))
                .emulateTransitionEnd(n.TRANSITION_DURATION)
                [r](this.$element[0][l]);
            }
          }
        }
      }),
      (n.prototype.hide = function () {
        if (!this.transitioning && this.$element.hasClass("in")) {
          var e = t.Event("hide.bs.collapse");
          if ((this.$element.trigger(e), !e.isDefaultPrevented())) {
            var i = this.dimension();
            this.$element[i](this.$element[i]())[0].offsetHeight,
              this.$element
                .addClass("collapsing")
                .removeClass("collapse in")
                .attr("aria-expanded", !1),
              this.$trigger.addClass("collapsed").attr("aria-expanded", !1),
              (this.transitioning = 1);
            var a = function () {
              (this.transitioning = 0),
                this.$element
                  .removeClass("collapsing")
                  .addClass("collapse")
                  .trigger("hidden.bs.collapse");
            };
            return t.support.transition
              ? void this.$element[i](0)
                  .one("bsTransitionEnd", t.proxy(a, this))
                  .emulateTransitionEnd(n.TRANSITION_DURATION)
              : a.call(this);
          }
        }
      }),
      (n.prototype.toggle = function () {
        this[this.$element.hasClass("in") ? "hide" : "show"]();
      }),
      (n.prototype.getParent = function () {
        return t(this.options.parent)
          .find(
            '[data-toggle="collapse"][data-parent="' +
              this.options.parent +
              '"]'
          )
          .each(
            t.proxy(function (i, n) {
              var a = t(n);
              this.addAriaAndCollapsedClass(e(a), a);
            }, this)
          )
          .end();
      }),
      (n.prototype.addAriaAndCollapsedClass = function (t, e) {
        var i = t.hasClass("in");
        t.attr("aria-expanded", i),
          e.toggleClass("collapsed", !i).attr("aria-expanded", i);
      });
    var a = t.fn.collapse;
    (t.fn.collapse = i),
      (t.fn.collapse.Constructor = n),
      (t.fn.collapse.noConflict = function () {
        return (t.fn.collapse = a), this;
      }),
      t(document).on(
        "click.bs.collapse.data-api",
        '[data-toggle="collapse"]',
        function (n) {
          var a = t(this);
          a.attr("data-target") || n.preventDefault();
          var o = e(a),
            r = o.data("bs.collapse"),
            s = r ? "toggle" : a.data();
          i.call(o, s);
        }
      );
  })(jQuery),
  (function (t) {
    "use strict";
    function e() {
      var t = document.createElement("bootstrap"),
        e = {
          WebkitTransition: "webkitTransitionEnd",
          MozTransition: "transitionend",
          OTransition: "oTransitionEnd otransitionend",
          transition: "transitionend",
        };
      for (var i in e) if (void 0 !== t.style[i]) return { end: e[i] };
      return !1;
    }
    (t.fn.emulateTransitionEnd = function (e) {
      var i = !1,
        n = this;
      t(this).one("bsTransitionEnd", function () {
        i = !0;
      });
      var a = function () {
        i || t(n).trigger(t.support.transition.end);
      };
      return setTimeout(a, e), this;
    }),
      t(function () {
        (t.support.transition = e()),
          t.support.transition &&
            (t.event.special.bsTransitionEnd = {
              bindType: t.support.transition.end,
              delegateType: t.support.transition.end,
              handle: function (e) {
                return t(e.target).is(this)
                  ? e.handleObj.handler.apply(this, arguments)
                  : void 0;
              },
            });
      });
  })(jQuery),
  define("lib-app/bootstrap/js/bootstrap.min", function () {}),
  "object" != typeof JSON && (JSON = {}),
  (function () {
    "use strict";
    function f(t) {
      return t < 10 ? "0" + t : t;
    }
    function quote(t) {
      return (
        (escapable.lastIndex = 0),
        escapable.test(t)
          ? '"' +
            t.replace(escapable, function (t) {
              var e = meta[t];
              return "string" == typeof e
                ? e
                : "\\u" + ("0000" + t.charCodeAt(0).toString(16)).slice(-4);
            }) +
            '"'
          : '"' + t + '"'
      );
    }
    function str(t, e) {
      var i,
        n,
        a,
        o,
        r,
        s = gap,
        l = e[t];
      switch (
        (l &&
          "object" == typeof l &&
          "function" == typeof l.toJSON &&
          (l = l.toJSON(t)),
        "function" == typeof rep && (l = rep.call(e, t, l)),
        typeof l)
      ) {
        case "string":
          return quote(l);
        case "number":
          return isFinite(l) ? String(l) : "null";
        case "boolean":
        case "null":
          return String(l);
        case "object":
          if (!l) return "null";
          if (
            ((gap += indent),
            (r = []),
            "[object Array]" === Object.prototype.toString.apply(l))
          ) {
            for (o = l.length, i = 0; i < o; i += 1) r[i] = str(i, l) || "null";
            return (
              (a =
                0 === r.length
                  ? "[]"
                  : gap
                  ? "[\n" + gap + r.join(",\n" + gap) + "\n" + s + "]"
                  : "[" + r.join(",") + "]"),
              (gap = s),
              a
            );
          }
          if (rep && "object" == typeof rep)
            for (o = rep.length, i = 0; i < o; i += 1)
              "string" == typeof rep[i] &&
                ((n = rep[i]),
                (a = str(n, l)) && r.push(quote(n) + (gap ? ": " : ":") + a));
          else
            for (n in l)
              Object.prototype.hasOwnProperty.call(l, n) &&
                (a = str(n, l)) &&
                r.push(quote(n) + (gap ? ": " : ":") + a);
          return (
            (a =
              0 === r.length
                ? "{}"
                : gap
                ? "{\n" + gap + r.join(",\n" + gap) + "\n" + s + "}"
                : "{" + r.join(",") + "}"),
            (gap = s),
            a
          );
      }
    }
    "function" != typeof Date.prototype.toJSON &&
      ((Date.prototype.toJSON = function (t) {
        return isFinite(this.valueOf())
          ? this.getUTCFullYear() +
              "-" +
              f(this.getUTCMonth() + 1) +
              "-" +
              f(this.getUTCDate()) +
              "T" +
              f(this.getUTCHours()) +
              ":" +
              f(this.getUTCMinutes()) +
              ":" +
              f(this.getUTCSeconds()) +
              "Z"
          : null;
      }),
      (String.prototype.toJSON =
        Number.prototype.toJSON =
        Boolean.prototype.toJSON =
          function (t) {
            return this.valueOf();
          }));
    var cx =
        /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
      escapable =
        /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
      gap,
      indent,
      meta = {
        "\b": "\\b",
        "\t": "\\t",
        "\n": "\\n",
        "\f": "\\f",
        "\r": "\\r",
        '"': '\\"',
        "\\": "\\\\",
      },
      rep;
    "function" != typeof JSON.stringify &&
      (JSON.stringify = function (t, e, i) {
        var n;
        if (((gap = ""), (indent = ""), "number" == typeof i))
          for (n = 0; n < i; n += 1) indent += " ";
        else "string" == typeof i && (indent = i);
        if (
          ((rep = e),
          !e ||
            "function" == typeof e ||
            ("object" == typeof e && "number" == typeof e.length))
        )
          return str("", { "": t });
        throw new Error("JSON.stringify");
      }),
      "function" != typeof JSON.parse &&
        (JSON.parse = function (text, reviver) {
          function walk(t, e) {
            var i,
              n,
              a = t[e];
            if (a && "object" == typeof a)
              for (i in a)
                Object.prototype.hasOwnProperty.call(a, i) &&
                  ((n = walk(a, i)), void 0 !== n ? (a[i] = n) : delete a[i]);
            return reviver.call(t, e, a);
          }
          var j;
          if (
            ((text = String(text)),
            (cx.lastIndex = 0),
            cx.test(text) &&
              (text = text.replace(cx, function (t) {
                return (
                  "\\u" + ("0000" + t.charCodeAt(0).toString(16)).slice(-4)
                );
              })),
            /^[\],:{}\s]*$/.test(
              text
                .replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@")
                .replace(
                  /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
                  "]"
                )
                .replace(/(?:^|:|,)(?:\s*\[)+/g, "")
            ))
          )
            return (
              (j = eval("(" + text + ")")),
              "function" == typeof reviver ? walk({ "": j }, "") : j
            );
          throw new SyntaxError("JSON.parse");
        });
  })(),
  (function (t, e) {
    "use strict";
    var i = (t.History = t.History || {});
    if (void 0 !== i.Adapter)
      throw new Error("History.js Adapter has already been loaded...");
    (i.Adapter = {
      handlers: {},
      _uid: 1,
      uid: function (t) {
        return t._uid || (t._uid = i.Adapter._uid++);
      },
      bind: function (t, e, n) {
        var a = i.Adapter.uid(t);
        (i.Adapter.handlers[a] = i.Adapter.handlers[a] || {}),
          (i.Adapter.handlers[a][e] = i.Adapter.handlers[a][e] || []),
          i.Adapter.handlers[a][e].push(n),
          (t["on" + e] = (function (t, e) {
            return function (n) {
              i.Adapter.trigger(t, e, n);
            };
          })(t, e));
      },
      trigger: function (t, e, n) {
        n = n || {};
        var a,
          o,
          r = i.Adapter.uid(t);
        for (
          i.Adapter.handlers[r] = i.Adapter.handlers[r] || {},
            i.Adapter.handlers[r][e] = i.Adapter.handlers[r][e] || [],
            a = 0,
            o = i.Adapter.handlers[r][e].length;
          a < o;
          ++a
        )
          i.Adapter.handlers[r][e][a].apply(this, [n]);
      },
      extractEventData: function (t, e) {
        return (e && e[t]) || void 0;
      },
      onDomLoad: function (e) {
        var i = t.setTimeout(function () {
          e();
        }, 2e3);
        t.onload = function () {
          clearTimeout(i), e();
        };
      },
    }),
      void 0 !== i.init && i.init();
  })(window),
  (function (t, e) {
    "use strict";
    var i = t.document,
      n = t.setTimeout || n,
      a = t.clearTimeout || a,
      o = t.setInterval || o,
      r = (t.History = t.History || {});
    if (void 0 !== r.initHtml4)
      throw new Error("History.js HTML4 Support has already been loaded...");
    (r.initHtml4 = function () {
      if (void 0 !== r.initHtml4.initialized) return !1;
      (r.initHtml4.initialized = !0),
        (r.enabled = !0),
        (r.savedHashes = []),
        (r.isLastHash = function (t) {
          var e = r.getHashByIndex();
          return t === e;
        }),
        (r.isHashEqual = function (t, e) {
          return (
            (t = encodeURIComponent(t).replace(/%25/g, "%")),
            (e = encodeURIComponent(e).replace(/%25/g, "%")),
            t === e
          );
        }),
        (r.saveHash = function (t) {
          return !r.isLastHash(t) && (r.savedHashes.push(t), !0);
        }),
        (r.getHashByIndex = function (t) {
          return void 0 === t
            ? r.savedHashes[r.savedHashes.length - 1]
            : t < 0
            ? r.savedHashes[r.savedHashes.length + t]
            : r.savedHashes[t];
        }),
        (r.discardedHashes = {}),
        (r.discardedStates = {}),
        (r.discardState = function (t, e, i) {
          var n,
            a = r.getHashByState(t);
          return (
            (n = { discardedState: t, backState: i, forwardState: e }),
            (r.discardedStates[a] = n),
            !0
          );
        }),
        (r.discardHash = function (t, e, i) {
          var n = { discardedHash: t, backState: i, forwardState: e };
          return (r.discardedHashes[t] = n), !0;
        }),
        (r.discardedState = function (t) {
          var e = r.getHashByState(t);
          return r.discardedStates[e] || !1;
        }),
        (r.discardedHash = function (t) {
          return r.discardedHashes[t] || !1;
        }),
        (r.recycleState = function (t) {
          var e = r.getHashByState(t);
          return r.discardedState(t) && delete r.discardedStates[e], !0;
        }),
        r.emulated.hashChange &&
          ((r.hashChangeInit = function () {
            r.checkerFunction = null;
            var e,
              n,
              a,
              s,
              l = "",
              d = Boolean(r.getHash());
            return (
              r.isInternetExplorer()
                ? ((e = "historyjs-iframe"),
                  (n = i.createElement("iframe")),
                  n.setAttribute("id", e),
                  n.setAttribute("src", "#"),
                  (n.style.display = "none"),
                  i.body.appendChild(n),
                  n.contentWindow.document.open(),
                  n.contentWindow.document.close(),
                  (a = ""),
                  (s = !1),
                  (r.checkerFunction = function () {
                    if (s) return !1;
                    s = !0;
                    var e = r.getHash(),
                      i = r.getHash(n.contentWindow.document);
                    return (
                      e !== l
                        ? ((l = e),
                          i !== e &&
                            ((a = i = e),
                            n.contentWindow.document.open(),
                            n.contentWindow.document.close(),
                            (n.contentWindow.document.location.hash =
                              r.escapeHash(e))),
                          r.Adapter.trigger(t, "hashchange"))
                        : i !== a &&
                          ((a = i),
                          d && "" === i ? r.back() : r.setHash(i, !1)),
                      (s = !1),
                      !0
                    );
                  }))
                : (r.checkerFunction = function () {
                    var e = r.getHash() || "";
                    return (
                      e !== l && ((l = e), r.Adapter.trigger(t, "hashchange")),
                      !0
                    );
                  }),
              r.intervalList.push(
                o(r.checkerFunction, r.options.hashChangeInterval)
              ),
              !0
            );
          }),
          r.Adapter.onDomLoad(r.hashChangeInit)),
        r.emulated.pushState &&
          ((r.onHashChange = function (e) {
            var i,
              n = (e && e.newURL) || r.getLocationHref(),
              a = r.getHashByUrl(n),
              o = null;
            return r.isLastHash(a)
              ? (r.busy(!1), !1)
              : (r.doubleCheckComplete(),
                r.saveHash(a),
                a && r.isTraditionalAnchor(a)
                  ? (r.Adapter.trigger(t, "anchorchange"), r.busy(!1), !1)
                  : ((o = r.extractState(
                      r.getFullUrl(a || r.getLocationHref()),
                      !0
                    )),
                    r.isLastSavedState(o)
                      ? (r.busy(!1), !1)
                      : (r.getHashByState(o),
                        (i = r.discardedState(o)),
                        i
                          ? (r.getHashByIndex(-2) ===
                            r.getHashByState(i.forwardState)
                              ? r.back(!1)
                              : r.forward(!1),
                            !1)
                          : (r.pushState(o.data, o.title, encodeURI(o.url), !1),
                            !0))));
          }),
          r.Adapter.bind(t, "hashchange", r.onHashChange),
          (r.pushState = function (e, i, n, a) {
            if (((n = encodeURI(n).replace(/%25/g, "%")), r.getHashByUrl(n)))
              throw new Error(
                "History.js does not support states with fragment-identifiers (hashes/anchors)."
              );
            if (!1 !== a && r.busy())
              return (
                r.pushQueue({
                  scope: r,
                  callback: r.pushState,
                  args: arguments,
                  queue: a,
                }),
                !1
              );
            r.busy(!0);
            var o = r.createStateObject(e, i, n),
              s = r.getHashByState(o),
              l = r.getState(!1),
              d = r.getHashByState(l),
              p = r.getHash(),
              c = r.expectedStateId == o.id;
            return (
              r.storeState(o),
              (r.expectedStateId = o.id),
              r.recycleState(o),
              r.setTitle(o),
              s === d
                ? (r.busy(!1), !1)
                : (r.saveState(o),
                  c || r.Adapter.trigger(t, "statechange"),
                  !r.isHashEqual(s, p) &&
                    !r.isHashEqual(s, r.getShortUrl(r.getLocationHref())) &&
                    r.setHash(s, !1),
                  r.busy(!1),
                  !0)
            );
          }),
          (r.replaceState = function (e, i, n, a) {
            if (((n = encodeURI(n).replace(/%25/g, "%")), r.getHashByUrl(n)))
              throw new Error(
                "History.js does not support states with fragment-identifiers (hashes/anchors)."
              );
            if (!1 !== a && r.busy())
              return (
                r.pushQueue({
                  scope: r,
                  callback: r.replaceState,
                  args: arguments,
                  queue: a,
                }),
                !1
              );
            r.busy(!0);
            var o = r.createStateObject(e, i, n),
              s = r.getHashByState(o),
              l = r.getState(!1),
              d = r.getHashByState(l),
              p = r.getStateByIndex(-2);
            return (
              r.discardState(l, o, p),
              s === d
                ? (r.storeState(o),
                  (r.expectedStateId = o.id),
                  r.recycleState(o),
                  r.setTitle(o),
                  r.saveState(o),
                  r.Adapter.trigger(t, "statechange"),
                  r.busy(!1))
                : r.pushState(o.data, o.title, o.url, !1),
              !0
            );
          })),
        r.emulated.pushState &&
          r.getHash() &&
          !r.emulated.hashChange &&
          r.Adapter.onDomLoad(function () {
            r.Adapter.trigger(t, "hashchange");
          });
    }),
      void 0 !== r.init && r.init();
  })(window),
  (function (t, e) {
    "use strict";
    var i = t.console || e,
      n = t.document,
      a = t.navigator,
      o = !1,
      r = t.setTimeout,
      s = t.clearTimeout,
      l = t.setInterval,
      d = t.clearInterval,
      p = t.JSON,
      c = t.alert,
      u = (t.History = t.History || {}),
      h = t.history;
    try {
      (o = t.sessionStorage), o.setItem("TEST", "1"), o.removeItem("TEST");
    } catch (t) {
      o = !1;
    }
    if (
      ((p.stringify = p.stringify || p.encode),
      (p.parse = p.parse || p.decode),
      void 0 !== u.init)
    )
      throw new Error("History.js Core has already been loaded...");
    (u.init = function (t) {
      return (
        void 0 !== u.Adapter &&
        (void 0 !== u.initCore && u.initCore(),
        void 0 !== u.initHtml4 && u.initHtml4(),
        !0)
      );
    }),
      (u.initCore = function (f) {
        if (void 0 !== u.initCore.initialized) return !1;
        if (
          ((u.initCore.initialized = !0),
          (u.options = u.options || {}),
          (u.options.hashChangeInterval = u.options.hashChangeInterval || 100),
          (u.options.safariPollInterval = u.options.safariPollInterval || 500),
          (u.options.doubleCheckInterval =
            u.options.doubleCheckInterval || 500),
          (u.options.disableSuid = u.options.disableSuid || !1),
          (u.options.storeInterval = u.options.storeInterval || 1e3),
          (u.options.busyDelay = u.options.busyDelay || 250),
          (u.options.debug = u.options.debug || !1),
          (u.options.initialTitle = u.options.initialTitle || n.title),
          (u.options.html4Mode = u.options.html4Mode || !1),
          (u.options.delayInit = u.options.delayInit || !1),
          (u.intervalList = []),
          (u.clearAllIntervals = function () {
            var t,
              e = u.intervalList;
            if (void 0 !== e && null !== e) {
              for (t = 0; t < e.length; t++) d(e[t]);
              u.intervalList = null;
            }
          }),
          (u.debug = function () {
            (u.options.debug || !1) && u.log.apply(u, arguments);
          }),
          (u.log = function () {
            var t,
              e,
              a,
              o,
              r,
              s = void 0 !== i && void 0 !== i.log && void 0 !== i.log.apply,
              l = n.getElementById("log");
            for (
              s
                ? ((o = Array.prototype.slice.call(arguments)),
                  (t = o.shift()),
                  void 0 !== i.debug
                    ? i.debug.apply(i, [t, o])
                    : i.log.apply(i, [t, o]))
                : (t = "\n" + arguments[0] + "\n"),
                e = 1,
                a = arguments.length;
              e < a;
              ++e
            ) {
              if ("object" == typeof (r = arguments[e]) && void 0 !== p)
                try {
                  r = p.stringify(r);
                } catch (t) {}
              t += "\n" + r + "\n";
            }
            return (
              l
                ? ((l.value += t + "\n-----\n"),
                  (l.scrollTop = l.scrollHeight - l.clientHeight))
                : s || c(t),
              !0
            );
          }),
          (u.getInternetExplorerMajorVersion = function () {
            return (u.getInternetExplorerMajorVersion.cached =
              void 0 !== u.getInternetExplorerMajorVersion.cached
                ? u.getInternetExplorerMajorVersion.cached
                : (function () {
                    for (
                      var t = 3,
                        e = n.createElement("div"),
                        i = e.getElementsByTagName("i");
                      (e.innerHTML =
                        "\x3c!--[if gt IE " +
                        ++t +
                        "]><i></i><![endif]--\x3e") && i[0];

                    );
                    return t > 4 && t;
                  })());
          }),
          (u.isInternetExplorer = function () {
            return (u.isInternetExplorer.cached =
              void 0 !== u.isInternetExplorer.cached
                ? u.isInternetExplorer.cached
                : Boolean(u.getInternetExplorerMajorVersion()));
          }),
          u.options.html4Mode
            ? (u.emulated = { pushState: !0, hashChange: !0 })
            : (u.emulated = {
                pushState: !Boolean(
                  t.history &&
                    t.history.pushState &&
                    t.history.replaceState &&
                    !/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(
                      a.userAgent
                    ) &&
                    !/AppleWebKit\/5([0-2]|3[0-2])/i.test(a.userAgent)
                ),
                hashChange: Boolean(
                  !("onhashchange" in t || "onhashchange" in n) ||
                    (u.isInternetExplorer() &&
                      u.getInternetExplorerMajorVersion() < 8)
                ),
              }),
          (u.enabled = !u.emulated.pushState),
          (u.bugs = {
            setHash: Boolean(
              !u.emulated.pushState &&
                "Apple Computer, Inc." === a.vendor &&
                /AppleWebKit\/5([0-2]|3[0-3])/.test(a.userAgent)
            ),
            safariPoll: Boolean(
              !u.emulated.pushState &&
                "Apple Computer, Inc." === a.vendor &&
                /AppleWebKit\/5([0-2]|3[0-3])/.test(a.userAgent)
            ),
            ieDoubleCheck: Boolean(
              u.isInternetExplorer() && u.getInternetExplorerMajorVersion() < 8
            ),
            hashEscape: Boolean(
              u.isInternetExplorer() && u.getInternetExplorerMajorVersion() < 7
            ),
          }),
          (u.isEmptyObject = function (t) {
            for (var e in t) if (t.hasOwnProperty(e)) return !1;
            return !0;
          }),
          (u.cloneObject = function (t) {
            var e, i;
            return t ? ((e = p.stringify(t)), (i = p.parse(e))) : (i = {}), i;
          }),
          (u.getRootUrl = function () {
            var t =
              n.location.protocol +
              "//" +
              (n.location.hostname || n.location.host);
            return n.location.port && (t += ":" + n.location.port), (t += "/");
          }),
          (u.getBaseHref = function () {
            var t = n.getElementsByTagName("base"),
              e = null,
              i = "";
            return (
              1 === t.length &&
                ((e = t[0]), (i = e.href.replace(/[^\/]+$/, ""))),
              (i = i.replace(/\/+$/, "")),
              i && (i += "/"),
              i
            );
          }),
          (u.getBaseUrl = function () {
            return u.getBaseHref() || u.getBasePageUrl() || u.getRootUrl();
          }),
          (u.getPageUrl = function () {
            var t = u.getState(!1, !1),
              e = (t || {}).url || u.getLocationHref();
            return e.replace(/\/+$/, "").replace(/[^\/]+$/, function (t, e, i) {
              return /\./.test(t) ? t : t + "/";
            });
          }),
          (u.getBasePageUrl = function () {
            return (
              u
                .getLocationHref()
                .replace(/[#\?].*/, "")
                .replace(/[^\/]+$/, function (t, e, i) {
                  return /[^\/]$/.test(t) ? "" : t;
                })
                .replace(/\/+$/, "") + "/"
            );
          }),
          (u.getFullUrl = function (t, e) {
            var i = t,
              n = t.substring(0, 1);
            return (
              (e = void 0 === e || e),
              /[a-z]+\:\/\//.test(t) ||
                (i =
                  "/" === n
                    ? u.getRootUrl() + t.replace(/^\/+/, "")
                    : "#" === n
                    ? u.getPageUrl().replace(/#.*/, "") + t
                    : "?" === n
                    ? u.getPageUrl().replace(/[\?#].*/, "") + t
                    : e
                    ? u.getBaseUrl() + t.replace(/^(\.\/)+/, "")
                    : u.getBasePageUrl() + t.replace(/^(\.\/)+/, "")),
              i.replace(/\#$/, "")
            );
          }),
          (u.getShortUrl = function (t) {
            var e = t,
              i = u.getBaseUrl(),
              n = u.getRootUrl();
            return (
              u.emulated.pushState && (e = e.replace(i, "")),
              (e = e.replace(n, "/")),
              u.isTraditionalAnchor(e) && (e = "./" + e),
              (e = e.replace(/^(\.\/)+/g, "./").replace(/\#$/, ""))
            );
          }),
          (u.getLocationHref = function (t) {
            return (
              (t = t || n),
              t.URL === t.location.href
                ? t.location.href
                : t.location.href === decodeURIComponent(t.URL)
                ? t.URL
                : t.location.hash &&
                  decodeURIComponent(t.location.href.replace(/^[^#]+/, "")) ===
                    t.location.hash
                ? t.location.href
                : -1 == t.URL.indexOf("#") && -1 != t.location.href.indexOf("#")
                ? t.location.href
                : t.URL || t.location.href
            );
          }),
          (u.store = {}),
          (u.idToState = u.idToState || {}),
          (u.stateToId = u.stateToId || {}),
          (u.urlToId = u.urlToId || {}),
          (u.storedStates = u.storedStates || []),
          (u.savedStates = u.savedStates || []),
          (u.normalizeStore = function () {
            (u.store.idToState = u.store.idToState || {}),
              (u.store.urlToId = u.store.urlToId || {}),
              (u.store.stateToId = u.store.stateToId || {});
          }),
          (u.getState = function (t, e) {
            void 0 === t && (t = !0), void 0 === e && (e = !0);
            var i = u.getLastSavedState();
            return (
              !i && e && (i = u.createStateObject()),
              t && ((i = u.cloneObject(i)), (i.url = i.cleanUrl || i.url)),
              i
            );
          }),
          (u.getIdByState = function (t) {
            var e,
              i = u.extractId(t.url);
            if (!i)
              if (((e = u.getStateString(t)), void 0 !== u.stateToId[e]))
                i = u.stateToId[e];
              else if (void 0 !== u.store.stateToId[e])
                i = u.store.stateToId[e];
              else {
                for (
                  ;
                  (i =
                    new Date().getTime() +
                    String(Math.random()).replace(/\D/g, "")),
                    void 0 !== u.idToState[i] ||
                      void 0 !== u.store.idToState[i];

                );
                (u.stateToId[e] = i), (u.idToState[i] = t);
              }
            return i;
          }),
          (u.normalizeState = function (t) {
            var e, i;
            return (
              (t && "object" == typeof t) || (t = {}),
              void 0 !== t.normalized
                ? t
                : ((t.data && "object" == typeof t.data) || (t.data = {}),
                  (e = {}),
                  (e.normalized = !0),
                  (e.title = t.title || ""),
                  (e.url = u.getFullUrl(t.url ? t.url : u.getLocationHref())),
                  (e.hash = u.getShortUrl(e.url)),
                  (e.data = u.cloneObject(t.data)),
                  (e.id = u.getIdByState(e)),
                  (e.cleanUrl = e.url.replace(/\??\&_suid.*/, "")),
                  (e.url = e.cleanUrl),
                  (i = !u.isEmptyObject(e.data)),
                  (e.title || i) &&
                    !0 !== u.options.disableSuid &&
                    ((e.hash = u
                      .getShortUrl(e.url)
                      .replace(/\??\&_suid.*/, "")),
                    /\?/.test(e.hash) || (e.hash += "?"),
                    (e.hash += "&_suid=" + e.id)),
                  (e.hashedUrl = u.getFullUrl(e.hash)),
                  (u.emulated.pushState || u.bugs.safariPoll) &&
                    u.hasUrlDuplicate(e) &&
                    (e.url = e.hashedUrl),
                  e)
            );
          }),
          (u.createStateObject = function (t, e, i) {
            var n = { data: t, title: e, url: i };
            return (n = u.normalizeState(n));
          }),
          (u.getStateById = function (t) {
            return (t = String(t)), u.idToState[t] || u.store.idToState[t] || e;
          }),
          (u.getStateString = function (t) {
            var e, i;
            return (
              (e = u.normalizeState(t)),
              (i = { data: e.data, title: t.title, url: t.url }),
              p.stringify(i)
            );
          }),
          (u.getStateId = function (t) {
            var e;
            return (e = u.normalizeState(t)), e.id;
          }),
          (u.getHashByState = function (t) {
            var e;
            return (e = u.normalizeState(t)), e.hash;
          }),
          (u.extractId = function (t) {
            var e, i;
            return (
              (i = -1 != t.indexOf("#") ? t.split("#")[0] : t),
              (e = /(.*)\&_suid=([0-9]+)$/.exec(i)),
              e ? e[1] || t : t,
              (e ? String(e[2] || "") : "") || !1
            );
          }),
          (u.isTraditionalAnchor = function (t) {
            return !/[\/\?\.]/.test(t);
          }),
          (u.extractState = function (t, e) {
            var i,
              n,
              a = null;
            return (
              (e = e || !1),
              (i = u.extractId(t)),
              i && (a = u.getStateById(i)),
              a ||
                ((n = u.getFullUrl(t)),
                (i = u.getIdByUrl(n) || !1),
                i && (a = u.getStateById(i)),
                !a &&
                  e &&
                  !u.isTraditionalAnchor(t) &&
                  (a = u.createStateObject(null, null, n))),
              a
            );
          }),
          (u.getIdByUrl = function (t) {
            return u.urlToId[t] || u.store.urlToId[t] || e;
          }),
          (u.getLastSavedState = function () {
            return u.savedStates[u.savedStates.length - 1] || e;
          }),
          (u.getLastStoredState = function () {
            return u.storedStates[u.storedStates.length - 1] || e;
          }),
          (u.hasUrlDuplicate = function (t) {
            var e;
            return (e = u.extractState(t.url)), e && e.id !== t.id;
          }),
          (u.storeState = function (t) {
            return (
              (u.urlToId[t.url] = t.id),
              u.storedStates.push(u.cloneObject(t)),
              t
            );
          }),
          (u.isLastSavedState = function (t) {
            var e,
              i,
              n,
              a = !1;
            return (
              u.savedStates.length &&
                ((e = t.id),
                (i = u.getLastSavedState()),
                (n = i.id),
                (a = e === n)),
              a
            );
          }),
          (u.saveState = function (t) {
            return (
              !u.isLastSavedState(t) &&
              (u.savedStates.push(u.cloneObject(t)), !0)
            );
          }),
          (u.getStateByIndex = function (t) {
            return void 0 === t
              ? u.savedStates[u.savedStates.length - 1]
              : t < 0
              ? u.savedStates[u.savedStates.length + t]
              : u.savedStates[t];
          }),
          (u.getCurrentIndex = function () {
            return u.savedStates.length < 1 ? 0 : u.savedStates.length - 1;
          }),
          (u.getHash = function (t) {
            var e = u.getLocationHref(t);
            return u.getHashByUrl(e);
          }),
          (u.unescapeHash = function (t) {
            var e = u.normalizeHash(t);
            return (e = decodeURIComponent(e));
          }),
          (u.normalizeHash = function (t) {
            return t.replace(/[^#]*#/, "").replace(/#.*/, "");
          }),
          (u.setHash = function (t, e) {
            var i, a;
            return !1 !== e && u.busy()
              ? (u.pushQueue({
                  scope: u,
                  callback: u.setHash,
                  args: arguments,
                  queue: e,
                }),
                !1)
              : (u.busy(!0),
                (i = u.extractState(t, !0)),
                i && !u.emulated.pushState
                  ? u.pushState(i.data, i.title, i.url, !1)
                  : u.getHash() !== t &&
                    (u.bugs.setHash
                      ? ((a = u.getPageUrl()),
                        u.pushState(null, null, a + "#" + t, !1))
                      : (n.location.hash = t)),
                u);
          }),
          (u.escapeHash = function (e) {
            var i = u.normalizeHash(e);
            return (
              (i = t.encodeURIComponent(i)),
              u.bugs.hashEscape ||
                (i = i
                  .replace(/\%21/g, "!")
                  .replace(/\%26/g, "&")
                  .replace(/\%3D/g, "=")
                  .replace(/\%3F/g, "?")),
              i
            );
          }),
          (u.getHashByUrl = function (t) {
            var e = String(t).replace(/([^#]*)#?([^#]*)#?(.*)/, "$2");
            return (e = u.unescapeHash(e));
          }),
          (u.setTitle = function (t) {
            var e,
              i = t.title;
            i ||
              ((e = u.getStateByIndex(0)) &&
                e.url === t.url &&
                (i = e.title || u.options.initialTitle));
            try {
              n.getElementsByTagName("title")[0].innerHTML = i
                .replace("<", "&lt;")
                .replace(">", "&gt;")
                .replace(" & ", " &amp; ");
            } catch (t) {}
            return (n.title = i), u;
          }),
          (u.queues = []),
          (u.busy = function (t) {
            if (
              (void 0 !== t
                ? (u.busy.flag = t)
                : void 0 === u.busy.flag && (u.busy.flag = !1),
              !u.busy.flag)
            ) {
              s(u.busy.timeout);
              var e = function () {
                var t, i, n;
                if (!u.busy.flag)
                  for (t = u.queues.length - 1; t >= 0; --t)
                    (i = u.queues[t]),
                      0 !== i.length &&
                        ((n = i.shift()),
                        u.fireQueueItem(n),
                        (u.busy.timeout = r(e, u.options.busyDelay)));
              };
              u.busy.timeout = r(e, u.options.busyDelay);
            }
            return u.busy.flag;
          }),
          (u.busy.flag = !1),
          (u.fireQueueItem = function (t) {
            return t.callback.apply(t.scope || u, t.args || []);
          }),
          (u.pushQueue = function (t) {
            return (
              (u.queues[t.queue || 0] = u.queues[t.queue || 0] || []),
              u.queues[t.queue || 0].push(t),
              u
            );
          }),
          (u.queue = function (t, e) {
            return (
              "function" == typeof t && (t = { callback: t }),
              void 0 !== e && (t.queue = e),
              u.busy() ? u.pushQueue(t) : u.fireQueueItem(t),
              u
            );
          }),
          (u.clearQueue = function () {
            return (u.busy.flag = !1), (u.queues = []), u;
          }),
          (u.stateChanged = !1),
          (u.doubleChecker = !1),
          (u.doubleCheckComplete = function () {
            return (u.stateChanged = !0), u.doubleCheckClear(), u;
          }),
          (u.doubleCheckClear = function () {
            return (
              u.doubleChecker && (s(u.doubleChecker), (u.doubleChecker = !1)), u
            );
          }),
          (u.doubleCheck = function (t) {
            return (
              (u.stateChanged = !1),
              u.doubleCheckClear(),
              u.bugs.ieDoubleCheck &&
                (u.doubleChecker = r(function () {
                  return u.doubleCheckClear(), u.stateChanged || t(), !0;
                }, u.options.doubleCheckInterval)),
              u
            );
          }),
          (u.safariStatePoll = function () {
            var e,
              i = u.extractState(u.getLocationHref());
            if (!u.isLastSavedState(i))
              return (
                (e = i),
                e || (e = u.createStateObject()),
                u.Adapter.trigger(t, "popstate"),
                u
              );
          }),
          (u.back = function (t) {
            return !1 !== t && u.busy()
              ? (u.pushQueue({
                  scope: u,
                  callback: u.back,
                  args: arguments,
                  queue: t,
                }),
                !1)
              : (u.busy(!0),
                u.doubleCheck(function () {
                  u.back(!1);
                }),
                h.go(-1),
                !0);
          }),
          (u.forward = function (t) {
            return !1 !== t && u.busy()
              ? (u.pushQueue({
                  scope: u,
                  callback: u.forward,
                  args: arguments,
                  queue: t,
                }),
                !1)
              : (u.busy(!0),
                u.doubleCheck(function () {
                  u.forward(!1);
                }),
                h.go(1),
                !0);
          }),
          (u.go = function (t, e) {
            var i;
            if (t > 0) for (i = 1; i <= t; ++i) u.forward(e);
            else {
              if (!(t < 0))
                throw new Error(
                  "History.go: History.go requires a positive or negative integer passed."
                );
              for (i = -1; i >= t; --i) u.back(e);
            }
            return u;
          }),
          u.emulated.pushState)
        ) {
          var m = function () {};
          (u.pushState = u.pushState || m),
            (u.replaceState = u.replaceState || m);
        } else
          (u.onPopState = function (e, i) {
            var n,
              a,
              o = !1,
              r = !1;
            return (
              u.doubleCheckComplete(),
              (n = u.getHash()),
              n
                ? ((a = u.extractState(n || u.getLocationHref(), !0)),
                  a
                    ? u.replaceState(a.data, a.title, a.url, !1)
                    : (u.Adapter.trigger(t, "anchorchange"), u.busy(!1)),
                  (u.expectedStateId = !1),
                  !1)
                : ((o = u.Adapter.extractEventData("state", e, i) || !1),
                  (r = o
                    ? u.getStateById(o)
                    : u.expectedStateId
                    ? u.getStateById(u.expectedStateId)
                    : u.extractState(u.getLocationHref())),
                  r ||
                    (r = u.createStateObject(null, null, u.getLocationHref())),
                  (u.expectedStateId = !1),
                  u.isLastSavedState(r)
                    ? (u.busy(!1), !1)
                    : (u.storeState(r),
                      u.saveState(r),
                      u.setTitle(r),
                      u.Adapter.trigger(t, "statechange"),
                      u.busy(!1),
                      !0))
            );
          }),
            u.Adapter.bind(t, "popstate", u.onPopState),
            (u.pushState = function (e, i, n, a) {
              if (u.getHashByUrl(n) && u.emulated.pushState)
                throw new Error(
                  "History.js does not support states with fragement-identifiers (hashes/anchors)."
                );
              if (!1 !== a && u.busy())
                return (
                  u.pushQueue({
                    scope: u,
                    callback: u.pushState,
                    args: arguments,
                    queue: a,
                  }),
                  !1
                );
              u.busy(!0);
              var o = u.createStateObject(e, i, n);
              return (
                u.isLastSavedState(o)
                  ? u.busy(!1)
                  : (u.storeState(o),
                    (u.expectedStateId = o.id),
                    h.pushState(o.id, o.title, o.url),
                    u.Adapter.trigger(t, "popstate")),
                !0
              );
            }),
            (u.replaceState = function (e, i, n, a) {
              if (u.getHashByUrl(n) && u.emulated.pushState)
                throw new Error(
                  "History.js does not support states with fragement-identifiers (hashes/anchors)."
                );
              if (!1 !== a && u.busy())
                return (
                  u.pushQueue({
                    scope: u,
                    callback: u.replaceState,
                    args: arguments,
                    queue: a,
                  }),
                  !1
                );
              u.busy(!0);
              var o = u.createStateObject(e, i, n);
              return (
                u.isLastSavedState(o)
                  ? u.busy(!1)
                  : (u.storeState(o),
                    (u.expectedStateId = o.id),
                    h.replaceState(o.id, o.title, o.url),
                    u.Adapter.trigger(t, "popstate")),
                !0
              );
            });
        if (o) {
          try {
            u.store = p.parse(o.getItem("History.store")) || {};
          } catch (t) {
            u.store = {};
          }
          u.normalizeStore();
        } else (u.store = {}), u.normalizeStore();
        u.Adapter.bind(t, "unload", u.clearAllIntervals),
          u.saveState(u.storeState(u.extractState(u.getLocationHref(), !0))),
          o &&
            ((u.onUnload = function () {
              var t, e, i;
              try {
                t = p.parse(o.getItem("History.store")) || {};
              } catch (e) {
                t = {};
              }
              (t.idToState = t.idToState || {}),
                (t.urlToId = t.urlToId || {}),
                (t.stateToId = t.stateToId || {});
              for (e in u.idToState)
                u.idToState.hasOwnProperty(e) &&
                  (t.idToState[e] = u.idToState[e]);
              for (e in u.urlToId)
                u.urlToId.hasOwnProperty(e) && (t.urlToId[e] = u.urlToId[e]);
              for (e in u.stateToId)
                u.stateToId.hasOwnProperty(e) &&
                  (t.stateToId[e] = u.stateToId[e]);
              (u.store = t), u.normalizeStore(), (i = p.stringify(t));
              try {
                o.setItem("History.store", i);
              } catch (t) {
                if (t.code !== DOMException.QUOTA_EXCEEDED_ERR) throw t;
                o.length &&
                  (o.removeItem("History.store"),
                  o.setItem("History.store", i));
              }
            }),
            u.intervalList.push(l(u.onUnload, u.options.storeInterval)),
            u.Adapter.bind(t, "beforeunload", u.onUnload),
            u.Adapter.bind(t, "unload", u.onUnload)),
          u.emulated.pushState ||
            (u.bugs.safariPoll &&
              u.intervalList.push(
                l(u.safariStatePoll, u.options.safariPollInterval)
              ),
            ("Apple Computer, Inc." !== a.vendor &&
              "Mozilla" !== (a.appCodeName || "")) ||
              (u.Adapter.bind(t, "hashchange", function () {
                u.Adapter.trigger(t, "popstate");
              }),
              u.getHash() &&
                u.Adapter.onDomLoad(function () {
                  u.Adapter.trigger(t, "hashchange");
                })));
      }),
      (!u.options || !u.options.delayInit) && u.init();
  })(window),
  define("lib-app/history.min", function () {}),
  define(
    "storymaps/common/Core",
    [
      "lib-build/css!lib-app/bootstrap/css/bootstrap.min",
      "lib-build/css!storymaps/common/ui/Modal.css",
      "lib-build/css!./Core",
      "lib-app/jquery",
      "./utils/Polyfills",
      "esri/map",
      "esri/arcgis/Portal",
      "esri/arcgis/utils",
      "./utils/CommonHelper",
      "esri/urlUtils",
      "storymaps/common/ui/EmbedBar/EmbedBar",
      "./builder/MyStoriesWrapper",
      "dojo/has",
      "esri/IdentityManager",
      "esri/arcgis/OAuthInfo",
      "esri/config",
      "esri/tasks/GeometryService",
      "esri/request",
      "dojo/topic",
      "dojo/on",
      "dojo/_base/lang",
      "dojo/_base/array",
      "dojo/_base/kernel",
      "dojo/Deferred",
      "dojo/DeferredList",
      "dojo/query",
      "lib-app/jquery.fastClick",
      "lib-app/bootstrap/js/bootstrap.min",
      "lib-app/history.min",
    ],
    function (
      t,
      e,
      i,
      n,
      a,
      o,
      r,
      s,
      l,
      d,
      p,
      c,
      u,
      h,
      f,
      m,
      g,
      b,
      v,
      y,
      w,
      C,
      _,
      x,
      S,
      T,
      k
    ) {
      function E(t, e) {
        var i = !1,
          n = !1;
        if (
          (console.log("common.core.Core - init", e),
          (dt = t),
          (app.userCanEdit = !1),
          it(),
          null != e &&
            ((i = null != pt.fromScratch || null != pt.fromscratch),
            (n = null != pt.fromGallery)),
          l.browserSupportHistory() ||
            (!i && !n) ||
            null != pt.ieredirected ||
            (window.location =
              document.location.protocol +
              "//" +
              document.location.host +
              document.location.pathname +
              "#" +
              document.location.search +
              "&ieredirected"),
          l.isArcGISHosted()
            ? (app.indexCfg = {})
            : nt() ||
              (app.indexCfg = {
                proxyurl: app.indexCfg.proxyurl,
                sharingurl: app.indexCfg.sharingurl,
                username: app.indexCfg.username,
                password: app.indexCfg.password,
                oAuthAppId: app.indexCfg.oAuthAppId,
              }),
          pt.sharinghost && (app.indexCfg.sharingurl = pt.sharinghost),
          !dt.checkConfigFileIsOK())
        )
          return void W("invalidConfig");
        if (
          ((document.title = app.cfg.TPL_NAME),
          u("touch") && $("body").addClass("hasTouch"),
          app.appCfg.noFastClick ||
            ((k.prototype._needsClick = k.prototype.needsClick),
            (k.prototype.needsClick = function (t) {
              return (
                !!$(t).parents(".esriPopup").length ||
                k.prototype._needsClick.call(this, t)
              );
            }),
            k.attach(document.body)),
          window != window.top && $("body").addClass("isEmbed"),
          w.mixin(app, {
            map: null,
            maps: {},
            portal: null,
            builder: e,
            isDirectCreation: i,
            isGalleryCreation: n,
            isDirectCreationFirstSave: i,
            isLoading: !0,
            loadingTimeout: null,
            ui: {},
          }),
          app.appCfg.useStandardHeader &&
            require(["storymaps/common/ui/header/Desktop"], function (t) {
              app.ui.headerDesktop = new t(
                $("#headerDesktop"),
                app.isInBuilder
              );
            }),
          dt.init(this))
        ) {
          if (
            (!nt() &&
              app.indexCfg.username &&
              app.indexCfg.password &&
              y(h, "dialog-create", function () {
                y(h.dialog, "show", function () {
                  h.dialog.txtUser_.set("value", app.indexCfg.username),
                    h.dialog.txtPwd_.set("value", app.indexCfg.password),
                    h.dialog.btnSubmit_.onClick();
                });
              }),
            Z(),
            !app.indexCfg.sharingurl)
          ) {
            var a = document.location.pathname.indexOf("/apps/");
            if (
              (-1 == a && (a = document.location.pathname.indexOf("/home/")),
              -1 != a)
            ) {
              var o = location.pathname.substr(0, a);
              (app.indexCfg.sharingurl =
                "//" + location.host + o + "/sharing/rest/content/items"),
                (app.indexCfg.proxyurl =
                  "//" + location.host + o + "/sharing/proxy");
            } else app.indexCfg.sharingurl = app.cfg.DEFAULT_SHARING_URL;
          }
          pt.sharinghost && (app.indexCfg.sharingurl = pt.sharinghost),
            app.indexCfg.sharingurl.match(/^http/)
              ? (s.arcgisUrl = app.indexCfg.sharingurl)
              : (s.arcgisUrl = location.protocol + app.indexCfg.sharingurl),
            app.indexCfg.proxyurl ||
              (app.indexCfg.proxyurl = app.cfg.DEFAULT_PROXY_URL),
            (m.defaults.io.proxyUrl =
              location.protocol + app.indexCfg.proxyurl),
            h &&
              h.setProtocolErrorHandler(function () {
                return !0;
              }),
            app.isInBuilder &&
              app.cfg.CORS_SERVER &&
              $.each(app.cfg.CORS_SERVER, function (t, e) {
                m.defaults.io.corsEnabledServers.push(e);
              }),
            app.cfg.PROXY_RULES &&
              app.cfg.PROXY_RULES.length &&
              $.each(app.cfg.PROXY_RULES, function (t, e) {
                e && e.urlPrefix && e.proxyUrl && d.addProxyRule(e);
              }),
            (m.defaults.io.timeout = app.isInBuilder
              ? app.cfg.TIMEOUT_BUILDER_REQUEST
              : app.cfg.TIMEOUT_VIEWER_REQUEST),
            ($.fn.modal.Constructor.prototype.enforceFocus = function () {}),
            dt.initLocalization(),
            $(window).resize(V),
            $("form").bind("keydown", function (t) {
              if (13 == t.keyCode) return !1;
            }),
            y(h, "dialog-create", K),
            v.subscribe("CORE_UPDATE_UI", U),
            v.subscribe("CORE_RESIZE", V),
            v.subscribe("CORE_UPDATE_EXTENT", H),
            (app.portal = new r.Portal(
              app.indexCfg.sharingurl.split("/sharing/")[0]
            )),
            app.portal.on("load", function (t) {
              if (
                ((app.isPortal = !!t.isPortal),
                at(),
                h.checkSignInStatus(app.portal.portalUrl),
                app.indexCfg.oAuthAppId)
              ) {
                var i = new f({
                  appId: app.indexCfg.oAuthAppId,
                  popup: !1,
                  portalUrl:
                    "https:" + app.indexCfg.sharingurl.split("/sharing/")[0],
                });
                h.registerOAuthInfos([i]),
                  h.checkSignInStatus(i.portalUrl).then(
                    function () {
                      D().then(A);
                    },
                    function () {
                      e ? D().then(A) : A();
                    }
                  );
              } else A();
            });
        }
      }
      function A() {
        console.log("common.core.Core - initStep2");
        var t = l.getAppID(nt()),
          e = l.getWebmapID(nt()),
          i = !(app.appCfg && !app.appCfg.supportWebmapPreviewAGOL);
        if (t) return void I(t);
        var n = l.getUrlParams().insights;
        if (app.isDirectCreation && n)
          return n.match(/^[a-fA-F0-9]{32}$/)
            ? void D().then(function () {
                N(),
                  (app.isInitializing = !1),
                  app.data.setStoryStorage("WEBAPP"),
                  s.getItem(n).then(
                    function (t) {
                      if (!t) return void W("appLoadingFail");
                      var e = t.item;
                      if (!e.url) return void W("appLoadingFail");
                      app.data.getWebAppData().setTitle(e.title + " - story");
                      var i =
                        location.protocol +
                        app.indexCfg.sharingurl.split("/sharing/")[0] +
                        "/apps/insights/#/embed/" +
                        n;
                      app.data.addStorySection({
                        title: e.title,
                        creaDate: Date.now(),
                        status: "PUBLISHED",
                        media: {
                          type: "webpage",
                          webpage: { url: i, display: "stretch", unload: !1 },
                        },
                        description: e.description,
                      }),
                        app.data.getWebAppData().setLayout({ id: "tab" }),
                        app.data
                          .getWebAppData()
                          .setLayoutOptions({
                            description: !0,
                            legend: "panel",
                            panel: { position: "right", size: "medium" },
                            panelMapOverlap: !1,
                          }),
                        app.data.setCurrentSectionIndex(0),
                        v.publish("story-update-entries"),
                        v.publish("BUILDER_INCREMENT_COUNTER", 1),
                        B(),
                        v.publish("CORE_UPDATE_UI"),
                        F();
                    },
                    function () {
                      W("appLoadingFail");
                    }
                  );
              })
            : void W("appLoadingFail");
        var a = l.getUrlParams().webmap;
        return app.isDirectCreation && (e || a)
          ? void D().then(function () {
              N(),
                "opendata" == l.getUrlParams().source &&
                  (app.isDirectCreationOpenData = !0),
                (app.isInitializing = !1),
                app.data.setStoryStorage("WEBAPP");
              var t = (e || a).split(","),
                i = [];
              $.each(t, function (t, e) {
                if (
                  e.match(/^[a-fA-F0-9]{32}$/) &&
                  !(app.data.getStoryLength() >= app.cfg.MAX_NB_ENTRIES)
                ) {
                  var n = {
                    title: "",
                    contentActions: [],
                    creaDate: Date.now(),
                    status: "PUBLISHED",
                    media: {
                      type: "webmap",
                      webmap: {
                        id: e,
                        extent: null,
                        layers: null,
                        popup: null,
                        legend: { enable: !1, openByDefault: !1 },
                      },
                    },
                    description: "",
                  };
                  i.push(n), app.data.addStorySection(n);
                }
              }),
                app.data.getWebAppData().setLayout({ id: "tab" }),
                app.data.getWebAppData().setDefaultLayoutOptions(),
                app.data.getWebAppData().setMapOptions({ mapsSync: !1 });
              var n = 0,
                o = i.length,
                r = v.subscribe("story-loaded-map", function (t) {
                  if (app.maps[t.id]) {
                    var e = app.maps[t.id].response.itemInfo.item;
                    $.each(i, function (i, a) {
                      a.media.webmap.id == t.id &&
                        (0 === i && app.data.getWebAppData().setTitle(e.title),
                        (a.title = e.title),
                        (a.description = e.description),
                        app.data.editSection(i, a),
                        n++);
                    });
                  } else
                    console.log("Could not load web map with id:", t.id), o--;
                  n == o &&
                    (r.remove(),
                    B(),
                    v.publish("CORE_UPDATE_UI"),
                    v.publish("story-update-entries"),
                    F());
                });
              app.data.setCurrentSectionIndex(0),
                v.publish("story-update-entries"),
                v.publish("BUILDER_INCREMENT_COUNTER", 1),
                app.ui.mainStage.preloadAllMaps(!0);
            })
          : e && !i
          ? void (l.isArcGISHosted() ? R() : M(e))
          : app.isDirectCreation &&
            nt() &&
            l.isArcGISHosted() &&
            !l.getPortalUser() &&
            !app.portal.getPortalUser()
          ? void X()
          : app.isDirectCreation
          ? void D().then(function () {
              var t = new f({
                appId: "storymaps",
                portalUrl:
                  "https:" + app.indexCfg.sharingurl.split("/sharing")[0],
                popup: !0,
              });
              h.registerOAuthInfos([t]),
                h
                  .checkAppAccess(
                    "https:" + app.indexCfg.sharingurl,
                    "storymaps"
                  )
                  .then(
                    function (t) {
                      return t && t.code && "IdentityManagerBase.1" === t.code
                        ? void W("notAuthorizedBuilder")
                        : t.viewOnly
                        ? void W("viewOnlyLicense")
                        : (N(), dt.startFromScratch(), B(), void 0);
                    },
                    function () {
                      W("notAuthorizedBuilder");
                    }
                  );
            })
          : void (l.isArcGISHosted()
              ? R()
              : W(
                  !pt.appid ||
                    (app.indexCfg.authorizedOwners &&
                      app.indexCfg.authorizedOwners[0])
                    ? app.isProduction
                      ? "invalidConfigNoApp"
                      : "invalidConfigNoAppDev"
                    : "unspecifiedConfigOwner"
                ));
      }
      function I(t) {
        console.log("common.core.Core - loadWebMappingApp - appId:", t),
          void 0 !== pt.forceLogin || app.isInBuilder
            ? D().then(
                function () {
                  L(t);
                },
                function () {
                  W("notAuthorized");
                }
              )
            : L(t);
      }
      function L(t) {
        s.getItem(t).then(
          function (t) {
            if (!t) return void W("appLoadingFail");
            var e = new f({
              appId: "storymaps",
              portalUrl:
                "https:" + app.indexCfg.sharingurl.split("/sharing")[0],
              popup: !0,
            });
            if (
              (h.registerOAuthInfos([e]),
              "public" === t.item.access && !app.isInBuilder)
            )
              return void P(t);
            h.checkAppAccess(
              "https:" + app.indexCfg.sharingurl,
              "storymaps"
            ).then(
              function (e) {
                return e && e.code && "IdentityManagerBase.1" === e.code
                  ? void W("notAuthorizedLicense")
                  : app.isInBuilder && e.viewOnly
                  ? void W("viewOnlyLicense")
                  : void P(t);
              },
              function () {
                W("notAuthorizedLicense");
              }
            );
          },
          function (t) {
            W(
              t && 400 == t.httpCode
                ? "invalidApp"
                : t && 403 == t.httpCode
                ? "notAuthorized"
                : "appLoadingFail"
            );
          }
        );
      }
      function P(t) {
        var e = t.item,
          i = t.itemData;
        if (
          (app.data.setWebAppItem(e),
          "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
            app.cfg.HTML_SANITIZER_DATE &&
            e.created > app.cfg.HTML_SANITIZER_DATE &&
            (i = app.sanitizer.sanitize(i)),
          app.data.getWebAppData().set(i),
          (app.userCanEdit = app.data.userIsAppOwner()),
          app.indexCfg.authorizedOwners &&
            app.indexCfg.authorizedOwners.length > 0 &&
            app.indexCfg.authorizedOwners[0])
        ) {
          var n = e.owner,
            a = !1;
          if (
            (n && (a = -1 != $.inArray(n, app.indexCfg.authorizedOwners)),
            a || "*" != app.indexCfg.authorizedOwners[0] || (a = !0),
            a ||
              $.each(app.indexCfg.authorizedOwners, function (t, i) {
                var n = i.match(/^\[(.*)\]$/);
                n && e.orgId == n[1] && (a = !0);
              }),
            !a)
          )
            return void W("invalidConfigOwner");
        }
        if (e && e.appProxies) {
          var o = C.map(e.appProxies, function (t) {
            return { url: t.sourceUrl, mixin: { url: t.proxyUrl } };
          });
          app.data.setAppProxies(o);
        }
        if (app.isInBuilder && nt() && !app.userCanEdit)
          return void W("notAuthorized");
        dt.webAppConfigLoaded();
        var r = !(app.appCfg && !app.appCfg.useWebmapInApp),
          s = app.data.getWebAppData().getWebmap() || l.getWebmapID(nt());
        (s && r && app.data.getWebAppData().isBlank()) || app.isGalleryCreation
          ? (dt.startFromScratch(), N())
          : s && r
          ? M(s)
          : !r || (!s && r)
          ? (N(), dt.loadWebmapFromData())
          : l.getPortalUser() || (!nt() && app.data.getWebAppData().isBlank())
          ? J()
          : app.data.getWebAppData().isBlank()
          ? W("appLoadingFail")
          : M(app.data.getWebAppData().getViews()[0].cfg.webmap.id);
      }
      function D() {
        var t = new x();
        return (
          y(h, "dialog-create", Y),
          app.portal.signIn().then(
            function () {
              if (app.isInBuilder && !app.data.checkUserItemPrivileges())
                return void W("notAuthorizedBuilder");
              (app.userCanEdit = app.data.userIsAppOwner()), at(), t.resolve();
            },
            function () {
              t.reject();
            }
          ),
          t
        );
      }
      function M(t) {
        dt.loadFirstWebmap(t).then(
          w.hitch(this, function (t) {
            O(t);
          }),
          w.hitch(this, function () {
            W("createMap");
          })
        );
      }
      function O(t) {
        console.log("common.core.Core - webMapInitCallback"),
          (app.maps[t.itemInfo.item.id] = dt.getMapConfig(t)),
          (app.map = t.map),
          app.data.setWebMap(t.itemInfo),
          app.map.disableKeyboardNavigation(),
          N(),
          dt.firstWebmapLoaded();
      }
      function R() {
        window.location =
          app.isPortal && app.cfg.HELP_URL_PORTAL
            ? app.cfg.HELP_URL_PORTAL
            : app.cfg.HELP_URL;
      }
      function N() {
        var t = app.indexCfg.title || app.data.getWebAppData().getTitle(),
          e = app.indexCfg.subtitle || app.data.getWebAppData().getSubtitle(),
          i = app.data.getWebAppData().getColors();
        app.ui.headerDesktop &&
          app.ui.headerDesktop.init(
            !app.isInBuilder && (app.cfg.EMBED || pt.embed || "" === pt.embed),
            t,
            e,
            G(),
            i,
            q(),
            app.appCfg.headerCompactByDefault
          ),
          app.appCfg.useAppTitleAsPageTitle &&
            (document.title = t
              ? $("<div>" + t + "</div>").text()
              : app.cfg.TPL_NAME);
      }
      function B() {
        if (
          (console.log("common.core.Core - initApp"),
          !app.embedBar || (app.embedBar && !app.embedBar.initiated))
        ) {
          var t = esri.urlToObject(document.location.search).query || {},
            e =
              !!t.classicEmbedMode ||
              "" === t.classicEmbedMode ||
              !!t.classicembedmode ||
              "" === t.classicembedmode,
            i =
              "resources/tpl/viewer/icons/esri-logo-white.png" ==
              app.data.getWebAppData().getLogoURL(),
            n = i18n.commonCore.embedBar;
          w.mixin(n, {
            open: i18n.viewer.shareFromCommon.open,
            close: i18n.viewer.common.close,
            shareFacebook: i18n.viewer.headerFromCommon.facebookTooltip,
            shareTwitter: i18n.viewer.headerFromCommon.twitterTooltip,
          });
          var a = [$(".shareBtns")];
          "shortlist" != app.appCfg.mediaPickerConfigureForceMode &&
            a.push($(".share-btn")),
            (app.embedBar = new p({
              classicEmbedMode: e,
              strings: n,
              appCreationDate: app.data.getWebAppItem().created,
              june2018ReleaseDate: app.cfg.JUNE_RELEASE_DATE,
              isBuilder: app.isInBuilder,
              isEsriLogo: i,
              logoPath: "resources/common/icons/esri-logo-black.png",
              logoElements: [$(".logoContainer")],
              taglineElements: [$(".linkContainer")],
              shareElements: a,
              appTitle: app.data.getWebAppData().getTitle(),
              bitlyCreds: [
                app.cfg.HEADER_SOCIAL.bitly.key,
                app.cfg.HEADER_SOCIAL.bitly.login,
              ],
            }));
        }
        V(),
          location.hash && l.browserSupportHistory() && (location.hash = "map"),
          (window.onhashchange = function () {
            dt.prepareMobileViewSwitch(), dt.onHashChange();
          }),
          dt.appInitComplete(),
          app.builder && app.builder.appInitComplete();
        var o = "true" === pt.preview || "" === pt.preview,
          r = "true" === pt.autoplay || "" === pt.autoplay;
        (!app.isInBuilder && !app.userCanEdit) ||
          9 == u("ie") ||
          o ||
          r ||
          (u("ff") && $(".builderShare #my-stories-frame").remove(),
          (!u("ff") && app.isInBuilder) ||
            $("body").append(
              '<div id="my-stories-hidden-container"><iframe id="my-stories-frame"></iframe></div>'
            ),
          c.loadMyStories()),
          document.location.pathname.match(/\/apps\/[a-zA-Z]+\/$/) &&
            document.location.search.match(/^\?appid=/) &&
            (!u("ie") || u("ie") >= 10) &&
            History.replaceState(
              {},
              "",
              "index.html" + document.location.search + document.location.hash
            );
        var s = document.location.search;
        s &&
          (s = s.replace("&preview", "")) != document.location.search &&
          window.history.replaceState(
            {},
            "",
            "index.html" + s + document.location.hash
          );
      }
      function F() {
        (app.isLoading = !1),
          $("#headerDesktop").removeAttr("aria-hidden"),
          $("#loadingIndicator, #loadingMessage")
            .addClass("fadeOut")
            .fadeOut(400),
          $("#loadingOverlay").fadeOut(800);
      }
      function W(t, e, i) {
        var n = i18n.viewer.errors[t];
        tt(),
          $("#loadingIndicator").hide(),
          "notAuthorizedLicense" == t
            ? ((n = i18n.commonCore.licenseChange2018.noAccess),
              (n = n.replace(
                /%USER_NAME%/g,
                l.getPortalUser() ? l.getPortalUser() : ""
              )))
            : "viewOnlyLicense" == t
            ? ((n = i18n.commonCore.storyTellerUserType.notCreatorError),
              (n = n.replace(
                /%USER_NAME%/g,
                l.getPortalUser() ? l.getPortalUser() : ""
              )))
            : (n = n.replace(/%TPL_NAME%/g, app.cfg.TPL_NAME)),
          "notAuthorized" == t &&
            app.indexCfg.oAuthAppId &&
            (n +=
              '<div><button class="btn btn-sm btn-default" onclick="esri.id.destroyCredentials(); window.location.reload();">' +
              i18n.viewer.errors.signOut +
              "</button></div>"),
          "appLoadingFail" == t
            ? $("#loadingMessage")
                .html(
                  '<div id="loadingRetry"> <button type="button" class="btn btn-naked btn-sm" onclick="document.location.reload()">' +
                    i18n.viewer.loading.failButton +
                    " </button></div>"
                )
                .hide()
                .fadeIn(1200, function () {
                  $("#loadingMessage").addClass("loaded");
                })
            : $("#loadingMessage").hide(),
          8 == u("ie") &&
            ($("#fatalError-icon").css({
              filter:
                "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='_resources/icons/warning-icon.png', sizingMethod='scale')",
              backgroundPosition: "2px 3px",
              width: 78,
            }),
            $("#fatalError-msg").css({ paddingLeft: 5 })),
          $("#fatalError .error-msg").html(n),
          i || $("#fatalError").show();
      }
      function j(t) {
        $("#fatalError .error-msg").html(i18n.viewer.errors[t]);
      }
      function H(t, e) {
        if (
          ((e = e || app.map),
          !(
            t &&
            t.spatialReference &&
            e &&
            e.extent.spatialReference &&
            e.spatialReference
          ))
        ) {
          var i = new x();
          return i.resolve(), i;
        }
        var n = !!app.appCfg.mapExtentFit && app.appCfg.mapExtentFit;
        if (e.spatialReference.wkid == t.spatialReference.wkid)
          return e.setExtent(dt.getLayoutExtent(t, !1), n);
        var a = new x();
        return (
          m.defaults.geometryService.project(
            [t],
            e.spatialReference,
            function (t) {
              if (t && t[0]) {
                var i = dt.getLayoutExtent(t[0], !1);
                e.setExtent(i, n), a.resolve();
              }
            }
          ),
          a
        );
      }
      function z(t, e) {
        t
          ? 102100 != app.map.spatialReference.wkid &&
            4326 != app.map.spatialReference.wkid
            ? m.defaults.geometryService.project(
                [e],
                app.map.spatialReference,
                function (t) {
                  t &&
                    t[0] &&
                    (app.map.extent.contains(t[0]) || app.map.centerAt(t[0]));
                }
              )
            : app.map.extent.contains(e) || app.map.centerAt(e)
          : ($(".mainMediaContainer.active .mapLocationMsg").html(
              i18n.viewer.locatorFromCommon.error
            ),
            $(".mainMediaContainer.active .mapLocationError").fadeIn(),
            setTimeout(function () {
              $(".mainMediaContainer.active .mapLocationError").fadeOut();
            }, 5e3));
      }
      function U() {
        console.log("common.core.Core - updateUI");
        var t = app.data.getWebAppData().getColors();
        app.ui.headerDesktop &&
          (app.ui.headerDesktop.setTitleAndSubtitle(
            app.data.getWebAppData().getTitle() ||
              (app.data.getWebMap() ? app.data.getWebMap().item.title : ""),
            app.data.getWebAppData().getSubtitle() ||
              (app.data.getWebMap() ? app.data.getWebMap().item.snippet : "")
          ),
          app.ui.headerDesktop.update(
            G(),
            t,
            app.appCfg.headerCompactByDefault
          )),
          dt.updateUI(),
          V();
      }
      function G(t) {
        return {
          logoURL: app.data.getWebAppData().getLogoURL(t && t.useMobileLogo),
          logoTarget: app.data.getWebAppData().getLogoTarget(),
          linkText: app.data.getWebAppData().getHeaderLinkText(),
          linkURL: app.data.getWebAppData().getHeaderLinkURL(),
          socialBtn: app.data.getWebAppData().getSocial(),
          compactSize: app.data.getWebAppData().getHeaderCompactSize(),
        };
      }
      function V() {
        var t = $("body").width(),
          e = $("body").height(),
          i = 0,
          n = 0,
          a = void 0 !== pt.forceDesktop || app.indexCfg.forceDesktop,
          o = void 0 !== pt.forceMobile || app.indexCfg.forceMobile,
          r = t <= 768 || o,
          s = !$(".centerLink").length || $(".centerLink").hasClass("current");
        if (
          (a && (r = !1),
          r
            ? $("body").addClass("mobile-view")
            : $("body").removeClass("mobile-view"),
          $(".mainViewAboveMap, .mainViewBelowMap").each(function (t, e) {
            var n = $(e);
            i += n.is(":visible") ? n.outerHeight() : 0;
          }),
          $(".mainViewSideMap").each(function (t, e) {
            var i = $(e);
            n += i.is(":visible") ? i.outerWidth() : 0;
          }),
          app.ui.headerDesktop && app.ui.headerDesktop.resize(t),
          app.initScreenIsOpen &&
            ($("#header").css("display", r ? "none" : "block"),
            $("#fatalError").css("display", r ? "block" : "none")),
          app.initScreenIsOpen || $("#contentPanel").height(e - i),
          dt.resize({
            isMobileView: r,
            isOnMobileMapView: s,
            width: t,
            height: e - i,
          }),
          app.isInBuilder && app.builder.resize({ isMobileView: r }),
          app.map && (!r || (r && s)))
        )
          try {
            app.map.resize(!!app.appCfg.mapsImmediateResize);
          } catch (t) {}
        r
          ? $(".mapContainer .esriControlsBR > div")
              .first()
              .removeClass("logo-med")
              .addClass("logo-sm")
          : $(".mapContainer .esriControlsBR > div")
              .first()
              .removeClass("logo-sm")
              .addClass("logo-med");
      }
      function q() {
        return (
          !app.isInBuilder &&
          ((!nt() && !!l.getAppID(nt())) || (nt() && app.userCanEdit)) &&
          (void 0 === pt.autoplay || "false" == pt.autoplay) &&
          (void 0 === pt.preview || "false" == pt.preview)
        );
      }
      function K() {
        $(".esriSignInDialog td label").siblings("br").css("display", "none"),
          $(".esriSignInDialog .dijitDialogPaneContentArea div:nth(1)").css(
            "display",
            "none"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "padding",
            "0px"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "margin-bottom",
            "0px"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "border",
            "none"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "border-radius",
            "0px"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "-webkit-border-radius",
            "0px"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "-moz-border-radius",
            "0px"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "box-shadow",
            "none"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "-webkit-box-shadow",
            "none"
          ),
          $(".esriSignInDialog .dijitReset.dijitInputInner").css(
            "-moz-box-shadow",
            "none"
          ),
          $(".esriSignInDialog .dijitReset.dijitValidationContainer").css(
            "display",
            "none"
          ),
          $(".esriSignInDialog .esriErrorMsg").css("margin-top", "10px"),
          $(".esriSignInDialog")
            .find(".dijitDialogTitleBar")
            .find(".dijitDialogTitle")
            .first()
            .html(i18n.viewer.signin.title),
          h._arcgisUrl &&
            ($(".esriSignInDialog")
              .find(".dijitDialogPaneContentArea:first-child")
              .find(":first-child")
              .first()
              .css("display", "none"),
            $(".esriSignInDialog")
              .find(".dijitDialogPaneContentArea:first-child")
              .find(":first-child")
              .first()
              .after(
                "<div id='dijitDialogPaneContentAreaLoginText'>" +
                  i18n.viewer.signin.explainViewer.replace(
                    "%PORTAL_LINK%",
                    "<a href='http://" +
                      h._arcgisUrl +
                      "' title='" +
                      h._arcgisUrl +
                      "' target='_blank'>" +
                      h._arcgisUrl +
                      "</a>"
                  ) +
                  "</div>"
              ));
      }
      function Y() {
        h._arcgisUrl &&
          $(".esriSignInDialog")
            .find("#dijitDialogPaneContentAreaLoginText")
            .html(
              i18n.viewer.signin.explainBuilder.replace(
                "%PORTAL_LINK%",
                "<a href='http://" +
                  h._arcgisUrl +
                  "' title='" +
                  h._arcgisUrl +
                  "' target='_blank'>" +
                  h._arcgisUrl +
                  "</a>"
              )
            );
      }
      function Q() {
        $("#header").css("display", "inherit"),
          $(".mobileView").css("display", "inherit"),
          $("#fatalError").css("display", "none"),
          $("#loadingOverlay").css("top", "0px"),
          Z(),
          V();
      }
      function X() {
        window.location =
          s.arcgisUrl.split("/sharing/")[0] +
          "/home/signin.html?returnUrl=" +
          encodeURIComponent(document.location.href);
      }
      function J() {
        window.location = document.location.href + "&fromGallery";
      }
      function Z() {
        app.loadingTimeout = setTimeout(et, app.cfg.TIMEOUT_VIEWER_LOAD);
      }
      function tt() {
        "undefined" != typeof app &&
          app.loadingTimeout &&
          (clearTimeout(app.loadingTimeout), (app.loadingTimeout = null));
      }
      function et() {
        if (
          h &&
          h.dialog &&
          h.dialog._alreadyInitialized &&
          !h.loadingTimeoutAlreadyFired
        )
          return (
            clearTimeout(app.loadingTimeout),
            Z(),
            void (h._busy || (h.loadingTimeoutAlreadyFired = !0))
          );
        $("#loadingMessage")
          .html(
            '<div class="mainMessage">' +
              i18n.viewer.loading.long +
              "<br />" +
              i18n.viewer.loading.long2 +
              "</div>"
          )
          .fadeIn("slow", function () {
            $("#loadingMessage").addClass("loaded");
          });
      }
      function it() {
        (document.documentElement.lang = _.locale),
          (T("#fatalError .error-title")[0].innerHTML =
            i18n.viewer.errors.boxTitle);
        var t = i18n.viewer.a11y;
        t &&
          ($(".skip-to-content").html(t.skipToContent),
          $('header[role="banner"]').attr("aria-label", t.headerAria),
          $('#nav-bar[role="navigation"]').attr("aria-label", t.navAria),
          $('[role="main"]').attr("aria-label", t.panelAria),
          $(".loop-to-top").html(t.toTop),
          $(".loading-gif").attr("alt", t.loadingAria).html(),
          $(".mainStagePanel").attr("aria-label", t.mainStageAria));
      }
      function nt() {
        return lt.environment != ["TPL", "ENV", "DEV"].join("_");
      }
      function at() {
        if ((console.log("common.core.Core - parsePortalConfig"), app.portal)) {
          if (app.data.getWebAppData().getAppGeocoders) {
            var t = app.data.getWebAppData().getAppGeocoders(),
              e = t
                ? t.map(function (t) {
                    return t.url;
                  })
                : [],
              i = [];
            app.cfg.HELPER_SERVICES.geocode &&
              app.cfg.HELPER_SERVICES.geocode.length &&
              ($.each(app.portal.helperServices.geocode, function (t, n) {
                n.url && e.indexOf(n.url) < 0 && i.push(n);
              }),
              (app.cfg.HELPER_SERVICES.geocode = i));
          }
          var n;
          if (
            (app.cfg.HELPER_SERVICES.geometry &&
            app.cfg.HELPER_SERVICES.geometry.url
              ? (n = app.cfg.HELPER_SERVICES.geometry.url)
              : app.portal.helperServices.geometry &&
                app.portal.helperServices.geometry.url &&
                (n = app.portal.helperServices.geometry.url),
            (m.defaults.geometryService = new g(n)),
            !app.cfg.BING_MAPS_KEY &&
              app.portal.bingKey &&
              (app.cfg.BING_MAPS_KEY = app.portal.bingKey),
            app.portal.isPortal &&
              app.cfg &&
              app.cfg.AUTHORIZED_IMPORT_SOURCE &&
              (app.cfg.AUTHORIZED_IMPORT_SOURCE.featureService = !1),
            (app.isPortal = !!app.portal.isPortal),
            app.isPortal &&
              app.portal.helpBase &&
              app.portal.portalHostname &&
              !app.cfg.HELP_URL_PORTAL.match("^//"))
          ) {
            var a = app.portal.portalHostname.split("/")[0];
            app.cfg.HELP_URL_PORTAL =
              "//" + a + app.portal.helpBase + app.cfg.HELP_URL_PORTAL;
          }
        }
      }
      function ot() {
        var t = "notConfiguredMobile";
        tt(),
          (app.isInitializing = !0),
          (app.initScreenIsOpen = !0),
          u("touch") &&
            l.isMobile() &&
            (window.innerHeight > window.innerWidth
              ? window.innerHeight > 768 && (t = "notConfiguredMobile2")
              : window.innerWidth > 768 && (t = "notConfiguredMobile2")),
          W(t, null, !0),
          setTimeout(V, 50);
      }
      function rt() {
        $("#initPopup").modal("hide"), (app.initScreenIsOpen = !1);
      }
      function st() {
        j("notConfiguredDesktop"),
          $("#loadingOverlay").css("top", "0px"),
          $("#header").css("display", "inherit"),
          $("#fatalError").css("display", "block"),
          (app.initScreenIsOpen = !1),
          V();
      }
      var lt = { environment: "TPL_ENV_PRODUCTION" },
        dt = null,
        pt = l.getUrlParams();
      return (
        a.apply(),
        {
          init: E,
          isProd: nt,
          appInitComplete: B,
          displayApp: F,
          loadWebMap: M,
          handleWindowResize: V,
          hasSwitchBuilderButton: q,
          initPopupPrepare: ot,
          initPopupComplete: rt,
          initPopupFail: st,
          setMapExtent: H,
          zoomToDeviceLocation: z,
          getHeaderUserCfg: G,
          cleanLoadingTimeout: tt,
          initError: W,
          prepareAppForWebmapReload: Q,
          replaceInitErrorMessage: j,
          portalLogin: D,
        }
      );
    }
  ),
  define(
    "lib-build/css!storymaps/common/ui/header/Desktop",
    [],
    function () {}
  ),
  define("text", {
    load: function (t) {
      throw new Error("Dynamic load not allowed: " + t);
    },
  }),
  function () {
    function t(t, e, i) {
      i = (i || 0) - 1;
      for (var n = t ? t.length : 0; ++i < n; ) if (t[i] === e) return i;
      return -1;
    }
    function e(e, i) {
      var n = typeof i;
      if (((e = e.l), "boolean" == n || null == i)) return e[i] ? 0 : -1;
      "number" != n && "string" != n && (n = "object");
      var a = "number" == n ? i : b + i;
      return (
        (e = (e = e[n]) && e[a]),
        "object" == n ? (e && -1 < t(e, i) ? 0 : -1) : e ? 0 : -1
      );
    }
    function i(t) {
      var e = this.l,
        i = typeof t;
      if ("boolean" == i || null == t) e[t] = !0;
      else {
        "number" != i && "string" != i && (i = "object");
        var n = "number" == i ? t : b + t,
          e = e[i] || (e[i] = {});
        "object" == i ? (e[n] || (e[n] = [])).push(t) : (e[n] = !0);
      }
    }
    function n(t) {
      return t.charCodeAt(0);
    }
    function a(t, e) {
      for (var i = t.m, n = e.m, a = -1, o = i.length; ++a < o; ) {
        var r = i[a],
          s = n[a];
        if (r !== s) {
          if (r > s || void 0 === r) return 1;
          if (r < s || void 0 === s) return -1;
        }
      }
      return t.n - e.n;
    }
    function o(t) {
      var e = -1,
        n = t.length,
        a = t[0],
        o = t[(n / 2) | 0],
        r = t[n - 1];
      if (
        a &&
        "object" == typeof a &&
        o &&
        "object" == typeof o &&
        r &&
        "object" == typeof r
      )
        return !1;
      for (
        a = l(),
          a.false = a.null = a.true = a.undefined = !1,
          o = l(),
          o.k = t,
          o.l = a,
          o.push = i;
        ++e < n;

      )
        o.push(t[e]);
      return o;
    }
    function r(t) {
      return "\\" + V[t];
    }
    function s() {
      return f.pop() || [];
    }
    function l() {
      return (
        m.pop() || {
          k: null,
          l: null,
          m: null,
          false: !1,
          n: 0,
          null: !1,
          number: null,
          object: null,
          push: null,
          string: null,
          true: !1,
          undefined: !1,
          o: null,
        }
      );
    }
    function d(t) {
      (t.length = 0), f.length < y && f.push(t);
    }
    function p(t) {
      var e = t.l;
      e && p(e),
        (t.k = t.l = t.m = t.object = t.number = t.string = t.o = null),
        m.length < y && m.push(t);
    }
    function c(t, e, i) {
      e || (e = 0), void 0 === i && (i = t ? t.length : 0);
      var n = -1;
      i = i - e || 0;
      for (var a = Array(0 > i ? 0 : i); ++n < i; ) a[n] = t[e + n];
      return a;
    }
    function u(i) {
      function f(t, e, i) {
        if (!t || !G[typeof t]) return t;
        e = e && void 0 === i ? e : et(e, i, 3);
        for (
          var n = -1, a = G[typeof t] && Re(t), o = a ? a.length : 0;
          ++n < o && ((i = a[n]), !1 !== e(t[i], i, t));

        );
        return t;
      }
      function m(t, e, i) {
        var n;
        if (!t || !G[typeof t]) return t;
        e = e && void 0 === i ? e : et(e, i, 3);
        for (n in t) if (!1 === e(t[n], n, t)) break;
        return t;
      }
      function y(t, e, i) {
        var n,
          a = t,
          o = a;
        if (!a) return o;
        for (
          var r = arguments, s = 0, l = "number" == typeof i ? 2 : r.length;
          ++s < l;

        )
          if ((a = r[s]) && G[typeof a])
            for (
              var d = -1, p = G[typeof a] && Re(a), c = p ? p.length : 0;
              ++d < c;

            )
              (n = p[d]), void 0 === o[n] && (o[n] = a[n]);
        return o;
      }
      function V(t, e, i) {
        var n,
          a = t,
          o = a;
        if (!a) return o;
        var r = arguments,
          s = 0,
          l = "number" == typeof i ? 2 : r.length;
        if (3 < l && "function" == typeof r[l - 2])
          var d = et(r[--l - 1], r[l--], 2);
        else 2 < l && "function" == typeof r[l - 1] && (d = r[--l]);
        for (; ++s < l; )
          if ((a = r[s]) && G[typeof a])
            for (
              var p = -1, c = G[typeof a] && Re(a), u = c ? c.length : 0;
              ++p < u;

            )
              (n = c[p]), (o[n] = d ? d(o[n], a[n]) : a[n]);
        return o;
      }
      function K(t) {
        var e,
          i = [];
        if (!t || !G[typeof t]) return i;
        for (e in t) be.call(t, e) && i.push(e);
        return i;
      }
      function Y(t) {
        return t && "object" == typeof t && !Oe(t) && be.call(t, "__wrapped__")
          ? t
          : new Q(t);
      }
      function Q(t, e) {
        (this.__chain__ = !!e), (this.__wrapped__ = t);
      }
      function X(t) {
        function e() {
          if (n) {
            var t = c(n);
            ve.apply(t, arguments);
          }
          if (this instanceof e) {
            var o = tt(i.prototype),
              t = i.apply(o, t || arguments);
            return Ct(t) ? t : o;
          }
          return i.apply(a, t || arguments);
        }
        var i = t[0],
          n = t[2],
          a = t[4];
        return Me(e, t), e;
      }
      function Z(t, e, i, n, a) {
        if (i) {
          var o = i(t);
          if (void 0 !== o) return o;
        }
        if (!Ct(t)) return t;
        var r = pe.call(t);
        if (!H[r]) return t;
        var l = De[r];
        switch (r) {
          case O:
          case R:
            return new l(+t);
          case B:
          case j:
            return new l(t);
          case W:
            return (o = l(t.source, T.exec(t))), (o.lastIndex = t.lastIndex), o;
        }
        if (((r = Oe(t)), e)) {
          var p = !n;
          n || (n = s()), a || (a = s());
          for (var u = n.length; u--; ) if (n[u] == t) return a[u];
          o = r ? l(t.length) : {};
        } else o = r ? c(t) : V({}, t);
        return (
          r &&
            (be.call(t, "index") && (o.index = t.index),
            be.call(t, "input") && (o.input = t.input)),
          e
            ? (n.push(t),
              a.push(o),
              (r ? It : f)(t, function (t, r) {
                o[r] = Z(t, e, i, n, a);
              }),
              p && (d(n), d(a)),
              o)
            : o
        );
      }
      function tt(t) {
        return Ct(t) ? xe(t) : {};
      }
      function et(t, e, i) {
        if ("function" != typeof t) return Vt;
        if (void 0 === e || !("prototype" in t)) return t;
        var n = t.__bindData__;
        if (
          void 0 === n &&
          ($e.funcNames && (n = !t.name), !(n = n || !$e.funcDecomp))
        ) {
          var a = me.call(t);
          $e.funcNames || (n = !k.test(a)), n || ((n = L.test(a)), Me(t, n));
        }
        if (!1 === n || (!0 !== n && 1 & n[1])) return t;
        switch (i) {
          case 1:
            return function (i) {
              return t.call(e, i);
            };
          case 2:
            return function (i, n) {
              return t.call(e, i, n);
            };
          case 3:
            return function (i, n, a) {
              return t.call(e, i, n, a);
            };
          case 4:
            return function (i, n, a, o) {
              return t.call(e, i, n, a, o);
            };
        }
        return Ut(t, e);
      }
      function it(t) {
        function e() {
          var t = l ? r : this;
          if (a) {
            var f = c(a);
            ve.apply(f, arguments);
          }
          return (o || p) &&
            (f || (f = c(arguments)), o && ve.apply(f, o), p && f.length < s)
            ? ((n |= 16), it([i, u ? n : -4 & n, f, null, r, s]))
            : (f || (f = arguments),
              d && (i = t[h]),
              this instanceof e
                ? ((t = tt(i.prototype)), (f = i.apply(t, f)), Ct(f) ? f : t)
                : i.apply(t, f));
        }
        var i = t[0],
          n = t[1],
          a = t[2],
          o = t[3],
          r = t[4],
          s = t[5],
          l = 1 & n,
          d = 2 & n,
          p = 4 & n,
          u = 8 & n,
          h = i;
        return Me(e, t), e;
      }
      function nt(i, n) {
        var a = -1,
          r = ut(),
          s = i ? i.length : 0,
          l = s >= v && r === t,
          d = [];
        if (l) {
          var c = o(n);
          c ? ((r = e), (n = c)) : (l = !1);
        }
        for (; ++a < s; ) (c = i[a]), 0 > r(n, c) && d.push(c);
        return l && p(n), d;
      }
      function at(t, e, i, n) {
        n = (n || 0) - 1;
        for (var a = t ? t.length : 0, o = []; ++n < a; ) {
          var r = t[n];
          if (
            r &&
            "object" == typeof r &&
            "number" == typeof r.length &&
            (Oe(r) || gt(r))
          ) {
            e || (r = at(r, e, i));
            var s = -1,
              l = r.length,
              d = o.length;
            for (o.length += l; ++s < l; ) o[d++] = r[s];
          } else i || o.push(r);
        }
        return o;
      }
      function ot(t, e, i, n, a, o) {
        if (i) {
          var r = i(t, e);
          if (void 0 !== r) return !!r;
        }
        if (t === e) return 0 !== t || 1 / t == 1 / e;
        if (t === t && !((t && G[typeof t]) || (e && G[typeof e]))) return !1;
        if (null == t || null == e) return t === e;
        var l = pe.call(t),
          p = pe.call(e);
        if ((l == $ && (l = F), p == $ && (p = F), l != p)) return !1;
        switch (l) {
          case O:
          case R:
            return +t == +e;
          case B:
            return t != +t ? e != +e : 0 == t ? 1 / t == 1 / e : t == +e;
          case W:
          case j:
            return t == oe(e);
        }
        if (!(p = l == M)) {
          var c = be.call(t, "__wrapped__"),
            u = be.call(e, "__wrapped__");
          if (c || u)
            return ot(c ? t.__wrapped__ : t, u ? e.__wrapped__ : e, i, n, a, o);
          if (l != F) return !1;
          if (
            ((l = t.constructor),
            (c = e.constructor),
            l != c &&
              !(wt(l) && l instanceof l && wt(c) && c instanceof c) &&
              "constructor" in t &&
              "constructor" in e)
          )
            return !1;
        }
        for (l = !a, a || (a = s()), o || (o = s()), c = a.length; c--; )
          if (a[c] == t) return o[c] == e;
        var h = 0,
          r = !0;
        if ((a.push(t), o.push(e), p)) {
          if (((c = t.length), (h = e.length), (r = h == c) || n))
            for (; h--; )
              if (((p = c), (u = e[h]), n))
                for (; p-- && !(r = ot(t[p], u, i, n, a, o)); );
              else if (!(r = ot(t[h], u, i, n, a, o))) break;
        } else
          m(e, function (e, s, l) {
            return be.call(l, s)
              ? (h++, (r = be.call(t, s) && ot(t[s], e, i, n, a, o)))
              : void 0;
          }),
            r &&
              !n &&
              m(t, function (t, e, i) {
                return be.call(i, e) ? (r = -1 < --h) : void 0;
              });
        return a.pop(), o.pop(), l && (d(a), d(o)), r;
      }
      function rt(t, e, i, n, a) {
        (Oe(e) ? It : f)(e, function (e, o) {
          var r,
            s,
            l = e,
            d = t[o];
          if (e && ((s = Oe(e)) || je(e))) {
            for (l = n.length; l--; )
              if ((r = n[l] == e)) {
                d = a[l];
                break;
              }
            if (!r) {
              var p;
              i && ((l = i(d, e)), (p = void 0 !== l)) && (d = l),
                p || (d = s ? (Oe(d) ? d : []) : je(d) ? d : {}),
                n.push(e),
                a.push(d),
                p || rt(d, e, i, n, a);
            }
          } else i && void 0 === (l = i(d, e)) && (l = e), void 0 !== l && (d = l);
          t[o] = d;
        });
      }
      function st(t, e) {
        return t + fe(Pe() * (e - t + 1));
      }
      function lt(i, n, a) {
        var r = -1,
          l = ut(),
          c = i ? i.length : 0,
          u = [],
          h = !n && c >= v && l === t,
          f = a || h ? s() : u;
        for (h && ((f = o(f)), (l = e)); ++r < c; ) {
          var m = i[r],
            g = a ? a(m, r, i) : m;
          (n ? !r || f[f.length - 1] !== g : 0 > l(f, g)) &&
            ((a || h) && f.push(g), u.push(m));
        }
        return h ? (d(f.k), p(f)) : a && d(f), u;
      }
      function dt(t) {
        return function (e, i, n) {
          var a = {};
          (i = Y.createCallback(i, n, 3)), (n = -1);
          var o = e ? e.length : 0;
          if ("number" == typeof o)
            for (; ++n < o; ) {
              var r = e[n];
              t(a, r, i(r, n, e), e);
            }
          else
            f(e, function (e, n, o) {
              t(a, e, i(e, n, o), o);
            });
          return a;
        };
      }
      function pt(t, e, i, n, a, o) {
        var r = 1 & e,
          s = 4 & e,
          l = 16 & e,
          d = 32 & e;
        if (!(2 & e || wt(t))) throw new re();
        l && !i.length && ((e &= -17), (l = i = !1)),
          d && !n.length && ((e &= -33), (d = n = !1));
        var p = t && t.__bindData__;
        return p && !0 !== p
          ? ((p = c(p)),
            p[2] && (p[2] = c(p[2])),
            p[3] && (p[3] = c(p[3])),
            !r || 1 & p[1] || (p[4] = a),
            !r && 1 & p[1] && (e |= 8),
            !s || 4 & p[1] || (p[5] = o),
            l && ve.apply(p[2] || (p[2] = []), i),
            d && Ce.apply(p[3] || (p[3] = []), n),
            (p[1] |= e),
            pt.apply(null, p))
          : (1 == e || 17 === e ? X : it)([t, e, i, n, a, o]);
      }
      function ct(t) {
        return Ne[t];
      }
      function ut() {
        var e = (e = Y.indexOf) === Bt ? t : e;
        return e;
      }
      function ht(t) {
        return "function" == typeof t && ce.test(t);
      }
      function ft(t) {
        var e, i;
        return (
          !!(
            t &&
            pe.call(t) == F &&
            ((e = t.constructor), !wt(e) || e instanceof e)
          ) &&
          (m(t, function (t, e) {
            i = e;
          }),
          void 0 === i || be.call(t, i))
        );
      }
      function mt(t) {
        return Be[t];
      }
      function gt(t) {
        return (
          (t &&
            "object" == typeof t &&
            "number" == typeof t.length &&
            pe.call(t) == $) ||
          !1
        );
      }
      function bt(t, e, i) {
        var n = Re(t),
          a = n.length;
        for (e = et(e, i, 3); a-- && ((i = n[a]), !1 !== e(t[i], i, t)); );
        return t;
      }
      function vt(t) {
        var e = [];
        return (
          m(t, function (t, i) {
            wt(t) && e.push(i);
          }),
          e.sort()
        );
      }
      function yt(t) {
        for (var e = -1, i = Re(t), n = i.length, a = {}; ++e < n; ) {
          var o = i[e];
          a[t[o]] = o;
        }
        return a;
      }
      function wt(t) {
        return "function" == typeof t;
      }
      function Ct(t) {
        return !(!t || !G[typeof t]);
      }
      function _t(t) {
        return (
          "number" == typeof t ||
          (t && "object" == typeof t && pe.call(t) == B) ||
          !1
        );
      }
      function xt(t) {
        return (
          "string" == typeof t ||
          (t && "object" == typeof t && pe.call(t) == j) ||
          !1
        );
      }
      function St(t) {
        for (var e = -1, i = Re(t), n = i.length, a = Xt(n); ++e < n; )
          a[e] = t[i[e]];
        return a;
      }
      function Tt(t, e, i) {
        var n = -1,
          a = ut(),
          o = t ? t.length : 0,
          r = !1;
        return (
          (i = (0 > i ? Ae(0, o + i) : i) || 0),
          Oe(t)
            ? (r = -1 < a(t, e, i))
            : "number" == typeof o
            ? (r = -1 < (xt(t) ? t.indexOf(e, i) : a(t, e, i)))
            : f(t, function (t) {
                return ++n < i ? void 0 : !(r = t === e);
              }),
          r
        );
      }
      function kt(t, e, i) {
        var n = !0;
        (e = Y.createCallback(e, i, 3)), (i = -1);
        var a = t ? t.length : 0;
        if ("number" == typeof a) for (; ++i < a && (n = !!e(t[i], i, t)); );
        else
          f(t, function (t, i, a) {
            return (n = !!e(t, i, a));
          });
        return n;
      }
      function Et(t, e, i) {
        var n = [];
        (e = Y.createCallback(e, i, 3)), (i = -1);
        var a = t ? t.length : 0;
        if ("number" == typeof a)
          for (; ++i < a; ) {
            var o = t[i];
            e(o, i, t) && n.push(o);
          }
        else
          f(t, function (t, i, a) {
            e(t, i, a) && n.push(t);
          });
        return n;
      }
      function At(t, e, i) {
        (e = Y.createCallback(e, i, 3)), (i = -1);
        var n = t ? t.length : 0;
        if ("number" != typeof n) {
          var a;
          return (
            f(t, function (t, i, n) {
              return e(t, i, n) ? ((a = t), !1) : void 0;
            }),
            a
          );
        }
        for (; ++i < n; ) {
          var o = t[i];
          if (e(o, i, t)) return o;
        }
      }
      function It(t, e, i) {
        var n = -1,
          a = t ? t.length : 0;
        if (((e = e && void 0 === i ? e : et(e, i, 3)), "number" == typeof a))
          for (; ++n < a && !1 !== e(t[n], n, t); );
        else f(t, e);
        return t;
      }
      function Lt(t, e, i) {
        var n = t ? t.length : 0;
        if (((e = e && void 0 === i ? e : et(e, i, 3)), "number" == typeof n))
          for (; n-- && !1 !== e(t[n], n, t); );
        else {
          var a = Re(t),
            n = a.length;
          f(t, function (t, i, o) {
            return (i = a ? a[--n] : --n), e(o[i], i, o);
          });
        }
        return t;
      }
      function Pt(t, e, i) {
        var n = -1,
          a = t ? t.length : 0;
        if (((e = Y.createCallback(e, i, 3)), "number" == typeof a))
          for (var o = Xt(a); ++n < a; ) o[n] = e(t[n], n, t);
        else
          (o = []),
            f(t, function (t, i, a) {
              o[++n] = e(t, i, a);
            });
        return o;
      }
      function Dt(t, e, i) {
        var a = -1 / 0,
          o = a;
        if (
          ("function" != typeof e && i && i[e] === t && (e = null),
          null == e && Oe(t))
        ) {
          i = -1;
          for (var r = t.length; ++i < r; ) {
            var s = t[i];
            s > o && (o = s);
          }
        } else
          (e = null == e && xt(t) ? n : Y.createCallback(e, i, 3)),
            It(t, function (t, i, n) {
              (i = e(t, i, n)) > a && ((a = i), (o = t));
            });
        return o;
      }
      function $t(t, e, i, n) {
        if (!t) return i;
        var a = 3 > arguments.length;
        e = Y.createCallback(e, n, 4);
        var o = -1,
          r = t.length;
        if ("number" == typeof r)
          for (a && (i = t[++o]); ++o < r; ) i = e(i, t[o], o, t);
        else
          f(t, function (t, n, o) {
            i = a ? ((a = !1), t) : e(i, t, n, o);
          });
        return i;
      }
      function Mt(t, e, i, n) {
        var a = 3 > arguments.length;
        return (
          (e = Y.createCallback(e, n, 4)),
          Lt(t, function (t, n, o) {
            i = a ? ((a = !1), t) : e(i, t, n, o);
          }),
          i
        );
      }
      function Ot(t) {
        var e = -1,
          i = t ? t.length : 0,
          n = Xt("number" == typeof i ? i : 0);
        return (
          It(t, function (t) {
            var i = st(0, ++e);
            (n[e] = n[i]), (n[i] = t);
          }),
          n
        );
      }
      function Rt(t, e, i) {
        var n;
        (e = Y.createCallback(e, i, 3)), (i = -1);
        var a = t ? t.length : 0;
        if ("number" == typeof a) for (; ++i < a && !(n = e(t[i], i, t)); );
        else
          f(t, function (t, i, a) {
            return !(n = e(t, i, a));
          });
        return !!n;
      }
      function Nt(t, e, i) {
        var n = 0,
          a = t ? t.length : 0;
        if ("number" != typeof e && null != e) {
          var o = -1;
          for (e = Y.createCallback(e, i, 3); ++o < a && e(t[o], o, t); ) n++;
        } else if (null == (n = e) || i) return t ? t[0] : h;
        return c(t, 0, Ie(Ae(0, n), a));
      }
      function Bt(e, i, n) {
        if ("number" == typeof n) {
          var a = e ? e.length : 0;
          n = 0 > n ? Ae(0, a + n) : n || 0;
        } else if (n) return (n = Wt(e, i)), e[n] === i ? n : -1;
        return t(e, i, n);
      }
      function Ft(t, e, i) {
        if ("number" != typeof e && null != e) {
          var n = 0,
            a = -1,
            o = t ? t.length : 0;
          for (e = Y.createCallback(e, i, 3); ++a < o && e(t[a], a, t); ) n++;
        } else n = null == e || i ? 1 : Ae(0, e);
        return c(t, n);
      }
      function Wt(t, e, i, n) {
        var a = 0,
          o = t ? t.length : a;
        for (i = i ? Y.createCallback(i, n, 1) : Vt, e = i(e); a < o; )
          (n = (a + o) >>> 1), i(t[n]) < e ? (a = n + 1) : (o = n);
        return a;
      }
      function jt(t, e, i, n) {
        return (
          "boolean" != typeof e &&
            null != e &&
            ((n = i),
            (i = "function" != typeof e && n && n[e] === t ? null : e),
            (e = !1)),
          null != i && (i = Y.createCallback(i, n, 3)),
          lt(t, e, i)
        );
      }
      function Ht() {
        for (
          var t = 1 < arguments.length ? arguments : arguments[0],
            e = -1,
            i = t ? Dt(Ge(t, "length")) : 0,
            n = Xt(0 > i ? 0 : i);
          ++e < i;

        )
          n[e] = Ge(t, e);
        return n;
      }
      function zt(t, e) {
        var i = -1,
          n = t ? t.length : 0,
          a = {};
        for (e || !n || Oe(t[0]) || (e = []); ++i < n; ) {
          var o = t[i];
          e ? (a[o] = e[i]) : o && (a[o[0]] = o[1]);
        }
        return a;
      }
      function Ut(t, e) {
        return 2 < arguments.length
          ? pt(t, 17, c(arguments, 2), null, e)
          : pt(t, 1, null, null, e);
      }
      function Gt(t, e, i) {
        function n() {
          p && he(p),
            (r = p = c = h),
            (m || f !== e) &&
              ((u = Ve()), (s = t.apply(d, o)), p || r || (o = d = null));
        }
        function a() {
          var i = e - (Ve() - l);
          0 < i
            ? (p = ye(a, i))
            : (r && he(r),
              (i = c),
              (r = p = c = h),
              i && ((u = Ve()), (s = t.apply(d, o)), p || r || (o = d = null)));
        }
        var o,
          r,
          s,
          l,
          d,
          p,
          c,
          u = 0,
          f = !1,
          m = !0;
        if (!wt(t)) throw new re();
        if (((e = Ae(0, e) || 0), !0 === i))
          var g = !0,
            m = !1;
        else
          Ct(i) &&
            ((g = i.leading),
            (f = "maxWait" in i && (Ae(e, i.maxWait) || 0)),
            (m = "trailing" in i ? i.trailing : m));
        return function () {
          if (
            ((o = arguments),
            (l = Ve()),
            (d = this),
            (c = m && (p || !g)),
            !1 === f)
          )
            var i = g && !p;
          else {
            r || g || (u = l);
            var h = f - (l - u),
              b = 0 >= h;
            b
              ? (r && (r = he(r)), (u = l), (s = t.apply(d, o)))
              : r || (r = ye(n, h));
          }
          return (
            b && p ? (p = he(p)) : p || e === f || (p = ye(a, e)),
            i && ((b = !0), (s = t.apply(d, o))),
            !b || p || r || (o = d = null),
            s
          );
        };
      }
      function Vt(t) {
        return t;
      }
      function qt(t, e, i) {
        var n = !0,
          a = e && vt(e);
        (e && (i || a.length)) ||
          (null == i && (i = e), (o = Q), (e = t), (t = Y), (a = vt(e))),
          !1 === i ? (n = !1) : Ct(i) && "chain" in i && (n = i.chain);
        var o = t,
          r = wt(o);
        It(a, function (i) {
          var a = (t[i] = e[i]);
          r &&
            (o.prototype[i] = function () {
              var e = this.__chain__,
                i = this.__wrapped__,
                r = [i];
              if ((ve.apply(r, arguments), (r = a.apply(t, r)), n || e)) {
                if (i === r && Ct(r)) return this;
                (r = new o(r)), (r.__chain__ = e);
              }
              return r;
            });
        });
      }
      function Kt() {}
      function Yt(t) {
        return function (e) {
          return e[t];
        };
      }
      function Qt() {
        return this.__wrapped__;
      }
      i = i ? J.defaults(q.Object(), i, J.pick(q, D)) : q;
      var Xt = i.Array,
        Jt = i.Boolean,
        Zt = i.Date,
        te = i.Function,
        ee = i.Math,
        ie = i.Number,
        ne = i.Object,
        ae = i.RegExp,
        oe = i.String,
        re = i.TypeError,
        se = [],
        le = ne.prototype,
        de = i._,
        pe = le.toString,
        ce = ae(
          "^" +
            oe(pe)
              .replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
              .replace(/toString| for [^\]]+/g, ".*?") +
            "$"
        ),
        ue = ee.ceil,
        he = i.clearTimeout,
        fe = ee.floor,
        me = te.prototype.toString,
        ge = ht((ge = ne.getPrototypeOf)) && ge,
        be = le.hasOwnProperty,
        ve = se.push,
        ye = i.setTimeout,
        we = se.splice,
        Ce = se.unshift,
        _e = (function () {
          try {
            var t = {},
              e = ht((e = ne.defineProperty)) && e,
              i = e(t, t, t) && e;
          } catch (t) {}
          return i;
        })(),
        xe = ht((xe = ne.create)) && xe,
        Se = ht((Se = Xt.isArray)) && Se,
        Te = i.isFinite,
        ke = i.isNaN,
        Ee = ht((Ee = ne.keys)) && Ee,
        Ae = ee.max,
        Ie = ee.min,
        Le = i.parseInt,
        Pe = ee.random,
        De = {};
      (De[M] = Xt),
        (De[O] = Jt),
        (De[R] = Zt),
        (De[N] = te),
        (De[F] = ne),
        (De[B] = ie),
        (De[W] = ae),
        (De[j] = oe),
        (Q.prototype = Y.prototype);
      var $e = (Y.support = {});
      ($e.funcDecomp = !ht(i.a) && L.test(u)),
        ($e.funcNames = "string" == typeof te.name),
        (Y.templateSettings = {
          escape: /<%-([\s\S]+?)%>/g,
          evaluate: /<%([\s\S]+?)%>/g,
          interpolate: E,
          variable: "",
          imports: { _: Y },
        }),
        xe ||
          (tt = (function () {
            function t() {}
            return function (e) {
              if (Ct(e)) {
                t.prototype = e;
                var n = new t();
                t.prototype = null;
              }
              return n || i.Object();
            };
          })());
      var Me = _e
          ? function (t, e) {
              (U.value = e), _e(t, "__bindData__", U);
            }
          : Kt,
        Oe =
          Se ||
          function (t) {
            return (
              (t &&
                "object" == typeof t &&
                "number" == typeof t.length &&
                pe.call(t) == M) ||
              !1
            );
          },
        Re = Ee
          ? function (t) {
              return Ct(t) ? Ee(t) : [];
            }
          : K,
        Ne = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;",
        },
        Be = yt(Ne),
        Fe = ae("(" + Re(Be).join("|") + ")", "g"),
        We = ae("[" + Re(Ne).join("") + "]", "g"),
        je = ge
          ? function (t) {
              if (!t || pe.call(t) != F) return !1;
              var e = t.valueOf,
                i = ht(e) && (i = ge(e)) && ge(i);
              return i ? t == i || ge(t) == i : ft(t);
            }
          : ft,
        He = dt(function (t, e, i) {
          be.call(t, i) ? t[i]++ : (t[i] = 1);
        }),
        ze = dt(function (t, e, i) {
          (be.call(t, i) ? t[i] : (t[i] = [])).push(e);
        }),
        Ue = dt(function (t, e, i) {
          t[i] = e;
        }),
        Ge = Pt,
        Ve =
          (ht((Ve = Zt.now)) && Ve) ||
          function () {
            return new Zt().getTime();
          },
        qe =
          8 == Le(w + "08")
            ? Le
            : function (t, e) {
                return Le(xt(t) ? t.replace(A, "") : t, e || 0);
              };
      return (
        (Y.after = function (t, e) {
          if (!wt(e)) throw new re();
          return function () {
            return 1 > --t ? e.apply(this, arguments) : void 0;
          };
        }),
        (Y.assign = V),
        (Y.at = function (t) {
          for (
            var e = arguments,
              i = -1,
              n = at(e, !0, !1, 1),
              e = e[2] && e[2][e[1]] === t ? 1 : n.length,
              a = Xt(e);
            ++i < e;

          )
            a[i] = t[n[i]];
          return a;
        }),
        (Y.bind = Ut),
        (Y.bindAll = function (t) {
          for (
            var e = 1 < arguments.length ? at(arguments, !0, !1, 1) : vt(t),
              i = -1,
              n = e.length;
            ++i < n;

          ) {
            var a = e[i];
            t[a] = pt(t[a], 1, null, null, t);
          }
          return t;
        }),
        (Y.bindKey = function (t, e) {
          return 2 < arguments.length
            ? pt(e, 19, c(arguments, 2), null, t)
            : pt(e, 3, null, null, t);
        }),
        (Y.chain = function (t) {
          return (t = new Q(t)), (t.__chain__ = !0), t;
        }),
        (Y.compact = function (t) {
          for (var e = -1, i = t ? t.length : 0, n = []; ++e < i; ) {
            var a = t[e];
            a && n.push(a);
          }
          return n;
        }),
        (Y.compose = function () {
          for (var t = arguments, e = t.length; e--; )
            if (!wt(t[e])) throw new re();
          return function () {
            for (var e = arguments, i = t.length; i--; )
              e = [t[i].apply(this, e)];
            return e[0];
          };
        }),
        (Y.constant = function (t) {
          return function () {
            return t;
          };
        }),
        (Y.countBy = He),
        (Y.create = function (t, e) {
          var i = tt(t);
          return e ? V(i, e) : i;
        }),
        (Y.createCallback = function (t, e, i) {
          var n = typeof t;
          if (null == t || "function" == n) return et(t, e, i);
          if ("object" != n) return Yt(t);
          var a = Re(t),
            o = a[0],
            r = t[o];
          return 1 != a.length || r !== r || Ct(r)
            ? function (e) {
                for (
                  var i = a.length, n = !1;
                  i-- && (n = ot(e[a[i]], t[a[i]], null, !0));

                );
                return n;
              }
            : function (t) {
                return (t = t[o]), r === t && (0 !== r || 1 / r == 1 / t);
              };
        }),
        (Y.curry = function (t, e) {
          return (
            (e = "number" == typeof e ? e : +e || t.length),
            pt(t, 4, null, null, null, e)
          );
        }),
        (Y.debounce = Gt),
        (Y.defaults = y),
        (Y.defer = function (t) {
          if (!wt(t)) throw new re();
          var e = c(arguments, 1);
          return ye(function () {
            t.apply(h, e);
          }, 1);
        }),
        (Y.delay = function (t, e) {
          if (!wt(t)) throw new re();
          var i = c(arguments, 2);
          return ye(function () {
            t.apply(h, i);
          }, e);
        }),
        (Y.difference = function (t) {
          return nt(t, at(arguments, !0, !0, 1));
        }),
        (Y.filter = Et),
        (Y.flatten = function (t, e, i, n) {
          return (
            "boolean" != typeof e &&
              null != e &&
              ((n = i),
              (i = "function" != typeof e && n && n[e] === t ? null : e),
              (e = !1)),
            null != i && (t = Pt(t, i, n)),
            at(t, e)
          );
        }),
        (Y.forEach = It),
        (Y.forEachRight = Lt),
        (Y.forIn = m),
        (Y.forInRight = function (t, e, i) {
          var n = [];
          m(t, function (t, e) {
            n.push(e, t);
          });
          var a = n.length;
          for (e = et(e, i, 3); a-- && !1 !== e(n[a--], n[a], t); );
          return t;
        }),
        (Y.forOwn = f),
        (Y.forOwnRight = bt),
        (Y.functions = vt),
        (Y.groupBy = ze),
        (Y.indexBy = Ue),
        (Y.initial = function (t, e, i) {
          var n = 0,
            a = t ? t.length : 0;
          if ("number" != typeof e && null != e) {
            var o = a;
            for (e = Y.createCallback(e, i, 3); o-- && e(t[o], o, t); ) n++;
          } else n = null == e || i ? 1 : e || n;
          return c(t, 0, Ie(Ae(0, a - n), a));
        }),
        (Y.intersection = function () {
          for (
            var i = [],
              n = -1,
              a = arguments.length,
              r = s(),
              l = ut(),
              c = l === t,
              u = s();
            ++n < a;

          ) {
            var h = arguments[n];
            (Oe(h) || gt(h)) &&
              (i.push(h), r.push(c && h.length >= v && o(n ? i[n] : u)));
          }
          var c = i[0],
            f = -1,
            m = c ? c.length : 0,
            g = [];
          t: for (; ++f < m; ) {
            var b = r[0],
              h = c[f];
            if (0 > (b ? e(b, h) : l(u, h))) {
              for (n = a, (b || u).push(h); --n; )
                if (((b = r[n]), 0 > (b ? e(b, h) : l(i[n], h)))) continue t;
              g.push(h);
            }
          }
          for (; a--; ) (b = r[a]) && p(b);
          return d(r), d(u), g;
        }),
        (Y.invert = yt),
        (Y.invoke = function (t, e) {
          var i = c(arguments, 2),
            n = -1,
            a = "function" == typeof e,
            o = t ? t.length : 0,
            r = Xt("number" == typeof o ? o : 0);
          return (
            It(t, function (t) {
              r[++n] = (a ? e : t[e]).apply(t, i);
            }),
            r
          );
        }),
        (Y.keys = Re),
        (Y.map = Pt),
        (Y.mapValues = function (t, e, i) {
          var n = {};
          return (
            (e = Y.createCallback(e, i, 3)),
            f(t, function (t, i, a) {
              n[i] = e(t, i, a);
            }),
            n
          );
        }),
        (Y.max = Dt),
        (Y.memoize = function (t, e) {
          function i() {
            var n = i.cache,
              a = e ? e.apply(this, arguments) : b + arguments[0];
            return be.call(n, a) ? n[a] : (n[a] = t.apply(this, arguments));
          }
          if (!wt(t)) throw new re();
          return (i.cache = {}), i;
        }),
        (Y.merge = function (t) {
          var e = arguments,
            i = 2;
          if (!Ct(t)) return t;
          if (
            ("number" != typeof e[2] && (i = e.length),
            3 < i && "function" == typeof e[i - 2])
          )
            var n = et(e[--i - 1], e[i--], 2);
          else 2 < i && "function" == typeof e[i - 1] && (n = e[--i]);
          for (var e = c(arguments, 1, i), a = -1, o = s(), r = s(); ++a < i; )
            rt(t, e[a], n, o, r);
          return d(o), d(r), t;
        }),
        (Y.min = function (t, e, i) {
          var a = 1 / 0,
            o = a;
          if (
            ("function" != typeof e && i && i[e] === t && (e = null),
            null == e && Oe(t))
          ) {
            i = -1;
            for (var r = t.length; ++i < r; ) {
              var s = t[i];
              s < o && (o = s);
            }
          } else
            (e = null == e && xt(t) ? n : Y.createCallback(e, i, 3)),
              It(t, function (t, i, n) {
                (i = e(t, i, n)) < a && ((a = i), (o = t));
              });
          return o;
        }),
        (Y.omit = function (t, e, i) {
          var n = {};
          if ("function" != typeof e) {
            var a = [];
            m(t, function (t, e) {
              a.push(e);
            });
            for (
              var a = nt(a, at(arguments, !0, !1, 1)), o = -1, r = a.length;
              ++o < r;

            ) {
              var s = a[o];
              n[s] = t[s];
            }
          } else
            (e = Y.createCallback(e, i, 3)),
              m(t, function (t, i, a) {
                e(t, i, a) || (n[i] = t);
              });
          return n;
        }),
        (Y.once = function (t) {
          var e, i;
          if (!wt(t)) throw new re();
          return function () {
            return e
              ? i
              : ((e = !0), (i = t.apply(this, arguments)), (t = null), i);
          };
        }),
        (Y.pairs = function (t) {
          for (var e = -1, i = Re(t), n = i.length, a = Xt(n); ++e < n; ) {
            var o = i[e];
            a[e] = [o, t[o]];
          }
          return a;
        }),
        (Y.partial = function (t) {
          return pt(t, 16, c(arguments, 1));
        }),
        (Y.partialRight = function (t) {
          return pt(t, 32, null, c(arguments, 1));
        }),
        (Y.pick = function (t, e, i) {
          var n = {};
          if ("function" != typeof e)
            for (
              var a = -1,
                o = at(arguments, !0, !1, 1),
                r = Ct(t) ? o.length : 0;
              ++a < r;

            ) {
              var s = o[a];
              s in t && (n[s] = t[s]);
            }
          else
            (e = Y.createCallback(e, i, 3)),
              m(t, function (t, i, a) {
                e(t, i, a) && (n[i] = t);
              });
          return n;
        }),
        (Y.pluck = Ge),
        (Y.property = Yt),
        (Y.pull = function (t) {
          for (
            var e = arguments, i = 0, n = e.length, a = t ? t.length : 0;
            ++i < n;

          )
            for (var o = -1, r = e[i]; ++o < a; )
              t[o] === r && (we.call(t, o--, 1), a--);
          return t;
        }),
        (Y.range = function (t, e, i) {
          (t = +t || 0),
            (i = "number" == typeof i ? i : +i || 1),
            null == e && ((e = t), (t = 0));
          var n = -1;
          e = Ae(0, ue((e - t) / (i || 1)));
          for (var a = Xt(e); ++n < e; ) (a[n] = t), (t += i);
          return a;
        }),
        (Y.reject = function (t, e, i) {
          return (
            (e = Y.createCallback(e, i, 3)),
            Et(t, function (t, i, n) {
              return !e(t, i, n);
            })
          );
        }),
        (Y.remove = function (t, e, i) {
          var n = -1,
            a = t ? t.length : 0,
            o = [];
          for (e = Y.createCallback(e, i, 3); ++n < a; )
            (i = t[n]), e(i, n, t) && (o.push(i), we.call(t, n--, 1), a--);
          return o;
        }),
        (Y.rest = Ft),
        (Y.shuffle = Ot),
        (Y.sortBy = function (t, e, i) {
          var n = -1,
            o = Oe(e),
            r = t ? t.length : 0,
            c = Xt("number" == typeof r ? r : 0);
          for (
            o || (e = Y.createCallback(e, i, 3)),
              It(t, function (t, i, a) {
                var r = (c[++n] = l());
                o
                  ? (r.m = Pt(e, function (e) {
                      return t[e];
                    }))
                  : ((r.m = s())[0] = e(t, i, a)),
                  (r.n = n),
                  (r.o = t);
              }),
              r = c.length,
              c.sort(a);
            r--;

          )
            (t = c[r]), (c[r] = t.o), o || d(t.m), p(t);
          return c;
        }),
        (Y.tap = function (t, e) {
          return e(t), t;
        }),
        (Y.throttle = function (t, e, i) {
          var n = !0,
            a = !0;
          if (!wt(t)) throw new re();
          return (
            !1 === i
              ? (n = !1)
              : Ct(i) &&
                ((n = "leading" in i ? i.leading : n),
                (a = "trailing" in i ? i.trailing : a)),
            (z.leading = n),
            (z.maxWait = e),
            (z.trailing = a),
            Gt(t, e, z)
          );
        }),
        (Y.times = function (t, e, i) {
          t = -1 < (t = +t) ? t : 0;
          var n = -1,
            a = Xt(t);
          for (e = et(e, i, 1); ++n < t; ) a[n] = e(n);
          return a;
        }),
        (Y.toArray = function (t) {
          return t && "number" == typeof t.length ? c(t) : St(t);
        }),
        (Y.transform = function (t, e, i, n) {
          var a = Oe(t);
          if (null == i)
            if (a) i = [];
            else {
              var o = t && t.constructor;
              i = tt(o && o.prototype);
            }
          return (
            e &&
              ((e = Y.createCallback(e, n, 4)),
              (a ? It : f)(t, function (t, n, a) {
                return e(i, t, n, a);
              })),
            i
          );
        }),
        (Y.union = function () {
          return lt(at(arguments, !0, !0));
        }),
        (Y.uniq = jt),
        (Y.values = St),
        (Y.where = Et),
        (Y.without = function (t) {
          return nt(t, c(arguments, 1));
        }),
        (Y.wrap = function (t, e) {
          return pt(e, 16, [t]);
        }),
        (Y.xor = function () {
          for (var t = -1, e = arguments.length; ++t < e; ) {
            var i = arguments[t];
            if (Oe(i) || gt(i)) var n = n ? lt(nt(n, i).concat(nt(i, n))) : i;
          }
          return n || [];
        }),
        (Y.zip = Ht),
        (Y.zipObject = zt),
        (Y.collect = Pt),
        (Y.drop = Ft),
        (Y.each = It),
        (Y.eachRight = Lt),
        (Y.extend = V),
        (Y.methods = vt),
        (Y.object = zt),
        (Y.select = Et),
        (Y.tail = Ft),
        (Y.unique = jt),
        (Y.unzip = Ht),
        qt(Y),
        (Y.clone = function (t, e, i, n) {
          return (
            "boolean" != typeof e && null != e && ((n = i), (i = e), (e = !1)),
            Z(t, e, "function" == typeof i && et(i, n, 1))
          );
        }),
        (Y.cloneDeep = function (t, e, i) {
          return Z(t, !0, "function" == typeof e && et(e, i, 1));
        }),
        (Y.contains = Tt),
        (Y.escape = function (t) {
          return null == t ? "" : oe(t).replace(We, ct);
        }),
        (Y.every = kt),
        (Y.find = At),
        (Y.findIndex = function (t, e, i) {
          var n = -1,
            a = t ? t.length : 0;
          for (e = Y.createCallback(e, i, 3); ++n < a; )
            if (e(t[n], n, t)) return n;
          return -1;
        }),
        (Y.findKey = function (t, e, i) {
          var n;
          return (
            (e = Y.createCallback(e, i, 3)),
            f(t, function (t, i, a) {
              return e(t, i, a) ? ((n = i), !1) : void 0;
            }),
            n
          );
        }),
        (Y.findLast = function (t, e, i) {
          var n;
          return (
            (e = Y.createCallback(e, i, 3)),
            Lt(t, function (t, i, a) {
              return e(t, i, a) ? ((n = t), !1) : void 0;
            }),
            n
          );
        }),
        (Y.findLastIndex = function (t, e, i) {
          var n = t ? t.length : 0;
          for (e = Y.createCallback(e, i, 3); n--; )
            if (e(t[n], n, t)) return n;
          return -1;
        }),
        (Y.findLastKey = function (t, e, i) {
          var n;
          return (
            (e = Y.createCallback(e, i, 3)),
            bt(t, function (t, i, a) {
              return e(t, i, a) ? ((n = i), !1) : void 0;
            }),
            n
          );
        }),
        (Y.has = function (t, e) {
          return !!t && be.call(t, e);
        }),
        (Y.identity = Vt),
        (Y.indexOf = Bt),
        (Y.isArguments = gt),
        (Y.isArray = Oe),
        (Y.isBoolean = function (t) {
          return (
            !0 === t ||
            !1 === t ||
            (t && "object" == typeof t && pe.call(t) == O) ||
            !1
          );
        }),
        (Y.isDate = function (t) {
          return (t && "object" == typeof t && pe.call(t) == R) || !1;
        }),
        (Y.isElement = function (t) {
          return (t && 1 === t.nodeType) || !1;
        }),
        (Y.isEmpty = function (t) {
          var e = !0;
          if (!t) return e;
          var i = pe.call(t),
            n = t.length;
          return i == M ||
            i == j ||
            i == $ ||
            (i == F && "number" == typeof n && wt(t.splice))
            ? !n
            : (f(t, function () {
                return (e = !1);
              }),
              e);
        }),
        (Y.isEqual = function (t, e, i, n) {
          return ot(t, e, "function" == typeof i && et(i, n, 2));
        }),
        (Y.isFinite = function (t) {
          return Te(t) && !ke(parseFloat(t));
        }),
        (Y.isFunction = wt),
        (Y.isNaN = function (t) {
          return _t(t) && t != +t;
        }),
        (Y.isNull = function (t) {
          return null === t;
        }),
        (Y.isNumber = _t),
        (Y.isObject = Ct),
        (Y.isPlainObject = je),
        (Y.isRegExp = function (t) {
          return (t && "object" == typeof t && pe.call(t) == W) || !1;
        }),
        (Y.isString = xt),
        (Y.isUndefined = function (t) {
          return void 0 === t;
        }),
        (Y.lastIndexOf = function (t, e, i) {
          var n = t ? t.length : 0;
          for (
            "number" == typeof i &&
            (n = (0 > i ? Ae(0, n + i) : Ie(i, n - 1)) + 1);
            n--;

          )
            if (t[n] === e) return n;
          return -1;
        }),
        (Y.mixin = qt),
        (Y.noConflict = function () {
          return (i._ = de), this;
        }),
        (Y.noop = Kt),
        (Y.now = Ve),
        (Y.parseInt = qe),
        (Y.random = function (t, e, i) {
          var n = null == t,
            a = null == e;
          return (
            null == i &&
              ("boolean" == typeof t && a
                ? ((i = t), (t = 1))
                : a || "boolean" != typeof e || ((i = e), (a = !0))),
            n && a && (e = 1),
            (t = +t || 0),
            a ? ((e = t), (t = 0)) : (e = +e || 0),
            i || t % 1 || e % 1
              ? ((i = Pe()),
                Ie(
                  t + i * (e - t + parseFloat("1e-" + ((i + "").length - 1))),
                  e
                ))
              : st(t, e)
          );
        }),
        (Y.reduce = $t),
        (Y.reduceRight = Mt),
        (Y.result = function (t, e) {
          if (t) {
            var i = t[e];
            return wt(i) ? t[e]() : i;
          }
        }),
        (Y.runInContext = u),
        (Y.size = function (t) {
          var e = t ? t.length : 0;
          return "number" == typeof e ? e : Re(t).length;
        }),
        (Y.some = Rt),
        (Y.sortedIndex = Wt),
        (Y.template = function (t, e, i) {
          var n = Y.templateSettings;
          (t = oe(t || "")), (i = y({}, i, n));
          var a,
            o = y({}, i.imports, n.imports),
            n = Re(o),
            o = St(o),
            s = 0,
            l = i.interpolate || I,
            d = "__p+='",
            l = ae(
              (i.escape || I).source +
                "|" +
                l.source +
                "|" +
                (l === E ? S : I).source +
                "|" +
                (i.evaluate || I).source +
                "|$",
              "g"
            );
          t.replace(l, function (e, i, n, o, l, p) {
            return (
              n || (n = o),
              (d += t.slice(s, p).replace(P, r)),
              i && (d += "'+__e(" + i + ")+'"),
              l && ((a = !0), (d += "';" + l + ";\n__p+='")),
              n && (d += "'+((__t=(" + n + "))==null?'':__t)+'"),
              (s = p + e.length),
              e
            );
          }),
            (d += "';"),
            (l = i = i.variable),
            l || ((i = "obj"), (d = "with(" + i + "){" + d + "}")),
            (d = (a ? d.replace(C, "") : d).replace(_, "$1").replace(x, "$1;")),
            (d =
              "function(" +
              i +
              "){" +
              (l ? "" : i + "||(" + i + "={});") +
              "var __t,__p='',__e=_.escape" +
              (a
                ? ",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}"
                : ";") +
              d +
              "return __p}");
          try {
            var p = te(n, "return " + d).apply(h, o);
          } catch (t) {
            throw ((t.source = d), t);
          }
          return e ? p(e) : ((p.source = d), p);
        }),
        (Y.unescape = function (t) {
          return null == t ? "" : oe(t).replace(Fe, mt);
        }),
        (Y.uniqueId = function (t) {
          var e = ++g;
          return oe(null == t ? "" : t) + e;
        }),
        (Y.all = kt),
        (Y.any = Rt),
        (Y.detect = At),
        (Y.findWhere = At),
        (Y.foldl = $t),
        (Y.foldr = Mt),
        (Y.include = Tt),
        (Y.inject = $t),
        qt(
          (function () {
            var t = {};
            return (
              f(Y, function (e, i) {
                Y.prototype[i] || (t[i] = e);
              }),
              t
            );
          })(),
          !1
        ),
        (Y.first = Nt),
        (Y.last = function (t, e, i) {
          var n = 0,
            a = t ? t.length : 0;
          if ("number" != typeof e && null != e) {
            var o = a;
            for (e = Y.createCallback(e, i, 3); o-- && e(t[o], o, t); ) n++;
          } else if (null == (n = e) || i) return t ? t[a - 1] : h;
          return c(t, Ae(0, a - n));
        }),
        (Y.sample = function (t, e, i) {
          return (
            t && "number" != typeof t.length && (t = St(t)),
            null == e || i
              ? t
                ? t[st(0, t.length - 1)]
                : h
              : ((t = Ot(t)), (t.length = Ie(Ae(0, e), t.length)), t)
          );
        }),
        (Y.take = Nt),
        (Y.head = Nt),
        f(Y, function (t, e) {
          var i = "sample" !== e;
          Y.prototype[e] ||
            (Y.prototype[e] = function (e, n) {
              var a = this.__chain__,
                o = t(this.__wrapped__, e, n);
              return a || (null != e && (!n || (i && "function" == typeof e)))
                ? new Q(o, a)
                : o;
            });
        }),
        (Y.VERSION = "2.4.1"),
        (Y.prototype.chain = function () {
          return (this.__chain__ = !0), this;
        }),
        (Y.prototype.toString = function () {
          return oe(this.__wrapped__);
        }),
        (Y.prototype.value = Qt),
        (Y.prototype.valueOf = Qt),
        It(["join", "pop", "shift"], function (t) {
          var e = se[t];
          Y.prototype[t] = function () {
            var t = this.__chain__,
              i = e.apply(this.__wrapped__, arguments);
            return t ? new Q(i, t) : i;
          };
        }),
        It(["push", "reverse", "sort", "unshift"], function (t) {
          var e = se[t];
          Y.prototype[t] = function () {
            return e.apply(this.__wrapped__, arguments), this;
          };
        }),
        It(["concat", "slice", "splice"], function (t) {
          var e = se[t];
          Y.prototype[t] = function () {
            return new Q(e.apply(this.__wrapped__, arguments), this.__chain__);
          };
        }),
        Y
      );
    }
    var h,
      f = [],
      m = [],
      g = 0,
      b = +new Date() + "",
      v = 75,
      y = 40,
      w = " \t\v\f \ufeff\n\r\u2028\u2029 ᠎             　",
      C = /\b__p\+='';/g,
      _ = /\b(__p\+=)''\+/g,
      x = /(__e\(.*?\)|\b__t\))\+'';/g,
      S = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,
      T = /\w*$/,
      k = /^\s*function[ \n\r\t]+\w/,
      E = /<%=([\s\S]+?)%>/g,
      A = RegExp("^[" + w + "]*0+(?=.$)"),
      I = /($^)/,
      L = /\bthis\b/,
      P = /['\n\r\t\u2028\u2029\\]/g,
      D =
        "Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(
          " "
        ),
      $ = "[object Arguments]",
      M = "[object Array]",
      O = "[object Boolean]",
      R = "[object Date]",
      N = "[object Function]",
      B = "[object Number]",
      F = "[object Object]",
      W = "[object RegExp]",
      j = "[object String]",
      H = {};
    (H[N] = !1), (H[$] = H[M] = H[O] = H[R] = H[B] = H[F] = H[W] = H[j] = !0);
    var z = { leading: !1, maxWait: 0, trailing: !1 },
      U = { configurable: !1, enumerable: !1, value: null, writable: !1 },
      G = {
        boolean: !1,
        function: !0,
        object: !0,
        number: !1,
        string: !1,
        undefined: !1,
      },
      V = {
        "\\": "\\",
        "'": "'",
        "\n": "n",
        "\r": "r",
        "\t": "t",
        "\u2028": "u2028",
        "\u2029": "u2029",
      },
      q = (G[typeof window] && window) || this,
      K = G[typeof exports] && exports && !exports.nodeType && exports,
      Y = G[typeof module] && module && !module.nodeType && module,
      Q = Y && Y.exports === K && K,
      X = G[typeof global] && global;
    !X || (X.global !== X && X.window !== X) || (q = X);
    var J = u();
    "function" == typeof define && "object" == typeof define.amd && define.amd
      ? ((q._ = J),
        define("underscore", [], function () {
          return J;
        }))
      : K && Y
      ? Q
        ? ((Y.exports = J)._ = J)
        : (K._ = J)
      : (q._ = J);
  }.call(this),
  define("lib-build/tpl", {
    load: function (t) {
      throw new Error("Dynamic load not allowed: " + t);
    },
  }),
  define(
    "lib-build/tpl!storymaps/common/ui/share/ShareDialog",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<span class="modal-title"></span>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<div class="social-container">\n\t\t\t\t<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\n\t\t\t\t<i class="shareIcon blackHover share_twitter icon-twitter"></i>\n\t\t\t</div>\n\n\t\t\t<div class="share-url-panel"></div>\n\n\t\t\t<div class="embed-title"></div>\n\t\t\t<div class="share-embed-panel"></div>\n\n\t\t\t<div class="checkbox autoplay-container">\n\t\t\t\t<label>\n\t\t\t\t\t<input type="checkbox" class="autoplay-checkbox" value="autoplay" />\n\t\t\t\t\t<span class="autoplay-label"></span>\n\t\t\t\t</label>\n\t\t\t\t<a href="#" class="help autoplay-help" data-toggle="tooltip">\n\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\n\t\t\t\t</a>\n\t\t\t\t<span class="autoplay-notification"></span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal"></button>\n\t\t</div>\n\t</div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/ui/share/ShareDialog",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/ui/share/ShareURLPanel",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="share-url-container">\n\t<span class="share-btn share-clipboard"></span>\n\t<input type="text" class="form-control bitlylink" readonly="true"/>\n\t<a class="btn btn-primary btn-bitlylink-open" target="_blank"></a>\n\t<div class="share-status-wrapper"><span class="share-status"></span></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/ui/share/ShareURLPanel",
    [],
    function () {}
  ),
  (function (t) {
    if ("object" == typeof exports && "undefined" != typeof module)
      module.exports = t();
    else if ("function" == typeof define && define.amd)
      define("lib-app/clipboard/clipboard", [], t);
    else {
      var e;
      (e =
        "undefined" != typeof window
          ? window
          : "undefined" != typeof global
          ? global
          : "undefined" != typeof self
          ? self
          : this),
        (e.Clipboard = t());
    }
  })(function () {
    var t;
    return (function t(e, i, n) {
      function a(r, s) {
        if (!i[r]) {
          if (!e[r]) {
            var l = "function" == typeof require && require;
            if (!s && l) return l(r, !0);
            if (o) return o(r, !0);
            var d = new Error("Cannot find module '" + r + "'");
            throw ((d.code = "MODULE_NOT_FOUND"), d);
          }
          var p = (i[r] = { exports: {} });
          e[r][0].call(
            p.exports,
            function (t) {
              var i = e[r][1][t];
              return a(i || t);
            },
            p,
            p.exports,
            t,
            e,
            i,
            n
          );
        }
        return i[r].exports;
      }
      for (
        var o = "function" == typeof require && require, r = 0;
        r < n.length;
        r++
      )
        a(n[r]);
      return a;
    })(
      {
        1: [
          function (t, e, i) {
            function n(t, e) {
              for (; t && t !== document; ) {
                if (t.matches(e)) return t;
                t = t.parentNode;
              }
            }
            if (Element && !Element.prototype.matches) {
              var a = Element.prototype;
              a.matches =
                a.matchesSelector ||
                a.mozMatchesSelector ||
                a.msMatchesSelector ||
                a.oMatchesSelector ||
                a.webkitMatchesSelector;
            }
            e.exports = n;
          },
          {},
        ],
        2: [
          function (t, e, i) {
            function n(t, e, i, n, o) {
              var r = a.apply(this, arguments);
              return (
                t.addEventListener(i, r, o),
                {
                  destroy: function () {
                    t.removeEventListener(i, r, o);
                  },
                }
              );
            }
            function a(t, e, i, n) {
              return function (i) {
                (i.delegateTarget = o(i.target, e)),
                  i.delegateTarget && n.call(t, i);
              };
            }
            var o = t("./closest");
            e.exports = n;
          },
          { "./closest": 1 },
        ],
        3: [
          function (t, e, i) {
            (i.node = function (t) {
              return (
                void 0 !== t && t instanceof HTMLElement && 1 === t.nodeType
              );
            }),
              (i.nodeList = function (t) {
                var e = Object.prototype.toString.call(t);
                return (
                  void 0 !== t &&
                  ("[object NodeList]" === e ||
                    "[object HTMLCollection]" === e) &&
                  "length" in t &&
                  (0 === t.length || i.node(t[0]))
                );
              }),
              (i.string = function (t) {
                return "string" == typeof t || t instanceof String;
              }),
              (i.fn = function (t) {
                return (
                  "[object Function]" === Object.prototype.toString.call(t)
                );
              });
          },
          {},
        ],
        4: [
          function (t, e, i) {
            function n(t, e, i) {
              if (!t && !e && !i) throw new Error("Missing required arguments");
              if (!s.string(e))
                throw new TypeError("Second argument must be a String");
              if (!s.fn(i))
                throw new TypeError("Third argument must be a Function");
              if (s.node(t)) return a(t, e, i);
              if (s.nodeList(t)) return o(t, e, i);
              if (s.string(t)) return r(t, e, i);
              throw new TypeError(
                "First argument must be a String, HTMLElement, HTMLCollection, or NodeList"
              );
            }
            function a(t, e, i) {
              return (
                t.addEventListener(e, i),
                {
                  destroy: function () {
                    t.removeEventListener(e, i);
                  },
                }
              );
            }
            function o(t, e, i) {
              return (
                Array.prototype.forEach.call(t, function (t) {
                  t.addEventListener(e, i);
                }),
                {
                  destroy: function () {
                    Array.prototype.forEach.call(t, function (t) {
                      t.removeEventListener(e, i);
                    });
                  },
                }
              );
            }
            function r(t, e, i) {
              return l(document.body, t, e, i);
            }
            var s = t("./is"),
              l = t("delegate");
            e.exports = n;
          },
          { "./is": 3, delegate: 2 },
        ],
        5: [
          function (t, e, i) {
            function n(t) {
              var e;
              if ("SELECT" === t.nodeName) t.focus(), (e = t.value);
              else if ("INPUT" === t.nodeName || "TEXTAREA" === t.nodeName)
                t.focus(),
                  t.setSelectionRange(0, t.value.length),
                  (e = t.value);
              else {
                t.hasAttribute("contenteditable") && t.focus();
                var i = window.getSelection(),
                  n = document.createRange();
                n.selectNodeContents(t),
                  i.removeAllRanges(),
                  i.addRange(n),
                  (e = i.toString());
              }
              return e;
            }
            e.exports = n;
          },
          {},
        ],
        6: [
          function (t, e, i) {
            function n() {}
            (n.prototype = {
              on: function (t, e, i) {
                var n = this.e || (this.e = {});
                return (n[t] || (n[t] = [])).push({ fn: e, ctx: i }), this;
              },
              once: function (t, e, i) {
                function n() {
                  a.off(t, n), e.apply(i, arguments);
                }
                var a = this;
                return (n._ = e), this.on(t, n, i);
              },
              emit: function (t) {
                var e = [].slice.call(arguments, 1),
                  i = ((this.e || (this.e = {}))[t] || []).slice(),
                  n = 0,
                  a = i.length;
                for (n; n < a; n++) i[n].fn.apply(i[n].ctx, e);
                return this;
              },
              off: function (t, e) {
                var i = this.e || (this.e = {}),
                  n = i[t],
                  a = [];
                if (n && e)
                  for (var o = 0, r = n.length; o < r; o++)
                    n[o].fn !== e && n[o].fn._ !== e && a.push(n[o]);
                return a.length ? (i[t] = a) : delete i[t], this;
              },
            }),
              (e.exports = n);
          },
          {},
        ],
        7: [
          function (e, i, n) {
            !(function (a, o) {
              if ("function" == typeof t && t.amd) t(["module", "select"], o);
              else if (void 0 !== n) o(i, e("select"));
              else {
                var r = { exports: {} };
                o(r, a.select), (a.clipboardAction = r.exports);
              }
            })(this, function (t, e) {
              "use strict";
              function i(t, e) {
                if (!(t instanceof e))
                  throw new TypeError("Cannot call a class as a function");
              }
              var n = (function (t) {
                  return t && t.__esModule ? t : { default: t };
                })(e),
                a =
                  "function" == typeof Symbol &&
                  "symbol" == typeof Symbol.iterator
                    ? function (t) {
                        return typeof t;
                      }
                    : function (t) {
                        return t &&
                          "function" == typeof Symbol &&
                          t.constructor === Symbol &&
                          t !== Symbol.prototype
                          ? "symbol"
                          : typeof t;
                      },
                o = (function () {
                  function t(t, e) {
                    for (var i = 0; i < e.length; i++) {
                      var n = e[i];
                      (n.enumerable = n.enumerable || !1),
                        (n.configurable = !0),
                        "value" in n && (n.writable = !0),
                        Object.defineProperty(t, n.key, n);
                    }
                  }
                  return function (e, i, n) {
                    return i && t(e.prototype, i), n && t(e, n), e;
                  };
                })(),
                r = (function () {
                  function t(e) {
                    i(this, t), this.resolveOptions(e), this.initSelection();
                  }
                  return (
                    o(t, [
                      {
                        key: "resolveOptions",
                        value: function () {
                          var t =
                            arguments.length > 0 && void 0 !== arguments[0]
                              ? arguments[0]
                              : {};
                          (this.action = t.action),
                            (this.emitter = t.emitter),
                            (this.target = t.target),
                            (this.text = t.text),
                            (this.trigger = t.trigger),
                            (this.selectedText = "");
                        },
                      },
                      {
                        key: "initSelection",
                        value: function () {
                          this.text
                            ? this.selectFake()
                            : this.target && this.selectTarget();
                        },
                      },
                      {
                        key: "selectFake",
                        value: function () {
                          var t = this,
                            e =
                              "rtl" ==
                              document.documentElement.getAttribute("dir");
                          this.removeFake(),
                            (this.fakeHandlerCallback = function () {
                              return t.removeFake();
                            }),
                            (this.fakeHandler =
                              document.body.addEventListener(
                                "click",
                                this.fakeHandlerCallback
                              ) || !0),
                            (this.fakeElem =
                              document.createElement("textarea")),
                            (this.fakeElem.style.fontSize = "12pt"),
                            (this.fakeElem.style.border = "0"),
                            (this.fakeElem.style.padding = "0"),
                            (this.fakeElem.style.margin = "0"),
                            (this.fakeElem.style.position = "absolute"),
                            (this.fakeElem.style[e ? "right" : "left"] =
                              "-9999px");
                          var i =
                            window.pageYOffset ||
                            document.documentElement.scrollTop;
                          this.fakeElem.addEventListener(
                            "focus",
                            window.scrollTo(0, i)
                          ),
                            (this.fakeElem.style.top = i + "px"),
                            this.fakeElem.setAttribute("readonly", ""),
                            (this.fakeElem.value = this.text),
                            document.body.appendChild(this.fakeElem),
                            (this.selectedText = (0, n.default)(this.fakeElem)),
                            this.copyText();
                        },
                      },
                      {
                        key: "removeFake",
                        value: function () {
                          this.fakeHandler &&
                            (document.body.removeEventListener(
                              "click",
                              this.fakeHandlerCallback
                            ),
                            (this.fakeHandler = null),
                            (this.fakeHandlerCallback = null)),
                            this.fakeElem &&
                              (document.body.removeChild(this.fakeElem),
                              (this.fakeElem = null));
                        },
                      },
                      {
                        key: "selectTarget",
                        value: function () {
                          (this.selectedText = (0, n.default)(this.target)),
                            this.copyText();
                        },
                      },
                      {
                        key: "copyText",
                        value: function () {
                          var t = void 0;
                          try {
                            t = document.execCommand(this.action);
                          } catch (e) {
                            t = !1;
                          }
                          this.handleResult(t);
                        },
                      },
                      {
                        key: "handleResult",
                        value: function (t) {
                          this.emitter.emit(t ? "success" : "error", {
                            action: this.action,
                            text: this.selectedText,
                            trigger: this.trigger,
                            clearSelection: this.clearSelection.bind(this),
                          });
                        },
                      },
                      {
                        key: "clearSelection",
                        value: function () {
                          this.target && this.target.blur(),
                            window.getSelection().removeAllRanges();
                        },
                      },
                      {
                        key: "destroy",
                        value: function () {
                          this.removeFake();
                        },
                      },
                      {
                        key: "action",
                        set: function () {
                          var t =
                            arguments.length > 0 && void 0 !== arguments[0]
                              ? arguments[0]
                              : "copy";
                          if (
                            ((this._action = t),
                            "copy" !== this._action && "cut" !== this._action)
                          )
                            throw new Error(
                              'Invalid "action" value, use either "copy" or "cut"'
                            );
                        },
                        get: function () {
                          return this._action;
                        },
                      },
                      {
                        key: "target",
                        set: function (t) {
                          if (void 0 !== t) {
                            if (
                              !t ||
                              "object" !==
                                (void 0 === t ? "undefined" : a(t)) ||
                              1 !== t.nodeType
                            )
                              throw new Error(
                                'Invalid "target" value, use a valid Element'
                              );
                            if (
                              "copy" === this.action &&
                              t.hasAttribute("disabled")
                            )
                              throw new Error(
                                'Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute'
                              );
                            if (
                              "cut" === this.action &&
                              (t.hasAttribute("readonly") ||
                                t.hasAttribute("disabled"))
                            )
                              throw new Error(
                                'Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes'
                              );
                            this._target = t;
                          }
                        },
                        get: function () {
                          return this._target;
                        },
                      },
                    ]),
                    t
                  );
                })();
              t.exports = r;
            });
          },
          { select: 5 },
        ],
        8: [
          function (e, i, n) {
            !(function (a, o) {
              if ("function" == typeof t && t.amd)
                t(
                  [
                    "module",
                    "./clipboard-action",
                    "tiny-emitter",
                    "good-listener",
                  ],
                  o
                );
              else if (void 0 !== n)
                o(
                  i,
                  e("./clipboard-action"),
                  e("tiny-emitter"),
                  e("good-listener")
                );
              else {
                var r = { exports: {} };
                o(r, a.clipboardAction, a.tinyEmitter, a.goodListener),
                  (a.clipboard = r.exports);
              }
            })(this, function (t, e, i, n) {
              "use strict";
              function a(t) {
                return t && t.__esModule ? t : { default: t };
              }
              function o(t, e) {
                if (!(t instanceof e))
                  throw new TypeError("Cannot call a class as a function");
              }
              function r(t, e) {
                if (!t)
                  throw new ReferenceError(
                    "this hasn't been initialised - super() hasn't been called"
                  );
                return !e || ("object" != typeof e && "function" != typeof e)
                  ? t
                  : e;
              }
              function s(t, e) {
                if ("function" != typeof e && null !== e)
                  throw new TypeError(
                    "Super expression must either be null or a function, not " +
                      typeof e
                  );
                (t.prototype = Object.create(e && e.prototype, {
                  constructor: {
                    value: t,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0,
                  },
                })),
                  e &&
                    (Object.setPrototypeOf
                      ? Object.setPrototypeOf(t, e)
                      : (t.__proto__ = e));
              }
              function l(t, e) {
                var i = "data-clipboard-" + t;
                if (e.hasAttribute(i)) return e.getAttribute(i);
              }
              var d = a(e),
                p = a(i),
                c = a(n),
                u = (function () {
                  function t(t, e) {
                    for (var i = 0; i < e.length; i++) {
                      var n = e[i];
                      (n.enumerable = n.enumerable || !1),
                        (n.configurable = !0),
                        "value" in n && (n.writable = !0),
                        Object.defineProperty(t, n.key, n);
                    }
                  }
                  return function (e, i, n) {
                    return i && t(e.prototype, i), n && t(e, n), e;
                  };
                })(),
                h = (function (t) {
                  function e(t, i) {
                    o(this, e);
                    var n = r(
                      this,
                      (e.__proto__ || Object.getPrototypeOf(e)).call(this)
                    );
                    return n.resolveOptions(i), n.listenClick(t), n;
                  }
                  return (
                    s(e, t),
                    u(e, [
                      {
                        key: "resolveOptions",
                        value: function () {
                          var t =
                            arguments.length > 0 && void 0 !== arguments[0]
                              ? arguments[0]
                              : {};
                          (this.action =
                            "function" == typeof t.action
                              ? t.action
                              : this.defaultAction),
                            (this.target =
                              "function" == typeof t.target
                                ? t.target
                                : this.defaultTarget),
                            (this.text =
                              "function" == typeof t.text
                                ? t.text
                                : this.defaultText);
                        },
                      },
                      {
                        key: "listenClick",
                        value: function (t) {
                          var e = this;
                          this.listener = (0, c.default)(
                            t,
                            "click",
                            function (t) {
                              return e.onClick(t);
                            }
                          );
                        },
                      },
                      {
                        key: "onClick",
                        value: function (t) {
                          var e = t.delegateTarget || t.currentTarget;
                          this.clipboardAction && (this.clipboardAction = null),
                            (this.clipboardAction = new d.default({
                              action: this.action(e),
                              target: this.target(e),
                              text: this.text(e),
                              trigger: e,
                              emitter: this,
                            }));
                        },
                      },
                      {
                        key: "defaultAction",
                        value: function (t) {
                          return l("action", t);
                        },
                      },
                      {
                        key: "defaultTarget",
                        value: function (t) {
                          var e = l("target", t);
                          if (e) return document.querySelector(e);
                        },
                      },
                      {
                        key: "defaultText",
                        value: function (t) {
                          return l("text", t);
                        },
                      },
                      {
                        key: "destroy",
                        value: function () {
                          this.listener.destroy(),
                            this.clipboardAction &&
                              (this.clipboardAction.destroy(),
                              (this.clipboardAction = null));
                        },
                      },
                    ]),
                    e
                  );
                })(p.default);
              t.exports = h;
            });
          },
          { "./clipboard-action": 7, "good-listener": 4, "tiny-emitter": 6 },
        ],
      },
      {},
      [8]
    )(8);
  }),
  define(
    "lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font",
    [],
    function () {}
  ),
  define(
    "storymaps/common/ui/share/ShareURLPanel",
    [
      "lib-build/tpl!./ShareURLPanel",
      "lib-build/css!./ShareURLPanel",
      "../../utils/SocialSharing",
      "lib-app/clipboard/clipboard",
      "lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css",
    ],
    function (t, e, i, n) {
      return function (e) {
        function a(t, a) {
          r.val(t),
            e.find(".btn-bitlylink-open").attr("href", t),
            i.requestShortUrl(t).then(function (t) {
              r.val(t), (void 0 !== a && !0 !== a) || r.select();
            }),
            new n(e.find(".share-btn").get(0), {
              text: function () {
                return e.find(".bitlylink").val();
              },
            }).on("success", function () {
              e
                .find(".share-btn")
                .removeClass("share-clipboard")
                .addClass("share-ok"),
                e.find(".share-status").show(),
                (e.find(".bitlylink")[0].selectionStart = e.find(
                  ".bitlylink"
                )[0].selectionEnd =
                  -1),
                e.find(".bitlylink").focus(),
                setTimeout(function () {
                  e
                    .find(".share-btn")
                    .addClass("share-clipboard")
                    .removeClass("share-ok"),
                    e.find(".share-status").hide();
                }, 2e3);
            });
        }
        var o = document.queryCommandSupported("copy");
        e.append(t({}));
        var r = e.find(".bitlylink"),
          s = null;
        !(function () {
          e.find(".bitlylink").click(function () {
            this.setSelectionRange(0, this.value.length);
          });
        })(),
          (this.present = function (t, n) {
            (s = i.cleanURL(t, !0)),
              a(s, n),
              e
                .find(".btn-bitlylink-open")
                .html(i18n.viewer.shareFromCommon.open),
              e.find(".share-url-container").toggleClass("touch", !o),
              e
                .find(".share-btn")
                .attr("title", i18n.viewer.shareFromCommon.copy),
              e.find(".share-status").html(i18n.viewer.shareFromCommon.copied);
          }),
          (this.focus = function () {
            r.select();
          }),
          (this.setAutoplay = function (t) {
            var e = s;
            t && ((e += e.match(/\?/) ? "&" : "?"), (e += "autoplay")), a(e);
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/ui/share/ShareEmbedPanel",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="share-embed-container">\n\t<div class="embed-explain"></div>\n\n\t<div class="share-embed-wrapper">\n\t\t<div class="share-btn share-clipboard"></div>\n\t\t<textarea class="form-control embedTextarea" readonly="true"></textarea>\n\t</div>\n\t<div class="share-status-wrapper"><span class="share-status"></span></div>\n\n\t<div>\n\t\t<span class="embed-lbl-size"></span>\n\t\t<div class="btn-group">\n\t\t\t<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">\n\t\t\t\t<span class="embed-sizes-btn"></span>&nbsp;<span class="caret"></span>\n\t\t\t</button>\n\t\t\t<ul class="dropdown-menu embed-sizes" role="menu"></ul>\n\t\t</div>\n\t</div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/ui/share/ShareEmbedPanel",
    [],
    function () {}
  ),
  define(
    "storymaps/common/ui/share/ShareEmbedPanel",
    [
      "lib-build/tpl!./ShareEmbedPanel",
      "lib-build/css!./ShareEmbedPanel",
      "lib-app/clipboard/clipboard",
      "lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css",
    ],
    function (t, e, i) {
      return function (e) {
        function n(t, n) {
          e
            .find(".embedTextarea")
            .val(
              a.replace("%URL%", r).replace("%WIDTH%", t).replace("%HEIGHT%", n)
            ),
            new i(e.find(".share-btn").get(0), {
              text: function () {
                return e.find(".embedTextarea").val();
              },
            }).on("success", function () {
              e
                .find(".share-btn")
                .removeClass("share-clipboard")
                .addClass("share-ok"),
                e.find(".share-status").show(),
                (e.find(".embedTextarea")[0].selectionStart = e.find(
                  ".embedTextarea"
                )[0].selectionEnd =
                  -1),
                e.find(".bitlylink").focus(),
                setTimeout(function () {
                  e
                    .find(".share-btn")
                    .addClass("share-clipboard")
                    .removeClass("share-ok"),
                    e.find(".share-status").hide();
                }, 2e3);
            });
        }
        var a =
            '<iframe width="%WIDTH%" height="%HEIGHT%" src="%URL%" frameborder="0" scrolling="no"></iframe>',
          o = [
            { width: "100%", height: "800px" },
            { width: "100%", height: "640px" },
            { width: "800px", height: "600px" },
            { width: "640px", height: "480px" },
          ],
          r = null,
          s = null;
        e.append(t({})),
          (function () {
            $.each(o, function (t, i) {
              e.find(".embed-sizes").append(
                '<li><a data-width="' +
                  i.width +
                  '" data-height="' +
                  i.height +
                  '">' +
                  i.width +
                  " / " +
                  i.height +
                  "</a></li>"
              );
            }),
              e.find(".embed-sizes a").click(function () {
                var t = $(this);
                t.parents(".btn-group").find(".embed-sizes-btn").text(t.text()),
                  n(t.data("width"), t.data("height"));
              });
          })(),
          (function () {
            e.find(".embedTextarea").click(function () {
              this.setSelectionRange(0, this.value.length);
            });
          })(),
          (this.present = function (t) {
            var i = document.queryCommandSupported("copy");
            (s = t),
              (r = t),
              e
                .find(".embed-explain")
                .html(i18n.viewer.shareFromCommon.embedExplain),
              e.find(".embed-lbl-size").html(i18n.viewer.shareFromCommon.size),
              e.find(".embed-sizes a").eq(0).click(),
              e.find(".share-embed-wrapper").toggleClass("touch", !i),
              e
                .find(".share-clipboard")
                .attr("title", i18n.viewer.shareFromCommon.copy),
              e.find(".share-status").html(i18n.viewer.shareFromCommon.copied);
          }),
          (this.setAutoplay = function (t) {
            var i = s;
            t && ((i += i.match(/\?/) ? "&" : "?"), (i += "autoplay")),
              (r = i),
              e.find(".embed-sizes a").eq(0).click();
          });
      };
    }
  ),
  define(
    "storymaps/common/ui/share/ShareDialog",
    [
      "lib-build/tpl!./ShareDialog",
      "lib-build/css!./ShareDialog",
      "./ShareURLPanel",
      "./ShareEmbedPanel",
      "../../utils/SocialSharing",
    ],
    function (t, e, i, n, a) {
      return function (e) {
        function o(t) {
          var i = $(
            "<div>" + app.data.getWebAppData().getTitle() + "</div>"
          ).text();
          e.find(".share_facebook").toggle(t.facebook),
            t.facebook &&
              e
                .find(".share_facebook")
                .off("click")
                .click(function () {
                  a.shareFacebook("", "", null, $(this).data("url"));
                }),
            e.find(".share_twitter").toggle(t.twitter),
            t.twitter &&
              e
                .find(".share_twitter")
                .off("click")
                .click(function () {
                  a.shareTwitter(i, $(this).data("url"));
                });
        }
        e.append(t({}));
        var r = new i(e.find(".share-url-panel")),
          s = new n(e.find(".share-embed-panel"));
        e.on("shown.bs.modal", function () {
          r.focus();
        }),
          e.find(".autoplay-checkbox").change(function () {
            r.setAutoplay(!!this.checked),
              s.setAutoplay(!!this.checked),
              e
                .find(".autoplay-notification")
                .html(i18n.viewer.shareFromCommon.linksupdated)
                .fadeIn(),
              setTimeout(function () {
                e.find(".autoplay-notification").fadeOut();
              }, 1e3);
          }),
          (this.present = function (t, i) {
            (i = i || { facebook: !1, twitter: !1 }),
              e.find(".social-container").toggle(i.facebook || i.twitter),
              o(i),
              r.present(t),
              s.present(t),
              e.find(".modal-title").html(i18n.viewer.headerFromCommon.share),
              e.find(".embed-title").html(i18n.viewer.shareFromCommon.embed),
              e.find(".btn-close").html(i18n.viewer.common.close),
              e
                .find(".autoplay-label")
                .html(i18n.viewer.shareFromCommon.autoplayLabel),
              e
                .find(".autoplay-help")
                .tooltip({
                  title:
                    i18n.viewer.shareFromCommon.autoplayExplain1 +
                    "<br /><br />" +
                    i18n.viewer.shareFromCommon.autoplayExplain2,
                  html: !0,
                }),
              e.find(".autoplay-checkbox").prop("checked", !1),
              e.modal({ keyboard: !0 }),
              app.appCfg.disableAutoPlay &&
                e.find(".autoplay-container").hide();
          });
      };
    }
  ),
  define(
    "storymaps/common/utils/HeaderHelper",
    [
      "./SocialSharing",
      "../ui/share/ShareDialog",
      "storymaps/common/utils/CommonHelper",
    ],
    function (t, e, i) {
      function n(t) {
        t.find(".linkContainer").parent().length &&
          t
            .find(".linkContainer")
            .css(
              "width",
              (t.find(".logoContainer").position() || { left: 186 }).left -
                t.find(".linkContainer").parent().position().left -
                t.find(".shareBtns").outerWidth() -
                ($(".logoContainer").width() > 1 ? 14 : 4)
            );
      }
      var a = new e($("#shareDialog"));
      return {
        setLogo: function (t, e, a) {
          if (e.logoURL && "NO_LOGO" != e.logoURL) {
            var o = t.find(".logoLink");
            e.logoTarget
              ? o
                  .css("cursor", "pointer")
                  .attr(
                    "aria-label",
                    i18n.viewer.a11y ? i18n.viewer.a11y.logoLinkAria : ""
                  )
                  .attr("href", e.logoTarget)
              : o.css("cursor", "default").removeAttr("href"),
              n(t);
            var r = t.find(".logoImg");
            (r[0].onload = function () {
              n(t), a && "function" == typeof a && a();
            }),
              (r[0].onerror = function () {
                n(t);
              }),
              r
                .attr("src", i.possiblyAddToken(e.logoURL))
                .attr("alt", i18n.viewer.a11y ? i18n.viewer.a11y.logoAria : "")
                .show();
          } else t.find(".logoImg").hide(), n(t);
        },
        setLink: function (t, e) {
          e.linkURL && e.linkText
            ? t
                .find(".linkContainer")
                .html(
                  '<a href="' +
                    e.linkURL +
                    '" class="link" target="_blank">' +
                    e.linkText +
                    "</a>"
                )
            : t.find(".linkContainer").html(e.linkText);
        },
        setSocial: function (t, e) {
          var i = app.cfg.HEADER_SOCIAL,
            n = e.socialBtn,
            a = i && i.facebook && (!n || n.facebook),
            o = i && i.twitter && (!n || n.twitter),
            r =
              i &&
              i.bitly &&
              i.bitly.enable &&
              i.bitly.login &&
              i.bitly.key &&
              (!n || n.bitly);
          t.find(".share_facebook").toggleClass("active", a),
            t.find(".share_twitter").toggleClass("active", o),
            t.find(".share_bitly").toggleClass("active", r),
            t
              .find(".share-all")
              .data("share-facebook", a)
              .data("share-twitter", o)
              .toggleClass("active", a || o || r);
        },
        toggleSocialBtnAppSharing: function (t, e) {
          e && t.find(".shareIcon").attr("title", ""),
            t
              .find(".shareIcon")
              .toggleClass("disabled", !!e)
              .tooltip(
                e
                  ? {
                      title: i18n.commonCore
                        ? i18n.commonCore.builderPanel.tooltipNotShared
                        : "",
                      container: "body",
                    }
                  : "destroy"
              );
        },
        disableSocialBtnAppSharingAutoplay: function (t, e) {
          t.find(".shareIcon").attr("title", ""),
            t
              .find(".shareIcon")
              .toggleClass("disabled", !0)
              .tooltip({
                title: i18n.viewer.headerFromCommon.tooltipAutoplayDisabled,
                container: "body",
                placement: e || "bottom",
              });
        },
        initEvents: function (e) {
          app.ui &&
            app.ui.accordionPanel &&
            e.off("keydown").on("keydown", function (t) {
              if (
                9 === t.keyCode &&
                !t.shiftKey &&
                !app.isInBuilder &&
                "accordion" === app.data.getWebAppData().getLayoutId()
              ) {
                var i = e.find(app.appCfg.focusable).filter(":visible"),
                  n = $(":focus");
                return i.index(n) === i.length - 1
                  ? (app.ui.accordionPanel.focus(0), !1)
                  : void 0;
              }
            }),
            e
              .find(".share_facebook")
              .off("click")
              .click(function () {
                if (!$(this).hasClass("disabled")) {
                  var e = $(
                      "<div>" +
                        (app.data.getWebAppData().getTitle() || "") +
                        "</div>"
                    ).text(),
                    i = $(
                      "<div>" +
                        (app.data.getWebAppData().getSubtitle() || "") +
                        "</div>"
                    ).text();
                  t.shareFacebook(e, i, null, $(this).data("url"));
                }
              }),
            e
              .find(".share_twitter")
              .off("click")
              .click(function () {
                if (!$(this).hasClass("disabled")) {
                  var e = $(
                    "<div>" +
                      (app.data.getWebAppData().getTitle() || "") +
                      "</div>"
                  ).text();
                  t.shareTwitter(e, $(this).data("url"));
                }
              }),
            e
              .find(".share_bitly")
              .off("click")
              .click(function () {
                if (!$(this).hasClass("disabled")) {
                  var e = $(this).data("url") || document.location.href;
                  a.present(t.cleanURL(e, !0));
                }
              }),
            e
              .find(".share-all")
              .off("click")
              .click(function () {
                if (!$(this).hasClass("disabled")) {
                  var e = $(this).data("url") || document.location.href;
                  a.present(t.cleanURL(e, !0), {
                    facebook: !!$(this).data("share-facebook"),
                    twitter: !!$(this).data("share-twitter"),
                  });
                }
              }),
            e
              .find(".shareIcon, .share-all")
              .off("keypress")
              .keypress(function (t) {
                if (13 == t.which) return $(this).click(), !1;
              });
          var i = i18n.viewer.headerFromCommon;
          e
            .find(".share_facebook")
            .attr("title", i.facebookTooltip)
            .attr("aria-label", i.facebookTooltip),
            e
              .find(".share_twitter")
              .attr("title", i.twitterTooltip)
              .attr("aria-label", i.twitterTooltip),
            e
              .find(".share_bitly")
              .attr("title", i.bitlyTooltip)
              .attr("aria-label", i.bitlyTooltip),
            $(window).resize(function () {
              n(e);
            });
        },
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/InlineFieldEdit",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/InlineFieldEdit",
    ["lib-build/css!./InlineFieldEdit", "dojo/has"],
    function (t, e) {
      return function (t, i, n) {
        function a(t, e, n) {
          t &&
            e &&
            n &&
            ("function" == typeof i && i(),
            (r = n),
            e.parent().parent().addClass("isEditing"),
            e.hide(),
            t.hide(),
            n.val(e.html()),
            n.show(),
            n.select());
        }
        function o(t) {
          if (t && t.get(0)) {
            r = null;
            var i = t.get(0).value,
              a = t.parent().find(".text_edit_label"),
              o = t.parent().find(".text_edit_icon"),
              s = a.parent().first();
            "" === i &&
              (i = $(t).parents("h1.title")
                ? i18n.commonCore.inlineFieldEdit.enterTitle
                : i18n.commonCore.inlineFieldEdit.enterSubtitle),
              (i =
                !app.data.getWebAppItem().created ||
                app.data.getWebAppItem().created > app.cfg.HTML_SANITIZER_DATE
                  ? app.sanitizer.sanitize(i)
                  : i.replace(/<\/?script>/g, "")),
              a.parent().parent().removeClass("isEditing"),
              a.html(i),
              a.show(),
              t.hide(),
              o.css("display", "inline-block"),
              e("ios") && document.activeElement.blur(),
              "function" == typeof n && n(s, i);
          }
        }
        var r = null;
        t.find(".text_edit_icon").click(function () {
          a(
            $(this),
            $(this).parent().find(".text_edit_label"),
            $(this).parent().find(".text_edit_input")
          );
        }),
          t.find(".text_edit_label").click(function () {
            a(
              $(this).parent().find(".text_edit_icon"),
              $(this),
              $(this).parent().find(".text_edit_input")
            );
          }),
          t.find(".text_edit_input").blur(function () {
            o($(this));
          }),
          e("ios") &&
            $("body").bind("touchstart", function (t) {
              r && t.target != r.get(0) && o(r);
            }),
          t.find(".text_edit_input").keypress(function (t) {
            "13" == (t.keyCode ? t.keyCode : t.which) && o($(this));
          });
      };
    }
  ),
  define(
    "storymaps/common/ui/header/Desktop",
    [
      "lib-build/css!./Desktop",
      "../../utils/HeaderHelper",
      "../../builder/InlineFieldEdit",
      "../../utils/CommonHelper",
      "dojo/has",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o) {
      return function (t, r) {
        function s() {
          $("#headerDesktop .subtitle:visible").length
            ? $("#headerDesktop .subtitle")[0].focus()
            : $("#headerDesktop .title")[0].focus();
        }
        function l(e) {
          if (!app.appCfg.noAppThemes) {
            t.css("background-color", e.header),
              t.find(".textArea").css("color", e.headerTitle),
              t.find(".rightArea").css("color", e.headerText);
            var i = t.find(".subtitle");
            e.name.match(/-org$|-modified$/)
              ? i.css({ color: e.headerTitle, opacity: 0.8 })
              : i.css({ color: e.headerText });
          }
        }
        function d(i, n) {
          var a = void 0 === i.compactSize ? n : i.compactSize;
          e.setLogo(t, i, m.resize),
            e.setLink(t, i),
            e.setSocial(t, i),
            e.initEvents(t, "bottom"),
            t.toggleClass("compact", a),
            a &&
              (t.find(".rightArea").hide(),
              setTimeout(function () {
                t.find(".rightArea").show();
              }, 0));
        }
        function p() {
          return (
            t.find(".check-story").hide(),
            t.find(".check-story").is(":visible") ||
              t.find(".share-story").is(":visible") ||
              t.find(".error-status").removeClass("enabled"),
            m.resize(),
            !1
          );
        }
        function c() {
          return (
            t.find(".share-story").hide(),
            t.find(".check-story").is(":visible") ||
              t.find(".share-story").is(":visible") ||
              t.find(".error-status").removeClass("enabled"),
            m.resize(),
            !1
          );
        }
        function u(e) {
          var i = t.find(".check-story"),
            o = $(
              '<span aria-hidden="true" class="check-story-close">×</span>'
            ),
            r = $(
              '<span aria-hidden="true" class="check-story-close">×</span>'
            );
          i.off("click").removeClass("forceEvent").show(),
            o.click(p),
            r.click(c),
            "start" == e
              ? i
                  .html(
                    '<span class="small-loader"></span>' +
                      i18n.viewer.headerFromCommon.checking
                  )
                  .append(o)
                  .css("cursor", "default")
              : "error" == e
              ? i
                  .html(i18n.viewer.headerFromCommon.fix)
                  .append(o)
                  .css("cursor", "pointer")
                  .click(n.switchToBuilder)
                  .removeClass("btn-warning")
                  .addClass("btn-danger")
              : i
                  .html(i18n.viewer.headerFromCommon.noerrors)
                  .append(o)
                  .removeClass("btn-warning")
                  .addClass("btn-success"),
            (a("ff") || a("ie") || 7 == a("trident")) &&
              "error" != e &&
              i.click(p).addClass("forceEvent");
          var s = t
              .find(".share-story")
              .html(i18n.viewer.headerFromCommon.notshared)
              .append(r)
              .toggle(
                "private" == app.data.getWebAppItem().access ||
                  "shared" == app.data.getWebAppItem().access
              ),
            l = s.css("background-color");
          if (!app.appCfg.noAppThemes) {
            var d = app.data.getWebAppData().getColors();
            l &&
              d &&
              d.header &&
              n.colorsAreSimilar(l, d.header, !0) &&
              s.css("box-shadow", "0 0 2px 1px white");
          }
          m.resize();
        }
        function h() {}
        function f(t, e) {
          setTimeout(
            function () {
              o.publish("HEADER_EDITED", {
                src: $(t).attr("class").split(" ")[0],
                value: e,
              }),
                $(t).removeClass("error");
            },
            a("ios") || a("ie") >= 10 ? 700 : 0
          ),
            app.builder.hideSaveConfirmation();
        }
        var m = this;
        (this.init = function (e, s, p, c, m, g, b) {
          if ((l(m), e)) return void t.addClass("hideDesktop");
          if (
            (r &&
              (t.addClass("isBuilder"),
              (s =
                "<div class='text_edit_label'>" +
                (s || i18n.commonCore.inlineFieldEdit.enterTitle) +
                "</div>"),
              (s +=
                "<div class='text_edit_icon' title='" +
                i18n.commonCore.header.title.replace(
                  "%TPL_NAME%",
                  app.cfg.TPL_NAME
                ) +
                "'></div>"),
              (s +=
                "<textarea rows='1' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>"),
              (p =
                "<span class='text_edit_label'>" +
                (p || i18n.commonCore.inlineFieldEdit.enterSubtitle) +
                "</span>"),
              (p +=
                "<div class='text_edit_icon' title='" +
                i18n.commonCore.header.subtitle.replace(
                  "%TPL_NAME%",
                  app.cfg.TPL_NAME
                ) +
                "'></div>"),
              (p +=
                "<textarea rows='3' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>")),
            t.find(".title").html(s),
            t.find(".subtitle").html(p),
            r && new i(t, h, f),
            !r && !p)
          ) {
            (void 0 === c.compactSize ? b : c.compactSize) ||
              (t.find(".title").css({ paddingTop: 30, height: 90 }),
              t.find(".subtitle").css("height", 32).attr("tabindex", "-1"));
          }
          if (g) {
            var v = t
                .find(".switchBuilder")
                .html(
                  '<span class="glyphicon glyphicon-cog"></span>' +
                    i18n.viewer.headerFromCommon.builderButton +
                    '<span aria-hidden="true" class="switch-builder-close">×</span>'
                )
                .click(n.switchToBuilder)
                .show(),
              y = v.css("background-color");
            if (!app.appCfg.noAppThemes) {
              var w = app.data.getWebAppData().getColors();
              y &&
                w &&
                w.header &&
                n.colorsAreSimilar(y, w.header, !0) &&
                v.css("box-shadow", "0 0 2px 1px white");
            }
            a("ff") || a("ie") || 7 == a("trident")
              ? v.find(".switch-builder-close").hide()
              : v.find(".switch-builder-close").click(function () {
                  return v.hide(), $(window).resize(), !1;
                });
          }
          var C = n.getUrlParams(),
            _ = "true" === C.preview || "" === C.preview,
            x = "true" === C.autoplay || "" === C.autoplay;
          app.isInBuilder ||
            !app.userCanEdit ||
            9 == a("ie") ||
            _ ||
            x ||
            (t.find(".error-status").addClass("enabled"),
            o.subscribe("MYSTORIES_SCAN", u),
            u("start")),
            d(c, b);
        }),
          (this.resize = function (e) {
            e || (e = $(document).width());
            var i = Math.max(
              t.find(".logoImg").outerWidth() + 50,
              t.find(".rightArea").outerWidth() + 20
            );
            t.find(".textArea").width(e - i - 15);
          }),
          (this.update = function (t, e, i) {
            l(e), d(t, i);
          }),
          (this.getTitle = function () {
            return r
              ? t.find(".title .text_edit_label").html()
              : t.find(".title").html();
          }),
          (this.getSubtitle = function () {
            return r
              ? t.find(".subtitle .text_edit_label").html()
              : t.find(".subtitle").html();
          }),
          (this.setTitleAndSubtitle = function (e, i) {
            var n = r ? i18n.commonCore.inlineFieldEdit.enterTitle : "",
              a = r ? i18n.commonCore.inlineFieldEdit.enterSubtitle : "";
            t.find(".title" + (r ? " .text_edit_label" : "")).html(e || n),
              t.find(".subtitle" + (r ? " .text_edit_label" : "")).html(i || a);
          }),
          (this.toggleSocialBtnAppSharing = function (i) {
            e.toggleSocialBtnAppSharing(t, i);
          }),
          (this.focus = function (t) {
            t && "social" != t.area
              ? s()
              : ($("#headerDesktop .shareIcon").attr("tabindex", "0"),
                $("#headerDesktop .linkContainer a").length
                  ? $("#headerDesktop .linkContainer a")
                      .attr("tabindex", "0")[0]
                      .focus()
                  : $("#headerDesktop .linkContainer").length
                  ? $("#headerDesktop .linkContainer")
                      .attr("tabindex", "0")[0]
                      .focus()
                  : $("#headerDesktop .shareIcon:visible").length
                  ? $("#headerDesktop .shareIcon")[0].focus()
                  : s());
          }),
          (this.enableAutoplay = function () {
            e.disableSocialBtnAppSharingAutoplay(t);
          }),
          (this.setTitleError = function () {
            t.find(".title").addClass("error");
          }),
          (this.initLocalization = function () {});
      };
    }
  ),
  define("lib-build/css!storymaps/tpl/core/MainView", [], function () {}),
  define("storymaps/tpl/core/Config", [], function () {
    return (
      (app.appCfg = {
        supportWebmapPreviewAGOL: !1,
        webmapStory: !0,
        createWebmap: !0,
        useWebmapInApp: !0,
        useStandardHeader: !0,
        useAppTitleAsPageTitle: !0,
        headerCompactOpt: !0,
        headerCompactByDefault: !1,
        mapsImmediateResize: !0,
        mapCommandLargerTouch: !1,
        mediaPickerDisableVideo: !0,
        mediaPickerDisableWebPage: !0,
        mediaPickerSkipConfigure: !0,
        mediaPickerConfigureForceMode: "shortlist",
        disableAutoPlay: !1,
        noAppTitleInitScreen: !0,
        mapExtentFit: !0,
        noFastClick: !0,
        deleteProtect: !!app.isProduction,
        noStoryLengthRequired: !0,
        disableImageUpload: !1,
        disableImageImportUpload: !0,
        disableFBWarning: !0,
        disableBuilderTour: !0,
        imageUploadThumbWidth: 250,
        useImageEXIF: !0,
        noAppThemes: !0,
        disableGalleryCreationSaveGeocoders: !0,
        useWebmapOwnerAsSave: !0,
      }),
      {
        checkConfigFileIsOK: function () {
          return (
            (app.cfg.HEADER_LOGO_URL =
              "resources/tpl/viewer/icons/esri-logo-white.png"),
            (app.cfg.HEADER_LOGO_TARGET = "https://www.esri.com"),
            (app.cfg.HEADER_LINK_TEXT =
              i18n.viewer.headerFromCommon.storymapsText),
            (app.cfg.HEADER_LINK_URL = "https://storymaps.arcgis.com"),
            app.cfg &&
              void 0 !== app.cfg.HEADER_LOGO_URL &&
              void 0 !== app.cfg.HEADER_LOGO_TARGET &&
              void 0 !== app.cfg.HEADER_LINK_TEXT &&
              void 0 !== app.cfg.HEADER_LINK_URL &&
              app.cfg.HEADER_SOCIAL &&
              app.cfg.TIMEOUT_VIEWER_LOAD &&
              app.cfg.TIMEOUT_VIEWER_REQUEST &&
              app.cfg.TIMEOUT_BUILDER_REQUEST &&
              app.cfg.HELP_URL &&
              app.cfg.HELP_URL_PORTAL &&
              app.cfg.TPL_NAME &&
              app.cfg.WEBAPP_TAG &&
              app.cfg.WEBAPP_KEYWORD_GENERIC &&
              app.cfg.WEBAPP_KEYWORD_APP &&
              app.cfg.AUTHORIZED_IMPORT_SOURCE &&
              app.cfg.FLICKR_API_KEY &&
              app.cfg.CORS_SERVER &&
              app.cfg.DEFAULT_SHARING_URL &&
              app.cfg.DEFAULT_PROXY_URL
          );
        },
      }
    );
  }),
  define(
    "storymaps/tpl/core/WebApplicationData",
    ["dojo/_base/lang"],
    function (t) {
      var e = {},
        i = { values: { tabs: [] } };
      return {
        set: function (n) {
          (e = t.clone(n)), n && n.values && (i = n);
        },
        get: function () {
          var e = t.clone(i);
          return (
            (e.values.template = e.values.template || {}),
            (e.values.template = {
              name: e.values.template.name || app.cfg.TPL_NAME,
              createdWith: e.values.template.createdWith || app.version,
              editedWith: app.version,
            }),
            e
          );
        },
        getOriginalData: function () {
          return e;
        },
        isBlank: function () {
          return Object.keys(i.values).length <= 2;
        },
        getBlank: function () {
          return { values: { webmap: e.values.webmap } };
        },
        getSourceWebmap: function () {
          return e && e.values ? e.values.webmap : null;
        },
        cleanWebAppAfterInitialization: function () {
          return !1;
        },
        restoreOriginalData: function () {
          this.set(e);
        },
        updateAfterSave: function () {
          e = t.clone(i);
        },
        getTemplateVersion: function () {
          return i.values.template ? i.values.template.editedWith : null;
        },
        getTemplateCreation: function () {
          return i.values.template ? i.values.template.creaedWith : null;
        },
        getDoNotWarnTitle: function () {
          return i.values.doNotWarnTitle || !1;
        },
        setDoNotWarnTitle: function (t) {
          i.values.doNotWarnTitle = t;
        },
        getIsExternalData: function () {
          return i.values.isExternalData;
        },
        setIsExternalData: function (t) {
          i.values.isExternalData = t;
        },
        getWebmap: function () {
          return i.values.webmap;
        },
        setWebmap: function (t) {
          i.values.webmap = t;
        },
        getResponse: function () {
          return i.values.response;
        },
        setResponse: function (t) {
          i.values.response = t;
        },
        getOriginalWebmap: function () {
          return i.values.originalWebmap;
        },
        setOriginalWebmap: function (t) {
          i.values.originalWebmap = t;
        },
        getMapExtent: function () {
          return i.values.mapExtent;
        },
        setMapExtent: function (t) {
          i.values.mapExtent = t;
        },
        getTitle: function () {
          return i.values.title;
        },
        setTitle: function (t) {
          i.values.title = t;
        },
        getSubtitle: function () {
          return i.values.subtitle;
        },
        setSubtitle: function (t) {
          i.values.subtitle = t;
        },
        getSettings: function () {
          return i.values.settings || {};
        },
        getLayoutId: function () {
          return "shortlist-classic";
        },
        getAppGeocoders: function () {
          return this.getSettings().appGeocoders;
        },
        setAppGeocoders: function (t) {
          (i.values.settings = i.values.settings || {}),
            (i.values.settings.appGeocoders = t);
        },
        getLayers: function () {
          return i.values.layers;
        },
        setLayers: function (t) {
          i.values.layers || (i.values.layers = []), i.values.layers.push(t);
        },
        getShortlistLayerId: function () {
          return i.values.shortlistLayerId;
        },
        setShortlistLayerId: function (t) {
          i.values.shortlistLayerId = t;
        },
        getTabs: function () {
          return i.values.tabs;
        },
        setTabs: function (t) {
          i.values.tabs = t;
        },
        clearTabs: function () {
          i.values.tabs = {};
        },
        clearLayers: function () {
          i.values.layers = [];
        },
        reverseContentLayers: function () {
          i.values.contentLayers.reverse();
        },
        getSupportLayers: function () {
          return i.values.supportLayers;
        },
        setSupportLayers: function (t) {
          i.values.supportLayers || (i.values.supportLayers = []),
            i.values.supportLayers.push(t);
        },
        getStoryTestPanel: function () {
          return i.values.testPanel;
        },
        setStoryTestPanel: function (t) {
          i.values.testPanel = t;
        },
        getLocateButton: function () {
          return !0;
        },
        getGeneralOptions: function () {
          return t.clone(this.getSettings().generalOptions) || {};
        },
        setGeneralOptions: function (t) {
          (i.values.settings = i.values.settings || {}),
            (i.values.settings.generalOptions = t);
        },
        setDefaultGeneralOptions: function () {
          this.setGeneralOptions({
            extentMode: "default",
            numberedIcons: !1,
            filterByExtent: !0,
            bookmarks: !1,
            bookmarksAlias: app.cfg.BOOKMARKS_ALIAS,
            geocoder: !1,
            locateButton: !1,
          });
        },
        getLayoutOptions: function () {
          return t.clone(this.getSettings().layoutOptions) || {};
        },
        setLayoutOptions: function (t) {
          (i.values.settings = i.values.settings || {}),
            (i.values.settings.layoutOptions = t);
        },
        setDefaultLayoutOptions: function () {
          this.setLayoutOptions({ description: !0 });
        },
        getThemeOptions: function () {
          return t.clone(this.getSettings().themeOptions) || {};
        },
        setThemeOptions: function (t) {
          (i.values.settings = i.values.settings || {}),
            (i.values.settings.themeOptions = t);
        },
        setDefaultThemeOptions: function () {
          this.setThemeOptions({ headerColor: "#444" });
        },
        getColors: function () {
          return {};
        },
        getHeader: function () {
          return this.getSettings().header || {};
        },
        setHeader: function (t) {
          (app.isInitializing &&
            app.data.getWebAppData().getShortlistLayerId()) ||
            ((i.values.settings = i.values.settings || {}),
            (i.values.settings.header = t));
        },
        getHeaderLinkText: function () {
          return void 0 === this.getHeader().linkText
            ? app.cfg.HEADER_LINK_TEXT
            : this.getHeader().linkText;
        },
        getHeaderLinkURL: function () {
          return void 0 === this.getHeader().linkURL
            ? app.cfg.HEADER_LINK_URL
            : this.getHeader().linkURL;
        },
        getLogoURL: function (t) {
          var e = this.getHeader().logoURL
            ? this.getHeader().logoURL
            : app.cfg.HEADER_LOGO_URL;
          return (
            e == app.cfg.HEADER_LOGO_URL &&
              this.getColors() &&
              (t
                ? "white" == this.getColors().esriLogoMobile &&
                  (e = "resources/tpl/viewer/icons/esri-logo-white.png")
                : "white" == this.getColors().esriLogo &&
                  (e = "resources/tpl/viewer/icons/esri-logo-white.png")),
            e
          );
        },
        getLogoTarget: function () {
          return this.getHeader().logoURL &&
            this.getHeader().logoURL != app.cfg.HEADER_LOGO_URL
            ? this.getHeader().logoTarget
            : app.cfg.HEADER_LOGO_TARGET;
        },
        getSocial: function () {
          return this.getHeader().social;
        },
        getHeaderCompactSize: function () {
          return this.getHeader().compactSize;
        },
      };
    }
  ),
  define(
    "storymaps/tpl/core/Data",
    ["./WebApplicationData", "storymaps/common/utils/CommonHelper"],
    function (t, e) {
      return function () {
        var i = null,
          n = null,
          a = null,
          o = null,
          r = {},
          s = null;
        (this.getWebMap = function () {
          return i;
        }),
          (this.setWebMap = function (t) {
            i = t;
          }),
          (this.getShortlistLayerId = function () {
            return o;
          }),
          (this.setShortlistLayerId = function (t) {
            o = t;
          }),
          (this.getWebAppItem = function () {
            return n || {};
          }),
          (this.setWebAppItem = function (t) {
            n = t;
          }),
          (this.getResponse = function () {
            return a;
          }),
          (this.setResponse = function (t) {
            a = t;
          }),
          (this.getWebAppData = function () {
            return t;
          }),
          (this.updateAfterSave = function () {
            t.updateAfterSave();
          }),
          (this.userIsAppOwner = function () {
            var t = app.portal ? app.portal.getPortalUser() : null;
            return (
              (t && t.username == this.getWebAppItem().owner) ||
              (null != e.getPortalUser() &&
                e.getPortalUser() == this.getWebAppItem().owner) ||
              (t &&
                t.privileges &&
                $.inArray("portal:admin:updateItems", t.privileges) > -1) ||
              "admin" == this.getWebAppItem().itemControl ||
              "update" == this.getWebAppItem().itemControl
            );
          }),
          (this.userIsOrgaPublisher = function () {
            var t = app.portal ? app.portal.getPortalUser() : null;
            return (
              t &&
              t.orgId &&
              ("org_admin" == t.role || "org_publisher" == t.role)
            );
          }),
          (this.checkUserItemPrivileges = function () {
            var t = app.portal ? app.portal.getPortalUser() : null;
            return (
              (t && !t.orgId && !t.privileges) ||
              (t &&
                t.privileges &&
                $.inArray("portal:user:createItem", t.privileges) > -1)
            );
          }),
          (this.isOrga = function () {
            return (
              !(!app.portal || !app.portal.getPortalUser()) &&
              !!app.portal.getPortalUser().orgId
            );
          }),
          (this.getAppProxies = function () {
            return s;
          }),
          (this.setAppProxies = function (t) {
            s = t;
          });
        var l = null;
        (this.getStoryStorage = function () {
          return l;
        }),
          (this.setStoryStorage = function (t) {
            l = t;
          }),
          (this.debug = function () {}),
          (this.getStory = function () {
            return r;
          }),
          (this.setStory = function (t, e, i, n) {
            t in r || (r[t] = { title: "", id: t, color: null, extent: null }),
              e && (r[t].title = e),
              i && (r[t].color = i),
              n && (r[t].extent = n);
          }),
          (this.clearStory = function () {
            r = {};
          }),
          (this.getStoryByIndex = function (t) {
            return r[t];
          }),
          (this.getStoryLength = function () {
            return app.data.getShortlistLayerId() &&
              app.map.getLayer(app.data.getShortlistLayerId()) &&
              app.map.getLayer(app.data.getShortlistLayerId()).graphics.length
              ? !!app.map.getLayer(app.data.getShortlistLayerId()).graphics
                  .length
              : 0;
          }),
          (this.storyReadyToScan = function () {
            return !app.isGalleryCreation || app.data.getWebMap().item.id;
          }),
          (this.getStoryEntries = function () {
            var e = [],
              i = [];
            return (
              "WEBAPP" == l && (e = t.getStoryEntries()),
              (e = e.slice(0, app.cfg.MAX_NB_ENTRIES)),
              app.isInBuilder
                ? e || []
                : ($.each(e || [], function (t, e) {
                    "PUBLISHED" == e.status && i.push(e);
                  }),
                  i)
            );
          }),
          (this.getImages = function () {
            var t = $.map(this.getStoryEntries(), function (t) {
              return t.media && "image" == t.media.type && t.media.image
                ? t.media.image.url
                : null;
            });
            return (t = $.grep(t, function (e, i) {
              return i == $.inArray(e, t);
            }));
          }),
          (this.getAllImageUrls = function () {
            return _.map(
              this.getImages().concat(
                this.getSidebarImages().concat([t.getLogoURL()])
              ),
              this.getNonProtocolNonDoubleSlashUrl
            );
          }),
          (this.getSidebarImages = function () {
            var t = this.getStoryEntries(),
              i = [];
            return (
              _.each(t, function (t) {
                var n = $(t.description);
                _.each(n.find("img"), function (t) {
                  i.push(e.possiblyRemoveToken(t.src));
                });
              }),
              i
            );
          }),
          (this.getNonProtocolNonDoubleSlashUrl = function (t) {
            return t.replace(/http[s]?\:\/\//, "").replace("//", "/");
          });
      };
    }
  ),
  define("storymaps/tpl/core/Helper", [], function () {
    return function () {
      (this.isMobile = function () {
        var t = !!navigator.userAgent.match(/Android/i),
          e = !!navigator.userAgent.match(/BlackBerry/i),
          i = !!navigator.userAgent.match(/iPhone|iPad|iPod/i),
          n = !!navigator.userAgent.match(/IEMobile/i);
        return t || e || i || n;
      }),
        (this.isIE = function () {
          return (
            navigator.appVersion.indexOf("MSIE") > -1 ||
            navigator.userAgent.match(/Trident.*rv\:11\./) ||
            navigator.appVersion.indexOf("Edge")
          );
        }),
        (this.isIE8 = function () {
          return (
            parseInt(navigator.userAgent.toLowerCase().split("msie")[1]) < 9
          );
        }),
        (this.prependURLHTTP = function (t) {
          return !t || "" === t || t.match(/^mailto:/)
            ? t
            : /^(https?:\/\/)|^(\/\/)/i.test(t)
            ? t
            : "http://" + t;
        });
    };
  }),
  (function (t, e) {
    "object" == typeof exports && "object" == typeof module
      ? (module.exports = e())
      : "function" == typeof define && define.amd
      ? define("storymaps/tpl/core/arcgis-html-sanitizer", [], e)
      : "object" == typeof exports
      ? (exports.Sanitizer = e())
      : (t.Sanitizer = e());
  })(window, function () {
    return (function (t) {
      function e(n) {
        if (i[n]) return i[n].exports;
        var a = (i[n] = { i: n, l: !1, exports: {} });
        return t[n].call(a.exports, a, a.exports, e), (a.l = !0), a.exports;
      }
      var i = {};
      return (
        (e.m = t),
        (e.c = i),
        (e.d = function (t, i, n) {
          e.o(t, i) || Object.defineProperty(t, i, { enumerable: !0, get: n });
        }),
        (e.r = function (t) {
          "undefined" != typeof Symbol &&
            Symbol.toStringTag &&
            Object.defineProperty(t, Symbol.toStringTag, { value: "Module" }),
            Object.defineProperty(t, "__esModule", { value: !0 });
        }),
        (e.t = function (t, i) {
          if ((1 & i && (t = e(t)), 8 & i)) return t;
          if (4 & i && "object" == typeof t && t && t.__esModule) return t;
          var n = Object.create(null);
          if (
            (e.r(n),
            Object.defineProperty(n, "default", { enumerable: !0, value: t }),
            2 & i && "string" != typeof t)
          )
            for (var a in t)
              e.d(
                n,
                a,
                function (e) {
                  return t[e];
                }.bind(null, a)
              );
          return n;
        }),
        (e.n = function (t) {
          var i =
            t && t.__esModule
              ? function () {
                  return t.default;
                }
              : function () {
                  return t;
                };
          return e.d(i, "a", i), i;
        }),
        (e.o = function (t, e) {
          return Object.prototype.hasOwnProperty.call(t, e);
        }),
        (e.p = ""),
        e((e.s = "./src/index.ts"))
      );
    })({
      "./node_modules/cssfilter/lib/css.js": function (t, e, i) {
        function n(t) {
          return void 0 === t || null === t;
        }
        function a(t) {
          var e = {};
          for (var i in t) e[i] = t[i];
          return e;
        }
        function o(t) {
          (t = a(t || {})),
            (t.whiteList = t.whiteList || r.whiteList),
            (t.onAttr = t.onAttr || r.onAttr),
            (t.onIgnoreAttr = t.onIgnoreAttr || r.onIgnoreAttr),
            (t.safeAttrValue = t.safeAttrValue || r.safeAttrValue),
            (this.options = t);
        }
        var r = i("./node_modules/cssfilter/lib/default.js"),
          s = i("./node_modules/cssfilter/lib/parser.js");
        i("./node_modules/cssfilter/lib/util.js");
        (o.prototype.process = function (t) {
          if (((t = t || ""), !(t = t.toString()))) return "";
          var e = this,
            i = e.options,
            a = i.whiteList,
            o = i.onAttr,
            r = i.onIgnoreAttr,
            l = i.safeAttrValue;
          return s(t, function (t, e, i, s, d) {
            var p = a[i],
              c = !1;
            if (
              (!0 === p
                ? (c = p)
                : "function" == typeof p
                ? (c = p(s))
                : p instanceof RegExp && (c = p.test(s)),
              !0 !== c && (c = !1),
              (s = l(i, s)))
            ) {
              var u = { position: e, sourcePosition: t, source: d, isWhite: c };
              if (c) {
                var h = o(i, s, u);
                return n(h) ? i + ":" + s : h;
              }
              var h = r(i, s, u);
              return n(h) ? void 0 : h;
            }
          });
        }),
          (t.exports = o);
      },
      "./node_modules/cssfilter/lib/default.js": function (t, e) {
        function i() {
          var t = {};
          return (
            (t["align-content"] = !1),
            (t["align-items"] = !1),
            (t["align-self"] = !1),
            (t["alignment-adjust"] = !1),
            (t["alignment-baseline"] = !1),
            (t.all = !1),
            (t["anchor-point"] = !1),
            (t.animation = !1),
            (t["animation-delay"] = !1),
            (t["animation-direction"] = !1),
            (t["animation-duration"] = !1),
            (t["animation-fill-mode"] = !1),
            (t["animation-iteration-count"] = !1),
            (t["animation-name"] = !1),
            (t["animation-play-state"] = !1),
            (t["animation-timing-function"] = !1),
            (t.azimuth = !1),
            (t["backface-visibility"] = !1),
            (t.background = !0),
            (t["background-attachment"] = !0),
            (t["background-clip"] = !0),
            (t["background-color"] = !0),
            (t["background-image"] = !0),
            (t["background-origin"] = !0),
            (t["background-position"] = !0),
            (t["background-repeat"] = !0),
            (t["background-size"] = !0),
            (t["baseline-shift"] = !1),
            (t.binding = !1),
            (t.bleed = !1),
            (t["bookmark-label"] = !1),
            (t["bookmark-level"] = !1),
            (t["bookmark-state"] = !1),
            (t.border = !0),
            (t["border-bottom"] = !0),
            (t["border-bottom-color"] = !0),
            (t["border-bottom-left-radius"] = !0),
            (t["border-bottom-right-radius"] = !0),
            (t["border-bottom-style"] = !0),
            (t["border-bottom-width"] = !0),
            (t["border-collapse"] = !0),
            (t["border-color"] = !0),
            (t["border-image"] = !0),
            (t["border-image-outset"] = !0),
            (t["border-image-repeat"] = !0),
            (t["border-image-slice"] = !0),
            (t["border-image-source"] = !0),
            (t["border-image-width"] = !0),
            (t["border-left"] = !0),
            (t["border-left-color"] = !0),
            (t["border-left-style"] = !0),
            (t["border-left-width"] = !0),
            (t["border-radius"] = !0),
            (t["border-right"] = !0),
            (t["border-right-color"] = !0),
            (t["border-right-style"] = !0),
            (t["border-right-width"] = !0),
            (t["border-spacing"] = !0),
            (t["border-style"] = !0),
            (t["border-top"] = !0),
            (t["border-top-color"] = !0),
            (t["border-top-left-radius"] = !0),
            (t["border-top-right-radius"] = !0),
            (t["border-top-style"] = !0),
            (t["border-top-width"] = !0),
            (t["border-width"] = !0),
            (t.bottom = !1),
            (t["box-decoration-break"] = !0),
            (t["box-shadow"] = !0),
            (t["box-sizing"] = !0),
            (t["box-snap"] = !0),
            (t["box-suppress"] = !0),
            (t["break-after"] = !0),
            (t["break-before"] = !0),
            (t["break-inside"] = !0),
            (t["caption-side"] = !1),
            (t.chains = !1),
            (t.clear = !0),
            (t.clip = !1),
            (t["clip-path"] = !1),
            (t["clip-rule"] = !1),
            (t.color = !0),
            (t["color-interpolation-filters"] = !0),
            (t["column-count"] = !1),
            (t["column-fill"] = !1),
            (t["column-gap"] = !1),
            (t["column-rule"] = !1),
            (t["column-rule-color"] = !1),
            (t["column-rule-style"] = !1),
            (t["column-rule-width"] = !1),
            (t["column-span"] = !1),
            (t["column-width"] = !1),
            (t.columns = !1),
            (t.contain = !1),
            (t.content = !1),
            (t["counter-increment"] = !1),
            (t["counter-reset"] = !1),
            (t["counter-set"] = !1),
            (t.crop = !1),
            (t.cue = !1),
            (t["cue-after"] = !1),
            (t["cue-before"] = !1),
            (t.cursor = !1),
            (t.direction = !1),
            (t.display = !0),
            (t["display-inside"] = !0),
            (t["display-list"] = !0),
            (t["display-outside"] = !0),
            (t["dominant-baseline"] = !1),
            (t.elevation = !1),
            (t["empty-cells"] = !1),
            (t.filter = !1),
            (t.flex = !1),
            (t["flex-basis"] = !1),
            (t["flex-direction"] = !1),
            (t["flex-flow"] = !1),
            (t["flex-grow"] = !1),
            (t["flex-shrink"] = !1),
            (t["flex-wrap"] = !1),
            (t.float = !1),
            (t["float-offset"] = !1),
            (t["flood-color"] = !1),
            (t["flood-opacity"] = !1),
            (t["flow-from"] = !1),
            (t["flow-into"] = !1),
            (t.font = !0),
            (t["font-family"] = !0),
            (t["font-feature-settings"] = !0),
            (t["font-kerning"] = !0),
            (t["font-language-override"] = !0),
            (t["font-size"] = !0),
            (t["font-size-adjust"] = !0),
            (t["font-stretch"] = !0),
            (t["font-style"] = !0),
            (t["font-synthesis"] = !0),
            (t["font-variant"] = !0),
            (t["font-variant-alternates"] = !0),
            (t["font-variant-caps"] = !0),
            (t["font-variant-east-asian"] = !0),
            (t["font-variant-ligatures"] = !0),
            (t["font-variant-numeric"] = !0),
            (t["font-variant-position"] = !0),
            (t["font-weight"] = !0),
            (t.grid = !1),
            (t["grid-area"] = !1),
            (t["grid-auto-columns"] = !1),
            (t["grid-auto-flow"] = !1),
            (t["grid-auto-rows"] = !1),
            (t["grid-column"] = !1),
            (t["grid-column-end"] = !1),
            (t["grid-column-start"] = !1),
            (t["grid-row"] = !1),
            (t["grid-row-end"] = !1),
            (t["grid-row-start"] = !1),
            (t["grid-template"] = !1),
            (t["grid-template-areas"] = !1),
            (t["grid-template-columns"] = !1),
            (t["grid-template-rows"] = !1),
            (t["hanging-punctuation"] = !1),
            (t.height = !0),
            (t.hyphens = !1),
            (t.icon = !1),
            (t["image-orientation"] = !1),
            (t["image-resolution"] = !1),
            (t["ime-mode"] = !1),
            (t["initial-letters"] = !1),
            (t["inline-box-align"] = !1),
            (t["justify-content"] = !1),
            (t["justify-items"] = !1),
            (t["justify-self"] = !1),
            (t.left = !1),
            (t["letter-spacing"] = !0),
            (t["lighting-color"] = !0),
            (t["line-box-contain"] = !1),
            (t["line-break"] = !1),
            (t["line-grid"] = !1),
            (t["line-height"] = !1),
            (t["line-snap"] = !1),
            (t["line-stacking"] = !1),
            (t["line-stacking-ruby"] = !1),
            (t["line-stacking-shift"] = !1),
            (t["line-stacking-strategy"] = !1),
            (t["list-style"] = !0),
            (t["list-style-image"] = !0),
            (t["list-style-position"] = !0),
            (t["list-style-type"] = !0),
            (t.margin = !0),
            (t["margin-bottom"] = !0),
            (t["margin-left"] = !0),
            (t["margin-right"] = !0),
            (t["margin-top"] = !0),
            (t["marker-offset"] = !1),
            (t["marker-side"] = !1),
            (t.marks = !1),
            (t.mask = !1),
            (t["mask-box"] = !1),
            (t["mask-box-outset"] = !1),
            (t["mask-box-repeat"] = !1),
            (t["mask-box-slice"] = !1),
            (t["mask-box-source"] = !1),
            (t["mask-box-width"] = !1),
            (t["mask-clip"] = !1),
            (t["mask-image"] = !1),
            (t["mask-origin"] = !1),
            (t["mask-position"] = !1),
            (t["mask-repeat"] = !1),
            (t["mask-size"] = !1),
            (t["mask-source-type"] = !1),
            (t["mask-type"] = !1),
            (t["max-height"] = !0),
            (t["max-lines"] = !1),
            (t["max-width"] = !0),
            (t["min-height"] = !0),
            (t["min-width"] = !0),
            (t["move-to"] = !1),
            (t["nav-down"] = !1),
            (t["nav-index"] = !1),
            (t["nav-left"] = !1),
            (t["nav-right"] = !1),
            (t["nav-up"] = !1),
            (t["object-fit"] = !1),
            (t["object-position"] = !1),
            (t.opacity = !1),
            (t.order = !1),
            (t.orphans = !1),
            (t.outline = !1),
            (t["outline-color"] = !1),
            (t["outline-offset"] = !1),
            (t["outline-style"] = !1),
            (t["outline-width"] = !1),
            (t.overflow = !1),
            (t["overflow-wrap"] = !1),
            (t["overflow-x"] = !1),
            (t["overflow-y"] = !1),
            (t.padding = !0),
            (t["padding-bottom"] = !0),
            (t["padding-left"] = !0),
            (t["padding-right"] = !0),
            (t["padding-top"] = !0),
            (t.page = !1),
            (t["page-break-after"] = !1),
            (t["page-break-before"] = !1),
            (t["page-break-inside"] = !1),
            (t["page-policy"] = !1),
            (t.pause = !1),
            (t["pause-after"] = !1),
            (t["pause-before"] = !1),
            (t.perspective = !1),
            (t["perspective-origin"] = !1),
            (t.pitch = !1),
            (t["pitch-range"] = !1),
            (t["play-during"] = !1),
            (t.position = !1),
            (t["presentation-level"] = !1),
            (t.quotes = !1),
            (t["region-fragment"] = !1),
            (t.resize = !1),
            (t.rest = !1),
            (t["rest-after"] = !1),
            (t["rest-before"] = !1),
            (t.richness = !1),
            (t.right = !1),
            (t.rotation = !1),
            (t["rotation-point"] = !1),
            (t["ruby-align"] = !1),
            (t["ruby-merge"] = !1),
            (t["ruby-position"] = !1),
            (t["shape-image-threshold"] = !1),
            (t["shape-outside"] = !1),
            (t["shape-margin"] = !1),
            (t.size = !1),
            (t.speak = !1),
            (t["speak-as"] = !1),
            (t["speak-header"] = !1),
            (t["speak-numeral"] = !1),
            (t["speak-punctuation"] = !1),
            (t["speech-rate"] = !1),
            (t.stress = !1),
            (t["string-set"] = !1),
            (t["tab-size"] = !1),
            (t["table-layout"] = !1),
            (t["text-align"] = !0),
            (t["text-align-last"] = !0),
            (t["text-combine-upright"] = !0),
            (t["text-decoration"] = !0),
            (t["text-decoration-color"] = !0),
            (t["text-decoration-line"] = !0),
            (t["text-decoration-skip"] = !0),
            (t["text-decoration-style"] = !0),
            (t["text-emphasis"] = !0),
            (t["text-emphasis-color"] = !0),
            (t["text-emphasis-position"] = !0),
            (t["text-emphasis-style"] = !0),
            (t["text-height"] = !0),
            (t["text-indent"] = !0),
            (t["text-justify"] = !0),
            (t["text-orientation"] = !0),
            (t["text-overflow"] = !0),
            (t["text-shadow"] = !0),
            (t["text-space-collapse"] = !0),
            (t["text-transform"] = !0),
            (t["text-underline-position"] = !0),
            (t["text-wrap"] = !0),
            (t.top = !1),
            (t.transform = !1),
            (t["transform-origin"] = !1),
            (t["transform-style"] = !1),
            (t.transition = !1),
            (t["transition-delay"] = !1),
            (t["transition-duration"] = !1),
            (t["transition-property"] = !1),
            (t["transition-timing-function"] = !1),
            (t["unicode-bidi"] = !1),
            (t["vertical-align"] = !1),
            (t.visibility = !1),
            (t["voice-balance"] = !1),
            (t["voice-duration"] = !1),
            (t["voice-family"] = !1),
            (t["voice-pitch"] = !1),
            (t["voice-range"] = !1),
            (t["voice-rate"] = !1),
            (t["voice-stress"] = !1),
            (t["voice-volume"] = !1),
            (t.volume = !1),
            (t["white-space"] = !1),
            (t.widows = !1),
            (t.width = !0),
            (t["will-change"] = !1),
            (t["word-break"] = !0),
            (t["word-spacing"] = !0),
            (t["word-wrap"] = !0),
            (t["wrap-flow"] = !1),
            (t["wrap-through"] = !1),
            (t["writing-mode"] = !1),
            (t["z-index"] = !1),
            t
          );
        }
        function n(t, e, i) {}
        function a(t, e, i) {}
        function o(t, e) {
          return r.test(e) ? "" : e;
        }
        var r = /javascript\s*\:/gim;
        (e.whiteList = i()),
          (e.getDefaultWhiteList = i),
          (e.onAttr = n),
          (e.onIgnoreAttr = a),
          (e.safeAttrValue = o);
      },
      "./node_modules/cssfilter/lib/index.js": function (t, e, i) {
        function n(t, e) {
          return new o(e).process(t);
        }
        var a = i("./node_modules/cssfilter/lib/default.js"),
          o = i("./node_modules/cssfilter/lib/css.js");
        (e = t.exports = n), (e.FilterCSS = o);
        for (var r in a) e[r] = a[r];
        "undefined" != typeof window && (window.filterCSS = t.exports);
      },
      "./node_modules/cssfilter/lib/parser.js": function (t, e, i) {
        function n(t, e) {
          function i() {
            if (!o) {
              var i = a.trim(t.slice(r, s)),
                n = i.indexOf(":");
              if (-1 !== n) {
                var d = a.trim(i.slice(0, n)),
                  p = a.trim(i.slice(n + 1));
                if (d) {
                  var c = e(r, l.length, d, p, i);
                  c && (l += c + "; ");
                }
              }
            }
            r = s + 1;
          }
          (t = a.trimRight(t)), ";" !== t[t.length - 1] && (t += ";");
          for (var n = t.length, o = !1, r = 0, s = 0, l = ""; s < n; s++) {
            var d = t[s];
            if ("/" === d && "*" === t[s + 1]) {
              var p = t.indexOf("*/", s + 2);
              if (-1 === p) break;
              (s = p + 1), (r = s + 1), (o = !1);
            } else
              "(" === d
                ? (o = !0)
                : ")" === d
                ? (o = !1)
                : ";" === d
                ? o || i()
                : "\n" === d && i();
          }
          return a.trim(l);
        }
        var a = i("./node_modules/cssfilter/lib/util.js");
        t.exports = n;
      },
      "./node_modules/cssfilter/lib/util.js": function (t, e) {
        t.exports = {
          indexOf: function (t, e) {
            var i, n;
            if (Array.prototype.indexOf) return t.indexOf(e);
            for (i = 0, n = t.length; i < n; i++) if (t[i] === e) return i;
            return -1;
          },
          forEach: function (t, e, i) {
            var n, a;
            if (Array.prototype.forEach) return t.forEach(e, i);
            for (n = 0, a = t.length; n < a; n++) e.call(i, t[n], n, t);
          },
          trim: function (t) {
            return String.prototype.trim
              ? t.trim()
              : t.replace(/(^\s*)|(\s*$)/g, "");
          },
          trimRight: function (t) {
            return String.prototype.trimRight
              ? t.trimRight()
              : t.replace(/(\s*$)/g, "");
          },
        };
      },
      "./node_modules/lodash.isplainobject/index.js": function (t, e) {
        function i(t) {
          var e = !1;
          if (null != t && "function" != typeof t.toString)
            try {
              e = !!(t + "");
            } catch (t) {}
          return e;
        }
        function n(t) {
          return !!t && "object" == typeof t;
        }
        function a(t) {
          if (!n(t) || c.call(t) != o || i(t)) return !1;
          var e = u(t);
          if (null === e) return !0;
          var a = d.call(e, "constructor") && e.constructor;
          return "function" == typeof a && a instanceof a && l.call(a) == p;
        }
        var o = "[object Object]",
          r = Function.prototype,
          s = Object.prototype,
          l = r.toString,
          d = s.hasOwnProperty,
          p = l.call(Object),
          c = s.toString,
          u = (function (t, e) {
            return function (i) {
              return t(e(i));
            };
          })(Object.getPrototypeOf, Object);
        t.exports = a;
      },
      "./node_modules/xss/lib/default.js": function (t, e, i) {
        function n() {
          return {
            a: ["target", "href", "title"],
            abbr: ["title"],
            address: [],
            area: ["shape", "coords", "href", "alt"],
            article: [],
            aside: [],
            audio: ["autoplay", "controls", "loop", "preload", "src"],
            b: [],
            bdi: ["dir"],
            bdo: ["dir"],
            big: [],
            blockquote: ["cite"],
            br: [],
            caption: [],
            center: [],
            cite: [],
            code: [],
            col: ["align", "valign", "span", "width"],
            colgroup: ["align", "valign", "span", "width"],
            dd: [],
            del: ["datetime"],
            details: ["open"],
            div: [],
            dl: [],
            dt: [],
            em: [],
            font: ["color", "size", "face"],
            footer: [],
            h1: [],
            h2: [],
            h3: [],
            h4: [],
            h5: [],
            h6: [],
            header: [],
            hr: [],
            i: [],
            img: ["src", "alt", "title", "width", "height"],
            ins: ["datetime"],
            li: [],
            mark: [],
            nav: [],
            ol: [],
            p: [],
            pre: [],
            s: [],
            section: [],
            small: [],
            span: [],
            sub: [],
            sup: [],
            strong: [],
            table: ["width", "border", "align", "valign"],
            tbody: ["align", "valign"],
            td: ["width", "rowspan", "colspan", "align", "valign"],
            tfoot: ["align", "valign"],
            th: ["width", "rowspan", "colspan", "align", "valign"],
            thead: ["align", "valign"],
            tr: ["rowspan", "align", "valign"],
            tt: [],
            u: [],
            ul: [],
            video: [
              "autoplay",
              "controls",
              "loop",
              "preload",
              "src",
              "height",
              "width",
            ],
          };
        }
        function a(t, e, i) {}
        function o(t, e, i) {}
        function r(t, e, i) {}
        function s(t, e, i) {}
        function l(t) {
          return t.replace(T, "&lt;").replace(k, "&gt;");
        }
        function d(t, e, i, n) {
          if (((i = m(i)), "href" === e || "src" === e)) {
            if ("#" === (i = x.trim(i))) return "#";
            if (
              "http://" !== i.substr(0, 7) &&
              "https://" !== i.substr(0, 8) &&
              "mailto:" !== i.substr(0, 7) &&
              "tel:" !== i.substr(0, 4) &&
              "#" !== i[0] &&
              "/" !== i[0]
            )
              return "";
          } else if ("background" === e) {
            if (((D.lastIndex = 0), D.test(i))) return "";
          } else if ("style" === e) {
            if ((($.lastIndex = 0), $.test(i))) return "";
            if (
              ((M.lastIndex = 0), M.test(i) && ((D.lastIndex = 0), D.test(i)))
            )
              return "";
            !1 !== n && ((n = n || S), (i = n.process(i)));
          }
          return (i = g(i));
        }
        function p(t) {
          return t.replace(E, "&quot;");
        }
        function c(t) {
          return t.replace(A, '"');
        }
        function u(t) {
          return t.replace(I, function (t, e) {
            return "x" === e[0] || "X" === e[0]
              ? String.fromCharCode(parseInt(e.substr(1), 16))
              : String.fromCharCode(parseInt(e, 10));
          });
        }
        function h(t) {
          return t.replace(L, ":").replace(P, " ");
        }
        function f(t) {
          for (var e = "", i = 0, n = t.length; i < n; i++)
            e += t.charCodeAt(i) < 32 ? " " : t.charAt(i);
          return x.trim(e);
        }
        function m(t) {
          return (t = c(t)), (t = u(t)), (t = h(t)), (t = f(t));
        }
        function g(t) {
          return (t = p(t)), (t = l(t));
        }
        function b() {
          return "";
        }
        function v(t, e) {
          function i(e) {
            return !!n || -1 !== x.indexOf(t, e);
          }
          "function" != typeof e && (e = function () {});
          var n = !Array.isArray(t),
            a = [],
            o = !1;
          return {
            onIgnoreTag: function (t, n, r) {
              if (i(t)) {
                if (r.isClosing) {
                  var s = "[/removed]",
                    l = r.position + s.length;
                  return a.push([!1 !== o ? o : r.position, l]), (o = !1), s;
                }
                return o || (o = r.position), "[removed]";
              }
              return e(t, n, r);
            },
            remove: function (t) {
              var e = "",
                i = 0;
              return (
                x.forEach(a, function (n) {
                  (e += t.slice(i, n[0])), (i = n[1]);
                }),
                (e += t.slice(i))
              );
            },
          };
        }
        function y(t) {
          return t.replace(O, "");
        }
        function w(t) {
          var e = t.split("");
          return (
            (e = e.filter(function (t) {
              var e = t.charCodeAt(0);
              return 127 !== e && (!(e <= 31) || 10 === e || 13 === e);
            })),
            e.join("")
          );
        }
        var C = i("./node_modules/cssfilter/lib/index.js").FilterCSS,
          _ = i("./node_modules/cssfilter/lib/index.js").getDefaultWhiteList,
          x = i("./node_modules/xss/lib/util.js"),
          S = new C(),
          T = /</g,
          k = />/g,
          E = /"/g,
          A = /&quot;/g,
          I = /&#([a-zA-Z0-9]*);?/gim,
          L = /&colon;?/gim,
          P = /&newline;?/gim,
          D =
            /((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,
          $ = /e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,
          M = /u\s*r\s*l\s*\(.*/gi,
          O = /<!--[\s\S]*?-->/g;
        (e.whiteList = n()),
          (e.getDefaultWhiteList = n),
          (e.onTag = a),
          (e.onIgnoreTag = o),
          (e.onTagAttr = r),
          (e.onIgnoreTagAttr = s),
          (e.safeAttrValue = d),
          (e.escapeHtml = l),
          (e.escapeQuote = p),
          (e.unescapeQuote = c),
          (e.escapeHtmlEntities = u),
          (e.escapeDangerHtml5Entities = h),
          (e.clearNonPrintableCharacter = f),
          (e.friendlyAttrValue = m),
          (e.escapeAttrValue = g),
          (e.onIgnoreTagStripAll = b),
          (e.StripTagBody = v),
          (e.stripCommentTag = y),
          (e.stripBlankChar = w),
          (e.cssFilter = S),
          (e.getDefaultCSSWhiteList = _);
      },
      "./node_modules/xss/lib/index.js": function (t, e, i) {
        function n(t, e) {
          return new r(e).process(t);
        }
        var a = i("./node_modules/xss/lib/default.js"),
          o = i("./node_modules/xss/lib/parser.js"),
          r = i("./node_modules/xss/lib/xss.js");
        (e = t.exports = n), (e.FilterXSS = r);
        for (var s in a) e[s] = a[s];
        for (var s in o) e[s] = o[s];
        "undefined" != typeof window && (window.filterXSS = t.exports);
      },
      "./node_modules/xss/lib/parser.js": function (t, e, i) {
        function n(t) {
          var e = c.spaceIndex(t);
          if (-1 === e) var i = t.slice(1, -1);
          else var i = t.slice(1, e + 1);
          return (
            (i = c.trim(i).toLowerCase()),
            "/" === i.slice(0, 1) && (i = i.slice(1)),
            "/" === i.slice(-1) && (i = i.slice(0, -1)),
            i
          );
        }
        function a(t) {
          return "</" === t.slice(0, 2);
        }
        function o(t, e, i) {
          "user strict";
          var o = "",
            r = 0,
            s = !1,
            l = !1,
            d = 0,
            p = t.length,
            c = "",
            u = "";
          for (d = 0; d < p; d++) {
            var h = t.charAt(d);
            if (!1 === s) {
              if ("<" === h) {
                s = d;
                continue;
              }
            } else if (!1 === l) {
              if ("<" === h) {
                (o += i(t.slice(r, d))), (s = d), (r = d);
                continue;
              }
              if (">" === h) {
                (o += i(t.slice(r, s))),
                  (u = t.slice(s, d + 1)),
                  (c = n(u)),
                  (o += e(s, o.length, c, u, a(u))),
                  (r = d + 1),
                  (s = !1);
                continue;
              }
              if (('"' === h || "'" === h) && "=" === t.charAt(d - 1)) {
                l = h;
                continue;
              }
            } else if (h === l) {
              l = !1;
              continue;
            }
          }
          return r < t.length && (o += i(t.substr(r))), o;
        }
        function r(t, e) {
          "user strict";
          function i(t, i) {
            if (
              ((t = c.trim(t)),
              (t = t.replace(u, "").toLowerCase()),
              !(t.length < 1))
            ) {
              var n = e(t, i || "");
              n && a.push(n);
            }
          }
          for (var n = 0, a = [], o = !1, r = t.length, d = 0; d < r; d++) {
            var h,
              f,
              m = t.charAt(d);
            if (!1 !== o || "=" !== m)
              if (
                !1 === o ||
                d !== n ||
                ('"' !== m && "'" !== m) ||
                "=" !== t.charAt(d - 1)
              )
                if (/\s|\n|\t/.test(m)) {
                  if (((t = t.replace(/\s|\n|\t/g, " ")), !1 === o)) {
                    if (-1 === (f = s(t, d))) {
                      (h = c.trim(t.slice(n, d))), i(h), (o = !1), (n = d + 1);
                      continue;
                    }
                    d = f - 1;
                    continue;
                  }
                  if (-1 === (f = l(t, d - 1))) {
                    (h = c.trim(t.slice(n, d))),
                      (h = p(h)),
                      i(o, h),
                      (o = !1),
                      (n = d + 1);
                    continue;
                  }
                } else;
              else {
                if (-1 === (f = t.indexOf(m, d + 1))) break;
                (h = c.trim(t.slice(n + 1, f))),
                  i(o, h),
                  (o = !1),
                  (d = f),
                  (n = d + 1);
              }
            else (o = t.slice(n, d)), (n = d + 1);
          }
          return (
            n < t.length &&
              (!1 === o ? i(t.slice(n)) : i(o, p(c.trim(t.slice(n))))),
            c.trim(a.join(" "))
          );
        }
        function s(t, e) {
          for (; e < t.length; e++) {
            var i = t[e];
            if (" " !== i) return "=" === i ? e : -1;
          }
        }
        function l(t, e) {
          for (; e > 0; e--) {
            var i = t[e];
            if (" " !== i) return "=" === i ? e : -1;
          }
        }
        function d(t) {
          return (
            ('"' === t[0] && '"' === t[t.length - 1]) ||
            ("'" === t[0] && "'" === t[t.length - 1])
          );
        }
        function p(t) {
          return d(t) ? t.substr(1, t.length - 2) : t;
        }
        var c = i("./node_modules/xss/lib/util.js"),
          u = /[^a-zA-Z0-9_:\.\-]/gim;
        (e.parseTag = o), (e.parseAttr = r);
      },
      "./node_modules/xss/lib/util.js": function (t, e) {
        t.exports = {
          indexOf: function (t, e) {
            var i, n;
            if (Array.prototype.indexOf) return t.indexOf(e);
            for (i = 0, n = t.length; i < n; i++) if (t[i] === e) return i;
            return -1;
          },
          forEach: function (t, e, i) {
            var n, a;
            if (Array.prototype.forEach) return t.forEach(e, i);
            for (n = 0, a = t.length; n < a; n++) e.call(i, t[n], n, t);
          },
          trim: function (t) {
            return String.prototype.trim
              ? t.trim()
              : t.replace(/(^\s*)|(\s*$)/g, "");
          },
          spaceIndex: function (t) {
            var e = /\s|\n|\t/,
              i = e.exec(t);
            return i ? i.index : -1;
          },
        };
      },
      "./node_modules/xss/lib/xss.js": function (t, e, i) {
        function n(t) {
          return void 0 === t || null === t;
        }
        function a(t) {
          var e = u.spaceIndex(t);
          if (-1 === e) return { html: "", closing: "/" === t[t.length - 2] };
          t = u.trim(t.slice(e + 1, -1));
          var i = "/" === t[t.length - 1];
          return i && (t = u.trim(t.slice(0, -1))), { html: t, closing: i };
        }
        function o(t) {
          var e = {};
          for (var i in t) e[i] = t[i];
          return e;
        }
        function r(t) {
          (t = o(t || {})),
            t.stripIgnoreTag &&
              (t.onIgnoreTag &&
                console.error(
                  'Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'
                ),
              (t.onIgnoreTag = l.onIgnoreTagStripAll)),
            (t.whiteList = t.whiteList || l.whiteList),
            (t.onTag = t.onTag || l.onTag),
            (t.onTagAttr = t.onTagAttr || l.onTagAttr),
            (t.onIgnoreTag = t.onIgnoreTag || l.onIgnoreTag),
            (t.onIgnoreTagAttr = t.onIgnoreTagAttr || l.onIgnoreTagAttr),
            (t.safeAttrValue = t.safeAttrValue || l.safeAttrValue),
            (t.escapeHtml = t.escapeHtml || l.escapeHtml),
            (this.options = t),
            !1 === t.css
              ? (this.cssFilter = !1)
              : ((t.css = t.css || {}), (this.cssFilter = new s(t.css)));
        }
        var s = i("./node_modules/cssfilter/lib/index.js").FilterCSS,
          l = i("./node_modules/xss/lib/default.js"),
          d = i("./node_modules/xss/lib/parser.js"),
          p = d.parseTag,
          c = d.parseAttr,
          u = i("./node_modules/xss/lib/util.js");
        (r.prototype.process = function (t) {
          if (((t = t || ""), !(t = t.toString()))) return "";
          var e = this,
            i = e.options,
            o = i.whiteList,
            r = i.onTag,
            s = i.onIgnoreTag,
            d = i.onTagAttr,
            h = i.onIgnoreTagAttr,
            f = i.safeAttrValue,
            m = i.escapeHtml,
            g = e.cssFilter;
          i.stripBlankChar && (t = l.stripBlankChar(t)),
            i.allowCommentTag || (t = l.stripCommentTag(t));
          var b = !1;
          if (i.stripIgnoreTagBody) {
            var b = l.StripTagBody(i.stripIgnoreTagBody, s);
            s = b.onIgnoreTag;
          }
          var v = p(
            t,
            function (t, e, i, l, p) {
              var b = {
                  sourcePosition: t,
                  position: e,
                  isClosing: p,
                  isWhite: o.hasOwnProperty(i),
                },
                v = r(i, l, b);
              if (!n(v)) return v;
              if (b.isWhite) {
                if (b.isClosing) return "</" + i + ">";
                var y = a(l),
                  w = o[i],
                  C = c(y.html, function (t, e) {
                    var a = -1 !== u.indexOf(w, t),
                      o = d(i, t, e, a);
                    if (!n(o)) return o;
                    if (a)
                      return (e = f(i, t, e, g)), e ? t + '="' + e + '"' : t;
                    var o = h(i, t, e, a);
                    return n(o) ? void 0 : o;
                  }),
                  l = "<" + i;
                return (
                  C && (l += " " + C), y.closing && (l += " /"), (l += ">")
                );
              }
              var v = s(i, l, b);
              return n(v) ? m(l) : v;
            },
            m
          );
          return b && (v = b.remove(v)), v;
        }),
          (t.exports = r);
      },
      "./src/index.ts": function (t, e, i) {
        i.r(e),
          i.d(e, "Sanitizer", function () {
            return s;
          });
        var n = i("./node_modules/lodash.isplainobject/index.js"),
          a = i.n(n),
          o = i("./node_modules/xss/lib/index.js"),
          r = i.n(o),
          s = (function () {
            function t(t, e) {
              var i = this;
              (this.arcgisWhiteList = {
                a: ["href", "target", "style"],
                img: ["src", "width", "height", "border", "alt", "style"],
                video: [
                  "autoplay",
                  "controls",
                  "height",
                  "loop",
                  "muted",
                  "poster",
                  "preload",
                  "src",
                  "width",
                ],
                audio: [
                  "autoplay",
                  "controls",
                  "loop",
                  "muted",
                  "preload",
                  "src",
                ],
                span: ["style"],
                table: [
                  "width",
                  "height",
                  "cellpadding",
                  "cellspacing",
                  "border",
                  "style",
                ],
                div: ["style", "class"],
                font: ["size", "color", "style"],
                tr: ["height", "valign", "align", "style"],
                td: [
                  "height",
                  "width",
                  "valign",
                  "align",
                  "colspan",
                  "rowspan",
                  "nowrap",
                  "style",
                ],
                th: [
                  "height",
                  "width",
                  "valign",
                  "align",
                  "colspan",
                  "rowspan",
                  "nowrap",
                  "style",
                ],
                p: ["style"],
                b: [],
                strong: [],
                i: [],
                em: [],
                br: [],
                li: [],
                ul: [],
                tbody: [],
              }),
                (this.arcgisFilterOptions = { allowCommentTag: !0 });
              var n;
              t && !e
                ? (n = t)
                : t && e
                ? ((n = Object.create(this.arcgisFilterOptions)),
                  Object.keys(t).forEach(function (e) {
                    "whiteList" === e
                      ? (n.whiteList = i._extendObjectOfArrays([
                          i.arcgisWhiteList,
                          t.whiteList || {},
                        ]))
                      : (n[e] = t[e]);
                  }))
                : ((n = Object.create(this.arcgisFilterOptions)),
                  (n.whiteList = this.arcgisWhiteList)),
                (this.xssFilterOptions = n),
                (this._xssFilter = new r.a.FilterXSS(n));
            }
            return (
              (t.prototype.sanitize = function (t) {
                switch (typeof t) {
                  case "number":
                    return isNaN(t) || !isFinite(t) ? null : t;
                  case "boolean":
                    return t;
                  case "string":
                    return this._xssFilter.process(t);
                  case "object":
                    return this._iterateOverObject(t);
                  default:
                    return null;
                }
              }),
              (t.prototype.validate = function (t) {
                var e = this.sanitize(t);
                return { isValid: t === e, sanitized: e };
              }),
              (t.prototype._extendObjectOfArrays = function (t) {
                var e = {};
                return (
                  t.forEach(function (t) {
                    Object.keys(t).forEach(function (i) {
                      Array.isArray(t[i]) && Array.isArray(e[i])
                        ? (e[i] = e[i].concat(t[i]))
                        : (e[i] = t[i]);
                    });
                  }),
                  e
                );
              }),
              (t.prototype._iterateOverObject = function (t) {
                var e = this;
                try {
                  var i = !1,
                    n = void 0;
                  if (Array.isArray(t))
                    n = t.reduce(function (t, n) {
                      var a = e.validate(n);
                      return a.isValid
                        ? t.concat([n])
                        : ((i = !0), t.concat([a.sanitized]));
                    }, []);
                  else {
                    if (!a()(t)) return null;
                    n = Object.keys(t).reduce(function (n, a) {
                      var o = t[a],
                        r = e.validate(o);
                      return (
                        r.isValid
                          ? (n[a] = o)
                          : ((i = !0), (n[a] = r.sanitized)),
                        n
                      );
                    }, {});
                  }
                  return i ? n : t;
                } catch (t) {
                  return null;
                }
              }),
              t
            );
          })();
      },
    }).Sanitizer;
  }),
  define("lib-build/tpl!storymaps/tpl/ui/desktop/TestPanel", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj) __p += '<div class="userInput"></div>';
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/ui/desktop/TestPanel",
    [],
    function () {}
  ),
  define("lib-build/css!storymaps/tpl/ui/desktop/Common", [], function () {}),
  define(
    "storymaps/tpl/ui/desktop/TestPanel",
    [
      "lib-build/tpl!./TestPanel",
      "lib-build/css!./TestPanel",
      "lib-build/css!./Common",
    ],
    function (t) {
      return function (e, i, n) {
        function a() {
          e.find(".userInput").attr("contenteditable", "true");
        }
        function o() {
          i &&
            e.find(".userInput").blur(function () {
              n($(this).html());
            });
        }
        (this.init = function (n) {
          (n = n || {}), e.html(t({})), e.show(), i && a(), o();
        }),
          (this.update = function (t) {
            (t = t || {}), e.find(".userInput").html(t.data);
          }),
          (this.resize = function () {}),
          (this.showEntryIndex = function () {}),
          (this.destroy = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/ui/desktop/TilePanel", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div id="paneLeft">\r\n\t<ul id="myList" class="tilelist"></ul>\r\n\t<div class="noFeature">\r\n\t\t<span class="noFeatureText">\r\n\t\t\t' +
          (null == (__t = noPlaces) ? "" : __t) +
          "\r\n\t\t</span>\r\n\t</div>\r\n</div>\r\n";
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/ui/desktop/TilePanel",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/ui/desktop/TilePanel",
    [
      "esri/geometry/screenUtils",
      "../../core/Helper",
      "storymaps/common/utils/CommonHelper",
      "lib-build/tpl!./TilePanel",
      "lib-build/css!./TilePanel",
      "../../core/WebApplicationData",
    ],
    function (t, e, i, n) {
      return function (t, a, o) {
        var r = this,
          s = a,
          l = new e(),
          d = /iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,
          p = !1;
        (this.tileClick = !0),
          $(document).bind("cbox_complete", function () {
            $(".details .rightDiv").height(
              $(".details").height() - $(".detailsTitle").height() - 20
            );
          }),
          (this.init = function () {
            $(t).prepend(n({ noPlaces: i18n.viewer.general.noPlaces })),
              $("#mainStagePanel").width(
                $("#contentPanel").width() - $("#paneLeft").width()
              ),
              $("#mainStagePanel").css({ left: $("#paneLeft").width() });
          }),
          (this.resize = function (t) {
            $("#paneLeft").width(t), $(".tilelist").width(t);
          }),
          (this.createTab = function (t, e) {
            $("#tabs").append(
              '<div class="tab" tabindex="0">' + e.title + "</div>"
            );
          }),
          (this.setTabClick = function () {
            $.each($(".entry.visible"), function (t) {
              $(this).click(function () {
                (s.selected = null),
                  s.activateLayer(t),
                  $(".detailContainer").hide(),
                  app.mapTips && app.mapTips.clean();
              });
            });
          }),
          (this.clearTilePanel = function () {
            d &&
              ($.each($("#mobileList").find("img"), function (t, e) {
                $(e).attr(
                  "src",
                  "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                );
              }),
              $("#mobileList").empty()),
              $("#myList").empty();
          }),
          (this.buildTilePanel = function () {
            r.clearTilePanel();
            var t,
              e,
              n,
              a,
              s,
              l,
              d = !1;
            if (
              app.layerCurrent &&
              app.layerCurrent.graphics &&
              app.layerCurrent.graphics.length
            ) {
              var p = app.layerCurrent.graphics[0].attributes,
                c = p.number
                  ? "number"
                  : p.Number
                  ? "Number"
                  : p.NUMBER
                  ? "NUMBER"
                  : p.PLACENUMSL
                  ? "PLACENUMSL"
                  : null;
              c &&
                app.layerCurrent.graphics.sort(function (t, e) {
                  return parseInt(t.attributes[c]) - parseInt(e.attributes[c]);
                }),
                $.each(app.layerCurrent.graphics, function (r, p) {
                  app.map.extent.contains(p.geometry)
                    ? ((t = "block"), (d = !0))
                    : app.data.getWebAppData().getGeneralOptions()
                        .filterByExtent &&
                      !app.isInBuilder &&
                      (t = "none"),
                    (e = $(
                      '<li tabindex="0" id="item' +
                        p.attributes.shortlist_id +
                        '" style="display:' +
                        t +
                        '">'
                    )),
                    (n = $('<div class="tileImage"></div>')),
                    $(n).attr("alt", "");
                  var c = p.attributes,
                    u =
                      c[
                        $.grep(Object.keys(c), function (t) {
                          return "thumb_url" == t.toLowerCase();
                        })[0]
                      ],
                    h =
                      c[
                        $.grep(Object.keys(c), function (t) {
                          return "pic_url" == t.toLowerCase();
                        })[0]
                      ];
                  u
                    ? (u.indexOf("sharing/rest/content/items/") > -1 &&
                        (u = i.possiblyAddToken(u)),
                      $(n).css("background-image", "url(" + u + ")"),
                      $(n).find("i").hide())
                    : h
                    ? ((u = h),
                      u.indexOf("sharing/rest/content/items/") > -1 &&
                        (u = i.possiblyAddToken(u)),
                      $(n).css("background-image", "url(" + u + ")"),
                      $(n).find("i").hide())
                    : $(n).append(
                        '<i class=" fa fa-camera" aria-hidden="true"></i>'
                      ),
                    (a = $('<div class="footer"></div>'));
                  var f =
                      c[
                        $.grep(Object.keys(c), function (t) {
                          return "name" == t.toLowerCase();
                        })[0]
                      ],
                    m = f || "Unnamed Place";
                  if (
                    ((l = $('<div class="blurb">' + m + "</div>")),
                    o.getGeneralOptions().numberedIcons)
                  ) {
                    var g =
                      app.layerCurrent.graphics[r].attributes.number ||
                      app.layerCurrent.graphics[r].attributes.Number ||
                      app.layerCurrent.graphics[r].attributes.NUMBER ||
                      app.layerCurrent.graphics[r].attributes.PLACENUMSL;
                    p.attributes.number < 100
                      ? (s = $(
                          '<div class="num" style="background-color:' +
                            app.layerCurrent.color +
                            '">' +
                            g +
                            "</div>"
                        ))
                      : ((s = $(
                          '<div class="num longNum" style="background-color:' +
                            app.layerCurrent.color +
                            '">' +
                            g +
                            "</div>"
                        )),
                        (l = $(
                          '<div class="blurb longNumBlurb">' + f + "</div>"
                        ))),
                      $(a).append(s);
                  }
                  $(a).append(l),
                    $(e).append(a),
                    $(e).data("shortlist-id", p.attributes.shortlist_id),
                    app.ui.mobileFeatureList.buildList(r, p, e),
                    $(e).append(n),
                    app.isInBuilder &&
                      (p.attributes.locationSet ||
                      app.data.getWebAppData().getIsExternalData()
                        ? $(e).addClass("located")
                        : $(e)
                            .find(".tileImage")
                            .append(
                              '<div class="unlocated" style="outline: none;"></div>'
                            )),
                    $("#myList").append(e);
                }),
                r.setTileEvents(),
                $("ul.tilelist").animate({ scrollTop: 0 }, { duration: 200 }),
                d ||
                !app.data.getWebAppData().getGeneralOptions().filterByExtent ||
                app.isInBuilder
                  ? $(".noFeature").css("display", "none")
                  : $(".noFeature").css("display", "block"),
                o.getGeneralOptions().numberedIcons ||
                  $("ul.tilelist .blurb").addClass("unNumBlurb");
            }
          }),
          (this.findTile = function (e) {
            return $.grep($(t).find($("ul.tilelist li")), function (t) {
              return $(t).data("shortlist-id") == e;
            })[0];
          }),
          (this.findMobileTile = function (t) {
            return $.grep($("ul.mobileTileList li"), function (e) {
              return $(e).data("shortlist-id") == t;
            })[0];
          }),
          (this.setTileEvents = function () {
            $("ul.tilelist li").mouseover(r.tile_onMouseOver),
              $("ul.tilelist li").mouseout(r.tile_onMouseOut),
              $("ul.tilelist li").click(r.tile_onClick),
              $("ul.tilelist li").on("touchmove", function () {
                p = !0;
              }),
              $("ul.tilelist li").on("touchend", r.tile_onClick);
          }),
          (this.refreshList = function () {
            var t,
              e,
              i = !1;
            app.layerCurrent &&
              app.layerCurrent.graphics.length &&
              setTimeout(function () {
                $.each(app.layerCurrent.graphics, function (n, a) {
                  (t = r.findTile(a.attributes.shortlist_id)),
                    (e = r.findMobileTile(a.attributes.shortlist_id)),
                    app.data.getWebAppData().getGeneralOptions()
                      .filterByExtent &&
                      !app.isInBuilder &&
                      (app.map.extent.contains(a.geometry)
                        ? ("none" == $(t).css("display") &&
                            $(t).stop().fadeIn(),
                          (i = !0))
                        : "none" != $(t).css("display") &&
                          $(t).stop().fadeOut(1e3));
                }),
                  i ||
                  !app.data.getWebAppData().getGeneralOptions()
                    .filterByExtent ||
                  app.isInBuilder
                    ? $(".noFeature").css("display", "none")
                    : $(".noFeature").css("display", "block");
              }, 100);
          }),
          (this.initSortable = function () {
            $("#myList").sortable({
              update: function () {
                app.addFeatureBar.updateNumber();
              },
            }),
              $("#myList").addClass("organize");
          }),
          (this.destroySortable = function () {
            $("#myList").sortable("destroy"),
              $("#myList").css("background-color", "#C7C7C7"),
              $("body").removeClass("organizeFeatures"),
              $("#myList").removeClass("organize");
          }),
          (this.tile_onMouseOver = function () {
            var t = this,
              e = $.grep(app.layerCurrent.graphics, function (e) {
                return e.attributes.shortlist_id == $(t).data("shortlist-id");
              });
            if (e[0]) {
              e[0].symbol.setWidth(s.lutIconSpecs.medium.getWidth()),
                e[0].symbol.setHeight(s.lutIconSpecs.medium.getHeight()),
                e[0].symbol.setOffset(
                  s.lutIconSpecs.medium.getOffsetX(),
                  s.lutIconSpecs.medium.getOffsetY()
                ),
                e[0].draw(),
                l.isIE() || s.moveGraphicToFront(e[0]);
              var i = e[0].attributes,
                n =
                  i[
                    $.grep(Object.keys(i), function (t) {
                      return "name" == t.toLowerCase();
                    })[0]
                  ];
              s.buildMapHoverTips(n, e[0]);
            }
          }),
          (this.tile_onMouseOut = function () {
            if (null != s.selected) {
              var t = parseInt($(this).attr("id").substring(4));
              if (s.selected.attributes.shortlist_id == t) return;
            }
            var e = this,
              i = $.grep(app.layerCurrent.graphics, function (t) {
                return t.attributes.shortlist_id == $(e).data("shortlist-id");
              });
            i[0] &&
              (i[0].symbol.setWidth(s.lutIconSpecs.tiny.getWidth()),
              i[0].symbol.setHeight(s.lutIconSpecs.tiny.getHeight()),
              i[0].symbol.setOffset(
                s.lutIconSpecs.tiny.getOffsetX(),
                s.lutIconSpecs.tiny.getOffsetY()
              ),
              i[0].draw()),
              app.mapTips && app.mapTips.clean(!0);
          }),
          (this.tile_onClick = function (t) {
            if (!$("body").hasClass("organizeFeatures")) {
              if (p) return void (p = !1);
              1 == t.which || 2 == t.which || 3 == t.which
                ? (r.tileClick = !0)
                : (r.tileClick = !1);
              var e = $(this).data("shortlist-id");
              s.preSelection(),
                (s.selected = $.grep(app.layerCurrent.graphics, function (t) {
                  return t.attributes.shortlist_id == e;
                })[0]),
                s.postSelection(),
                $("#mobileTitlePage").css("display", "none"),
                s.themeSelected || app.ui.mobileFeatureList.selectTheme(0),
                (s.themeSelected = !0);
            }
          });
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/ui/desktop/DetailPanel", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="detailContainer swiper-container">\r\n\t<button type="button" class=\'detailClose ion-android-close\' style=""></button>\r\n\t<div class="detail-btn-container detail-btn-left">\r\n\t\t<div class="detail-btn ion-chevron-left" style="outline: none;"></div>\r\n\t</div>\r\n\t<div class="detail-btn-container detail-btn-right">\r\n\t\t<div class="detail-btn ion-chevron-right" style="outline: none;"></div>\r\n\t</div>\r\n\t<div class="detailView swiper-wrapper"></div>\r\n</div>\r\n';
      return __p;
    };
  }),
  define("lib-build/tpl!storymaps/tpl/ui/desktop/DetailSlide", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class=\'swiper-slide\'>\r\n\t<div class=\'detailHeader\'>\r\n\t\t<div class="detailFeatureNum" ></div>\r\n\t\t<div class=\'detailFeatureTitle\'></div>\r\n\t</div>\r\n\t<div class="detailTextContainer">\r\n\t\t<div class="detailPictureDiv">\r\n\t\t\t<img class="swiper-lazy">\r\n\t\t\t<div class="swiper-lazy-preloader"></div>\r\n\t\t</div>\r\n\t\t<div class=\'shortDesc\'></div>\r\n\t\t<div class=\'description detailFeatureDesc\'></div>\r\n\t\t<div class="website"></div>\r\n\t</div>\r\n</div>\r\n';
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/ui/desktop/DetailPanel",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/ui/desktop/DetailPanel",
    [
      "../../core/Helper",
      "storymaps/common/utils/CommonHelper",
      "lib-build/tpl!./DetailPanel",
      "lib-build/tpl!./DetailSlide",
      "lib-build/css!./DetailPanel",
    ],
    function (t, e, i, n) {
      return function (a, o, r, s, l) {
        function d() {
          var t = $(".entry.active").index();
          t < 0 && (t = 0),
            $(".detailContainer").show(),
            v[t].slideNext(),
            v[t].slidePrev(),
            f.resize(),
            $(".detailContainer").hide();
        }
        function p() {
          a.find(".userInput").attr("contenteditable", "true");
        }
        function c() {
          o &&
            a.find(".userInput").blur(function () {
              r($(this).html());
            });
        }
        var u,
          h = s,
          f = this,
          m = new t(),
          g = 0,
          b = !1,
          v = [],
          y = {},
          w = !1,
          C = l,
          _ = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,
          x = /(android)/i.test(navigator.userAgent),
          S = {};
        (f.loaded = !1),
          (f.viewed = !1),
          (this.init = function (t) {
            (t = t || {}), $(a).show(), o && p(), c();
          }),
          (this.buildFeatureViews = function (t) {
            var e = $(".entry.active").index();
            e < 0 && (e = 0);
            var n = t || [];
            if (!n.length) {
              var o = app.map.getLayer(app.data.getShortlistLayerId());
              $.each(app.data.getStory(), function (t, e) {
                var i = {
                  title: e.title ? e.title : "tab " + (n.length + 1),
                  features: [],
                };
                n.push(i);
              }),
                $.each(o.graphics, function (t, e) {
                  e.attributes.locationSet &&
                    e.attributes.pic_url &&
                    e.attributes.name &&
                    "Unnamed Place" != e.attributes.name &&
                    n[e.attributes.tab_id].features.push(e);
                });
            }
            if (!b)
              if (_) {
                $(a).prepend(i({}));
                var r = $(".detailView")[0];
                $(r).attr("id", "detailView0"),
                  (S = new Swiper($(".detailContainer")[0], {
                    speed: 0,
                    setWrapperSize: !0,
                  })),
                  S.init(),
                  (b = !0),
                  a.find(".detailClose").click(function () {
                    a.find(".detailContainer").hide(),
                      "small" == app.ui.mobileIntro.screenSize &&
                        app.ui.mobileFeatureList.showMobileList(),
                      h.unselect();
                  }),
                  a.find($(".detail-btn-left")[0]).click(function () {
                    var t = app.layerCurrent.graphics,
                      e = null,
                      i = [];
                    $.each(t, function (t, e) {
                      (!app.map.extent.contains(e.geometry) &&
                        app.data.getWebAppData().getGeneralOptions()
                          .filterByExtent) ||
                        i.push(e);
                    });
                    var n = null;
                    $.grep(i, function (t, e) {
                      t.attributes.shortlist_id ==
                        app.ui.mainView.selected.attributes.shortlist_id &&
                        (n = e);
                    }),
                      (e = 0 !== n ? i[n - 1] : i[i.length - 1]),
                      h.unselect(),
                      (h.selected = e),
                      app.map.extent.contains(e.geometry) ||
                        app.map.centerAt(e.geometry),
                      h.selectSymbol(),
                      f.buildSlide();
                  }),
                  a.find($(".detail-btn-right")[0]).click(function () {
                    var t = app.layerCurrent.graphics,
                      e = null,
                      i = [];
                    $.each(t, function (t, e) {
                      (!app.map.extent.contains(e.geometry) &&
                        app.data.getWebAppData().getGeneralOptions()
                          .filterByExtent) ||
                        i.push(e);
                    });
                    var n = null;
                    $.grep(i, function (t, e) {
                      t.attributes.shortlist_id ==
                        app.ui.mainView.selected.attributes.shortlist_id &&
                        (n = e);
                    }),
                      (e = n !== i.length - 1 ? i[n + 1] : i[0]),
                      h.unselect(),
                      (h.selected = e),
                      app.map.extent.contains(e.geometry) ||
                        app.map.centerAt(e.geometry),
                      h.selectSymbol(),
                      f.buildSlide();
                  }),
                  a.find(".detailPictureDiv img").click(function () {
                    var t = app.layerCurrent.graphics,
                      e = null,
                      i = [];
                    $.each(t, function (t, e) {
                      (!app.map.extent.contains(e.geometry) &&
                        app.data.getWebAppData().getGeneralOptions()
                          .filterByExtent) ||
                        i.push(e);
                    });
                    var n = null;
                    $.grep(i, function (t, e) {
                      t.attributes.shortlist_id ==
                        app.ui.mainView.selected.attributes.shortlist_id &&
                        (n = e);
                    }),
                      (e = n !== i.length - 1 ? i[n + 1] : i[0]),
                      h.unselect(),
                      (h.selected = e),
                      h.selectSymbol(),
                      f.buildSlide();
                  });
              } else
                $.each(n, function (t) {
                  if (
                    0 !== t ||
                    (app.isInBuilder &&
                      !app.data.getWebAppData().getIsExternalData())
                  ) {
                    var e = $(a).find(" .detailContainer")[t - 1];
                    $(e).after(i({}));
                  } else $(a).prepend(i({}));
                  app.isInBuilder &&
                    app.data.getWebAppData().getIsExternalData() &&
                    ($(".detailContainer.swiper-container").addClass(
                      "externalData"
                    ),
                    $(".detail-btn-add").addClass("externalData"));
                  var n = $(".detailView")[t];
                  $(n).attr("id", "detailView" + t),
                    (v[t] = {}),
                    (y[String(t)] = []);
                });
            if (!_ && ((b = !0), !y[String(e)].length)) {
              $(".detailContainer").css("z-index", "0");
              var s = $(".detailContainer")[e];
              $(s).css("z-index", "99"), (g = 0), _ || f.buildSlides(n);
            }
          }),
          (this.buildSlide = function () {
            var t = $(".entry.active").index();
            t < 0 && (t = 0),
              S.removeAllSlides(),
              a.find("#detailView0").append(n()),
              $(".swiper-lazy-preloader").addClass("iOS-hidden");
            var i = $(".detailContainer")[0],
              o = $(i).find(".swiper-slide")[0];
            $(o).addClass("swiper-no-swiping");
            var r = app.ui.mainView.selected.attributes,
              s =
                r[
                  $.grep(Object.keys(r), function (t) {
                    return "name" == t.toLowerCase();
                  })[0]
                ],
              l =
                r[
                  $.grep(Object.keys(r), function (t) {
                    return "description" == t.toLowerCase();
                  })[0]
                ],
              d = "";
            if (app.data.getWebAppData().getIsExternalData()) {
              d =
                r[
                  $.grep(Object.keys(r), function (t) {
                    return "short_desc" == t.toLowerCase();
                  })[0]
                ];
              var p =
                  r[
                    $.grep(Object.keys(r), function (t) {
                      return "desc1" == t.toLowerCase();
                    })[0]
                  ],
                c =
                  r[
                    $.grep(Object.keys(r), function (t) {
                      return "desc2" == t.toLowerCase();
                    })[0]
                  ],
                u =
                  r[
                    $.grep(Object.keys(r), function (t) {
                      return "desc3" == t.toLowerCase();
                    })[0]
                  ],
                h =
                  r[
                    $.grep(Object.keys(r), function (t) {
                      return "desc4" == t.toLowerCase();
                    })[0]
                  ],
                m =
                  r[
                    $.grep(Object.keys(r), function (t) {
                      return "desc5" == t.toLowerCase();
                    })[0]
                  ];
              p && (l ? (l += "<p>" + p + "</p>") : (l = "<p>" + p + "</p>")),
                c && (l ? (l += "<p>" + c + "</p>") : (l = "<p>" + c + "</p>")),
                u && (l ? (l += "<p>" + u + "</p>") : (l = "<p>" + u + "</p>")),
                h && (l ? (l += "<p>" + h + "</p>") : (l = "<p>" + h + "</p>")),
                m && (l ? (l += "<p>" + m + "</p>") : (l = "<p>" + m + "</p>"));
            }
            var g =
                r[
                  $.grep(Object.keys(r), function (t) {
                    return "pic_url" == t.toLowerCase();
                  })[0]
                ],
              b =
                r[
                  $.grep(Object.keys(r), function (t) {
                    return "thumb_url" == t.toLowerCase();
                  })[0]
                ],
              v =
                r[
                  $.grep(Object.keys(r), function (t) {
                    return "website" == t.toLowerCase();
                  })[0]
                ];
            if (
              (app.data.getWebAppData().getGeneralOptions().numberedIcons
                ? ($(o)
                    .find(".detailFeatureNum")
                    .css("background-color", app.data.getStory()[t].color),
                  $(o)
                    .find(".detailFeatureNum")
                    .text(r.PLACENUMSL ? r.PLACENUMSL : r.number))
                : ($(o).find(".detailFeatureNum").hide(),
                  $(o).find(".detailFeatureTitle").addClass("notNumbered")),
              s && $(o).find(".detailFeatureTitle").html(s),
              g)
            ) {
              (g = b || g),
                g.indexOf("sharing/rest/content/items/") > -1 &&
                  (g = e.possiblyAddToken(g));
              ($(o).find("img")[0].onload = function () {
                $(this)
                  .parent()
                  .find(".imageLoadingIndicator")
                  .css("display", "none"),
                  f.resize();
              }),
                $(o).find("img").attr("src", g);
            } else $(o).find(".imageLoadingIndicator").css("display", "none");
            d
              ? $(o).find(".shortDesc").html(d)
              : $(o).find(".shortDesc").remove(),
              l && $(o).find(".description").html(l),
              v &&
                ($(o).find(".website").empty(),
                $(o)
                  .find(".website")
                  .append("<a href=" + v + ' target="_blank" >More info</a>'),
                $(".website").show()),
              $(o).data("shortlist-id", r.shortlist_id);
            var y = app.data.getStory()[t].color;
            $("#detailView0").find(".detailHeader").css("border-top-color", y),
              f.resize(),
              $("#mobilePaneList").hide(),
              setTimeout(function () {
                $(i).show(), $(i).css("z-index", 99);
              }, 0);
          }),
          (this.buildSlides = function (t) {
            (w = !0), (f.loaded = !1), (u = t);
            var i = $(".entry.active").index();
            i < 0 && (i = 0);
            var o = u[i],
              r = o.features;
            if (r[0] && r[0].attributes) {
              r[0].attributes[
                $.grep(Object.keys(r[0].attributes), function (t) {
                  return "number" == t.toLowerCase();
                })[0]
              ] &&
                r.sort(function (t, e) {
                  var i =
                      t.attributes[
                        $.grep(Object.keys(t.attributes), function (t) {
                          return "number" == t.toLowerCase();
                        })[0]
                      ],
                    n =
                      e.attributes[
                        $.grep(Object.keys(e.attributes), function (t) {
                          return "number" == t.toLowerCase();
                        })[0]
                      ];
                  return parseInt(i) - parseInt(n);
                });
            }
            for (; g < r.length; g++) {
              var s = $(".detailContainer")[i];
              a.find("#detailView" + i).append(n());
              var l = $(s).find(".swiper-slide")[g];
              $(l).on("mousedown", function () {
                $(this).addClass("swiper-no-swiping");
              }),
                navigator.userAgent.match(/Trident.*rv\:11\./) &&
                  navigator.userAgent.match(/Trident.*rv\:11\./).length &&
                  $(l).on("pointerdown", function () {
                    $(this).addClass("swiper-no-swiping");
                  }),
                $(l).on("mouseup", function () {
                  $(this).removeClass("swiper-no-swiping");
                });
              var p = r[g].attributes,
                c =
                  p[
                    $.grep(Object.keys(p), function (t) {
                      return "name" == t.toLowerCase();
                    })[0]
                  ],
                b =
                  p[
                    $.grep(Object.keys(p), function (t) {
                      return "description" == t.toLowerCase();
                    })[0]
                  ],
                C = "";
              if (app.data.getWebAppData().getIsExternalData()) {
                C =
                  p[
                    $.grep(Object.keys(p), function (t) {
                      return "short_desc" == t.toLowerCase();
                    })[0]
                  ];
                var _ =
                    p[
                      $.grep(Object.keys(p), function (t) {
                        return "desc1" == t.toLowerCase();
                      })[0]
                    ],
                  S =
                    p[
                      $.grep(Object.keys(p), function (t) {
                        return "desc2" == t.toLowerCase();
                      })[0]
                    ],
                  T =
                    p[
                      $.grep(Object.keys(p), function (t) {
                        return "desc3" == t.toLowerCase();
                      })[0]
                    ],
                  k =
                    p[
                      $.grep(Object.keys(p), function (t) {
                        return "desc4" == t.toLowerCase();
                      })[0]
                    ],
                  E =
                    p[
                      $.grep(Object.keys(p), function (t) {
                        return "desc5" == t.toLowerCase();
                      })[0]
                    ];
                _ && (b ? (b += "<p>" + _ + "</p>") : (b = "<p>" + _ + "</p>")),
                  S &&
                    (b ? (b += "<p>" + S + "</p>") : (b = "<p>" + S + "</p>")),
                  T &&
                    (b ? (b += "<p>" + T + "</p>") : (b = "<p>" + T + "</p>")),
                  k &&
                    (b ? (b += "<p>" + k + "</p>") : (b = "<p>" + k + "</p>")),
                  E &&
                    (b ? (b += "<p>" + E + "</p>") : (b = "<p>" + E + "</p>"));
              }
              var A =
                  p[
                    $.grep(Object.keys(p), function (t) {
                      return "pic_url" == t.toLowerCase();
                    })[0]
                  ],
                I =
                  p[
                    $.grep(Object.keys(p), function (t) {
                      return "thumb_url" == t.toLowerCase();
                    })[0]
                  ],
                L =
                  p[
                    $.grep(Object.keys(p), function (t) {
                      return "website" == t.toLowerCase();
                    })[0]
                  ];
              if (
                (m.prependURLHTTP(L),
                app.data.getWebAppData().getGeneralOptions().numberedIcons
                  ? ($(l)
                      .find(".detailFeatureNum")
                      .css("background-color", app.data.getStory()[i].color),
                    $(l)
                      .find(".detailFeatureNum")
                      .text(p.PLACENUMSL ? p.PLACENUMSL : p.number))
                  : ($(l).find(".detailFeatureNum").hide(),
                    $(l).find(".detailFeatureTitle").addClass("notNumbered")),
                c && $(l).find(".detailFeatureTitle").html(c),
                A)
              ) {
                var P = $(l).find("img")[0];
                if (A.indexOf("sharing/rest/content/items/") > -1) {
                  A.indexOf("http") > -1 &&
                    5 == A.indexOf("https") &&
                    (A = A.slice(5));
                  (A.match(/https/g) || [].length).length > 1 &&
                    (A = A.slice(6));
                }
                x
                  ? ((A = I || A),
                    A.indexOf("sharing/rest/content/items/") > -1 &&
                      (A = e.possiblyAddToken(A)),
                    $(l).find("img").attr("src", A))
                  : (A.indexOf("sharing/rest/content/items/") > -1 &&
                      (A = e.possiblyAddToken(A)),
                    $(l).find("img").attr("data-src", A),
                    $(l).find("img").attr("alt", "")),
                  P.complete && $(l).find(".imageLoadingIndicator").hide();
              } else $(l).find(".imageLoadingIndicator").css("display", "none");
              if (
                (C
                  ? $(l).find(".shortDesc").html(C)
                  : $(l).find(".shortDesc").remove(),
                b && $(l).find(".description").html(b),
                L &&
                  ($(l)
                    .find(".website")
                    .append("<a href=" + L + ' target="_blank" >More info</a>'),
                  $(".website").show(),
                  app.data.getWebAppData().getIsExternalData() &&
                    $(".website").css("margin-top", 0)),
                $(l).data("shortlist-id", p.shortlist_id),
                $(l)
                  .find(".detailPictureDiv img")
                  .click(function () {
                    var t = $(".entry.active").index();
                    if ((t < 0 && (t = 0), !h.selected)) {
                      var e = v[t].activeIndex + 1;
                      v[t].activeIndex === v[t].slides.length - 1 && (e = 0);
                      var i = v[t].slides[e],
                        n = $(i).data("shortlist-id"),
                        a = app.map.getLayer(
                          app.data.getWebAppData().getShortlistLayerId()
                        );
                      app.ui.mainView.selected = $.grep(
                        a.graphics,
                        function (t) {
                          return t.attributes.shortlist_id == n;
                        }
                      )[0];
                    }
                    (h.selected.updated = !1),
                      v[t].activeIndex == v[t].slides.length - 1
                        ? ((M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "visible",
                            }),
                          v[t].slideTo(0, 0),
                          (M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "auto",
                            }))
                        : ((M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "visible",
                            }),
                          v[t].slideNext(),
                          (M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "auto",
                            }));
                  }),
                y[String(i)].push(l),
                g % 10 == 0 && g + 1 < r.length)
              )
                return (
                  setTimeout(function () {
                    g++, f.buildSlides(t);
                  }, 0),
                  !1
                );
              if (g + 1 == r.length) {
                var D = new Swiper($(".detailContainer")[i], {
                  speed: 0,
                  setWrapperSize: !0,
                  lazyLoading: !0,
                });
                (v[i] = D),
                  D.init(),
                  D.update(),
                  D.on("onSlideChangeEnd", function (t) {
                    if (!w) {
                      if ((h.preSelection(), h.selected.updated))
                        return void (
                          !h.selected ||
                          app.map.extent.contains(h.selected.geometry) ||
                          app.data.getWebAppData().getGeneralOptions()
                            .filterByExtent ||
                          app.map.centerAt(h.selected.geometry)
                        );
                      var e = $(".entry.active").index();
                      if ((e < 0 && (e = 0), f.viewed && !h.selected.updated)) {
                        var i = D.slides[D.activeIndex],
                          n = $(i).data("shortlist-id"),
                          a = $.grep(app.layerCurrent.graphics, function (t) {
                            return t.attributes.shortlist_id == n;
                          })[0];
                        (h.selected = a),
                          !h.selected ||
                            app.map.extent.contains(h.selected.geometry) ||
                            app.data.getWebAppData().getGeneralOptions()
                              .filterByExtent ||
                            app.map.centerAt(h.selected.geometry);
                      }
                      if (
                        (setTimeout(function () {
                          h.buildMapTips();
                        }, 0),
                        $(".showOnce").length)
                      ) {
                        var o = $(".showOnce")[0];
                        $(o).hasClass("swiper-slide-active") ||
                          ($(".swiper-slide").removeClass("showOnce"),
                          v[e].removeSlide(v[e].previousIndex),
                          v[e].update());
                      }
                      1 == v[e].slides.length
                        ? $(".detail-btn-container").hide()
                        : $(".detail-btn-container").show(),
                        f.resize(),
                        D.update(),
                        $(".esriPopup").hide();
                    }
                  }),
                  a.find(".detail-btn-left").mouseover(function () {
                    $(".detail-btn-left").css("opacity", 1),
                      $(".detail-btn-right").css("opacity", 0.8);
                  }),
                  a.find(".detail-btn-right").mouseover(function () {
                    $(".detail-btn-right").css("opacity", 1),
                      $(".detail-btn-left").css("opacity", 0.8);
                  }),
                  a.find(".detail-btn-left").mouseout(function () {
                    $(".detail-btn-left").css("opacity", 0.8);
                  }),
                  a.find(".detail-btn-right").mouseout(function () {
                    $(".detail-btn-right").css("opacity", 0.8);
                  }),
                  a.find(".detailClose").click(function () {
                    a.find(".detailContainer").hide(),
                      "small" == app.ui.mobileIntro.screenSize &&
                        app.ui.mobileFeatureList.showMobileList(),
                      h.unselect();
                  });
                var M = navigator.appVersion.indexOf("Edge") > 0,
                  O = navigator.userAgent.indexOf("Windows NT 10.0") > 0;
                a.find($(".detail-btn-left")[i]).click(function () {
                  if (!h.selected) {
                    var t = v[i].activeIndex - 1;
                    0 === v[i].activeIndex && (t = v[i].slides.length - 1);
                    var e = v[i].slides[t],
                      n = $(e).data("shortlist-id"),
                      a = app.map.getLayer(
                        app.data.getWebAppData().getShortlistLayerId()
                      );
                    app.ui.mainView.selected = $.grep(a.graphics, function (t) {
                      return t.attributes.shortlist_id == n;
                    })[0];
                  }
                  (h.selected.updated = !1),
                    0 === v[i].activeIndex
                      ? ((M || O) &&
                          $(".swiper-slide-active .detailTextContainer").css({
                            "overflow-y": "visible",
                          }),
                        v[i].slideTo(v[i].slides.length - 1, 0),
                        (M || O) &&
                          $(".swiper-slide-active .detailTextContainer").css({
                            "overflow-y": "auto",
                          }))
                      : ((M || O) &&
                          $(".swiper-slide-active .detailTextContainer").css({
                            "overflow-y": "visible",
                          }),
                        v[i].slidePrev(),
                        (M || O) &&
                          $(".swiper-slide-active .detailTextContainer").css({
                            "overflow-y": "auto",
                          }));
                }),
                  a.find($(".detail-btn-right")[i]).click(function () {
                    if (!h.selected) {
                      var t = v[i].activeIndex + 1;
                      v[i].activeIndex === v[i].slides.length - 1 && (t = 0);
                      var e = v[i].slides[t],
                        n = $(e).data("shortlist-id"),
                        a = app.map.getLayer(
                          app.data.getWebAppData().getShortlistLayerId()
                        );
                      app.ui.mainView.selected = $.grep(
                        a.graphics,
                        function (t) {
                          return t.attributes.shortlist_id == n;
                        }
                      )[0];
                    }
                    (h.selected.updated = !1),
                      v[i].activeIndex == v[i].slides.length - 1
                        ? ((M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "visible",
                            }),
                          v[i].slideTo(0, 0),
                          (M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "auto",
                            }))
                        : ((M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "visible",
                            }),
                          v[i].slideNext(),
                          (M || O) &&
                            $(".swiper-slide-active .detailTextContainer").css({
                              "overflow-y": "auto",
                            }));
                  });
                var R = app.data.getStory()[i].color;
                $("#detailView" + i)
                  .find(".detailHeader")
                  .css("border-top-color", R),
                  v[i].update(),
                  d(),
                  f.resize();
              }
            }
            (f.loaded = !0), (f.viewed = !1), (w = !1);
          }),
          (this.showDetails = function (t) {
            if (
              (app.data.getWebAppData().getGeneralOptions().filterByExtent ||
                ((h.selected = t), (h.selected.updated = !0)),
              null != t)
            ) {
              f.resize(),
                app.data.getWebAppData().getGeneralOptions().filterByExtent &&
                  d();
              var i = $(".entry.active").index();
              i < 0 && (i = 0);
              var n = $(".detailContainer")[i],
                a = v[i];
              $("#mobilePaneList").hide();
              var o;
              $.each(
                $("#detailView" + i).find($(".swiper-slide")),
                function (e, i) {
                  if (
                    parseInt($(i).data("shortlist-id")) ==
                    t.attributes.shortlist_id
                  )
                    return (o = e), !1;
                }
              ),
                C.getGeneralOptions().numberedIcons ||
                  $(".detailFeatureTitle").addClass("notNumbered");
              var r = navigator.userAgent.indexOf("Windows NT 10.0") > 0,
                s = navigator.appVersion.indexOf("Edge") > 0;
              if (
                (v[i].on("onSlideChangeEnd", function () {
                  $(n).show(), $(n).css("z-index", 99);
                }),
                0 === o && 0 === a.activeIndex
                  ? ($(n).show(),
                    !s && r && 0 == i && (v[i].slideNext(), v[i].slidePrev()),
                    $(n).hide(),
                    $(n).show(),
                    $(n).css("z-index", 99))
                  : setTimeout(function () {
                      v[i].slideTo(o, 0), o === a.activeIndex && $(n).show();
                    }, 0),
                1 == v[i].slides.length
                  ? $(".detail-btn-container").hide()
                  : $(".detail-btn-container").show(),
                v[i].update(),
                0 === $(".swiper-slide-active img").width())
              ) {
                var l = $(".swiper-slide-active img")[0],
                  p = $(l).attr("data-src")
                    ? $(l).attr("data-src")
                    : $(l).attr("src");
                p &&
                  p.indexOf("sharing/rest/content/items/") > -1 &&
                  (p = e.possiblyAddToken(p)),
                  $(l).attr("src", p),
                  $(l).attr("alt", "");
              }
              f.resize(), (f.viewed = !0);
            }
          }),
          (this.refreshSlides = function () {
            if (
              ((w = !0),
              !app.data.getWebAppData().getGeneralOptions().filterByExtent &&
                !app.isInBuilder)
            )
              return void (w = !1);
            var t = $(".entry.active").index();
            if ((t < 0 && (t = 0), !(v[t] && v[t].init && y && y[String(t)]))) {
              return;
            }
            $(".detailContainer").css("z-index", "0");
            var e = $(".detailContainer")[t];
            if (($(e).css("z-index", "99"), !u)) return void (w = !1);
            var i = u[t],
              n = i.features,
              a = null;
            v[t].slides && v[t].removeAllSlides(),
              $.each(n, function (e, i) {
                app.map.extent.contains(i.geometry) &&
                  $.each(y[String(t)], function (e, n) {
                    parseInt($(n).data("shortlist-id")) ==
                      i.attributes.shortlist_id &&
                      (v[t].appendSlide($(n)[0]),
                      h.selected &&
                        parseInt($(n).data("shortlist-id")) ==
                          h.selected.attributes.shortlist_id &&
                        (a = parseInt(e)));
                  }),
                  h.selected &&
                    !app.map.extent.contains(h.selected.geometry) &&
                    $.each(y[String(t)], function (e, i) {
                      parseInt($(i).data("shortlist-id")) ==
                        h.selected.attributes.shortlist_id &&
                        (v[t].appendSlide($(i)[0]), $(i).addClass("showOnce"));
                    });
              }),
              h.selected &&
                $.each(
                  $("#detailView" + t).find($(".swiper-slide")),
                  function (t, e) {
                    parseInt($(e).data("shortlist-id")) ==
                      h.selected.attributes.shortlist_id && (a = parseInt(t));
                  }
                ),
              v[t].update(),
              null != a && v[t].slideTo(a, 0),
              1 == v[t].slides.length
                ? $(".detail-btn-container").hide()
                : $(".detail-btn-container").show(),
              (w = !1);
          }),
          (this.update = function (t) {
            (t = t || {}), a.find(".detailContainer").html(t.data);
          }),
          (this.resize = function () {
            setTimeout(function () {
              var t = 40;
              _ && (t = 80),
                "small" == app.ui.mobileIntro.screenSize &&
                  ($("#paneLeft").css(
                    "height",
                    $("#contentPanel").height() - $("#map").height() + 10
                  ),
                  $("#paneLeft").css("width", "100%"),
                  $("#paneLeft").css({ top: $("#map").height() - 10 }),
                  (t = 20),
                  _ && (t = 110));
              var e,
                i = $(".entry.active").index();
              i < 0 && (i = 0);
              var n;
              $.isEmptyObject(v[i]) ||
                ((n = v[i]), (e = n.slides[n.activeIndex])),
                $(e).height(
                  $("#paneLeft").outerHeight() -
                    5 +
                    (app.embedBar && app.embedBar.initiated ? -26 : 0)
                );
              var a = $(e).find(".detailHeader").outerHeight();
              $(".detailTextContainer").height(
                $("#paneLeft").outerHeight() - a - t + "px"
              ),
                $(".detailPictureDiv img").css(
                  "max-width",
                  $("#paneLeft").outerWidth()
                );
              var o =
                $("#paneLeft").outerHeight() - a - 60 <
                0.6 * $("#paneLeft").outerHeight()
                  ? $("#paneLeft").outerHeight() - a - 60
                  : 0.6 * $("#paneLeft").outerHeight();
              $(".detailPictureDiv img").css("max-height", parseInt(o) + "px"),
                $(".detailContainer").width($("#paneLeft").outerWidth()),
                $(".detailContainer").height($("#paneLeft").outerHeight()),
                n &&
                  (app.data.getWebAppData().getGeneralOptions().filterByExtent
                    ? setTimeout(function () {
                        v[i].slideTo(n.activeIndex),
                          n.update(),
                          v[i].slideTo(n.activeIndex);
                      }, 800)
                    : (v[i].slideTo(n.activeIndex),
                      n.update(),
                      v[i].slideTo(n.activeIndex)));
            }, 0);
          }),
          (this.showEntryIndex = function () {}),
          (this.destroy = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBar", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="nav-bar">\r\n\t<div class="entries">\r\n\t\t<ul class="nav nav-tabs">\r\n\t\t\t\x3c!--\r\n\t\t\t\ttabs and the more button are injected here\r\n\t\t\t--\x3e\r\n\t\t</ul>\r\n\t</div>\r\n\t<div class="builder-content-panel inline">\r\n\t\t<span class="builder-content-panel-group builder-edit btn btn-sm btn-default">\r\n\t\t\t<div class="builder-btn"></div>\r\n\t\t\t<div class="builder-lbl"></div>\r\n\t\t</span>\r\n\r\n\t\t<span class="builder-content-panel-group builder-add btn btn-sm btn-default">\r\n\t\t\t<div class="builder-btn"></div>\r\n\t\t\t<div class="builder-lbl"></div>\r\n\t\t</span>\r\n\t\t<span class="builder-content-panel-group builder-organize btn btn-sm btn-default">\r\n\t\t\t<div class="builder-btn"></div>\r\n\t\t\t<div class="builder-lbl"></div>\r\n\t\t</span>\r\n\t</div>\r\n\t<div class="builder-mask"></div>\r\n\t<div id="bookmarksCon">\r\n\t\t<div id="bookmarksButton"></div>\r\n\t\t<div id="bookmarksToggle"> \x3c!--tabindex="0"--\x3e\r\n\t\t\t<span id="bookmarksTogText"></span>\r\n\t\t</div>\r\n\t\t<div id="bookmarksDiv"></div>\r\n\t</div>\r\n</div>\r\n';
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/ui/desktop/NavBar", [], function () {}),
  define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntry", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<li class="entry ' +
          (null == (__t = optHtmlClass) ? "" : __t) +
          '" data-title="' +
          (null == (__t = tooltip) ? "" : __t) +
          '">\r\n\t<a class="entryLbl" tabindex="0">' +
          (null == (__t = value) ? "" : __t) +
          "</a>\r\n</li>\r\n";
      return __p;
    };
  }),
  define(
    "lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntryMore",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<li class="dropdown pull-right"> \x3c!-- tabindex="0" --\x3e\r\n\t<a class="dropdown-toggle" data-toggle="dropdown">\r\n\t\t<span class="glyphicon glyphicon-th-list"></span> <span class="caret"></span>\r\n\t</a>\r\n\t<ul class="dropdown-menu">\r\n\t\t\x3c!--\r\n\t\t\ttabs are injected here a second time\r\n\t\t\tthat way they are just toggled and not moved around\r\n\t\t--\x3e\r\n\t\t' +
            (null == (__t = entries) ? "" : __t) +
            "\r\n\t</ul>\r\n</li>\r\n";
        return __p;
      };
    }
  ),
  define(
    "storymaps/tpl/ui/desktop/NavBar",
    [
      "lib-build/tpl!./NavBar",
      "lib-build/css!./NavBar",
      "lib-build/tpl!./NavBarEntry",
      "lib-build/tpl!./NavBarEntryMore",
      "storymaps/common/utils/CommonHelper",
      "esri/graphicsUtils",
      "esri/layers/GraphicsLayer",
      "esri/geometry/webMercatorUtils",
      "esri/geometry/Extent",
      "dojo/topic",
      "dojo/has",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p) {
      return function (e, o, r, s) {
        function l(t, a) {
          (g = g || []), $(".nav-bar").addClass("isTab");
          var o = (g.length, "");
          $.each(g, function (t, e) {
            var n = e.alias ? e.alias : e.title;
            o += i({ value: n, tooltip: "", optHtmlClass: "" });
          }),
            e.find(".nav-tabs").html(o + n({ entries: o })),
            p(t),
            e.find(".entry").click(c),
            e.find(".entryLbl").on("keydown", function (t) {
              if (9 === t.keyCode)
                return (
                  d.publish("story-tab-navigation", {
                    from: "nav",
                    direction: t.shiftKey ? "backward" : "forward",
                  }),
                  !1
                );
            }),
            e
              .find(".entryLbl")
              .eq(0)
              .focus(function () {
                $(this).data("mouseDown") ||
                  $(this).parent(".entry").hasClass("active") ||
                  $(this).parent(".entry").click();
              })
              .mousedown(function () {
                $(this).data("mouseDown", !0);
              })
              .mouseup(function () {
                $(this).removeData("mouseDown");
              }),
            $("#nav-bar").show(),
            app.isInBuilder && app.addFeatureBar.updateLocatedFeatures(a),
            m.resize();
        }
        function p(t) {
          e.css("background-color", t.header),
            a.addCSSRule(
              ".nav-bar .nav > .entry .entryLbl, \t\t\t\t\t.nav-bar .dropdown-toggle { \t\t\t\t\t\tcolor: " +
                t.tabText +
                "; \t\t\t\t\t\tbackground-color: " +
                t.tab +
                " !important; \t\t\t\t\t}",
              "NavBarTab"
            ),
            a.addCSSRule(
              ".nav-bar .entry.active > .entryLbl, \t\t\t\t\t.nav-bar .dropdown.active .dropdown-toggle { \t\t\t\t\t\tcolor: " +
                t.tabTextActive +
                "; \t\t\t\t\t\tbackground-color: " +
                t.tabActive +
                " !important; \t\t\t\t\t}",
              "NavBarActive"
            ),
            a.addCSSRule(
              ".nav-bar .dropdown:not(.active):hover .dropdown-toggle, \t\t\t\t\t.nav-bar li:not(.active) .entryLbl:hover { \t\t\t\t\t\tcolor: " +
                t.tabTextHover +
                "; \t\t\t\t\t\tbackground-color: " +
                t.tabHover +
                " !important; \t\t\t\t\t}",
              "NavBarHover"
            ),
            a.addCSSRule(
              ".nav-bar .dropdown-menu, \t\t\t\t\t.nav-bar .dropdown-menu .entryLbl { \t\t\t\t\t\tcolor: " +
                t.tabText +
                " !important; \t\t\t\t\t\tbackground-color: " +
                t.header +
                " !important; \t\t\t\t\t}",
              "NavBarMore"
            );
        }
        function c() {
          if (!$("body").hasClass("organizeFeatures")) {
            var t = $(this).index();
            r(t),
              app.isInBuilder &&
                !app.data.getWebAppData().getIsExternalData() &&
                (app.addFeatureBar.updateLocatedFeatures(),
                app.addFeatureBar.exitOrganizeMode());
          }
        }
        function u() {
          e.find(".builder-content-panel").css("display", "inline-block"),
            e
              .find(".builder-edit")
              .off("click")
              .click(h)
              .find(".builder-lbl")
              .html(i18n.builder.addEditPopup.editTab),
            e
              .find(".builder-add")
              .off("click")
              .click(m.onClickAdd)
              .find(".builder-lbl")
              .html(i18n.builder.addEditPopup.addTab);
        }
        function h() {
          $("body").hasClass("organizeFeatures") ||
            app.builder.openEditPopup({ entryIndex: m.getEntryIndex() });
        }
        function f(t, e, i) {
          return t.hasOwnProperty(e) && t[e] === i;
        }
        var m = this,
          g = null,
          b = null,
          v = null;
        e.html(t({})),
          (this.init = function (t, e, i, n) {
            (g = t),
              (b = null),
              (v = n),
              l(i, e),
              this.showEntryIndex(e),
              1 == g.length && app.ui.navBar.disableOrganize(),
              o && u();
          }),
          (this.update = function (t) {
            l(t), this.showEntryIndex(b);
          }),
          (this.resize = function () {
            e.find(".nav-tabs > li").addClass("visible"),
              e.find(".nav-tabs .dropdown").removeClass("visible"),
              e.find(".nav-tabs .dropdown-menu li").removeClass("visible");
            var t = 0,
              i = 0,
              n = !1,
              a = e.find(".nav-tabs > li:not(.dropdown)"),
              o = e.find("li.dropdown").outerWidth(),
              r =
                e.width() -
                e.find(".builder-content-panel:visible").outerWidth() -
                30 -
                4;
            a.each(function () {
              i++,
                ((t += $(this).outerWidth()) > r ||
                  (t + o > r && i < a.length)) &&
                  ((n = !0),
                  $(this).removeClass("visible"),
                  e
                    .find(".nav-tabs .dropdown-menu li")
                    .eq($(this).index())
                    .addClass("visible"));
            });
            var s = e.find(".nav-tabs > .entry.active"),
              l = e.find(".nav-tabs .dropdown-menu li.active");
            s.length && !s.hasClass("visible")
              ? (s.removeClass("active"),
                e
                  .find(".nav-tabs .dropdown-menu li")
                  .eq(s.index())
                  .addClass("active"),
                e.find(".nav-tabs > .dropdown").addClass("active"))
              : l.length &&
                !l.hasClass("visible") &&
                (l.removeClass("active"),
                e.find(".nav-tabs > .entry").eq(l.index()).addClass("active"),
                e.find(".nav-tabs > .dropdown").removeClass("active")),
              n && e.find(".nav-tabs .dropdown").addClass("visible");
          }),
          (this.showEntryIndex = function (t) {
            var i = e.find(".nav-tabs > .entry.visible").length;
            e.find("li").removeClass("active"),
              t < i
                ? (e.find(".entry").eq(t).addClass("active"),
                  app.isLoading ||
                    (e.find(".entry").eq(t).find(".entryLbl").focus(),
                    e.find(".dropdown").hasClass("open") &&
                      e.find(".dropdown-toggle").click()))
                : (e.find(".dropdown").addClass("active"),
                  e.find(".dropdown .entry").eq(t).addClass("active"),
                  app.isLoading ||
                    (e.find(".dropdown").hasClass("open") ||
                      e.find(".dropdown-toggle").click(),
                    e.find(".dropdown .entry").eq(t).focus())),
              app.isInBuilder &&
                setTimeout(function () {
                  m.resize();
                }, 50),
              (b = t);
          }),
          (this.getEntryIndex = function () {
            return b;
          }),
          (this.destroy = function () {
            e.hide();
          }),
          (this.bookmarksLoaded = !1),
          (this.initBookmarks = function () {
            var t = app.data.getResponse()
              ? app.data.getResponse().itemInfo.itemData.bookmarks
              : app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo
                  .itemData.bookmarks;
            t.length &&
              app.data.getWebAppData().getGeneralOptions().bookmarks &&
              ($("#bookmarksCon").show(),
              $("#bookmarksTogText").html(
                app.data.getWebAppData().getGeneralOptions().bookmarksAlias +
                  " &#x25BC;"
              ),
              $("#mobileBookmarksTogText").html(
                app.data.getWebAppData().getGeneralOptions().bookmarksAlias +
                  " &#x25BC;"
              ),
              $("#bookmarksToggle").addClass("closed"),
              $("#mobileBookmarksToggle").addClass("closed"),
              $("#bookmarksToggle").click(function () {
                "none" == $("#bookmarksDiv").css("display")
                  ? ($("#bookmarksTogText").html(
                      app.data.getWebAppData().getGeneralOptions()
                        .bookmarksAlias + " &#x25B2;"
                    ),
                    $("#bookmarksDiv").css("display", "inline-block"),
                    $("#bookmarksToggle").removeClass("closed"),
                    $("#bookmarksToggle").addClass("open"))
                  : ($("#bookmarksTogText").html(
                      app.data.getWebAppData().getGeneralOptions()
                        .bookmarksAlias + " &#x25BC;"
                    ),
                    $("#bookmarksDiv").css("display", "none"),
                    $("#bookmarksToggle").removeClass("open"),
                    $("#bookmarksToggle").addClass("closed")),
                  $("#mobileBookmarksTogText").html(
                    app.data.getWebAppData().getGeneralOptions()
                      .bookmarksAlias + " &#x25BC;"
                  );
              }),
              $("#mobileBookmarksToggle").click(function () {
                "none" == $("#mobileBookmarksDiv").css("display")
                  ? ($("#mobileBookmarksDiv").css("display", "inline-block"),
                    $("#mobileBookmarksTogText").html(
                      app.data.getWebAppData().getGeneralOptions()
                        .bookmarksAlias + " &#x25B2;"
                    ),
                    $("#mobileBookmarksToggle").removeClass("closed"),
                    $("#mobileBookmarksToggle").addClass("open"))
                  : ($("#mobileBookmarksDiv").css("display", "none"),
                    $("#mobileBookmarksTogText").html(
                      app.data.getWebAppData().getGeneralOptions()
                        .bookmarksAlias + " &#x25BC;"
                    ),
                    $("#mobileBookmarksToggle").removeClass("open"),
                    $("#mobileBookmarksToggle").addClass("closed"));
              }),
              $.each(t, function (t, e) {
                $("#bookmarksDiv").append(
                  "<p><a tabindex='0'>" + e.name + "</a></p>"
                ),
                  $("#mobileBookmarksDiv").append(
                    "<p><a>" + e.name + "</a></p>"
                  );
              }),
              $("#bookmarksDiv a").click(function () {
                var e = $(this).html(),
                  i = new esri.geometry.Extent(
                    $.grep(t, function (t) {
                      return t.name == e;
                    })[0].extent
                  );
                app.map.setExtent(i),
                  $("#bookmarksTogText").html(
                    app.data.getWebAppData().getGeneralOptions()
                      .bookmarksAlias + " &#x25BC;"
                  ),
                  $("#bookmarksDiv").css("display", "none"),
                  $("#bookmarksToggle").removeClass("open"),
                  $("#bookmarksToggle").addClass("closed");
              }),
              $("#mobileBookmarksDiv a").click(function () {
                var e = $(this).html(),
                  i = new esri.geometry.Extent(
                    $.grep(t, function (t) {
                      return t.name == e;
                    })[0].extent
                  );
                app.map.setExtent(i),
                  $("#mobileBookmarksTogText").html(
                    app.data.getWebAppData().getGeneralOptions()
                      .bookmarksAlias + " &#x25BC;"
                  ),
                  $("#mobileBookmarksToggle").removeClass("open"),
                  $("#mobileBookmarksToggle").addClass("closed"),
                  $("#mobileBookmarksDiv").css("display", "none");
              }),
              !app.isInBuilder &&
                app.data.getWebAppData().getTabs() &&
                1 == Object.keys(app.data.getWebAppData().getTabs()).length &&
                $("#bookmarksCon").css({ top: "10px" })),
              $("#nav-bar").show(),
              $("#bookmarksDiv").show(),
              $("#bookmarksCon").width($("#bookmarksDiv").outerWidth()),
              $("#bookmarksDiv").hide(),
              (m.bookmarksLoaded = !0);
          }),
          (this.hideBookmarks = function () {
            $("#bookmarksCon").hide();
          }),
          (this.showBookmarks = function () {
            $("#bookmarksCon").show();
          }),
          (this.updateBookmarksAlias = function (t) {
            $("#bookmarksTogText").html(t + " &#x25BC;"),
              $("#mobileBookmarksTogText").html(t + " &#x25BC;");
          }),
          (this.disableOrganize = function () {
            e.find(".builder-organize").attr("disabled", !0),
              e.find(".builder-organize").addClass("disabled"),
              $.each(e.find(".builder-organize").children(), function (t, e) {
                $(e).addClass("disabled");
              });
          }),
          (this.enableOrganize = function () {
            e.find(".builder-organize").attr("disabled", !1),
              e.find(".builder-organize").removeClass("disabled"),
              $.each(e.find(".builder-organize").children(), function (t, e) {
                $(e).removeClass("disabled");
              });
          }),
          (this.onClickAdd = function (t, i) {
            if (!$("body").hasClass("organizeFeatures")) {
              app.detailPanelBuilder.hideSearch();
              var n = e.find(".nav-tabs .entry.visible").length,
                a =
                  "customHome" ==
                  app.data.getWebAppData().getGeneralOptions().extentMode
                    ? app.data.getWebAppData().getMapExtent()
                    : null,
                o = {
                  id: n,
                  title: i || "Tab " + (n + 1),
                  features: [],
                  extent: a,
                };
              f(g, "id", n) || (g[n] = o);
              var s = app.cfg.COLOR_ORDER.split(","),
                l = n;
              l > 7 && (l %= 7);
              var p = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                return t.name == s[l];
              });
              (o.color = p),
                $("#contentPanel").css("border-top-color", p[0].color),
                app.ui.tilePanel.clearTilePanel();
              var c = {
                header: app.data.getWebAppData().getThemeOptions().headerColor,
                tabText: "#d8d8d8",
                tab: "#666",
                tabTextActive: "#fff",
                tabActive: p[0].color,
                tabTextHover: "#fff",
                tabHover: "#666",
              };
              app.isGalleryCreation &&
                app.data.getStory()[0].title &&
                (g[0].title = app.data.getStory()[0].title),
                m.init(g, e.find(".nav-tabs .entry.visible").length, c, v);
              var u = app.map.getLayer(app.data.getShortlistLayerId());
              $.each(u.graphics, function (t, e) {
                e.hide();
              });
              var h = new esri.layers.GraphicsLayer(),
                b = p[0].color;
              (h.color = b),
                (app.layerCurrent = h),
                app.detailPanelBuilder.addDetailPanelSwiper(n),
                app.addFeatureBar.exitOrganizeMode(),
                app.data.setStory(n, o.title, b, a),
                app.data.getWebAppData().setTabs(app.data.getStory()),
                r(n),
                m.enableOrganize(),
                v.getTitle() && d.publish("BUILDER_INCREMENT_COUNTER");
            }
          });
      };
    }
  ),
  define(
    "storymaps/tpl/ui/desktop/MultiTips",
    [
      "dojo/dom-style",
      "dojo/dom-construct",
      "dojo/_base/lang",
      "dojo/on",
      "dojo/_base/array",
      "dojo/query",
      "dojo/dom",
      "dojo/has",
    ],
    function (t, e, i, n, a, o, r, s) {
      return function (l) {
        function d(i, r) {
          p();
          var s = n(C.map, "zoom-start", function () {
              h();
            }),
            l = n(C.map, "zoom-end", function (t) {
              _ || c(t.extent, !0);
            }),
            d = n(C.map, "pan", function (t) {
              t && (t.delta.x || t.delta.y) && (_ || u(t.extent, t.delta));
            }),
            f = n(C.map, "extent-change", function (t) {
              (t && t.delta && 0 === t.delta.x && 0 === t.delta.y) ||
                _ ||
                c(t.extent, !0);
            });
          r && (C.visible = !0),
            C.selected &&
              (C.pointArray.push(C.selected),
              C.pointArray.reverse(),
              C.selected.geometry.x == C.pointArray[1].geometry.x &&
                C.selected.geometry.y == C.pointArray[1].geometry.y &&
                C.pointArray.splice(1, 1)),
            a.forEach(C.pointArray, function (n, a) {
              e.place(
                "<div id='arrow" +
                  a +
                  "' class='mtArrow'></div><div id='multiTip" +
                  a +
                  "' class='multiTip'></div>",
                i,
                "last"
              );
              var r;
              C.selected &&
                (r =
                  C.selected.attributes.name ||
                  C.selected.attributes.Name ||
                  C.selected.attributes.NAME),
                (o("#multiTip" + a)[0].innerHTML =
                  0 === a && C.selected ? r : C.content);
              var s = $("#multiTip" + a),
                l = $("#arrow" + a);
              if (
                (0 === a && C.selected && $(s).addClass("selected"),
                0 === a && C.selected && $(l).addClass("selected"),
                t.set("multiTip" + a, {
                  backgroundColor:
                    0 === a && C.selected
                      ? app.cfg.SELECTED_POPUP_BACKGROUND_COLOR
                      : C.backgroundColor,
                  borderColor:
                    0 === a && C.selected
                      ? app.cfg.SELECTED_POPUP_BORDER_COLOR
                      : C.borderColor,
                  color: C.textColor,
                  padding: "5px",
                  position: "absolute",
                }),
                C.minWidth &&
                  t.set("multiTip" + a, "minWidth", C.minWidth + "px"),
                t.set("arrow" + a, {
                  pointerColor:
                    0 === a && C.selected
                      ? app.cfg.SELECTED_POPUP_ARROW_COLOR
                      : C.pointerColor,
                  position: "absolute",
                  width: "0px",
                  height: "0px",
                }),
                C.map.extent.contains(n.geometry))
              ) {
                g(C.map.toScreen(n.geometry), a, C);
              }
            }),
            (x = [s, l, d, f]);
        }
        function p(t) {
          (_ = !1),
            a.forEach(x, function (t) {
              t.remove();
            }),
            t
              ? (o(".multiTip").forEach(function (t) {
                  $(t).remove();
                }),
                o(".mtArrow").forEach(function (t) {
                  $(t).remove();
                }),
                (_ = !0))
              : (o(".multiTip").forEach(function (t) {
                  $(t).hasClass("selected") || $(t).remove();
                }),
                o(".mtArrow").forEach(function (t) {
                  $(t).hasClass("selected") || $(t).remove();
                }));
        }
        function c(t, e) {
          a.forEach(C.pointArray, function (i, n) {
            t.contains(i.geometry) && (m(n) || e)
              ? g(C.map.toScreen(i.geometry), n, C)
              : f(n);
          });
        }
        function u(t, e) {
          a.forEach(C.pointArray, function (i, n) {
            if (t.contains(i.geometry)) {
              var a = C.map.toScreen(i.geometry);
              (a.x += e.x), (a.y += e.y);
              g(a, n, C);
            } else f(n);
          });
        }
        function h() {
          o(".multiTip, .mtArrow").forEach(function (t) {
            $(t).hasClass("selected") || (t.style.display = "none");
          });
        }
        function f(e) {
          r.byId("multiTip" + e) &&
            "none" != t.get(r.byId("multiTip" + e), "display") &&
            (t.set(r.byId("multiTip" + e), "display", "none"),
            t.set(r.byId("arrow" + e), "display", "none"));
        }
        function m(e) {
          if (r.byId("multiTip" + e))
            return "block" == t.get(r.byId("multiTip" + e), "display");
        }
        function g(e, i, n) {
          if (r.byId("multiTip" + i)) {
            if (e.x > n.mapAuthorizedWidth || e.y > n.mapAuthorizedHeight)
              return void f(i);
            var a = 0 === i && n.selected ? 44 : n.offsetTop;
            (s("ie") > 0 || /Trident\/7\./.test(navigator.userAgent)) &&
              (a += 10);
            var o = t.get("multiTip" + i, "width"),
              l = t.get("multiTip" + i, "height");
            if (
              (8 == s("ie") && ((o -= 7), (l -= 14)),
              (o && l) ||
                (t.set(
                  r.byId("multiTip" + i),
                  "display",
                  n.visible ? "block" : "none"
                ),
                t.set(
                  r.byId("arrow" + i),
                  "display",
                  n.visible ? "block" : "none"
                ),
                (o = t.get("multiTip" + i, "width")),
                (l = t.get("multiTip" + i, "height"))),
              n.minWidth && o < n.minWidth && (o = n.minWidth),
              "auto" != n.labelDirection)
            )
              "left" == n.labelDirection
                ? w(e, i, n, o, l)
                : "right" == n.labelDirection
                ? y(e, i, n, o, l)
                : "down" == n.labelDirection
                ? b(e, i, n, o)
                : v(e, i, n, o, l, a);
            else if (
              e.x < o / 2 + 25 + n.offsetSide + n.topLeftNotAuthorizedArea[0] &&
              e.y < n.topLeftNotAuthorizedArea[1] + l
            ) {
              if (
                e.y < l - 15 ||
                (e.x < 35 + n.topLeftNotAuthorizedArea[0] &&
                  e.y < n.topLeftNotAuthorizedArea[1])
              )
                return void f(i);
              y(e, i, n, o, l);
            } else if (e.x < o / 2 + 25 + n.offsetSide) {
              if (e.y < l - 15 || e.y > n.mapAuthorizedHeight - l / 2 - 10)
                return void f(i);
              y(e, i, n, o, l);
            } else if (e.x > n.mapAuthorizedWidth - o / 2 - 10) {
              if (e.y < l - 15 || e.y > n.mapAuthorizedHeight - l / 2 - 10)
                return void f(i);
              w(e, i, n, o, l);
            } else if (e.x < n.mapAuthorizedMinWidth + o / 2) {
              if (
                e.y < l - 15 ||
                e.y > n.mapAuthorizedHeight - l / 2 - 10 ||
                e.x < n.mapAuthorizedMinWidth
              )
                return void f(i);
              y(e, i, n, o, l);
            } else e.y > l + 25 + a ? v(e, i, n, o, l, a) : b(e, i, n, o);
            t.set(
              r.byId("multiTip" + i),
              "display",
              n.visible ? "block" : "none"
            ),
              t.set(
                r.byId("arrow" + i),
                "display",
                n.visible ? "block" : "none"
              );
          }
        }
        function b(e, i, n, a) {
          t.set("multiTip" + i, {
            top: e.y + 3 + n.offsetBottom + "px",
            left: e.x - a / 2 - 5 + "px",
          }),
            t.set("arrow" + i, {
              left: e.x - 10 + "px",
              top: e.y + n.offsetBottom - 5 + "px",
              borderLeft: "10px solid transparent",
              borderRight: "10px solid transparent",
              borderBottom: "10px solid",
              borderBottomColor:
                0 === i && n.selected
                  ? app.cfg.SELECTED_POPUP_ARROW_COLOR
                  : n.pointerColor,
              borderTop: "none",
            });
        }
        function v(e, i, n, a, o, r) {
          t.set("multiTip" + i, {
            top: e.y - o - 10 - r + "px",
            left: e.x - a / 2 + 0 + "px",
          }),
            (s("ie") > 0 || /Trident\/7\./.test(navigator.userAgent)) &&
              (r -= 10),
            t.set("arrow" + i, {
              left: e.x - 10 + "px",
              top: e.y - 10 - r + "px",
              borderLeft: "10px solid transparent",
              borderRight: "10px solid transparent",
              borderTop: "10px solid",
              borderTopColor:
                0 === i && n.selected
                  ? app.cfg.SELECTED_POPUP_ARROW_COLOR
                  : n.pointerColor,
              borderBottom: "none",
            });
        }
        function y(e, i, n, a, o) {
          var r = 0 === i && n.selected ? 5 : 0,
            l = 0;
          (s("ie") > 0 || /Trident\/7\./.test(navigator.userAgent)) && (l += 5),
            t.set("arrow" + i, {
              left: e.x + 8 + n.offsetSide + "px",
              top: e.y - 26 - r + "px",
              borderTop: "10px solid transparent",
              borderBottom: "10px solid transparent",
              borderRight: "10px solid",
              borderRightColor:
                0 === i && n.selected
                  ? app.cfg.SELECTED_POPUP_ARROW_COLOR
                  : n.pointerColor,
              borderLeft: "none",
            }),
            t.set("multiTip" + i, {
              top: e.y - 22 - r - l - (o - 10) / 2 + "px",
              left: e.x + 17 + n.offsetSide + "px",
            });
        }
        function w(e, i, n, a, o) {
          var r = 0 === i && n.selected ? 5 : 0,
            l = 0,
            d = 0;
          (s("ie") > 0 || /Trident\/7\./.test(navigator.userAgent)) &&
            ((l += 5), (d += 10)),
            t.set("arrow" + i, {
              left: e.x - 18 - n.offsetSide + "px",
              top: e.y - 26 - r + "px",
              borderTop: "10px solid transparent",
              borderBottom: "10px solid transparent",
              borderLeft: "10px solid",
              borderLeftColor:
                0 === i && n.selected
                  ? app.cfg.SELECTED_POPUP_ARROW_COLOR
                  : n.pointerColor,
              borderRight: "none",
            }),
            t.set("multiTip" + i, {
              top: e.y - 22 - r - l - (o - 10) / 2 + "px",
              left: e.x - 18 - a - d - n.offsetSide + "px",
            });
        }
        var C = null,
          _ = !1,
          x = [];
        !(function (t) {
          (C = i.mixin(
            {
              pointArray: [],
              map: null,
              attributeLabelField: "",
              content: "",
              selected: !1,
              zoomToPoints: !1,
              backgroundColor: "#000000",
              borderColor: "#000000",
              pointerColor: "#000000",
              textColor: "#ffffff",
              minWidth: "",
              labelDirection: "auto",
              offsetTop: 8,
              offsetSide: 3,
              offsetBottom: 8,
              mapAuthorizedMinWidth: -1,
              mapAuthorizedWidth: -1,
              mapAuthorizedHeight: -1,
              visible: !0,
            },
            t
          )),
            -1 == t.mapAuthorizedWidth && (C.mapAuthorizedWidth = C.map.width),
            -1 == t.mapAuthorizedHeight &&
              (C.mapAuthorizedHeight = C.map.height),
            d(t.map.container);
        })(l),
          (this.current = function () {
            return C.pointArray;
          }),
          (this.clean = function (t) {
            (C = null), p(t);
          }),
          (this.hide = function () {
            (_ = !0), h();
          }),
          (this.show = function () {
            C && ((_ = !1), (C.visible = !0), c(C.map.extent, !0));
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/ui/autoplay/Autoplay",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="autoplay-container">\n\t<div class="backdrop"></div>\n\t<div class="btn-play-container status-pause">\n\t\t<span class="btn-play glyphicon glyphicon-play"></span>\n\t</div>\n\t<div class="slider-container ">\n\t\t<input type="text" class="span2" value="" />\n\t</div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/ui/autoplay/Autoplay",
    [],
    function () {}
  ),
  (function (t) {
    var e = function (e, i) {
      (this.element = t(e)),
        (this.picker = t(
          '<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div><div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>'
        )
          .insertBefore(this.element)
          .append(this.element)),
        (this.id = this.element.data("slider-id") || i.id),
        this.id && (this.picker[0].id = this.id),
        "undefined" != typeof Modernizr &&
          Modernizr.touch &&
          (this.touchCapable = !0);
      var n = this.element.data("slider-tooltip") || i.tooltip;
      switch (
        ((this.tooltip = this.picker.find(".tooltip")),
        (this.tooltipInner = this.tooltip.find("div.tooltip-inner")),
        (this.orientation =
          this.element.data("slider-orientation") || i.orientation),
        this.orientation)
      ) {
        case "vertical":
          this.picker.addClass("slider-vertical"),
            (this.stylePos = "top"),
            (this.mousePos = "pageY"),
            (this.sizePos = "offsetHeight"),
            (this.tooltip.addClass("right")[0].style.left = "100%");
          break;
        default:
          this.picker
            .addClass("slider-horizontal")
            .css("width", this.element.outerWidth()),
            (this.orientation = "horizontal"),
            (this.stylePos = "left"),
            (this.mousePos = "pageX"),
            (this.sizePos = "offsetWidth"),
            (this.tooltip.addClass("top")[0].style.top =
              -this.tooltip.outerHeight() - 14 + "px");
      }
      switch (
        ((this.min = this.element.data("slider-min") || i.min),
        (this.max = this.element.data("slider-max") || i.max),
        (this.step = this.element.data("slider-step") || i.step),
        (this.value = this.element.data("slider-value") || i.value),
        this.value[1] && (this.range = !0),
        (this.selection = this.element.data("slider-selection") || i.selection),
        (this.selectionEl = this.picker.find(".slider-selection")),
        "none" === this.selection && this.selectionEl.addClass("hide"),
        (this.selectionElStyle = this.selectionEl[0].style),
        (this.handle1 = this.picker.find(".slider-handle:first")),
        (this.handle1Stype = this.handle1[0].style),
        (this.handle2 = this.picker.find(".slider-handle:last")),
        (this.handle2Stype = this.handle2[0].style),
        this.element.data("slider-handle") || i.handle)
      ) {
        case "round":
          this.handle1.addClass("round"), this.handle2.addClass("round");
          break;
        case "triangle":
          this.handle1.addClass("triangle"), this.handle2.addClass("triangle");
      }
      this.range
        ? ((this.value[0] = Math.max(
            this.min,
            Math.min(this.max, this.value[0])
          )),
          (this.value[1] = Math.max(
            this.min,
            Math.min(this.max, this.value[1])
          )))
        : ((this.value = [Math.max(this.min, Math.min(this.max, this.value))]),
          this.handle2.addClass("hide"),
          "after" == this.selection
            ? (this.value[1] = this.max)
            : (this.value[1] = this.min)),
        (this.diff = this.max - this.min),
        (this.percentage = [
          (100 * (this.value[0] - this.min)) / this.diff,
          (100 * (this.value[1] - this.min)) / this.diff,
          (100 * this.step) / this.diff,
        ]),
        (this.offset = this.picker.offset()),
        (this.size = this.picker[0][this.sizePos]),
        (this.formater = i.formater),
        this.layout(),
        this.touchCapable
          ? this.picker.on({ touchstart: t.proxy(this.mousedown, this) })
          : this.picker.on({ mousedown: t.proxy(this.mousedown, this) }),
        "show" === n
          ? this.picker.on({
              mouseenter: t.proxy(this.showTooltip, this),
              mouseleave: t.proxy(this.hideTooltip, this),
            })
          : this.tooltip.addClass("hide");
    };
    (e.prototype = {
      constructor: e,
      over: !1,
      inDrag: !1,
      showTooltip: function () {
        this.tooltip.addClass("in"), (this.over = !0);
      },
      hideTooltip: function () {
        !1 === this.inDrag && this.tooltip.removeClass("in"), (this.over = !1);
      },
      layout: function () {
        (this.handle1Stype[this.stylePos] = this.percentage[0] + "%"),
          (this.handle2Stype[this.stylePos] = this.percentage[1] + "%"),
          "vertical" == this.orientation
            ? ((this.selectionElStyle.top =
                Math.min(this.percentage[0], this.percentage[1]) + "%"),
              (this.selectionElStyle.height =
                Math.abs(this.percentage[0] - this.percentage[1]) + "%"))
            : ((this.selectionElStyle.left =
                Math.min(this.percentage[0], this.percentage[1]) + "%"),
              (this.selectionElStyle.width =
                Math.abs(this.percentage[0] - this.percentage[1]) + "%")),
          this.range
            ? (this.tooltipInner.text(
                this.formater(this.value[0]) +
                  " : " +
                  this.formater(this.value[1])
              ),
              (this.tooltip[0].style[this.stylePos] =
                (this.size *
                  (this.percentage[0] +
                    (this.percentage[1] - this.percentage[0]) / 2)) /
                  100 -
                ("vertical" === this.orientation
                  ? this.tooltip.outerHeight() / 2
                  : this.tooltip.outerWidth() / 2) +
                "px"))
            : (this.tooltipInner.text(this.formater(this.value[0])),
              (this.tooltip[0].style[this.stylePos] =
                (this.size * this.percentage[0]) / 100 -
                ("vertical" === this.orientation
                  ? this.tooltip.outerHeight() / 2
                  : this.tooltip.outerWidth() / 2) +
                "px"));
      },
      mousedown: function (e) {
        this.touchCapable && "touchstart" === e.type && (e = e.originalEvent),
          (this.offset = this.picker.offset()),
          (this.size = this.picker[0][this.sizePos]);
        var i = this.getPercentage(e);
        if (this.range) {
          var n = Math.abs(this.percentage[0] - i),
            a = Math.abs(this.percentage[1] - i);
          this.dragged = n < a ? 0 : 1;
        } else this.dragged = 0;
        (this.percentage[this.dragged] = i),
          this.layout(),
          this.touchCapable
            ? t(document).on({
                touchmove: t.proxy(this.mousemove, this),
                touchend: t.proxy(this.mouseup, this),
              })
            : t(document).on({
                mousemove: t.proxy(this.mousemove, this),
                mouseup: t.proxy(this.mouseup, this),
              }),
          (this.inDrag = !0);
        var o = this.calculateValue();
        return (
          this.element
            .trigger({ type: "slideStart", value: o })
            .trigger({ type: "slide", value: o }),
          !1
        );
      },
      mousemove: function (t) {
        this.touchCapable && "touchmove" === t.type && (t = t.originalEvent);
        var e = this.getPercentage(t);
        this.range &&
          (0 === this.dragged && this.percentage[1] < e
            ? ((this.percentage[0] = this.percentage[1]), (this.dragged = 1))
            : 1 === this.dragged &&
              this.percentage[0] > e &&
              ((this.percentage[1] = this.percentage[0]), (this.dragged = 0))),
          (this.percentage[this.dragged] = e),
          this.layout();
        var i = this.calculateValue();
        return (
          this.element
            .trigger({ type: "slide", value: i })
            .data("value", i)
            .prop("value", i),
          !1
        );
      },
      mouseup: function (e) {
        this.touchCapable
          ? t(document).off({
              touchmove: this.mousemove,
              touchend: this.mouseup,
            })
          : t(document).off({
              mousemove: this.mousemove,
              mouseup: this.mouseup,
            }),
          (this.inDrag = !1),
          0 == this.over && this.hideTooltip(),
          this.element;
        var i = this.calculateValue();
        return (
          this.element
            .trigger({ type: "slideStop", value: i })
            .data("value", i)
            .prop("value", i),
          !1
        );
      },
      calculateValue: function () {
        var t;
        return (
          this.range
            ? ((t = [
                this.min +
                  Math.round(
                    (this.diff * this.percentage[0]) / 100 / this.step
                  ) *
                    this.step,
                this.min +
                  Math.round(
                    (this.diff * this.percentage[1]) / 100 / this.step
                  ) *
                    this.step,
              ]),
              (this.value = t))
            : ((t =
                this.min +
                Math.round((this.diff * this.percentage[0]) / 100 / this.step) *
                  this.step),
              (this.value = [t, this.value[1]])),
          t
        );
      },
      getPercentage: function (t) {
        this.touchCapable && (t = t.touches[0]);
        var e =
          (100 * (t[this.mousePos] - this.offset[this.stylePos])) / this.size;
        return (
          (e = Math.round(e / this.percentage[2]) * this.percentage[2]),
          Math.max(0, Math.min(100, e))
        );
      },
      getValue: function () {
        return this.range ? this.value : this.value[0];
      },
      setValue: function (t) {
        (this.value = t),
          this.range
            ? ((this.value[0] = Math.max(
                this.min,
                Math.min(this.max, this.value[0])
              )),
              (this.value[1] = Math.max(
                this.min,
                Math.min(this.max, this.value[1])
              )))
            : ((this.value = [
                Math.max(this.min, Math.min(this.max, this.value)),
              ]),
              this.handle2.addClass("hide"),
              "after" == this.selection
                ? (this.value[1] = this.max)
                : (this.value[1] = this.min)),
          (this.diff = this.max - this.min),
          (this.percentage = [
            (100 * (this.value[0] - this.min)) / this.diff,
            (100 * (this.value[1] - this.min)) / this.diff,
            (100 * this.step) / this.diff,
          ]),
          this.layout();
      },
    }),
      (t.fn.slider = function (i, n) {
        return this.each(function () {
          var a = t(this),
            o = a.data("slider"),
            r = "object" == typeof i && i;
          o ||
            a.data(
              "slider",
              (o = new e(this, t.extend({}, t.fn.slider.defaults, r)))
            ),
            "string" == typeof i && o[i](n);
        });
      }),
      (t.fn.slider.defaults = {
        min: 0,
        max: 10,
        step: 1,
        orientation: "horizontal",
        value: 5,
        selection: "before",
        tooltip: "show",
        handle: "round",
        formater: function (t) {
          return t;
        },
      }),
      (t.fn.slider.Constructor = e);
  })(window.jQuery),
  define("lib-app/bootstrap-slider/js/bootstrap-slider", function () {}),
  define(
    "lib-build/css!lib-app/bootstrap-slider/css/slider",
    [],
    function () {}
  ),
  define(
    "storymaps/common/ui/autoplay/Autoplay",
    [
      "lib-build/tpl!./Autoplay",
      "lib-build/css!./Autoplay",
      "dojo/topic",
      "dojo/has",
      "lib-app/bootstrap-slider/js/bootstrap-slider",
      "lib-build/css!lib-app/bootstrap-slider/css/slider",
    ],
    function (t, e, i, n) {
      var a = 10;
      return function (e, i) {
        function o(t, e) {
          console.log("Autoplay: start, delay:", t, "immediate:", e),
            (f = !0),
            m && clearTimeout(m),
            e
              ? s(t)
              : (m = setTimeout(function () {
                  s(t);
                }, t));
        }
        function r() {
          f && (console.log("Autoplay: pause"), (f = !1), m && clearTimeout(m));
        }
        function s(t) {
          (g = i()),
            (m = setTimeout(function () {
              s(t);
            }, t));
        }
        function l() {
          return e.find(".btn-play-container").hasClass("status-play");
        }
        function d(t) {
          e.find(".btn-play-container").removeClass("status-play status-pause"),
            e.find(".btn-play").removeClass("glyphicon-play glyphicon-pause"),
            e
              .find(".btn-play-container")
              .addClass(t ? "status-play" : "status-pause"),
            e
              .find(".btn-play")
              .addClass(t ? "glyphicon-pause" : "glyphicon-play");
        }
        function p() {
          var t = !l();
          t ? c(!0) : r(), d(t);
        }
        function c(t) {
          o(1e3 * (e.find(".slider input").slider("getValue").val() || a), t);
        }
        function u() {
          var t = Date.now();
          b > Date.now() - 150 && e.removeClass("fade"), (b = t);
        }
        function h() {
          !v && Date.now() > b + 6e3 && e.addClass("fade");
        }
        var f = !1,
          m = null,
          g = null,
          b = null,
          v = !1;
        (e && i && "function" == typeof i) ||
          console.log("Autoplay: failed to initialize"),
          e.append(t({})).show(),
          (function () {
            e.find(".btn-play-container").click(p),
              e.find(".slider-container input").slider({
                min: 5,
                max: 60,
                value: a,
                formater: function (t) {
                  return t + "s";
                },
              }),
              e.find(".slider-container input").on("slideStop", function () {
                l() && c(!1);
              }),
              n("touch") ||
                ((b = Date.now()),
                e.hover(
                  function () {
                    v = !0;
                  },
                  function () {
                    (v = !1), h();
                  }
                ),
                $(window).mousemove(u),
                setInterval(h, 1e3));
          })(),
          (this.init = function (t) {
            t &&
              (t.color &&
                (t.useBackdrop
                  ? (e
                      .find(".backdrop")
                      .css({ backgroundColor: t.color, display: "block" }),
                    e
                      .find(".autoplay-container")
                      .css({ backgroundColor: "inherit" }))
                  : (e
                      .find(".autoplay-container")
                      .css({ backgroundColor: t.color }),
                    ("#FFF8E9" != t.color &&
                      "#FFFFFF" != t.color &&
                      "#D4E6C3" != t.color) ||
                      (t.themeMajor = "white2"))),
              t.themeMajor && e.addClass("theme-" + t.themeMajor));
          }),
          (this.start = function () {
            c(!1), d(!0);
          }),
          (this.stop = function () {
            r(), d(!1);
          }),
          (this.onNavigationEvent = function (t) {
            l() && t != g && p();
          });
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/ui/mobile/MobileIntro", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj) __p += '<div id="mobileIntro"></div>\r\n';
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/ui/mobile/MobileIntro",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/ui/mobile/MobileIntro",
    [
      "esri/geometry/Extent",
      "lib-build/tpl!./MobileIntro",
      "lib-build/css!./MobileIntro",
      "dojo/on",
    ],
    function (t, e, i) {
      return function (i, n, a, o) {
        function r() {
          app.map.on("click", function () {
            $("#mobileIntro").css("display", "none");
          });
        }
        var s = o,
          l = this;
        (this.screenSize = "desktop"),
          (this.init = function () {
            $(i).prepend(e({}));
          }),
          (this.hide = function () {
            $("#mobileIntro").hide();
          }),
          (this.setTitle = function () {
            var t = app.data.getWebAppData().getTitle(),
              e = app.data.getWebAppData().getSubtitle();
            $("#mobileIntro").append(
              '<div class="mobileTitle">' + t + "</div>"
            ),
              app.data.getWebAppData().getSettings().header &&
              !app.data.getWebAppData().getSettings().header.compactSize
                ? ($("#mobileIntro").append(
                    '<div class="mobileSnippet"></div>'
                  ),
                  e && $(".mobileSnippet").html(e))
                : e &&
                  !app.data.getWebAppData().getSettings().header &&
                  ($("#mobileIntro").append(
                    '<div class="mobileSnippet"></div>'
                  ),
                  e && $(".mobileSnippet").html(e)),
              r();
          }),
          (this.fillList = function (t, e, i) {
            if (1 == i.length) {
              if ($("#mobileThemeList .mobileTitleTheme")[t]) return;
              $("#mobileIntro").append("<br><hr></hr>"),
                $("#mobileIntro").append(
                  '<ul id="mobileThemeList" class="mobileTileList">'
                );
              var n = $('<li class="mobileTitleTheme">').append(
                '<div class="startButton">' +
                  i18n.viewer.general.start +
                  "</div>"
              );
              n.on("click", function () {
                l.selectMobileTheme(0);
              }),
                $("#mobileThemeList").append(n);
            } else {
              if ($("#mobileThemeList .mobileTitleThemes")[t]) return;
              0 === t &&
                $("#mobileIntro").append(
                  '<ul id="mobileThemeList" style=" height: 80px; line-height: 80px;" class="mobileTileList introList">'
                );
              var n = $('<li class="mobileTitleThemes">').append(
                '<span style="width: 100%;margin-left: 30px; margin-right: 30px; vertical-align: middle; line-height: 20px; display: inline-block;">' +
                  e.title +
                  "</span>"
              );
              n.on("click", function () {
                l.selectMobileTheme(t);
              }),
                0 === t && $(n).css("border-width", "2px 0px 1px 0px"),
                t == i.length - 1 &&
                  $(n).css("border-width", "1px 0px 2px 0px"),
                $("#mobileThemeList").append(n);
            }
          }),
          (this.resizeMobileElements = function () {
            "desktop" != l.screenSize ||
              s.selected ||
              app.ui.mobileFeatureList.showMobileList(),
              setTimeout(function () {
                app.ui.detailPanel.resize();
              }, 50),
              $("#contentPanel").height($("body").height());
            var t = 0.48 * $(window).height() - 20;
            $("#mobileIntro").height(
              $("body").height() -
                (app.embedBar && app.embedBar.initiated ? 26 : 0)
            ),
              $("#map").css("height", t),
              $("#map").css({ top: 0 }),
              $("#mainStagePanel").css({ left: 0 }),
              $("#mainStagePanel").css("width", "100%"),
              $("#map").css("width", "100%"),
              $("#mainStagePanel").height($("#map").height()),
              $("#paneLeft").css("height", "52%").css("height", "+=20px");
            var e = 0.52 * $("#paneLeft").css("top");
            (e -= 20),
              $("#paneLeft").css("top", e),
              app.embedBar &&
                app.embedBar.initiated &&
                $("#mobilePaneList").css("bottom", "26px"),
              $("#mobileThemeBar")
                .css("top", "48%")
                .css("top", $("#mobileThemeBar").position().top - 20 + "px");
            var i = $(".mobileThemeTitle").length;
            $("#mobileThemeBarSlider").width($(window).width() * i),
              $("#returnHiddenBar").css("width", "100%").css("width", "-=80px");
            var n =
              0.52 * $("body").height() -
              (app.embedBar && app.embedBar.initiated ? 41 : 20);
            $("#mobilePaneList").css("height", "52%").css("height", n),
              $(".mobileTileList.blurb")
                .css("width", "100%")
                .css("width", "-=125px"),
              setTimeout(function () {
                app.ui.detailPanel.resize();
              }, 50),
              (l.screenSize = "small");
          }),
          (this.selectMobileTheme = function (e) {
            0 !== e && s.activateLayer(e),
              $("#contentPanel").css("display", "block"),
              $("#mobileIntro").css("display", "none"),
              $(window).resize(),
              app.ui.mobileFeatureList.selectTheme(e),
              (s.themeSelected = !0);
            var i = new t(app.data.getWebAppData().getMapExtent());
            102100 != app.map.spatialReference.wkid &&
            4326 != app.map.spatialReference.wkid
              ? (i = esriConfig.defaults.geometryService.project(
                  [i],
                  app.map.spatialReference,
                  function (t) {
                    (i = t[0]), app.map.setExtent(i, !0);
                  }
                ))
              : app.map.setExtent(i, !0);
          });
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/ui/mobile/MobileFeatureList",
    [],
    function () {}
  ),
  define("lib-build/css!lib-app/Swiper/swiper", [], function () {}),
  (function () {
    "use strict";
    var t,
      e = function (n, a) {
        function o(t) {
          return Math.floor(t);
        }
        function r() {
          w.autoplayTimeoutId = setTimeout(function () {
            w.params.loop
              ? (w.fixLoop(), w._slideNext(), w.emit("onAutoplay", w))
              : w.isEnd
              ? a.autoplayStopOnLast
                ? w.stopAutoplay()
                : (w._slideTo(0), w.emit("onAutoplay", w))
              : (w._slideNext(), w.emit("onAutoplay", w));
          }, w.params.autoplay);
        }
        function s(e, i) {
          var n = t(e.target);
          if (!n.is(i))
            if ("string" == typeof i) n = n.parents(i);
            else if (i.nodeType) {
              var a;
              return (
                n.parents().each(function (t, e) {
                  e === i && (a = i);
                }),
                a ? i : void 0
              );
            }
          if (0 !== n.length) return n[0];
        }
        function l(t, e) {
          e = e || {};
          var i = window.MutationObserver || window.WebkitMutationObserver,
            n = new i(function (t) {
              t.forEach(function (t) {
                w.onResize(!0), w.emit("onObserverUpdate", w, t);
              });
            });
          n.observe(t, {
            attributes: void 0 === e.attributes || e.attributes,
            childList: void 0 === e.childList || e.childList,
            characterData: void 0 === e.characterData || e.characterData,
          }),
            w.observers.push(n);
        }
        function d(t) {
          t.originalEvent && (t = t.originalEvent);
          var e = t.keyCode || t.charCode;
          if (
            !w.params.allowSwipeToNext &&
            ((w.isHorizontal() && 39 === e) || (!w.isHorizontal() && 40 === e))
          )
            return !1;
          if (
            !w.params.allowSwipeToPrev &&
            ((w.isHorizontal() && 37 === e) || (!w.isHorizontal() && 38 === e))
          )
            return !1;
          if (
            !(
              t.shiftKey ||
              t.altKey ||
              t.ctrlKey ||
              t.metaKey ||
              (document.activeElement &&
                document.activeElement.nodeName &&
                ("input" === document.activeElement.nodeName.toLowerCase() ||
                  "textarea" === document.activeElement.nodeName.toLowerCase()))
            )
          ) {
            if (37 === e || 39 === e || 38 === e || 40 === e) {
              var i = !1;
              if (
                w.container.parents(".swiper-slide").length > 0 &&
                0 === w.container.parents(".swiper-slide-active").length
              )
                return;
              var n = { left: window.pageXOffset, top: window.pageYOffset },
                a = window.innerWidth,
                o = window.innerHeight,
                r = w.container.offset();
              w.rtl && (r.left = r.left - w.container[0].scrollLeft);
              for (
                var s = [
                    [r.left, r.top],
                    [r.left + w.width, r.top],
                    [r.left, r.top + w.height],
                    [r.left + w.width, r.top + w.height],
                  ],
                  l = 0;
                l < s.length;
                l++
              ) {
                var d = s[l];
                d[0] >= n.left &&
                  d[0] <= n.left + a &&
                  d[1] >= n.top &&
                  d[1] <= n.top + o &&
                  (i = !0);
              }
              if (!i) return;
            }
            w.isHorizontal()
              ? ((37 !== e && 39 !== e) ||
                  (t.preventDefault
                    ? t.preventDefault()
                    : (t.returnValue = !1)),
                ((39 === e && !w.rtl) || (37 === e && w.rtl)) && w.slideNext(),
                ((37 === e && !w.rtl) || (39 === e && w.rtl)) && w.slidePrev())
              : ((38 !== e && 40 !== e) ||
                  (t.preventDefault
                    ? t.preventDefault()
                    : (t.returnValue = !1)),
                40 === e && w.slideNext(),
                38 === e && w.slidePrev());
          }
        }
        function p(t) {
          t.originalEvent && (t = t.originalEvent);
          var e = w.mousewheel.event,
            i = 0,
            n = w.rtl ? -1 : 1;
          if ("mousewheel" === e)
            if (w.params.mousewheelForceToAxis)
              if (w.isHorizontal()) {
                if (!(Math.abs(t.wheelDeltaX) > Math.abs(t.wheelDeltaY)))
                  return;
                i = t.wheelDeltaX * n;
              } else {
                if (!(Math.abs(t.wheelDeltaY) > Math.abs(t.wheelDeltaX)))
                  return;
                i = t.wheelDeltaY;
              }
            else
              i =
                Math.abs(t.wheelDeltaX) > Math.abs(t.wheelDeltaY)
                  ? -t.wheelDeltaX * n
                  : -t.wheelDeltaY;
          else if ("DOMMouseScroll" === e) i = -t.detail;
          else if ("wheel" === e)
            if (w.params.mousewheelForceToAxis)
              if (w.isHorizontal()) {
                if (!(Math.abs(t.deltaX) > Math.abs(t.deltaY))) return;
                i = -t.deltaX * n;
              } else {
                if (!(Math.abs(t.deltaY) > Math.abs(t.deltaX))) return;
                i = -t.deltaY;
              }
            else
              i =
                Math.abs(t.deltaX) > Math.abs(t.deltaY)
                  ? -t.deltaX * n
                  : -t.deltaY;
          if (0 !== i) {
            if ((w.params.mousewheelInvert && (i = -i), w.params.freeMode)) {
              var a =
                  w.getWrapperTranslate() + i * w.params.mousewheelSensitivity,
                o = w.isBeginning,
                r = w.isEnd;
              if (
                (a >= w.minTranslate() && (a = w.minTranslate()),
                a <= w.maxTranslate() && (a = w.maxTranslate()),
                w.setWrapperTransition(0),
                w.setWrapperTranslate(a),
                w.updateProgress(),
                w.updateActiveIndex(),
                ((!o && w.isBeginning) || (!r && w.isEnd)) && w.updateClasses(),
                w.params.freeModeSticky
                  ? (clearTimeout(w.mousewheel.timeout),
                    (w.mousewheel.timeout = setTimeout(function () {
                      w.slideReset();
                    }, 300)))
                  : w.params.lazyLoading && w.lazy && w.lazy.load(),
                0 === a || a === w.maxTranslate())
              )
                return;
            } else {
              if (
                new window.Date().getTime() - w.mousewheel.lastScrollTime >
                60
              )
                if (i < 0)
                  if ((w.isEnd && !w.params.loop) || w.animating) {
                    if (w.params.mousewheelReleaseOnEdges) return !0;
                  } else w.slideNext();
                else if ((w.isBeginning && !w.params.loop) || w.animating) {
                  if (w.params.mousewheelReleaseOnEdges) return !0;
                } else w.slidePrev();
              w.mousewheel.lastScrollTime = new window.Date().getTime();
            }
            return (
              w.params.autoplay && w.stopAutoplay(),
              t.preventDefault ? t.preventDefault() : (t.returnValue = !1),
              !1
            );
          }
        }
        function c(e, i) {
          e = t(e);
          var n,
            a,
            o,
            r = w.rtl ? -1 : 1;
          (n = e.attr("data-swiper-parallax") || "0"),
            (a = e.attr("data-swiper-parallax-x")),
            (o = e.attr("data-swiper-parallax-y")),
            a || o
              ? ((a = a || "0"), (o = o || "0"))
              : w.isHorizontal()
              ? ((a = n), (o = "0"))
              : ((o = n), (a = "0")),
            (a =
              a.indexOf("%") >= 0
                ? parseInt(a, 10) * i * r + "%"
                : a * i * r + "px"),
            (o =
              o.indexOf("%") >= 0 ? parseInt(o, 10) * i + "%" : o * i + "px"),
            e.transform("translate3d(" + a + ", " + o + ",0px)");
        }
        function u(t) {
          return (
            0 !== t.indexOf("on") &&
              (t =
                t[0] !== t[0].toUpperCase()
                  ? "on" + t[0].toUpperCase() + t.substring(1)
                  : "on" + t),
            t
          );
        }
        if (!(this instanceof e)) return new e(n, a);
        var h = {
            direction: "horizontal",
            touchEventsTarget: "container",
            initialSlide: 0,
            speed: 300,
            autoplay: !1,
            autoplayDisableOnInteraction: !0,
            autoplayStopOnLast: !1,
            iOSEdgeSwipeDetection: !1,
            iOSEdgeSwipeThreshold: 20,
            freeMode: !1,
            freeModeMomentum: !0,
            freeModeMomentumRatio: 1,
            freeModeMomentumBounce: !0,
            freeModeMomentumBounceRatio: 1,
            freeModeSticky: !1,
            freeModeMinimumVelocity: 0.02,
            autoHeight: !1,
            setWrapperSize: !1,
            virtualTranslate: !1,
            effect: "slide",
            coverflow: {
              rotate: 50,
              stretch: 0,
              depth: 100,
              modifier: 1,
              slideShadows: !0,
            },
            flip: { slideShadows: !0, limitRotation: !0 },
            cube: {
              slideShadows: !0,
              shadow: !0,
              shadowOffset: 20,
              shadowScale: 0.94,
            },
            fade: { crossFade: !1 },
            parallax: !1,
            scrollbar: null,
            scrollbarHide: !0,
            scrollbarDraggable: !1,
            scrollbarSnapOnRelease: !1,
            keyboardControl: !1,
            mousewheelControl: !1,
            mousewheelReleaseOnEdges: !1,
            mousewheelInvert: !1,
            mousewheelForceToAxis: !1,
            mousewheelSensitivity: 1,
            hashnav: !1,
            breakpoints: void 0,
            spaceBetween: 0,
            slidesPerView: 1,
            slidesPerColumn: 1,
            slidesPerColumnFill: "column",
            slidesPerGroup: 1,
            centeredSlides: !1,
            slidesOffsetBefore: 0,
            slidesOffsetAfter: 0,
            roundLengths: !1,
            touchRatio: 1,
            touchAngle: 45,
            simulateTouch: !0,
            shortSwipes: !0,
            longSwipes: !0,
            longSwipesRatio: 0.5,
            longSwipesMs: 300,
            followFinger: !0,
            onlyExternal: !1,
            threshold: 0,
            touchMoveStopPropagation: !0,
            uniqueNavElements: !0,
            pagination: null,
            paginationElement: "span",
            paginationClickable: !1,
            paginationHide: !1,
            paginationBulletRender: null,
            paginationProgressRender: null,
            paginationFractionRender: null,
            paginationCustomRender: null,
            paginationType: "bullets",
            resistance: !0,
            resistanceRatio: 0.85,
            nextButton: null,
            prevButton: null,
            watchSlidesProgress: !1,
            watchSlidesVisibility: !1,
            grabCursor: !1,
            preventClicks: !0,
            preventClicksPropagation: !0,
            slideToClickedSlide: !1,
            lazyLoading: !1,
            lazyLoadingInPrevNext: !1,
            lazyLoadingInPrevNextAmount: 1,
            lazyLoadingOnTransitionStart: !1,
            preloadImages: !0,
            updateOnImagesReady: !0,
            loop: !1,
            loopAdditionalSlides: 0,
            loopedSlides: null,
            control: void 0,
            controlInverse: !1,
            controlBy: "slide",
            allowSwipeToPrev: !0,
            allowSwipeToNext: !0,
            swipeHandler: null,
            noSwiping: !0,
            noSwipingClass: "swiper-no-swiping",
            slideClass: "swiper-slide",
            slideActiveClass: "swiper-slide-active",
            slideVisibleClass: "swiper-slide-visible",
            slideDuplicateClass: "swiper-slide-duplicate",
            slideNextClass: "swiper-slide-next",
            slidePrevClass: "swiper-slide-prev",
            wrapperClass: "swiper-wrapper",
            bulletClass: "swiper-pagination-bullet",
            bulletActiveClass: "swiper-pagination-bullet-active",
            buttonDisabledClass: "swiper-button-disabled",
            paginationCurrentClass: "swiper-pagination-current",
            paginationTotalClass: "swiper-pagination-total",
            paginationHiddenClass: "swiper-pagination-hidden",
            paginationProgressbarClass: "swiper-pagination-progressbar",
            observer: !1,
            observeParents: !1,
            a11y: !1,
            prevSlideMessage: "Previous slide",
            nextSlideMessage: "Next slide",
            firstSlideMessage: "This is the first slide",
            lastSlideMessage: "This is the last slide",
            paginationBulletMessage: "Go to slide {{index}}",
            runCallbacksOnInit: !0,
          },
          f = a && a.virtualTranslate;
        a = a || {};
        var m = {};
        for (var g in a)
          if (
            "object" != typeof a[g] ||
            null === a[g] ||
            a[g].nodeType ||
            a[g] === window ||
            a[g] === document ||
            (void 0 !== i && a[g] instanceof i) ||
            ("undefined" != typeof jQuery && a[g] instanceof jQuery)
          )
            m[g] = a[g];
          else {
            m[g] = {};
            for (var b in a[g]) m[g][b] = a[g][b];
          }
        for (var v in h)
          if (void 0 === a[v]) a[v] = h[v];
          else if ("object" == typeof a[v])
            for (var y in h[v]) void 0 === a[v][y] && (a[v][y] = h[v][y]);
        var w = this;
        if (
          ((w.params = a),
          (w.originalParams = m),
          (w.classNames = []),
          void 0 !== t && void 0 !== i && (t = i),
          (void 0 !== t ||
            (t =
              void 0 === i
                ? window.Dom7 || window.Zepto || window.jQuery
                : i)) &&
            ((w.$ = t),
            (w.currentBreakpoint = void 0),
            (w.getActiveBreakpoint = function () {
              if (!w.params.breakpoints) return !1;
              var t,
                e = !1,
                i = [];
              for (t in w.params.breakpoints)
                w.params.breakpoints.hasOwnProperty(t) && i.push(t);
              i.sort(function (t, e) {
                return parseInt(t, 10) > parseInt(e, 10);
              });
              for (var n = 0; n < i.length; n++)
                (t = i[n]) >= window.innerWidth && !e && (e = t);
              return e || "max";
            }),
            (w.setBreakpoint = function () {
              var t = w.getActiveBreakpoint();
              if (t && w.currentBreakpoint !== t) {
                var e =
                    t in w.params.breakpoints
                      ? w.params.breakpoints[t]
                      : w.originalParams,
                  i =
                    w.params.loop && e.slidesPerView !== w.params.slidesPerView;
                for (var n in e) w.params[n] = e[n];
                (w.currentBreakpoint = t), i && w.destroyLoop && w.reLoop(!0);
              }
            }),
            w.params.breakpoints && w.setBreakpoint(),
            (w.container = t(n)),
            0 !== w.container.length))
        ) {
          if (w.container.length > 1) {
            var C = [];
            return (
              w.container.each(function () {
                C.push(new e(this, a));
              }),
              C
            );
          }
          (w.container[0].swiper = w),
            w.container.data("swiper", w),
            w.classNames.push("swiper-container-" + w.params.direction),
            w.params.freeMode &&
              w.classNames.push("swiper-container-free-mode"),
            w.support.flexbox ||
              (w.classNames.push("swiper-container-no-flexbox"),
              (w.params.slidesPerColumn = 1)),
            w.params.autoHeight &&
              w.classNames.push("swiper-container-autoheight"),
            (w.params.parallax || w.params.watchSlidesVisibility) &&
              (w.params.watchSlidesProgress = !0),
            ["cube", "coverflow", "flip"].indexOf(w.params.effect) >= 0 &&
              (w.support.transforms3d
                ? ((w.params.watchSlidesProgress = !0),
                  w.classNames.push("swiper-container-3d"))
                : (w.params.effect = "slide")),
            "slide" !== w.params.effect &&
              w.classNames.push("swiper-container-" + w.params.effect),
            "cube" === w.params.effect &&
              ((w.params.resistanceRatio = 0),
              (w.params.slidesPerView = 1),
              (w.params.slidesPerColumn = 1),
              (w.params.slidesPerGroup = 1),
              (w.params.centeredSlides = !1),
              (w.params.spaceBetween = 0),
              (w.params.virtualTranslate = !0),
              (w.params.setWrapperSize = !1)),
            ("fade" !== w.params.effect && "flip" !== w.params.effect) ||
              ((w.params.slidesPerView = 1),
              (w.params.slidesPerColumn = 1),
              (w.params.slidesPerGroup = 1),
              (w.params.watchSlidesProgress = !0),
              (w.params.spaceBetween = 0),
              (w.params.setWrapperSize = !1),
              void 0 === f && (w.params.virtualTranslate = !0)),
            w.params.grabCursor &&
              w.support.touch &&
              (w.params.grabCursor = !1),
            (w.wrapper = w.container.children("." + w.params.wrapperClass)),
            w.params.pagination &&
              ((w.paginationContainer = t(w.params.pagination)),
              w.params.uniqueNavElements &&
                "string" == typeof w.params.pagination &&
                w.paginationContainer.length > 1 &&
                1 === w.container.find(w.params.pagination).length &&
                (w.paginationContainer = w.container.find(w.params.pagination)),
              "bullets" === w.params.paginationType &&
              w.params.paginationClickable
                ? w.paginationContainer.addClass("swiper-pagination-clickable")
                : (w.params.paginationClickable = !1),
              w.paginationContainer.addClass(
                "swiper-pagination-" + w.params.paginationType
              )),
            (w.params.nextButton || w.params.prevButton) &&
              (w.params.nextButton &&
                ((w.nextButton = t(w.params.nextButton)),
                w.params.uniqueNavElements &&
                  "string" == typeof w.params.nextButton &&
                  w.nextButton.length > 1 &&
                  1 === w.container.find(w.params.nextButton).length &&
                  (w.nextButton = w.container.find(w.params.nextButton))),
              w.params.prevButton &&
                ((w.prevButton = t(w.params.prevButton)),
                w.params.uniqueNavElements &&
                  "string" == typeof w.params.prevButton &&
                  w.prevButton.length > 1 &&
                  1 === w.container.find(w.params.prevButton).length &&
                  (w.prevButton = w.container.find(w.params.prevButton)))),
            (w.isHorizontal = function () {
              return "horizontal" === w.params.direction;
            }),
            (w.rtl =
              w.isHorizontal() &&
              ("rtl" === w.container[0].dir.toLowerCase() ||
                "rtl" === w.container.css("direction"))),
            w.rtl && w.classNames.push("swiper-container-rtl"),
            w.rtl && (w.wrongRTL = "-webkit-box" === w.wrapper.css("display")),
            w.params.slidesPerColumn > 1 &&
              w.classNames.push("swiper-container-multirow"),
            w.device.android && w.classNames.push("swiper-container-android"),
            w.container.addClass(w.classNames.join(" ")),
            (w.translate = 0),
            (w.progress = 0),
            (w.velocity = 0),
            (w.lockSwipeToNext = function () {
              w.params.allowSwipeToNext = !1;
            }),
            (w.lockSwipeToPrev = function () {
              w.params.allowSwipeToPrev = !1;
            }),
            (w.lockSwipes = function () {
              w.params.allowSwipeToNext = w.params.allowSwipeToPrev = !1;
            }),
            (w.unlockSwipeToNext = function () {
              w.params.allowSwipeToNext = !0;
            }),
            (w.unlockSwipeToPrev = function () {
              w.params.allowSwipeToPrev = !0;
            }),
            (w.unlockSwipes = function () {
              w.params.allowSwipeToNext = w.params.allowSwipeToPrev = !0;
            }),
            w.params.grabCursor &&
              ((w.container[0].style.cursor = "move"),
              (w.container[0].style.cursor = "-webkit-grab"),
              (w.container[0].style.cursor = "-moz-grab"),
              (w.container[0].style.cursor = "grab")),
            (w.imagesToLoad = []),
            (w.imagesLoaded = 0),
            (w.loadImage = function (t, e, i, n, a) {
              function o() {
                a && a();
              }
              var r;
              t.complete && n
                ? o()
                : e
                ? ((r = new window.Image()),
                  (r.onload = o),
                  (r.onerror = o),
                  i && (r.srcset = i),
                  e && (r.src = e))
                : o();
            }),
            (w.preloadImages = function () {
              function t() {
                void 0 !== w &&
                  null !== w &&
                  (void 0 !== w.imagesLoaded && w.imagesLoaded++,
                  w.imagesLoaded === w.imagesToLoad.length &&
                    (w.params.updateOnImagesReady && w.update(),
                    w.emit("onImagesReady", w)));
              }
              w.imagesToLoad = w.container.find("img");
              for (var e = 0; e < w.imagesToLoad.length; e++)
                w.loadImage(
                  w.imagesToLoad[e],
                  w.imagesToLoad[e].currentSrc ||
                    w.imagesToLoad[e].getAttribute("src"),
                  w.imagesToLoad[e].srcset ||
                    w.imagesToLoad[e].getAttribute("srcset"),
                  !0,
                  t
                );
            }),
            (w.autoplayTimeoutId = void 0),
            (w.autoplaying = !1),
            (w.autoplayPaused = !1),
            (w.startAutoplay = function () {
              return (
                void 0 === w.autoplayTimeoutId &&
                !!w.params.autoplay &&
                !w.autoplaying &&
                ((w.autoplaying = !0), w.emit("onAutoplayStart", w), void r())
              );
            }),
            (w.stopAutoplay = function (t) {
              w.autoplayTimeoutId &&
                (w.autoplayTimeoutId && clearTimeout(w.autoplayTimeoutId),
                (w.autoplaying = !1),
                (w.autoplayTimeoutId = void 0),
                w.emit("onAutoplayStop", w));
            }),
            (w.pauseAutoplay = function (t) {
              w.autoplayPaused ||
                (w.autoplayTimeoutId && clearTimeout(w.autoplayTimeoutId),
                (w.autoplayPaused = !0),
                0 === t
                  ? ((w.autoplayPaused = !1), r())
                  : w.wrapper.transitionEnd(function () {
                      w &&
                        ((w.autoplayPaused = !1),
                        w.autoplaying ? r() : w.stopAutoplay());
                    }));
            }),
            (w.minTranslate = function () {
              return -w.snapGrid[0];
            }),
            (w.maxTranslate = function () {
              return -w.snapGrid[w.snapGrid.length - 1];
            }),
            (w.updateAutoHeight = function () {
              var t = w.slides.eq(w.activeIndex)[0];
              if (void 0 !== t) {
                var e = t.offsetHeight;
                e && w.wrapper.css("height", e + "px");
              }
            }),
            (w.updateContainerSize = function () {
              var t, e;
              (t =
                void 0 !== w.params.width
                  ? w.params.width
                  : w.container[0].clientWidth),
                (e =
                  void 0 !== w.params.height
                    ? w.params.height
                    : w.container[0].clientHeight),
                (0 === t && w.isHorizontal()) ||
                  (0 === e && !w.isHorizontal()) ||
                  ((t =
                    t -
                    parseInt(w.container.css("padding-left"), 10) -
                    parseInt(w.container.css("padding-right"), 10)),
                  (e =
                    e -
                    parseInt(w.container.css("padding-top"), 10) -
                    parseInt(w.container.css("padding-bottom"), 10)),
                  (w.width = t),
                  (w.height = e),
                  (w.size = w.isHorizontal() ? w.width : w.height));
            }),
            (w.updateSlidesSize = function () {
              (w.slides = w.wrapper.children("." + w.params.slideClass)),
                (w.snapGrid = []),
                (w.slidesGrid = []),
                (w.slidesSizesGrid = []);
              var t,
                e = w.params.spaceBetween,
                i = -w.params.slidesOffsetBefore,
                n = 0,
                a = 0;
              if (void 0 !== w.size) {
                "string" == typeof e &&
                  e.indexOf("%") >= 0 &&
                  (e = (parseFloat(e.replace("%", "")) / 100) * w.size),
                  (w.virtualSize = -e),
                  w.rtl
                    ? w.slides.css({ marginLeft: "", marginTop: "" })
                    : w.slides.css({ marginRight: "", marginBottom: "" });
                var r;
                w.params.slidesPerColumn > 1 &&
                  ((r =
                    Math.floor(w.slides.length / w.params.slidesPerColumn) ===
                    w.slides.length / w.params.slidesPerColumn
                      ? w.slides.length
                      : Math.ceil(w.slides.length / w.params.slidesPerColumn) *
                        w.params.slidesPerColumn),
                  "auto" !== w.params.slidesPerView &&
                    "row" === w.params.slidesPerColumnFill &&
                    (r = Math.max(
                      r,
                      w.params.slidesPerView * w.params.slidesPerColumn
                    )));
                var s,
                  l = w.params.slidesPerColumn,
                  d = r / l,
                  p = d - (w.params.slidesPerColumn * d - w.slides.length);
                for (t = 0; t < w.slides.length; t++) {
                  s = 0;
                  var c = w.slides.eq(t);
                  if (w.params.slidesPerColumn > 1) {
                    var u, h, f;
                    "column" === w.params.slidesPerColumnFill
                      ? ((h = Math.floor(t / l)),
                        (f = t - h * l),
                        (h > p || (h === p && f === l - 1)) &&
                          ++f >= l &&
                          ((f = 0), h++),
                        (u = h + (f * r) / l),
                        c.css({
                          "-webkit-box-ordinal-group": u,
                          "-moz-box-ordinal-group": u,
                          "-ms-flex-order": u,
                          "-webkit-order": u,
                          order: u,
                        }))
                      : ((f = Math.floor(t / d)), (h = t - f * d)),
                      c
                        .css({
                          "margin-top":
                            0 !== f &&
                            w.params.spaceBetween &&
                            w.params.spaceBetween + "px",
                        })
                        .attr("data-swiper-column", h)
                        .attr("data-swiper-row", f);
                  }
                  "none" !== c.css("display") &&
                    ("auto" === w.params.slidesPerView
                      ? ((s = w.isHorizontal()
                          ? c.outerWidth(!0)
                          : c.outerHeight(!0)),
                        w.params.roundLengths && (s = o(s)))
                      : ((s =
                          (w.size - (w.params.slidesPerView - 1) * e) /
                          w.params.slidesPerView),
                        w.params.roundLengths && (s = o(s)),
                        w.isHorizontal()
                          ? (w.slides[t].style.width = s + "px")
                          : (w.slides[t].style.height = s + "px")),
                    (w.slides[t].swiperSlideSize = s),
                    w.slidesSizesGrid.push(s),
                    w.params.centeredSlides
                      ? ((i = i + s / 2 + n / 2 + e),
                        0 === t && (i = i - w.size / 2 - e),
                        Math.abs(i) < 0.001 && (i = 0),
                        a % w.params.slidesPerGroup == 0 && w.snapGrid.push(i),
                        w.slidesGrid.push(i))
                      : (a % w.params.slidesPerGroup == 0 && w.snapGrid.push(i),
                        w.slidesGrid.push(i),
                        (i = i + s + e)),
                    (w.virtualSize += s + e),
                    (n = s),
                    a++);
                }
                w.virtualSize =
                  Math.max(w.virtualSize, w.size) + w.params.slidesOffsetAfter;
                var m;
                if (
                  (w.rtl &&
                    w.wrongRTL &&
                    ("slide" === w.params.effect ||
                      "coverflow" === w.params.effect) &&
                    w.wrapper.css({
                      width: w.virtualSize + w.params.spaceBetween + "px",
                    }),
                  (w.support.flexbox && !w.params.setWrapperSize) ||
                    (w.isHorizontal()
                      ? w.wrapper.css({
                          width: w.virtualSize + w.params.spaceBetween + "px",
                        })
                      : w.wrapper.css({
                          height: w.virtualSize + w.params.spaceBetween + "px",
                        })),
                  w.params.slidesPerColumn > 1 &&
                    ((w.virtualSize = (s + w.params.spaceBetween) * r),
                    (w.virtualSize =
                      Math.ceil(w.virtualSize / w.params.slidesPerColumn) -
                      w.params.spaceBetween),
                    w.wrapper.css({
                      width: w.virtualSize + w.params.spaceBetween + "px",
                    }),
                    w.params.centeredSlides))
                ) {
                  for (m = [], t = 0; t < w.snapGrid.length; t++)
                    w.snapGrid[t] < w.virtualSize + w.snapGrid[0] &&
                      m.push(w.snapGrid[t]);
                  w.snapGrid = m;
                }
                if (!w.params.centeredSlides) {
                  for (m = [], t = 0; t < w.snapGrid.length; t++)
                    w.snapGrid[t] <= w.virtualSize - w.size &&
                      m.push(w.snapGrid[t]);
                  (w.snapGrid = m),
                    Math.floor(w.virtualSize - w.size) -
                      Math.floor(w.snapGrid[w.snapGrid.length - 1]) >
                      1 && w.snapGrid.push(w.virtualSize - w.size);
                }
                0 === w.snapGrid.length && (w.snapGrid = [0]),
                  0 !== w.params.spaceBetween &&
                    (w.isHorizontal()
                      ? w.rtl
                        ? w.slides.css({ marginLeft: e + "px" })
                        : w.slides.css({ marginRight: e + "px" })
                      : w.slides.css({ marginBottom: e + "px" })),
                  w.params.watchSlidesProgress && w.updateSlidesOffset();
              }
            }),
            (w.updateSlidesOffset = function () {
              for (var t = 0; t < w.slides.length; t++)
                w.slides[t].swiperSlideOffset = w.isHorizontal()
                  ? w.slides[t].offsetLeft
                  : w.slides[t].offsetTop;
            }),
            (w.updateSlidesProgress = function (t) {
              if (
                (void 0 === t && (t = w.translate || 0), 0 !== w.slides.length)
              ) {
                void 0 === w.slides[0].swiperSlideOffset &&
                  w.updateSlidesOffset();
                var e = -t;
                w.rtl && (e = t),
                  w.slides.removeClass(w.params.slideVisibleClass);
                for (var i = 0; i < w.slides.length; i++) {
                  var n = w.slides[i],
                    a =
                      (e - n.swiperSlideOffset) /
                      (n.swiperSlideSize + w.params.spaceBetween);
                  if (w.params.watchSlidesVisibility) {
                    var o = -(e - n.swiperSlideOffset),
                      r = o + w.slidesSizesGrid[i];
                    ((o >= 0 && o < w.size) ||
                      (r > 0 && r <= w.size) ||
                      (o <= 0 && r >= w.size)) &&
                      w.slides.eq(i).addClass(w.params.slideVisibleClass);
                  }
                  n.progress = w.rtl ? -a : a;
                }
              }
            }),
            (w.updateProgress = function (t) {
              void 0 === t && (t = w.translate || 0);
              var e = w.maxTranslate() - w.minTranslate(),
                i = w.isBeginning,
                n = w.isEnd;
              0 === e
                ? ((w.progress = 0), (w.isBeginning = w.isEnd = !0))
                : ((w.progress = (t - w.minTranslate()) / e),
                  (w.isBeginning = w.progress <= 0),
                  (w.isEnd = w.progress >= 1)),
                w.isBeginning && !i && w.emit("onReachBeginning", w),
                w.isEnd && !n && w.emit("onReachEnd", w),
                w.params.watchSlidesProgress && w.updateSlidesProgress(t),
                w.emit("onProgress", w, w.progress);
            }),
            (w.updateActiveIndex = function () {
              var t,
                e,
                i,
                n = w.rtl ? w.translate : -w.translate;
              for (e = 0; e < w.slidesGrid.length; e++)
                void 0 !== w.slidesGrid[e + 1]
                  ? n >= w.slidesGrid[e] &&
                    n <
                      w.slidesGrid[e + 1] -
                        (w.slidesGrid[e + 1] - w.slidesGrid[e]) / 2
                    ? (t = e)
                    : n >= w.slidesGrid[e] &&
                      n < w.slidesGrid[e + 1] &&
                      (t = e + 1)
                  : n >= w.slidesGrid[e] && (t = e);
              (t < 0 || void 0 === t) && (t = 0),
                (i = Math.floor(t / w.params.slidesPerGroup)),
                i >= w.snapGrid.length && (i = w.snapGrid.length - 1),
                t !== w.activeIndex &&
                  ((w.snapIndex = i),
                  (w.previousIndex = w.activeIndex),
                  (w.activeIndex = t),
                  w.updateClasses());
            }),
            (w.updateClasses = function () {
              w.slides.removeClass(
                w.params.slideActiveClass +
                  " " +
                  w.params.slideNextClass +
                  " " +
                  w.params.slidePrevClass
              );
              var e = w.slides.eq(w.activeIndex);
              e.addClass(w.params.slideActiveClass);
              var i = e
                .next("." + w.params.slideClass)
                .addClass(w.params.slideNextClass);
              w.params.loop &&
                0 === i.length &&
                w.slides.eq(0).addClass(w.params.slideNextClass);
              var n = e
                .prev("." + w.params.slideClass)
                .addClass(w.params.slidePrevClass);
              if (
                (w.params.loop &&
                  0 === n.length &&
                  w.slides.eq(-1).addClass(w.params.slidePrevClass),
                w.paginationContainer && w.paginationContainer.length > 0)
              ) {
                var a,
                  o = w.params.loop
                    ? Math.ceil(
                        (w.slides.length - 2 * w.loopedSlides) /
                          w.params.slidesPerGroup
                      )
                    : w.snapGrid.length;
                if (
                  (w.params.loop
                    ? ((a = Math.ceil(
                        (w.activeIndex - w.loopedSlides) /
                          w.params.slidesPerGroup
                      )),
                      a > w.slides.length - 1 - 2 * w.loopedSlides &&
                        (a -= w.slides.length - 2 * w.loopedSlides),
                      a > o - 1 && (a -= o),
                      a < 0 &&
                        "bullets" !== w.params.paginationType &&
                        (a = o + a))
                    : (a =
                        void 0 !== w.snapIndex
                          ? w.snapIndex
                          : w.activeIndex || 0),
                  "bullets" === w.params.paginationType &&
                    w.bullets &&
                    w.bullets.length > 0 &&
                    (w.bullets.removeClass(w.params.bulletActiveClass),
                    w.paginationContainer.length > 1
                      ? w.bullets.each(function () {
                          t(this).index() === a &&
                            t(this).addClass(w.params.bulletActiveClass);
                        })
                      : w.bullets.eq(a).addClass(w.params.bulletActiveClass)),
                  "fraction" === w.params.paginationType &&
                    (w.paginationContainer
                      .find("." + w.params.paginationCurrentClass)
                      .text(a + 1),
                    w.paginationContainer
                      .find("." + w.params.paginationTotalClass)
                      .text(o)),
                  "progress" === w.params.paginationType)
                ) {
                  var r = (a + 1) / o,
                    s = r,
                    l = 1;
                  w.isHorizontal() || ((l = r), (s = 1)),
                    w.paginationContainer
                      .find("." + w.params.paginationProgressbarClass)
                      .transform(
                        "translate3d(0,0,0) scaleX(" + s + ") scaleY(" + l + ")"
                      )
                      .transition(w.params.speed);
                }
                "custom" === w.params.paginationType &&
                  w.params.paginationCustomRender &&
                  (w.paginationContainer.html(
                    w.params.paginationCustomRender(w, a + 1, o)
                  ),
                  w.emit("onPaginationRendered", w, w.paginationContainer[0]));
              }
              w.params.loop ||
                (w.params.prevButton &&
                  w.prevButton &&
                  w.prevButton.length > 0 &&
                  (w.isBeginning
                    ? (w.prevButton.addClass(w.params.buttonDisabledClass),
                      w.params.a11y && w.a11y && w.a11y.disable(w.prevButton))
                    : (w.prevButton.removeClass(w.params.buttonDisabledClass),
                      w.params.a11y && w.a11y && w.a11y.enable(w.prevButton))),
                w.params.nextButton &&
                  w.nextButton &&
                  w.nextButton.length > 0 &&
                  (w.isEnd
                    ? (w.nextButton.addClass(w.params.buttonDisabledClass),
                      w.params.a11y && w.a11y && w.a11y.disable(w.nextButton))
                    : (w.nextButton.removeClass(w.params.buttonDisabledClass),
                      w.params.a11y && w.a11y && w.a11y.enable(w.nextButton))));
            }),
            (w.updatePagination = function () {
              if (
                w.params.pagination &&
                w.paginationContainer &&
                w.paginationContainer.length > 0
              ) {
                var t = "";
                if ("bullets" === w.params.paginationType) {
                  for (
                    var e = w.params.loop
                        ? Math.ceil(
                            (w.slides.length - 2 * w.loopedSlides) /
                              w.params.slidesPerGroup
                          )
                        : w.snapGrid.length,
                      i = 0;
                    i < e;
                    i++
                  )
                    w.params.paginationBulletRender
                      ? (t += w.params.paginationBulletRender(
                          i,
                          w.params.bulletClass
                        ))
                      : (t +=
                          "<" +
                          w.params.paginationElement +
                          ' class="' +
                          w.params.bulletClass +
                          '"></' +
                          w.params.paginationElement +
                          ">");
                  w.paginationContainer.html(t),
                    (w.bullets = w.paginationContainer.find(
                      "." + w.params.bulletClass
                    )),
                    w.params.paginationClickable &&
                      w.params.a11y &&
                      w.a11y &&
                      w.a11y.initPagination();
                }
                "fraction" === w.params.paginationType &&
                  ((t = w.params.paginationFractionRender
                    ? w.params.paginationFractionRender(
                        w,
                        w.params.paginationCurrentClass,
                        w.params.paginationTotalClass
                      )
                    : '<span class="' +
                      w.params.paginationCurrentClass +
                      '"></span> / <span class="' +
                      w.params.paginationTotalClass +
                      '"></span>'),
                  w.paginationContainer.html(t)),
                  "progress" === w.params.paginationType &&
                    ((t = w.params.paginationProgressRender
                      ? w.params.paginationProgressRender(
                          w,
                          w.params.paginationProgressbarClass
                        )
                      : '<span class="' +
                        w.params.paginationProgressbarClass +
                        '"></span>'),
                    w.paginationContainer.html(t)),
                  "custom" !== w.params.paginationType &&
                    w.emit("onPaginationRendered", w, w.paginationContainer[0]);
              }
            }),
            (w.update = function (t) {
              function e() {
                (i = Math.min(
                  Math.max(w.translate, w.maxTranslate()),
                  w.minTranslate()
                )),
                  w.setWrapperTranslate(i),
                  w.updateActiveIndex(),
                  w.updateClasses();
              }
              if (
                (w.updateContainerSize(),
                w.updateSlidesSize(),
                w.updateProgress(),
                w.updatePagination(),
                w.updateClasses(),
                w.params.scrollbar && w.scrollbar && w.scrollbar.set(),
                t)
              ) {
                var i;
                w.controller &&
                  w.controller.spline &&
                  (w.controller.spline = void 0),
                  w.params.freeMode
                    ? (e(), w.params.autoHeight && w.updateAutoHeight())
                    : (("auto" === w.params.slidesPerView ||
                        w.params.slidesPerView > 1) &&
                      w.isEnd &&
                      !w.params.centeredSlides
                        ? w.slideTo(w.slides.length - 1, 0, !1, !0)
                        : w.slideTo(w.activeIndex, 0, !1, !0)) || e();
              } else w.params.autoHeight && w.updateAutoHeight();
            }),
            (w.onResize = function (t) {
              w.params.breakpoints && w.setBreakpoint();
              var e = w.params.allowSwipeToPrev,
                i = w.params.allowSwipeToNext;
              (w.params.allowSwipeToPrev = w.params.allowSwipeToNext = !0),
                w.updateContainerSize(),
                w.updateSlidesSize(),
                ("auto" === w.params.slidesPerView || w.params.freeMode || t) &&
                  w.updatePagination(),
                w.params.scrollbar && w.scrollbar && w.scrollbar.set(),
                w.controller &&
                  w.controller.spline &&
                  (w.controller.spline = void 0);
              var n = !1;
              if (w.params.freeMode) {
                var a = Math.min(
                  Math.max(w.translate, w.maxTranslate()),
                  w.minTranslate()
                );
                w.setWrapperTranslate(a),
                  w.updateActiveIndex(),
                  w.updateClasses(),
                  w.params.autoHeight && w.updateAutoHeight();
              } else
                w.updateClasses(),
                  (n =
                    ("auto" === w.params.slidesPerView ||
                      w.params.slidesPerView > 1) &&
                    w.isEnd &&
                    !w.params.centeredSlides
                      ? w.slideTo(w.slides.length - 1, 0, !1, !0)
                      : w.slideTo(w.activeIndex, 0, !1, !0));
              w.params.lazyLoading && !n && w.lazy && w.lazy.load(),
                (w.params.allowSwipeToPrev = e),
                (w.params.allowSwipeToNext = i);
            });
          var _ = ["mousedown", "mousemove", "mouseup"];
          window.navigator.pointerEnabled
            ? (_ = ["pointerdown", "pointermove", "pointerup"])
            : window.navigator.msPointerEnabled &&
              (_ = ["MSPointerDown", "MSPointerMove", "MSPointerUp"]),
            (w.touchEvents = {
              start:
                w.support.touch || !w.params.simulateTouch
                  ? "touchstart"
                  : _[0],
              move:
                w.support.touch || !w.params.simulateTouch ? "touchmove" : _[1],
              end:
                w.support.touch || !w.params.simulateTouch ? "touchend" : _[2],
            }),
            (window.navigator.pointerEnabled ||
              window.navigator.msPointerEnabled) &&
              ("container" === w.params.touchEventsTarget
                ? w.container
                : w.wrapper
              ).addClass("swiper-wp8-" + w.params.direction),
            (w.initEvents = function (t) {
              var e = t ? "off" : "on",
                i = t ? "removeEventListener" : "addEventListener",
                n =
                  "container" === w.params.touchEventsTarget
                    ? w.container[0]
                    : w.wrapper[0],
                o = w.support.touch ? n : document,
                r = !!w.params.nested;
              w.browser.ie
                ? (n[i](w.touchEvents.start, w.onTouchStart, !1),
                  o[i](w.touchEvents.move, w.onTouchMove, r),
                  o[i](w.touchEvents.end, w.onTouchEnd, !1))
                : (w.support.touch &&
                    (n[i](w.touchEvents.start, w.onTouchStart, !1),
                    n[i](w.touchEvents.move, w.onTouchMove, r),
                    n[i](w.touchEvents.end, w.onTouchEnd, !1)),
                  !a.simulateTouch ||
                    w.device.ios ||
                    w.device.android ||
                    (n[i]("mousedown", w.onTouchStart, !1),
                    document[i]("mousemove", w.onTouchMove, r),
                    document[i]("mouseup", w.onTouchEnd, !1))),
                window[i]("resize", w.onResize),
                w.params.nextButton &&
                  w.nextButton &&
                  w.nextButton.length > 0 &&
                  (w.nextButton[e]("click", w.onClickNext),
                  w.params.a11y &&
                    w.a11y &&
                    w.nextButton[e]("keydown", w.a11y.onEnterKey)),
                w.params.prevButton &&
                  w.prevButton &&
                  w.prevButton.length > 0 &&
                  (w.prevButton[e]("click", w.onClickPrev),
                  w.params.a11y &&
                    w.a11y &&
                    w.prevButton[e]("keydown", w.a11y.onEnterKey)),
                w.params.pagination &&
                  w.params.paginationClickable &&
                  (w.paginationContainer[e](
                    "click",
                    "." + w.params.bulletClass,
                    w.onClickIndex
                  ),
                  w.params.a11y &&
                    w.a11y &&
                    w.paginationContainer[e](
                      "keydown",
                      "." + w.params.bulletClass,
                      w.a11y.onEnterKey
                    )),
                (w.params.preventClicks || w.params.preventClicksPropagation) &&
                  n[i]("click", w.preventClicks, !0);
            }),
            (w.attachEvents = function () {
              w.initEvents();
            }),
            (w.detachEvents = function () {
              w.initEvents(!0);
            }),
            (w.allowClick = !0),
            (w.preventClicks = function (t) {
              w.allowClick ||
                (w.params.preventClicks && t.preventDefault(),
                w.params.preventClicksPropagation &&
                  w.animating &&
                  (t.stopPropagation(), t.stopImmediatePropagation()));
            }),
            (w.onClickNext = function (t) {
              t.preventDefault(), (w.isEnd && !w.params.loop) || w.slideNext();
            }),
            (w.onClickPrev = function (t) {
              t.preventDefault(),
                (w.isBeginning && !w.params.loop) || w.slidePrev();
            }),
            (w.onClickIndex = function (e) {
              e.preventDefault();
              var i = t(this).index() * w.params.slidesPerGroup;
              w.params.loop && (i += w.loopedSlides), w.slideTo(i);
            }),
            (w.updateClickedSlide = function (e) {
              var i = s(e, "." + w.params.slideClass),
                n = !1;
              if (i)
                for (var a = 0; a < w.slides.length; a++)
                  w.slides[a] === i && (n = !0);
              if (!i || !n)
                return (
                  (w.clickedSlide = void 0), void (w.clickedIndex = void 0)
                );
              if (
                ((w.clickedSlide = i),
                (w.clickedIndex = t(i).index()),
                w.params.slideToClickedSlide &&
                  void 0 !== w.clickedIndex &&
                  w.clickedIndex !== w.activeIndex)
              ) {
                var o,
                  r = w.clickedIndex;
                if (w.params.loop) {
                  if (w.animating) return;
                  (o = t(w.clickedSlide).attr("data-swiper-slide-index")),
                    w.params.centeredSlides
                      ? r < w.loopedSlides - w.params.slidesPerView / 2 ||
                        r >
                          w.slides.length -
                            w.loopedSlides +
                            w.params.slidesPerView / 2
                        ? (w.fixLoop(),
                          (r = w.wrapper
                            .children(
                              "." +
                                w.params.slideClass +
                                '[data-swiper-slide-index="' +
                                o +
                                '"]:not(.swiper-slide-duplicate)'
                            )
                            .eq(0)
                            .index()),
                          setTimeout(function () {
                            w.slideTo(r);
                          }, 0))
                        : w.slideTo(r)
                      : r > w.slides.length - w.params.slidesPerView
                      ? (w.fixLoop(),
                        (r = w.wrapper
                          .children(
                            "." +
                              w.params.slideClass +
                              '[data-swiper-slide-index="' +
                              o +
                              '"]:not(.swiper-slide-duplicate)'
                          )
                          .eq(0)
                          .index()),
                        setTimeout(function () {
                          w.slideTo(r);
                        }, 0))
                      : w.slideTo(r);
                } else w.slideTo(r);
              }
            });
          var x,
            S,
            T,
            k,
            E,
            A,
            I,
            L,
            P,
            D,
            $ = "input, select, textarea, button",
            M = Date.now(),
            O = [];
          (w.animating = !1),
            (w.touches = {
              startX: 0,
              startY: 0,
              currentX: 0,
              currentY: 0,
              diff: 0,
            });
          var R, N;
          if (
            ((w.onTouchStart = function (e) {
              if (
                (e.originalEvent && (e = e.originalEvent),
                (R = "touchstart" === e.type) ||
                  !("which" in e) ||
                  3 !== e.which)
              ) {
                if (w.params.noSwiping && s(e, "." + w.params.noSwipingClass))
                  return void (w.allowClick = !0);
                if (!w.params.swipeHandler || s(e, w.params.swipeHandler)) {
                  var i = (w.touches.currentX =
                      "touchstart" === e.type
                        ? e.targetTouches[0].pageX
                        : e.pageX),
                    n = (w.touches.currentY =
                      "touchstart" === e.type
                        ? e.targetTouches[0].pageY
                        : e.pageY);
                  if (
                    !(
                      w.device.ios &&
                      w.params.iOSEdgeSwipeDetection &&
                      i <= w.params.iOSEdgeSwipeThreshold
                    )
                  ) {
                    if (
                      ((x = !0),
                      (S = !1),
                      (T = !0),
                      (E = void 0),
                      (N = void 0),
                      (w.touches.startX = i),
                      (w.touches.startY = n),
                      (k = Date.now()),
                      (w.allowClick = !0),
                      w.updateContainerSize(),
                      (w.swipeDirection = void 0),
                      w.params.threshold > 0 && (L = !1),
                      "touchstart" !== e.type)
                    ) {
                      var a = !0;
                      t(e.target).is($) && (a = !1),
                        document.activeElement &&
                          t(document.activeElement).is($) &&
                          document.activeElement.blur(),
                        a && e.preventDefault();
                    }
                    w.emit("onTouchStart", w, e);
                  }
                }
              }
            }),
            (w.onTouchMove = function (e) {
              if (
                (e.originalEvent && (e = e.originalEvent),
                !R || "mousemove" !== e.type)
              ) {
                if (e.preventedByNestedSwiper)
                  return (
                    (w.touches.startX =
                      "touchmove" === e.type
                        ? e.targetTouches[0].pageX
                        : e.pageX),
                    void (w.touches.startY =
                      "touchmove" === e.type
                        ? e.targetTouches[0].pageY
                        : e.pageY)
                  );
                if (w.params.onlyExternal)
                  return (
                    (w.allowClick = !1),
                    void (
                      x &&
                      ((w.touches.startX = w.touches.currentX =
                        "touchmove" === e.type
                          ? e.targetTouches[0].pageX
                          : e.pageX),
                      (w.touches.startY = w.touches.currentY =
                        "touchmove" === e.type
                          ? e.targetTouches[0].pageY
                          : e.pageY),
                      (k = Date.now()))
                    )
                  );
                if (
                  R &&
                  document.activeElement &&
                  e.target === document.activeElement &&
                  t(e.target).is($)
                )
                  return (S = !0), void (w.allowClick = !1);
                if (
                  (T && w.emit("onTouchMove", w, e),
                  !(e.targetTouches && e.targetTouches.length > 1))
                ) {
                  if (
                    ((w.touches.currentX =
                      "touchmove" === e.type
                        ? e.targetTouches[0].pageX
                        : e.pageX),
                    (w.touches.currentY =
                      "touchmove" === e.type
                        ? e.targetTouches[0].pageY
                        : e.pageY),
                    void 0 === E)
                  ) {
                    var i =
                      (180 *
                        Math.atan2(
                          Math.abs(w.touches.currentY - w.touches.startY),
                          Math.abs(w.touches.currentX - w.touches.startX)
                        )) /
                      Math.PI;
                    E = w.isHorizontal()
                      ? i > w.params.touchAngle
                      : 90 - i > w.params.touchAngle;
                  }
                  if (
                    (E && w.emit("onTouchMoveOpposite", w, e),
                    void 0 === N &&
                      w.browser.ieTouch &&
                      ((w.touches.currentX === w.touches.startX &&
                        w.touches.currentY === w.touches.startY) ||
                        (N = !0)),
                    x)
                  ) {
                    if (E) return void (x = !1);
                    if (N || !w.browser.ieTouch) {
                      (w.allowClick = !1),
                        w.emit("onSliderMove", w, e),
                        e.preventDefault(),
                        w.params.touchMoveStopPropagation &&
                          !w.params.nested &&
                          e.stopPropagation(),
                        S ||
                          (a.loop && w.fixLoop(),
                          (I = w.getWrapperTranslate()),
                          w.setWrapperTransition(0),
                          w.animating &&
                            w.wrapper.trigger(
                              "webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"
                            ),
                          w.params.autoplay &&
                            w.autoplaying &&
                            (w.params.autoplayDisableOnInteraction
                              ? w.stopAutoplay()
                              : w.pauseAutoplay()),
                          (D = !1),
                          w.params.grabCursor &&
                            ((w.container[0].style.cursor = "move"),
                            (w.container[0].style.cursor = "-webkit-grabbing"),
                            (w.container[0].style.cursor = "-moz-grabbin"),
                            (w.container[0].style.cursor = "grabbing"))),
                        (S = !0);
                      var n = (w.touches.diff = w.isHorizontal()
                        ? w.touches.currentX - w.touches.startX
                        : w.touches.currentY - w.touches.startY);
                      (n *= w.params.touchRatio),
                        w.rtl && (n = -n),
                        (w.swipeDirection = n > 0 ? "prev" : "next"),
                        (A = n + I);
                      var o = !0;
                      if (
                        (n > 0 && A > w.minTranslate()
                          ? ((o = !1),
                            w.params.resistance &&
                              (A =
                                w.minTranslate() -
                                1 +
                                Math.pow(
                                  -w.minTranslate() + I + n,
                                  w.params.resistanceRatio
                                )))
                          : n < 0 &&
                            A < w.maxTranslate() &&
                            ((o = !1),
                            w.params.resistance &&
                              (A =
                                w.maxTranslate() +
                                1 -
                                Math.pow(
                                  w.maxTranslate() - I - n,
                                  w.params.resistanceRatio
                                ))),
                        o && (e.preventedByNestedSwiper = !0),
                        !w.params.allowSwipeToNext &&
                          "next" === w.swipeDirection &&
                          A < I &&
                          (A = I),
                        !w.params.allowSwipeToPrev &&
                          "prev" === w.swipeDirection &&
                          A > I &&
                          (A = I),
                        w.params.followFinger)
                      ) {
                        if (w.params.threshold > 0) {
                          if (!(Math.abs(n) > w.params.threshold || L))
                            return void (A = I);
                          if (!L)
                            return (
                              (L = !0),
                              (w.touches.startX = w.touches.currentX),
                              (w.touches.startY = w.touches.currentY),
                              (A = I),
                              void (w.touches.diff = w.isHorizontal()
                                ? w.touches.currentX - w.touches.startX
                                : w.touches.currentY - w.touches.startY)
                            );
                        }
                        (w.params.freeMode || w.params.watchSlidesProgress) &&
                          w.updateActiveIndex(),
                          w.params.freeMode &&
                            (0 === O.length &&
                              O.push({
                                position:
                                  w.touches[
                                    w.isHorizontal() ? "startX" : "startY"
                                  ],
                                time: k,
                              }),
                            O.push({
                              position:
                                w.touches[
                                  w.isHorizontal() ? "currentX" : "currentY"
                                ],
                              time: new window.Date().getTime(),
                            })),
                          w.updateProgress(A),
                          w.setWrapperTranslate(A);
                      }
                    }
                  }
                }
              }
            }),
            (w.onTouchEnd = function (e) {
              if (
                (e.originalEvent && (e = e.originalEvent),
                T && w.emit("onTouchEnd", w, e),
                (T = !1),
                x)
              ) {
                w.params.grabCursor &&
                  S &&
                  x &&
                  ((w.container[0].style.cursor = "move"),
                  (w.container[0].style.cursor = "-webkit-grab"),
                  (w.container[0].style.cursor = "-moz-grab"),
                  (w.container[0].style.cursor = "grab"));
                var i = Date.now(),
                  n = i - k;
                if (
                  (w.allowClick &&
                    (w.updateClickedSlide(e),
                    w.emit("onTap", w, e),
                    n < 300 &&
                      i - M > 300 &&
                      (P && clearTimeout(P),
                      (P = setTimeout(function () {
                        w &&
                          (w.params.paginationHide &&
                            w.paginationContainer.length > 0 &&
                            !t(e.target).hasClass(w.params.bulletClass) &&
                            w.paginationContainer.toggleClass(
                              w.params.paginationHiddenClass
                            ),
                          w.emit("onClick", w, e));
                      }, 300))),
                    n < 300 &&
                      i - M < 300 &&
                      (P && clearTimeout(P), w.emit("onDoubleTap", w, e))),
                  (M = Date.now()),
                  setTimeout(function () {
                    w && (w.allowClick = !0);
                  }, 0),
                  !x ||
                    !S ||
                    !w.swipeDirection ||
                    0 === w.touches.diff ||
                    A === I)
                )
                  return void (x = S = !1);
                x = S = !1;
                var a;
                if (
                  ((a = w.params.followFinger
                    ? w.rtl
                      ? w.translate
                      : -w.translate
                    : -A),
                  w.params.freeMode)
                ) {
                  if (a < -w.minTranslate())
                    return void w.slideTo(w.activeIndex);
                  if (a > -w.maxTranslate())
                    return void (w.slides.length < w.snapGrid.length
                      ? w.slideTo(w.snapGrid.length - 1)
                      : w.slideTo(w.slides.length - 1));
                  if (w.params.freeModeMomentum) {
                    if (O.length > 1) {
                      var o = O.pop(),
                        r = O.pop(),
                        s = o.position - r.position,
                        l = o.time - r.time;
                      (w.velocity = s / l),
                        (w.velocity = w.velocity / 2),
                        Math.abs(w.velocity) <
                          w.params.freeModeMinimumVelocity && (w.velocity = 0),
                        (l > 150 ||
                          new window.Date().getTime() - o.time > 300) &&
                          (w.velocity = 0);
                    } else w.velocity = 0;
                    O.length = 0;
                    var d = 1e3 * w.params.freeModeMomentumRatio,
                      p = w.velocity * d,
                      c = w.translate + p;
                    w.rtl && (c = -c);
                    var u,
                      h = !1,
                      f =
                        20 *
                        Math.abs(w.velocity) *
                        w.params.freeModeMomentumBounceRatio;
                    if (c < w.maxTranslate())
                      w.params.freeModeMomentumBounce
                        ? (c + w.maxTranslate() < -f &&
                            (c = w.maxTranslate() - f),
                          (u = w.maxTranslate()),
                          (h = !0),
                          (D = !0))
                        : (c = w.maxTranslate());
                    else if (c > w.minTranslate())
                      w.params.freeModeMomentumBounce
                        ? (c - w.minTranslate() > f &&
                            (c = w.minTranslate() + f),
                          (u = w.minTranslate()),
                          (h = !0),
                          (D = !0))
                        : (c = w.minTranslate());
                    else if (w.params.freeModeSticky) {
                      var m,
                        g = 0;
                      for (g = 0; g < w.snapGrid.length; g += 1)
                        if (w.snapGrid[g] > -c) {
                          m = g;
                          break;
                        }
                      (c =
                        Math.abs(w.snapGrid[m] - c) <
                          Math.abs(w.snapGrid[m - 1] - c) ||
                        "next" === w.swipeDirection
                          ? w.snapGrid[m]
                          : w.snapGrid[m - 1]),
                        w.rtl || (c = -c);
                    }
                    if (0 !== w.velocity)
                      d = w.rtl
                        ? Math.abs((-c - w.translate) / w.velocity)
                        : Math.abs((c - w.translate) / w.velocity);
                    else if (w.params.freeModeSticky)
                      return void w.slideReset();
                    w.params.freeModeMomentumBounce && h
                      ? (w.updateProgress(u),
                        w.setWrapperTransition(d),
                        w.setWrapperTranslate(c),
                        w.onTransitionStart(),
                        (w.animating = !0),
                        w.wrapper.transitionEnd(function () {
                          w &&
                            D &&
                            (w.emit("onMomentumBounce", w),
                            w.setWrapperTransition(w.params.speed),
                            w.setWrapperTranslate(u),
                            w.wrapper.transitionEnd(function () {
                              w && w.onTransitionEnd();
                            }));
                        }))
                      : w.velocity
                      ? (w.updateProgress(c),
                        w.setWrapperTransition(d),
                        w.setWrapperTranslate(c),
                        w.onTransitionStart(),
                        w.animating ||
                          ((w.animating = !0),
                          w.wrapper.transitionEnd(function () {
                            w && w.onTransitionEnd();
                          })))
                      : w.updateProgress(c),
                      w.updateActiveIndex();
                  }
                  return void (
                    (!w.params.freeModeMomentum ||
                      n >= w.params.longSwipesMs) &&
                    (w.updateProgress(), w.updateActiveIndex())
                  );
                }
                var b,
                  v = 0,
                  y = w.slidesSizesGrid[0];
                for (
                  b = 0;
                  b < w.slidesGrid.length;
                  b += w.params.slidesPerGroup
                )
                  void 0 !== w.slidesGrid[b + w.params.slidesPerGroup]
                    ? a >= w.slidesGrid[b] &&
                      a < w.slidesGrid[b + w.params.slidesPerGroup] &&
                      ((v = b),
                      (y =
                        w.slidesGrid[b + w.params.slidesPerGroup] -
                        w.slidesGrid[b]))
                    : a >= w.slidesGrid[b] &&
                      ((v = b),
                      (y =
                        w.slidesGrid[w.slidesGrid.length - 1] -
                        w.slidesGrid[w.slidesGrid.length - 2]));
                var C = (a - w.slidesGrid[v]) / y;
                if (n > w.params.longSwipesMs) {
                  if (!w.params.longSwipes)
                    return void w.slideTo(w.activeIndex);
                  "next" === w.swipeDirection &&
                    (C >= w.params.longSwipesRatio
                      ? w.slideTo(v + w.params.slidesPerGroup)
                      : w.slideTo(v)),
                    "prev" === w.swipeDirection &&
                      (C > 1 - w.params.longSwipesRatio
                        ? w.slideTo(v + w.params.slidesPerGroup)
                        : w.slideTo(v));
                } else {
                  if (!w.params.shortSwipes)
                    return void w.slideTo(w.activeIndex);
                  "next" === w.swipeDirection &&
                    w.slideTo(v + w.params.slidesPerGroup),
                    "prev" === w.swipeDirection && w.slideTo(v);
                }
              }
            }),
            (w._slideTo = function (t, e) {
              return w.slideTo(t, e, !0, !0);
            }),
            (w.slideTo = function (t, e, i, n) {
              void 0 === i && (i = !0),
                void 0 === t && (t = 0),
                t < 0 && (t = 0),
                (w.snapIndex = Math.floor(t / w.params.slidesPerGroup)),
                w.snapIndex >= w.snapGrid.length &&
                  (w.snapIndex = w.snapGrid.length - 1);
              var a = -w.snapGrid[w.snapIndex];
              w.params.autoplay &&
                w.autoplaying &&
                (n || !w.params.autoplayDisableOnInteraction
                  ? w.pauseAutoplay(e)
                  : w.stopAutoplay()),
                w.updateProgress(a);
              for (var o = 0; o < w.slidesGrid.length; o++)
                -Math.floor(100 * a) >= Math.floor(100 * w.slidesGrid[o]) &&
                  (t = o);
              return (
                !(
                  !w.params.allowSwipeToNext &&
                  a < w.translate &&
                  a < w.minTranslate()
                ) &&
                !(
                  !w.params.allowSwipeToPrev &&
                  a > w.translate &&
                  a > w.maxTranslate() &&
                  (w.activeIndex || 0) !== t
                ) &&
                (void 0 === e && (e = w.params.speed),
                (w.previousIndex = w.activeIndex || 0),
                (w.activeIndex = t),
                (w.rtl && -a === w.translate) || (!w.rtl && a === w.translate)
                  ? (w.params.autoHeight && w.updateAutoHeight(),
                    w.updateClasses(),
                    "slide" !== w.params.effect && w.setWrapperTranslate(a),
                    !1)
                  : (w.updateClasses(),
                    w.onTransitionStart(i),
                    0 === e
                      ? (w.setWrapperTranslate(a),
                        w.setWrapperTransition(0),
                        w.onTransitionEnd(i))
                      : (w.setWrapperTranslate(a),
                        w.setWrapperTransition(e),
                        w.animating ||
                          ((w.animating = !0),
                          w.wrapper.transitionEnd(function () {
                            w && w.onTransitionEnd(i);
                          }))),
                    !0))
              );
            }),
            (w.onTransitionStart = function (t) {
              void 0 === t && (t = !0),
                w.params.autoHeight && w.updateAutoHeight(),
                w.lazy && w.lazy.onTransitionStart(),
                t &&
                  (w.emit("onTransitionStart", w),
                  w.activeIndex !== w.previousIndex &&
                    (w.emit("onSlideChangeStart", w),
                    w.activeIndex > w.previousIndex
                      ? w.emit("onSlideNextStart", w)
                      : w.emit("onSlidePrevStart", w)));
            }),
            (w.onTransitionEnd = function (t) {
              (w.animating = !1),
                w.setWrapperTransition(0),
                void 0 === t && (t = !0),
                w.lazy && w.lazy.onTransitionEnd(),
                t &&
                  (w.emit("onTransitionEnd", w),
                  w.activeIndex !== w.previousIndex &&
                    (w.emit("onSlideChangeEnd", w),
                    w.activeIndex > w.previousIndex
                      ? w.emit("onSlideNextEnd", w)
                      : w.emit("onSlidePrevEnd", w))),
                w.params.hashnav && w.hashnav && w.hashnav.setHash();
            }),
            (w.slideNext = function (t, e, i) {
              if (w.params.loop) {
                if (w.animating) return !1;
                w.fixLoop();
                w.container[0].clientLeft;
                return w.slideTo(
                  w.activeIndex + w.params.slidesPerGroup,
                  e,
                  t,
                  i
                );
              }
              return w.slideTo(
                w.activeIndex + w.params.slidesPerGroup,
                e,
                t,
                i
              );
            }),
            (w._slideNext = function (t) {
              return w.slideNext(!0, t, !0);
            }),
            (w.slidePrev = function (t, e, i) {
              if (w.params.loop) {
                if (w.animating) return !1;
                w.fixLoop();
                w.container[0].clientLeft;
                return w.slideTo(w.activeIndex - 1, e, t, i);
              }
              return w.slideTo(w.activeIndex - 1, e, t, i);
            }),
            (w._slidePrev = function (t) {
              return w.slidePrev(!0, t, !0);
            }),
            (w.slideReset = function (t, e, i) {
              return w.slideTo(w.activeIndex, e, t);
            }),
            (w.setWrapperTransition = function (t, e) {
              w.wrapper.transition(t),
                "slide" !== w.params.effect &&
                  w.effects[w.params.effect] &&
                  w.effects[w.params.effect].setTransition(t),
                w.params.parallax && w.parallax && w.parallax.setTransition(t),
                w.params.scrollbar &&
                  w.scrollbar &&
                  w.scrollbar.setTransition(t),
                w.params.control &&
                  w.controller &&
                  w.controller.setTransition(t, e),
                w.emit("onSetTransition", w, t);
            }),
            (w.setWrapperTranslate = function (t, e, i) {
              var n = 0,
                a = 0;
              w.isHorizontal() ? (n = w.rtl ? -t : t) : (a = t),
                w.params.roundLengths && ((n = o(n)), (a = o(a))),
                w.params.virtualTranslate ||
                  (w.support.transforms3d
                    ? w.wrapper.transform(
                        "translate3d(" + n + "px, " + a + "px, 0px)"
                      )
                    : w.wrapper.transform(
                        "translate(" + n + "px, " + a + "px)"
                      )),
                (w.translate = w.isHorizontal() ? n : a);
              var r,
                s = w.maxTranslate() - w.minTranslate();
              (r = 0 === s ? 0 : (t - w.minTranslate()) / s),
                r !== w.progress && w.updateProgress(t),
                e && w.updateActiveIndex(),
                "slide" !== w.params.effect &&
                  w.effects[w.params.effect] &&
                  w.effects[w.params.effect].setTranslate(w.translate),
                w.params.parallax &&
                  w.parallax &&
                  w.parallax.setTranslate(w.translate),
                w.params.scrollbar &&
                  w.scrollbar &&
                  w.scrollbar.setTranslate(w.translate),
                w.params.control &&
                  w.controller &&
                  w.controller.setTranslate(w.translate, i),
                w.emit("onSetTranslate", w, w.translate);
            }),
            (w.getTranslate = function (t, e) {
              var i, n, a, o;
              return (
                void 0 === e && (e = "x"),
                w.params.virtualTranslate
                  ? w.rtl
                    ? -w.translate
                    : w.translate
                  : ((a = window.getComputedStyle(t, null)),
                    window.WebKitCSSMatrix
                      ? ((n = a.transform || a.webkitTransform),
                        n.split(",").length > 6 &&
                          (n = n
                            .split(", ")
                            .map(function (t) {
                              return t.replace(",", ".");
                            })
                            .join(", ")),
                        (o = new window.WebKitCSSMatrix("none" === n ? "" : n)))
                      : ((o =
                          a.MozTransform ||
                          a.OTransform ||
                          a.MsTransform ||
                          a.msTransform ||
                          a.transform ||
                          a
                            .getPropertyValue("transform")
                            .replace("translate(", "matrix(1, 0, 0, 1,")),
                        (i = o.toString().split(","))),
                    "x" === e &&
                      (n = window.WebKitCSSMatrix
                        ? o.m41
                        : 16 === i.length
                        ? parseFloat(i[12])
                        : parseFloat(i[4])),
                    "y" === e &&
                      (n = window.WebKitCSSMatrix
                        ? o.m42
                        : 16 === i.length
                        ? parseFloat(i[13])
                        : parseFloat(i[5])),
                    w.rtl && n && (n = -n),
                    n || 0)
              );
            }),
            (w.getWrapperTranslate = function (t) {
              return (
                void 0 === t && (t = w.isHorizontal() ? "x" : "y"),
                w.getTranslate(w.wrapper[0], t)
              );
            }),
            (w.observers = []),
            (w.initObservers = function () {
              if (w.params.observeParents)
                for (var t = w.container.parents(), e = 0; e < t.length; e++)
                  l(t[e]);
              l(w.container[0], { childList: !1 }),
                l(w.wrapper[0], { attributes: !1 });
            }),
            (w.disconnectObservers = function () {
              for (var t = 0; t < w.observers.length; t++)
                w.observers[t].disconnect();
              w.observers = [];
            }),
            (w.createLoop = function () {
              w.wrapper
                .children(
                  "." + w.params.slideClass + "." + w.params.slideDuplicateClass
                )
                .remove();
              var e = w.wrapper.children("." + w.params.slideClass);
              "auto" !== w.params.slidesPerView ||
                w.params.loopedSlides ||
                (w.params.loopedSlides = e.length),
                (w.loopedSlides = parseInt(
                  w.params.loopedSlides || w.params.slidesPerView,
                  10
                )),
                (w.loopedSlides =
                  w.loopedSlides + w.params.loopAdditionalSlides),
                w.loopedSlides > e.length && (w.loopedSlides = e.length);
              var i,
                n = [],
                a = [];
              for (
                e.each(function (i, o) {
                  var r = t(this);
                  i < w.loopedSlides && a.push(o),
                    i < e.length && i >= e.length - w.loopedSlides && n.push(o),
                    r.attr("data-swiper-slide-index", i);
                }),
                  i = 0;
                i < a.length;
                i++
              )
                w.wrapper.append(
                  t(a[i].cloneNode(!0)).addClass(w.params.slideDuplicateClass)
                );
              for (i = n.length - 1; i >= 0; i--)
                w.wrapper.prepend(
                  t(n[i].cloneNode(!0)).addClass(w.params.slideDuplicateClass)
                );
            }),
            (w.destroyLoop = function () {
              w.wrapper
                .children(
                  "." + w.params.slideClass + "." + w.params.slideDuplicateClass
                )
                .remove(),
                w.slides.removeAttr("data-swiper-slide-index");
            }),
            (w.reLoop = function (t) {
              var e = w.activeIndex - w.loopedSlides;
              w.destroyLoop(),
                w.createLoop(),
                w.updateSlidesSize(),
                t && w.slideTo(e + w.loopedSlides, 0, !1);
            }),
            (w.fixLoop = function () {
              var t;
              w.activeIndex < w.loopedSlides
                ? ((t = w.slides.length - 3 * w.loopedSlides + w.activeIndex),
                  (t += w.loopedSlides),
                  w.slideTo(t, 0, !1, !0))
                : (("auto" === w.params.slidesPerView &&
                    w.activeIndex >= 2 * w.loopedSlides) ||
                    w.activeIndex >
                      w.slides.length - 2 * w.params.slidesPerView) &&
                  ((t = -w.slides.length + w.activeIndex + w.loopedSlides),
                  (t += w.loopedSlides),
                  w.slideTo(t, 0, !1, !0));
            }),
            (w.appendSlide = function (t) {
              if (
                (w.params.loop && w.destroyLoop(),
                "object" == typeof t && t.length)
              )
                for (var e = 0; e < t.length; e++)
                  t[e] && w.wrapper.append(t[e]);
              else w.wrapper.append(t);
              w.params.loop && w.createLoop(),
                (w.params.observer && w.support.observer) || w.update(!0);
            }),
            (w.prependSlide = function (t) {
              w.params.loop && w.destroyLoop();
              var e = w.activeIndex + 1;
              if ("object" == typeof t && t.length) {
                for (var i = 0; i < t.length; i++)
                  t[i] && w.wrapper.prepend(t[i]);
                e = w.activeIndex + t.length;
              } else w.wrapper.prepend(t);
              w.params.loop && w.createLoop(),
                (w.params.observer && w.support.observer) || w.update(!0),
                w.slideTo(e, 0, !1);
            }),
            (w.removeSlide = function (t) {
              w.params.loop &&
                (w.destroyLoop(),
                (w.slides = w.wrapper.children("." + w.params.slideClass)));
              var e,
                i = w.activeIndex;
              if ("object" == typeof t && t.length) {
                for (var n = 0; n < t.length; n++)
                  (e = t[n]),
                    w.slides[e] && w.slides.eq(e).remove(),
                    e < i && i--;
                i = Math.max(i, 0);
              } else
                (e = t),
                  w.slides[e] && w.slides.eq(e).remove(),
                  e < i && i--,
                  (i = Math.max(i, 0));
              w.params.loop && w.createLoop(),
                (w.params.observer && w.support.observer) || w.update(!0),
                w.params.loop
                  ? w.slideTo(i + w.loopedSlides, 0, !1)
                  : w.slideTo(i, 0, !1);
            }),
            (w.removeAllSlides = function () {
              for (var t = [], e = 0; e < w.slides.length; e++) t.push(e);
              w.removeSlide(t);
            }),
            (w.effects = {
              fade: {
                setTranslate: function () {
                  for (var t = 0; t < w.slides.length; t++) {
                    var e = w.slides.eq(t),
                      i = e[0].swiperSlideOffset,
                      n = -i;
                    w.params.virtualTranslate || (n -= w.translate);
                    var a = 0;
                    w.isHorizontal() || ((a = n), (n = 0));
                    var o = w.params.fade.crossFade
                      ? Math.max(1 - Math.abs(e[0].progress), 0)
                      : 1 + Math.min(Math.max(e[0].progress, -1), 0);
                    e.css({ opacity: o }).transform(
                      "translate3d(" + n + "px, " + a + "px, 0px)"
                    );
                  }
                },
                setTransition: function (t) {
                  if (
                    (w.slides.transition(t),
                    w.params.virtualTranslate && 0 !== t)
                  ) {
                    var e = !1;
                    w.slides.transitionEnd(function () {
                      if (!e && w) {
                        (e = !0), (w.animating = !1);
                        for (
                          var t = [
                              "webkitTransitionEnd",
                              "transitionend",
                              "oTransitionEnd",
                              "MSTransitionEnd",
                              "msTransitionEnd",
                            ],
                            i = 0;
                          i < t.length;
                          i++
                        )
                          w.wrapper.trigger(t[i]);
                      }
                    });
                  }
                },
              },
              flip: {
                setTranslate: function () {
                  for (var e = 0; e < w.slides.length; e++) {
                    var i = w.slides.eq(e),
                      n = i[0].progress;
                    w.params.flip.limitRotation &&
                      (n = Math.max(Math.min(i[0].progress, 1), -1));
                    var a = i[0].swiperSlideOffset,
                      o = -180 * n,
                      r = o,
                      s = 0,
                      l = -a,
                      d = 0;
                    if (
                      (w.isHorizontal()
                        ? w.rtl && (r = -r)
                        : ((d = l), (l = 0), (s = -r), (r = 0)),
                      (i[0].style.zIndex =
                        -Math.abs(Math.round(n)) + w.slides.length),
                      w.params.flip.slideShadows)
                    ) {
                      var p = w.isHorizontal()
                          ? i.find(".swiper-slide-shadow-left")
                          : i.find(".swiper-slide-shadow-top"),
                        c = w.isHorizontal()
                          ? i.find(".swiper-slide-shadow-right")
                          : i.find(".swiper-slide-shadow-bottom");
                      0 === p.length &&
                        ((p = t(
                          '<div class="swiper-slide-shadow-' +
                            (w.isHorizontal() ? "left" : "top") +
                            '"></div>'
                        )),
                        i.append(p)),
                        0 === c.length &&
                          ((c = t(
                            '<div class="swiper-slide-shadow-' +
                              (w.isHorizontal() ? "right" : "bottom") +
                              '"></div>'
                          )),
                          i.append(c)),
                        p.length && (p[0].style.opacity = Math.max(-n, 0)),
                        c.length && (c[0].style.opacity = Math.max(n, 0));
                    }
                    i.transform(
                      "translate3d(" +
                        l +
                        "px, " +
                        d +
                        "px, 0px) rotateX(" +
                        s +
                        "deg) rotateY(" +
                        r +
                        "deg)"
                    );
                  }
                },
                setTransition: function (e) {
                  if (
                    (w.slides
                      .transition(e)
                      .find(
                        ".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left"
                      )
                      .transition(e),
                    w.params.virtualTranslate && 0 !== e)
                  ) {
                    var i = !1;
                    w.slides.eq(w.activeIndex).transitionEnd(function () {
                      if (
                        !i &&
                        w &&
                        t(this).hasClass(w.params.slideActiveClass)
                      ) {
                        (i = !0), (w.animating = !1);
                        for (
                          var e = [
                              "webkitTransitionEnd",
                              "transitionend",
                              "oTransitionEnd",
                              "MSTransitionEnd",
                              "msTransitionEnd",
                            ],
                            n = 0;
                          n < e.length;
                          n++
                        )
                          w.wrapper.trigger(e[n]);
                      }
                    });
                  }
                },
              },
              cube: {
                setTranslate: function () {
                  var e,
                    i = 0;
                  w.params.cube.shadow &&
                    (w.isHorizontal()
                      ? ((e = w.wrapper.find(".swiper-cube-shadow")),
                        0 === e.length &&
                          ((e = t('<div class="swiper-cube-shadow"></div>')),
                          w.wrapper.append(e)),
                        e.css({ height: w.width + "px" }))
                      : ((e = w.container.find(".swiper-cube-shadow")),
                        0 === e.length &&
                          ((e = t('<div class="swiper-cube-shadow"></div>')),
                          w.container.append(e))));
                  for (var n = 0; n < w.slides.length; n++) {
                    var a = w.slides.eq(n),
                      o = 90 * n,
                      r = Math.floor(o / 360);
                    w.rtl && ((o = -o), (r = Math.floor(-o / 360)));
                    var s = Math.max(Math.min(a[0].progress, 1), -1),
                      l = 0,
                      d = 0,
                      p = 0;
                    n % 4 == 0
                      ? ((l = 4 * -r * w.size), (p = 0))
                      : (n - 1) % 4 == 0
                      ? ((l = 0), (p = 4 * -r * w.size))
                      : (n - 2) % 4 == 0
                      ? ((l = w.size + 4 * r * w.size), (p = w.size))
                      : (n - 3) % 4 == 0 &&
                        ((l = -w.size), (p = 3 * w.size + 4 * w.size * r)),
                      w.rtl && (l = -l),
                      w.isHorizontal() || ((d = l), (l = 0));
                    var c =
                      "rotateX(" +
                      (w.isHorizontal() ? 0 : -o) +
                      "deg) rotateY(" +
                      (w.isHorizontal() ? o : 0) +
                      "deg) translate3d(" +
                      l +
                      "px, " +
                      d +
                      "px, " +
                      p +
                      "px)";
                    if (
                      (s <= 1 &&
                        s > -1 &&
                        ((i = 90 * n + 90 * s),
                        w.rtl && (i = 90 * -n - 90 * s)),
                      a.transform(c),
                      w.params.cube.slideShadows)
                    ) {
                      var u = w.isHorizontal()
                          ? a.find(".swiper-slide-shadow-left")
                          : a.find(".swiper-slide-shadow-top"),
                        h = w.isHorizontal()
                          ? a.find(".swiper-slide-shadow-right")
                          : a.find(".swiper-slide-shadow-bottom");
                      0 === u.length &&
                        ((u = t(
                          '<div class="swiper-slide-shadow-' +
                            (w.isHorizontal() ? "left" : "top") +
                            '"></div>'
                        )),
                        a.append(u)),
                        0 === h.length &&
                          ((h = t(
                            '<div class="swiper-slide-shadow-' +
                              (w.isHorizontal() ? "right" : "bottom") +
                              '"></div>'
                          )),
                          a.append(h)),
                        u.length && (u[0].style.opacity = Math.max(-s, 0)),
                        h.length && (h[0].style.opacity = Math.max(s, 0));
                    }
                  }
                  if (
                    (w.wrapper.css({
                      "-webkit-transform-origin":
                        "50% 50% -" + w.size / 2 + "px",
                      "-moz-transform-origin": "50% 50% -" + w.size / 2 + "px",
                      "-ms-transform-origin": "50% 50% -" + w.size / 2 + "px",
                      "transform-origin": "50% 50% -" + w.size / 2 + "px",
                    }),
                    w.params.cube.shadow)
                  )
                    if (w.isHorizontal())
                      e.transform(
                        "translate3d(0px, " +
                          (w.width / 2 + w.params.cube.shadowOffset) +
                          "px, " +
                          -w.width / 2 +
                          "px) rotateX(90deg) rotateZ(0deg) scale(" +
                          w.params.cube.shadowScale +
                          ")"
                      );
                    else {
                      var f = Math.abs(i) - 90 * Math.floor(Math.abs(i) / 90),
                        m =
                          1.5 -
                          (Math.sin((2 * f * Math.PI) / 360) / 2 +
                            Math.cos((2 * f * Math.PI) / 360) / 2),
                        g = w.params.cube.shadowScale,
                        b = w.params.cube.shadowScale / m,
                        v = w.params.cube.shadowOffset;
                      e.transform(
                        "scale3d(" +
                          g +
                          ", 1, " +
                          b +
                          ") translate3d(0px, " +
                          (w.height / 2 + v) +
                          "px, " +
                          -w.height / 2 / b +
                          "px) rotateX(-90deg)"
                      );
                    }
                  var y = w.isSafari || w.isUiWebView ? -w.size / 2 : 0;
                  w.wrapper.transform(
                    "translate3d(0px,0," +
                      y +
                      "px) rotateX(" +
                      (w.isHorizontal() ? 0 : i) +
                      "deg) rotateY(" +
                      (w.isHorizontal() ? -i : 0) +
                      "deg)"
                  );
                },
                setTransition: function (t) {
                  w.slides
                    .transition(t)
                    .find(
                      ".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left"
                    )
                    .transition(t),
                    w.params.cube.shadow &&
                      !w.isHorizontal() &&
                      w.container.find(".swiper-cube-shadow").transition(t);
                },
              },
              coverflow: {
                setTranslate: function () {
                  for (
                    var e = w.translate,
                      i = w.isHorizontal()
                        ? -e + w.width / 2
                        : -e + w.height / 2,
                      n = w.isHorizontal()
                        ? w.params.coverflow.rotate
                        : -w.params.coverflow.rotate,
                      a = w.params.coverflow.depth,
                      o = 0,
                      r = w.slides.length;
                    o < r;
                    o++
                  ) {
                    var s = w.slides.eq(o),
                      l = w.slidesSizesGrid[o],
                      d = s[0].swiperSlideOffset,
                      p = ((i - d - l / 2) / l) * w.params.coverflow.modifier,
                      c = w.isHorizontal() ? n * p : 0,
                      u = w.isHorizontal() ? 0 : n * p,
                      h = -a * Math.abs(p),
                      f = w.isHorizontal() ? 0 : w.params.coverflow.stretch * p,
                      m = w.isHorizontal() ? w.params.coverflow.stretch * p : 0;
                    Math.abs(m) < 0.001 && (m = 0),
                      Math.abs(f) < 0.001 && (f = 0),
                      Math.abs(h) < 0.001 && (h = 0),
                      Math.abs(c) < 0.001 && (c = 0),
                      Math.abs(u) < 0.001 && (u = 0);
                    var g =
                      "translate3d(" +
                      m +
                      "px," +
                      f +
                      "px," +
                      h +
                      "px)  rotateX(" +
                      u +
                      "deg) rotateY(" +
                      c +
                      "deg)";
                    if (
                      (s.transform(g),
                      (s[0].style.zIndex = 1 - Math.abs(Math.round(p))),
                      w.params.coverflow.slideShadows)
                    ) {
                      var b = w.isHorizontal()
                          ? s.find(".swiper-slide-shadow-left")
                          : s.find(".swiper-slide-shadow-top"),
                        v = w.isHorizontal()
                          ? s.find(".swiper-slide-shadow-right")
                          : s.find(".swiper-slide-shadow-bottom");
                      0 === b.length &&
                        ((b = t(
                          '<div class="swiper-slide-shadow-' +
                            (w.isHorizontal() ? "left" : "top") +
                            '"></div>'
                        )),
                        s.append(b)),
                        0 === v.length &&
                          ((v = t(
                            '<div class="swiper-slide-shadow-' +
                              (w.isHorizontal() ? "right" : "bottom") +
                              '"></div>'
                          )),
                          s.append(v)),
                        b.length && (b[0].style.opacity = p > 0 ? p : 0),
                        v.length && (v[0].style.opacity = -p > 0 ? -p : 0);
                    }
                  }
                  if (w.browser.ie) {
                    w.wrapper[0].style.perspectiveOrigin = i + "px 50%";
                  }
                },
                setTransition: function (t) {
                  w.slides
                    .transition(t)
                    .find(
                      ".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left"
                    )
                    .transition(t);
                },
              },
            }),
            (w.lazy = {
              initialImageLoaded: !1,
              loadImageInSlide: function (e, i) {
                if (
                  void 0 !== e &&
                  (void 0 === i && (i = !0), 0 !== w.slides.length)
                ) {
                  var n = w.slides.eq(e),
                    a = n.find(
                      ".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)"
                    );
                  !n.hasClass("swiper-lazy") ||
                    n.hasClass("swiper-lazy-loaded") ||
                    n.hasClass("swiper-lazy-loading") ||
                    (a = a.add(n[0])),
                    0 !== a.length &&
                      a.each(function () {
                        var e = t(this);
                        e.addClass("swiper-lazy-loading");
                        var a = e.attr("data-background"),
                          o = e.attr("data-src"),
                          r = e.attr("data-srcset");
                        w.loadImage(e[0], o || a, r, !1, function () {
                          if (
                            (a
                              ? (e.css("background-image", 'url("' + a + '")'),
                                e.removeAttr("data-background"))
                              : (r &&
                                  (e.attr("srcset", r),
                                  e.removeAttr("data-srcset")),
                                o &&
                                  (e.attr("src", o), e.removeAttr("data-src"))),
                            e
                              .addClass("swiper-lazy-loaded")
                              .removeClass("swiper-lazy-loading"),
                            n
                              .find(".swiper-lazy-preloader, .preloader")
                              .remove(),
                            w.params.loop && i)
                          ) {
                            var t = n.attr("data-swiper-slide-index");
                            if (n.hasClass(w.params.slideDuplicateClass)) {
                              var s = w.wrapper.children(
                                '[data-swiper-slide-index="' +
                                  t +
                                  '"]:not(.' +
                                  w.params.slideDuplicateClass +
                                  ")"
                              );
                              w.lazy.loadImageInSlide(s.index(), !1);
                            } else {
                              var l = w.wrapper.children(
                                "." +
                                  w.params.slideDuplicateClass +
                                  '[data-swiper-slide-index="' +
                                  t +
                                  '"]'
                              );
                              w.lazy.loadImageInSlide(l.index(), !1);
                            }
                          }
                          w.emit("onLazyImageReady", w, n[0], e[0]);
                        }),
                          w.emit("onLazyImageLoad", w, n[0], e[0]);
                      });
                }
              },
              load: function () {
                var e;
                if (w.params.watchSlidesVisibility)
                  w.wrapper
                    .children("." + w.params.slideVisibleClass)
                    .each(function () {
                      w.lazy.loadImageInSlide(t(this).index());
                    });
                else if (w.params.slidesPerView > 1)
                  for (
                    e = w.activeIndex;
                    e < w.activeIndex + w.params.slidesPerView;
                    e++
                  )
                    w.slides[e] && w.lazy.loadImageInSlide(e);
                else w.lazy.loadImageInSlide(w.activeIndex);
                if (w.params.lazyLoadingInPrevNext)
                  if (
                    w.params.slidesPerView > 1 ||
                    (w.params.lazyLoadingInPrevNextAmount &&
                      w.params.lazyLoadingInPrevNextAmount > 1)
                  ) {
                    var i = w.params.lazyLoadingInPrevNextAmount,
                      n = w.params.slidesPerView,
                      a = Math.min(
                        w.activeIndex + n + Math.max(i, n),
                        w.slides.length
                      ),
                      o = Math.max(w.activeIndex - Math.max(n, i), 0);
                    for (e = w.activeIndex + w.params.slidesPerView; e < a; e++)
                      w.slides[e] && w.lazy.loadImageInSlide(e);
                    for (e = o; e < w.activeIndex; e++)
                      w.slides[e] && w.lazy.loadImageInSlide(e);
                  } else {
                    var r = w.wrapper.children("." + w.params.slideNextClass);
                    r.length > 0 && w.lazy.loadImageInSlide(r.index());
                    var s = w.wrapper.children("." + w.params.slidePrevClass);
                    s.length > 0 && w.lazy.loadImageInSlide(s.index());
                  }
              },
              onTransitionStart: function () {
                w.params.lazyLoading &&
                  (w.params.lazyLoadingOnTransitionStart ||
                    (!w.params.lazyLoadingOnTransitionStart &&
                      !w.lazy.initialImageLoaded)) &&
                  w.lazy.load();
              },
              onTransitionEnd: function () {
                w.params.lazyLoading &&
                  !w.params.lazyLoadingOnTransitionStart &&
                  w.lazy.load();
              },
            }),
            (w.scrollbar = {
              isTouched: !1,
              setDragPosition: function (t) {
                var e = w.scrollbar,
                  i = w.isHorizontal()
                    ? "touchstart" === t.type || "touchmove" === t.type
                      ? t.targetTouches[0].pageX
                      : t.pageX || t.clientX
                    : "touchstart" === t.type || "touchmove" === t.type
                    ? t.targetTouches[0].pageY
                    : t.pageY || t.clientY,
                  n =
                    i -
                    e.track.offset()[w.isHorizontal() ? "left" : "top"] -
                    e.dragSize / 2,
                  a = -w.minTranslate() * e.moveDivider,
                  o = -w.maxTranslate() * e.moveDivider;
                n < a ? (n = a) : n > o && (n = o),
                  (n = -n / e.moveDivider),
                  w.updateProgress(n),
                  w.setWrapperTranslate(n, !0);
              },
              dragStart: function (t) {
                var e = w.scrollbar;
                (e.isTouched = !0),
                  t.preventDefault(),
                  t.stopPropagation(),
                  e.setDragPosition(t),
                  clearTimeout(e.dragTimeout),
                  e.track.transition(0),
                  w.params.scrollbarHide && e.track.css("opacity", 1),
                  w.wrapper.transition(100),
                  e.drag.transition(100),
                  w.emit("onScrollbarDragStart", w);
              },
              dragMove: function (t) {
                var e = w.scrollbar;
                e.isTouched &&
                  (t.preventDefault ? t.preventDefault() : (t.returnValue = !1),
                  e.setDragPosition(t),
                  w.wrapper.transition(0),
                  e.track.transition(0),
                  e.drag.transition(0),
                  w.emit("onScrollbarDragMove", w));
              },
              dragEnd: function (t) {
                var e = w.scrollbar;
                e.isTouched &&
                  ((e.isTouched = !1),
                  w.params.scrollbarHide &&
                    (clearTimeout(e.dragTimeout),
                    (e.dragTimeout = setTimeout(function () {
                      e.track.css("opacity", 0), e.track.transition(400);
                    }, 1e3))),
                  w.emit("onScrollbarDragEnd", w),
                  w.params.scrollbarSnapOnRelease && w.slideReset());
              },
              enableDraggable: function () {
                var e = w.scrollbar,
                  i = w.support.touch ? e.track : document;
                t(e.track).on(w.touchEvents.start, e.dragStart),
                  t(i).on(w.touchEvents.move, e.dragMove),
                  t(i).on(w.touchEvents.end, e.dragEnd);
              },
              disableDraggable: function () {
                var e = w.scrollbar,
                  i = w.support.touch ? e.track : document;
                t(e.track).off(w.touchEvents.start, e.dragStart),
                  t(i).off(w.touchEvents.move, e.dragMove),
                  t(i).off(w.touchEvents.end, e.dragEnd);
              },
              set: function () {
                if (w.params.scrollbar) {
                  var e = w.scrollbar;
                  (e.track = t(w.params.scrollbar)),
                    w.params.uniqueNavElements &&
                      "string" == typeof w.params.scrollbar &&
                      e.track.length > 1 &&
                      1 === w.container.find(w.params.scrollbar).length &&
                      (e.track = w.container.find(w.params.scrollbar)),
                    (e.drag = e.track.find(".swiper-scrollbar-drag")),
                    0 === e.drag.length &&
                      ((e.drag = t(
                        '<div class="swiper-scrollbar-drag"></div>'
                      )),
                      e.track.append(e.drag)),
                    (e.drag[0].style.width = ""),
                    (e.drag[0].style.height = ""),
                    (e.trackSize = w.isHorizontal()
                      ? e.track[0].offsetWidth
                      : e.track[0].offsetHeight),
                    (e.divider = w.size / w.virtualSize),
                    (e.moveDivider = e.divider * (e.trackSize / w.size)),
                    (e.dragSize = e.trackSize * e.divider),
                    w.isHorizontal()
                      ? (e.drag[0].style.width = e.dragSize + "px")
                      : (e.drag[0].style.height = e.dragSize + "px"),
                    e.divider >= 1
                      ? (e.track[0].style.display = "none")
                      : (e.track[0].style.display = ""),
                    w.params.scrollbarHide && (e.track[0].style.opacity = 0);
                }
              },
              setTranslate: function () {
                if (w.params.scrollbar) {
                  var t,
                    e = w.scrollbar,
                    i = (w.translate, e.dragSize);
                  (t = (e.trackSize - e.dragSize) * w.progress),
                    w.rtl && w.isHorizontal()
                      ? ((t = -t),
                        t > 0
                          ? ((i = e.dragSize - t), (t = 0))
                          : -t + e.dragSize > e.trackSize &&
                            (i = e.trackSize + t))
                      : t < 0
                      ? ((i = e.dragSize + t), (t = 0))
                      : t + e.dragSize > e.trackSize && (i = e.trackSize - t),
                    w.isHorizontal()
                      ? (w.support.transforms3d
                          ? e.drag.transform("translate3d(" + t + "px, 0, 0)")
                          : e.drag.transform("translateX(" + t + "px)"),
                        (e.drag[0].style.width = i + "px"))
                      : (w.support.transforms3d
                          ? e.drag.transform("translate3d(0px, " + t + "px, 0)")
                          : e.drag.transform("translateY(" + t + "px)"),
                        (e.drag[0].style.height = i + "px")),
                    w.params.scrollbarHide &&
                      (clearTimeout(e.timeout),
                      (e.track[0].style.opacity = 1),
                      (e.timeout = setTimeout(function () {
                        (e.track[0].style.opacity = 0), e.track.transition(400);
                      }, 1e3)));
                }
              },
              setTransition: function (t) {
                w.params.scrollbar && w.scrollbar.drag.transition(t);
              },
            }),
            (w.controller = {
              LinearSpline: function (t, e) {
                (this.x = t), (this.y = e), (this.lastIndex = t.length - 1);
                var i, n;
                this.x.length;
                this.interpolate = function (t) {
                  return t
                    ? ((n = a(this.x, t)),
                      (i = n - 1),
                      ((t - this.x[i]) * (this.y[n] - this.y[i])) /
                        (this.x[n] - this.x[i]) +
                        this.y[i])
                    : 0;
                };
                var a = (function () {
                  var t, e, i;
                  return function (n, a) {
                    for (e = -1, t = n.length; t - e > 1; )
                      n[(i = (t + e) >> 1)] <= a ? (e = i) : (t = i);
                    return t;
                  };
                })();
              },
              getInterpolateFunction: function (t) {
                w.controller.spline ||
                  (w.controller.spline = w.params.loop
                    ? new w.controller.LinearSpline(w.slidesGrid, t.slidesGrid)
                    : new w.controller.LinearSpline(w.snapGrid, t.snapGrid));
              },
              setTranslate: function (t, i) {
                function n(e) {
                  (t =
                    e.rtl && "horizontal" === e.params.direction
                      ? -w.translate
                      : w.translate),
                    "slide" === w.params.controlBy &&
                      (w.controller.getInterpolateFunction(e),
                      (o = -w.controller.spline.interpolate(-t))),
                    (o && "container" !== w.params.controlBy) ||
                      ((a =
                        (e.maxTranslate() - e.minTranslate()) /
                        (w.maxTranslate() - w.minTranslate())),
                      (o = (t - w.minTranslate()) * a + e.minTranslate())),
                    w.params.controlInverse && (o = e.maxTranslate() - o),
                    e.updateProgress(o),
                    e.setWrapperTranslate(o, !1, w),
                    e.updateActiveIndex();
                }
                var a,
                  o,
                  r = w.params.control;
                if (w.isArray(r))
                  for (var s = 0; s < r.length; s++)
                    r[s] !== i && r[s] instanceof e && n(r[s]);
                else r instanceof e && i !== r && n(r);
              },
              setTransition: function (t, i) {
                function n(e) {
                  e.setWrapperTransition(t, w),
                    0 !== t &&
                      (e.onTransitionStart(),
                      e.wrapper.transitionEnd(function () {
                        o &&
                          (e.params.loop &&
                            "slide" === w.params.controlBy &&
                            e.fixLoop(),
                          e.onTransitionEnd());
                      }));
                }
                var a,
                  o = w.params.control;
                if (w.isArray(o))
                  for (a = 0; a < o.length; a++)
                    o[a] !== i && o[a] instanceof e && n(o[a]);
                else o instanceof e && i !== o && n(o);
              },
            }),
            (w.hashnav = {
              init: function () {
                if (w.params.hashnav) {
                  w.hashnav.initialized = !0;
                  var t = document.location.hash.replace("#", "");
                  if (t)
                    for (var e = 0, i = w.slides.length; e < i; e++) {
                      var n = w.slides.eq(e),
                        a = n.attr("data-hash");
                      if (
                        a === t &&
                        !n.hasClass(w.params.slideDuplicateClass)
                      ) {
                        var o = n.index();
                        w.slideTo(o, 0, w.params.runCallbacksOnInit, !0);
                      }
                    }
                }
              },
              setHash: function () {
                w.hashnav.initialized &&
                  w.params.hashnav &&
                  (document.location.hash =
                    w.slides.eq(w.activeIndex).attr("data-hash") || "");
              },
            }),
            (w.disableKeyboardControl = function () {
              (w.params.keyboardControl = !1), t(document).off("keydown", d);
            }),
            (w.enableKeyboardControl = function () {
              (w.params.keyboardControl = !0), t(document).on("keydown", d);
            }),
            (w.mousewheel = {
              event: !1,
              lastScrollTime: new window.Date().getTime(),
            }),
            w.params.mousewheelControl)
          ) {
            try {
              new window.WheelEvent("wheel"), (w.mousewheel.event = "wheel");
            } catch (t) {
              (window.WheelEvent ||
                (w.container[0] && "wheel" in w.container[0])) &&
                (w.mousewheel.event = "wheel");
            }
            !w.mousewheel.event && window.WheelEvent,
              w.mousewheel.event ||
                void 0 === document.onmousewheel ||
                (w.mousewheel.event = "mousewheel"),
              w.mousewheel.event || (w.mousewheel.event = "DOMMouseScroll");
          }
          (w.disableMousewheelControl = function () {
            return (
              !!w.mousewheel.event &&
              (w.container.off(w.mousewheel.event, p), !0)
            );
          }),
            (w.enableMousewheelControl = function () {
              return (
                !!w.mousewheel.event &&
                (w.container.on(w.mousewheel.event, p), !0)
              );
            }),
            (w.parallax = {
              setTranslate: function () {
                w.container
                  .children(
                    "[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]"
                  )
                  .each(function () {
                    c(this, w.progress);
                  }),
                  w.slides.each(function () {
                    var e = t(this);
                    e.find(
                      "[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]"
                    ).each(function () {
                      c(this, Math.min(Math.max(e[0].progress, -1), 1));
                    });
                  });
              },
              setTransition: function (e) {
                void 0 === e && (e = w.params.speed),
                  w.container
                    .find(
                      "[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]"
                    )
                    .each(function () {
                      var i = t(this),
                        n =
                          parseInt(
                            i.attr("data-swiper-parallax-duration"),
                            10
                          ) || e;
                      0 === e && (n = 0), i.transition(n);
                    });
              },
            }),
            (w._plugins = []);
          for (var B in w.plugins) {
            var F = w.plugins[B](w, w.params[B]);
            F && w._plugins.push(F);
          }
          return (
            (w.callPlugins = function (t) {
              for (var e = 0; e < w._plugins.length; e++)
                t in w._plugins[e] &&
                  w._plugins[e][t](
                    arguments[1],
                    arguments[2],
                    arguments[3],
                    arguments[4],
                    arguments[5]
                  );
            }),
            (w.emitterEventListeners = {}),
            (w.emit = function (t) {
              w.params[t] &&
                w.params[t](
                  arguments[1],
                  arguments[2],
                  arguments[3],
                  arguments[4],
                  arguments[5]
                );
              var e;
              if (w.emitterEventListeners[t])
                for (e = 0; e < w.emitterEventListeners[t].length; e++)
                  w.emitterEventListeners[t][e](
                    arguments[1],
                    arguments[2],
                    arguments[3],
                    arguments[4],
                    arguments[5]
                  );
              w.callPlugins &&
                w.callPlugins(
                  t,
                  arguments[1],
                  arguments[2],
                  arguments[3],
                  arguments[4],
                  arguments[5]
                );
            }),
            (w.on = function (t, e) {
              return (
                (t = u(t)),
                w.emitterEventListeners[t] || (w.emitterEventListeners[t] = []),
                w.emitterEventListeners[t].push(e),
                w
              );
            }),
            (w.off = function (t, e) {
              var i;
              if (((t = u(t)), void 0 === e))
                return (w.emitterEventListeners[t] = []), w;
              if (
                w.emitterEventListeners[t] &&
                0 !== w.emitterEventListeners[t].length
              ) {
                for (i = 0; i < w.emitterEventListeners[t].length; i++)
                  w.emitterEventListeners[t][i] === e &&
                    w.emitterEventListeners[t].splice(i, 1);
                return w;
              }
            }),
            (w.once = function (t, e) {
              t = u(t);
              var i = function () {
                e(
                  arguments[0],
                  arguments[1],
                  arguments[2],
                  arguments[3],
                  arguments[4]
                ),
                  w.off(t, i);
              };
              return w.on(t, i), w;
            }),
            (w.a11y = {
              makeFocusable: function (t) {
                return t.attr("tabIndex", "0"), t;
              },
              addRole: function (t, e) {
                return t.attr("role", e), t;
              },
              addLabel: function (t, e) {
                return t.attr("aria-label", e), t;
              },
              disable: function (t) {
                return t.attr("aria-disabled", !0), t;
              },
              enable: function (t) {
                return t.attr("aria-disabled", !1), t;
              },
              onEnterKey: function (e) {
                13 === e.keyCode &&
                  (t(e.target).is(w.params.nextButton)
                    ? (w.onClickNext(e),
                      w.isEnd
                        ? w.a11y.notify(w.params.lastSlideMessage)
                        : w.a11y.notify(w.params.nextSlideMessage))
                    : t(e.target).is(w.params.prevButton) &&
                      (w.onClickPrev(e),
                      w.isBeginning
                        ? w.a11y.notify(w.params.firstSlideMessage)
                        : w.a11y.notify(w.params.prevSlideMessage)),
                  t(e.target).is("." + w.params.bulletClass) &&
                    t(e.target)[0].click());
              },
              liveRegion: t(
                '<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'
              ),
              notify: function (t) {
                var e = w.a11y.liveRegion;
                0 !== e.length && (e.html(""), e.html(t));
              },
              init: function () {
                w.params.nextButton &&
                  w.nextButton &&
                  w.nextButton.length > 0 &&
                  (w.a11y.makeFocusable(w.nextButton),
                  w.a11y.addRole(w.nextButton, "button"),
                  w.a11y.addLabel(w.nextButton, w.params.nextSlideMessage)),
                  w.params.prevButton &&
                    w.prevButton &&
                    w.prevButton.length > 0 &&
                    (w.a11y.makeFocusable(w.prevButton),
                    w.a11y.addRole(w.prevButton, "button"),
                    w.a11y.addLabel(w.prevButton, w.params.prevSlideMessage)),
                  t(w.container).append(w.a11y.liveRegion);
              },
              initPagination: function () {
                w.params.pagination &&
                  w.params.paginationClickable &&
                  w.bullets &&
                  w.bullets.length &&
                  w.bullets.each(function () {
                    var e = t(this);
                    w.a11y.makeFocusable(e),
                      w.a11y.addRole(e, "button"),
                      w.a11y.addLabel(
                        e,
                        w.params.paginationBulletMessage.replace(
                          /{{index}}/,
                          e.index() + 1
                        )
                      );
                  });
              },
              destroy: function () {
                w.a11y.liveRegion &&
                  w.a11y.liveRegion.length > 0 &&
                  w.a11y.liveRegion.remove();
              },
            }),
            (w.init = function () {
              w.params.loop && w.createLoop(),
                w.updateContainerSize(),
                w.updateSlidesSize(),
                w.updatePagination(),
                w.params.scrollbar &&
                  w.scrollbar &&
                  (w.scrollbar.set(),
                  w.params.scrollbarDraggable && w.scrollbar.enableDraggable()),
                "slide" !== w.params.effect &&
                  w.effects[w.params.effect] &&
                  (w.params.loop || w.updateProgress(),
                  w.effects[w.params.effect].setTranslate()),
                w.params.loop
                  ? w.slideTo(
                      w.params.initialSlide + w.loopedSlides,
                      0,
                      w.params.runCallbacksOnInit
                    )
                  : (w.slideTo(
                      w.params.initialSlide,
                      0,
                      w.params.runCallbacksOnInit
                    ),
                    0 === w.params.initialSlide &&
                      (w.parallax &&
                        w.params.parallax &&
                        w.parallax.setTranslate(),
                      w.lazy &&
                        w.params.lazyLoading &&
                        (w.lazy.load(), (w.lazy.initialImageLoaded = !0)))),
                w.attachEvents(),
                w.params.observer && w.support.observer && w.initObservers(),
                w.params.preloadImages &&
                  !w.params.lazyLoading &&
                  w.preloadImages(),
                w.params.autoplay && w.startAutoplay(),
                w.params.keyboardControl &&
                  w.enableKeyboardControl &&
                  w.enableKeyboardControl(),
                w.params.mousewheelControl &&
                  w.enableMousewheelControl &&
                  w.enableMousewheelControl(),
                w.params.hashnav && w.hashnav && w.hashnav.init(),
                w.params.a11y && w.a11y && w.a11y.init(),
                w.emit("onInit", w);
            }),
            (w.cleanupStyles = function () {
              w.container
                .removeClass(w.classNames.join(" "))
                .removeAttr("style"),
                w.wrapper.removeAttr("style"),
                w.slides &&
                  w.slides.length &&
                  w.slides
                    .removeClass(
                      [
                        w.params.slideVisibleClass,
                        w.params.slideActiveClass,
                        w.params.slideNextClass,
                        w.params.slidePrevClass,
                      ].join(" ")
                    )
                    .removeAttr("style")
                    .removeAttr("data-swiper-column")
                    .removeAttr("data-swiper-row"),
                w.paginationContainer &&
                  w.paginationContainer.length &&
                  w.paginationContainer.removeClass(
                    w.params.paginationHiddenClass
                  ),
                w.bullets &&
                  w.bullets.length &&
                  w.bullets.removeClass(w.params.bulletActiveClass),
                w.params.prevButton &&
                  t(w.params.prevButton).removeClass(
                    w.params.buttonDisabledClass
                  ),
                w.params.nextButton &&
                  t(w.params.nextButton).removeClass(
                    w.params.buttonDisabledClass
                  ),
                w.params.scrollbar &&
                  w.scrollbar &&
                  (w.scrollbar.track &&
                    w.scrollbar.track.length &&
                    w.scrollbar.track.removeAttr("style"),
                  w.scrollbar.drag &&
                    w.scrollbar.drag.length &&
                    w.scrollbar.drag.removeAttr("style"));
            }),
            (w.destroy = function (t, e) {
              w.detachEvents(),
                w.stopAutoplay(),
                w.params.scrollbar &&
                  w.scrollbar &&
                  w.params.scrollbarDraggable &&
                  w.scrollbar.disableDraggable(),
                w.params.loop && w.destroyLoop(),
                e && w.cleanupStyles(),
                w.disconnectObservers(),
                w.params.keyboardControl &&
                  w.disableKeyboardControl &&
                  w.disableKeyboardControl(),
                w.params.mousewheelControl &&
                  w.disableMousewheelControl &&
                  w.disableMousewheelControl(),
                w.params.a11y && w.a11y && w.a11y.destroy(),
                w.emit("onDestroy"),
                !1 !== t && (w = null);
            }),
            w.init(),
            w
          );
        }
      };
    e.prototype = {
      isSafari: (function () {
        var t = navigator.userAgent.toLowerCase();
        return (
          t.indexOf("safari") >= 0 &&
          t.indexOf("chrome") < 0 &&
          t.indexOf("android") < 0
        );
      })(),
      isUiWebView: /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(
        navigator.userAgent
      ),
      isArray: function (t) {
        return "[object Array]" === Object.prototype.toString.apply(t);
      },
      browser: {
        ie:
          window.navigator.pointerEnabled || window.navigator.msPointerEnabled,
        ieTouch:
          (window.navigator.msPointerEnabled &&
            window.navigator.msMaxTouchPoints > 1) ||
          (window.navigator.pointerEnabled &&
            window.navigator.maxTouchPoints > 1),
      },
      device: (function () {
        var t = navigator.userAgent,
          e = t.match(/(Android);?[\s\/]+([\d.]+)?/),
          i = t.match(/(iPad).*OS\s([\d_]+)/),
          n = t.match(/(iPod)(.*OS\s([\d_]+))?/),
          a = !i && t.match(/(iPhone\sOS)\s([\d_]+)/);
        return { ios: i || a || n, android: e };
      })(),
      support: {
        touch:
          (window.Modernizr && !0 === Modernizr.touch) ||
          (function () {
            return !!(
              "ontouchstart" in window ||
              (window.DocumentTouch && document instanceof DocumentTouch)
            );
          })(),
        transforms3d:
          (window.Modernizr && !0 === Modernizr.csstransforms3d) ||
          (function () {
            var t = document.createElement("div").style;
            return (
              "webkitPerspective" in t ||
              "MozPerspective" in t ||
              "OPerspective" in t ||
              "MsPerspective" in t ||
              "perspective" in t
            );
          })(),
        flexbox: (function () {
          for (
            var t = document.createElement("div").style,
              e =
                "alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(
                  " "
                ),
              i = 0;
            i < e.length;
            i++
          )
            if (e[i] in t) return !0;
        })(),
        observer: (function () {
          return (
            "MutationObserver" in window || "WebkitMutationObserver" in window
          );
        })(),
      },
      plugins: {},
    };
    for (
      var i = (function () {
          var t = function (t) {
              var e = this,
                i = 0;
              for (i = 0; i < t.length; i++) e[i] = t[i];
              return (e.length = t.length), this;
            },
            e = function (e, i) {
              var n = [],
                a = 0;
              if (e && !i && e instanceof t) return e;
              if (e)
                if ("string" == typeof e) {
                  var o,
                    r,
                    s = e.trim();
                  if (s.indexOf("<") >= 0 && s.indexOf(">") >= 0) {
                    var l = "div";
                    for (
                      0 === s.indexOf("<li") && (l = "ul"),
                        0 === s.indexOf("<tr") && (l = "tbody"),
                        (0 !== s.indexOf("<td") && 0 !== s.indexOf("<th")) ||
                          (l = "tr"),
                        0 === s.indexOf("<tbody") && (l = "table"),
                        0 === s.indexOf("<option") && (l = "select"),
                        r = document.createElement(l),
                        r.innerHTML = e,
                        a = 0;
                      a < r.childNodes.length;
                      a++
                    )
                      n.push(r.childNodes[a]);
                  } else
                    for (
                      o =
                        i || "#" !== e[0] || e.match(/[ .<>:~]/)
                          ? (i || document).querySelectorAll(e)
                          : [document.getElementById(e.split("#")[1])],
                        a = 0;
                      a < o.length;
                      a++
                    )
                      o[a] && n.push(o[a]);
                } else if (e.nodeType || e === window || e === document)
                  n.push(e);
                else if (e.length > 0 && e[0].nodeType)
                  for (a = 0; a < e.length; a++) n.push(e[a]);
              return new t(n);
            };
          return (
            (t.prototype = {
              addClass: function (t) {
                if (void 0 === t) return this;
                for (var e = t.split(" "), i = 0; i < e.length; i++)
                  for (var n = 0; n < this.length; n++)
                    this[n].classList.add(e[i]);
                return this;
              },
              removeClass: function (t) {
                for (var e = t.split(" "), i = 0; i < e.length; i++)
                  for (var n = 0; n < this.length; n++)
                    this[n].classList.remove(e[i]);
                return this;
              },
              hasClass: function (t) {
                return !!this[0] && this[0].classList.contains(t);
              },
              toggleClass: function (t) {
                for (var e = t.split(" "), i = 0; i < e.length; i++)
                  for (var n = 0; n < this.length; n++)
                    this[n].classList.toggle(e[i]);
                return this;
              },
              attr: function (t, e) {
                if (1 === arguments.length && "string" == typeof t)
                  return this[0] ? this[0].getAttribute(t) : void 0;
                for (var i = 0; i < this.length; i++)
                  if (2 === arguments.length) this[i].setAttribute(t, e);
                  else
                    for (var n in t)
                      (this[i][n] = t[n]), this[i].setAttribute(n, t[n]);
                return this;
              },
              removeAttr: function (t) {
                for (var e = 0; e < this.length; e++)
                  this[e].removeAttribute(t);
                return this;
              },
              data: function (t, e) {
                if (void 0 !== e) {
                  for (var i = 0; i < this.length; i++) {
                    var n = this[i];
                    n.dom7ElementDataStorage || (n.dom7ElementDataStorage = {}),
                      (n.dom7ElementDataStorage[t] = e);
                  }
                  return this;
                }
                if (this[0]) {
                  var a = this[0].getAttribute("data-" + t);
                  return (
                    a ||
                    (this[0].dom7ElementDataStorage &&
                    (t in this[0].dom7ElementDataStorage)
                      ? this[0].dom7ElementDataStorage[t]
                      : void 0)
                  );
                }
              },
              transform: function (t) {
                for (var e = 0; e < this.length; e++) {
                  var i = this[e].style;
                  i.webkitTransform =
                    i.MsTransform =
                    i.msTransform =
                    i.MozTransform =
                    i.OTransform =
                    i.transform =
                      t;
                }
                return this;
              },
              transition: function (t) {
                "string" != typeof t && (t += "ms");
                for (var e = 0; e < this.length; e++) {
                  var i = this[e].style;
                  i.webkitTransitionDuration =
                    i.MsTransitionDuration =
                    i.msTransitionDuration =
                    i.MozTransitionDuration =
                    i.OTransitionDuration =
                    i.transitionDuration =
                      t;
                }
                return this;
              },
              on: function (t, i, n, a) {
                function o(t) {
                  var a = t.target;
                  if (e(a).is(i)) n.call(a, t);
                  else
                    for (var o = e(a).parents(), r = 0; r < o.length; r++)
                      e(o[r]).is(i) && n.call(o[r], t);
                }
                var r,
                  s,
                  l = t.split(" ");
                for (r = 0; r < this.length; r++)
                  if ("function" == typeof i || !1 === i)
                    for (
                      "function" == typeof i &&
                        ((n = arguments[1]), (a = arguments[2] || !1)),
                        s = 0;
                      s < l.length;
                      s++
                    )
                      this[r].addEventListener(l[s], n, a);
                  else
                    for (s = 0; s < l.length; s++)
                      this[r].dom7LiveListeners ||
                        (this[r].dom7LiveListeners = []),
                        this[r].dom7LiveListeners.push({
                          listener: n,
                          liveListener: o,
                        }),
                        this[r].addEventListener(l[s], o, a);
                return this;
              },
              off: function (t, e, i, n) {
                for (var a = t.split(" "), o = 0; o < a.length; o++)
                  for (var r = 0; r < this.length; r++)
                    if ("function" == typeof e || !1 === e)
                      "function" == typeof e &&
                        ((i = arguments[1]), (n = arguments[2] || !1)),
                        this[r].removeEventListener(a[o], i, n);
                    else if (this[r].dom7LiveListeners)
                      for (var s = 0; s < this[r].dom7LiveListeners.length; s++)
                        this[r].dom7LiveListeners[s].listener === i &&
                          this[r].removeEventListener(
                            a[o],
                            this[r].dom7LiveListeners[s].liveListener,
                            n
                          );
                return this;
              },
              once: function (t, e, i, n) {
                function a(r) {
                  i(r), o.off(t, e, a, n);
                }
                var o = this;
                "function" == typeof e &&
                  ((e = !1), (i = arguments[1]), (n = arguments[2])),
                  o.on(t, e, a, n);
              },
              trigger: function (t, e) {
                for (var i = 0; i < this.length; i++) {
                  var n;
                  try {
                    n = new window.CustomEvent(t, {
                      detail: e,
                      bubbles: !0,
                      cancelable: !0,
                    });
                  } catch (i) {
                    (n = document.createEvent("Event")),
                      n.initEvent(t, !0, !0),
                      (n.detail = e);
                  }
                  this[i].dispatchEvent(n);
                }
                return this;
              },
              transitionEnd: function (t) {
                function e(o) {
                  if (o.target === this)
                    for (t.call(this, o), i = 0; i < n.length; i++)
                      a.off(n[i], e);
                }
                var i,
                  n = [
                    "webkitTransitionEnd",
                    "transitionend",
                    "oTransitionEnd",
                    "MSTransitionEnd",
                    "msTransitionEnd",
                  ],
                  a = this;
                if (t) for (i = 0; i < n.length; i++) a.on(n[i], e);
                return this;
              },
              width: function () {
                return this[0] === window
                  ? window.innerWidth
                  : this.length > 0
                  ? parseFloat(this.css("width"))
                  : null;
              },
              outerWidth: function (t) {
                return this.length > 0
                  ? t
                    ? this[0].offsetWidth +
                      parseFloat(this.css("margin-right")) +
                      parseFloat(this.css("margin-left"))
                    : this[0].offsetWidth
                  : null;
              },
              height: function () {
                return this[0] === window
                  ? window.innerHeight
                  : this.length > 0
                  ? parseFloat(this.css("height"))
                  : null;
              },
              outerHeight: function (t) {
                return this.length > 0
                  ? t
                    ? this[0].offsetHeight +
                      parseFloat(this.css("margin-top")) +
                      parseFloat(this.css("margin-bottom"))
                    : this[0].offsetHeight
                  : null;
              },
              offset: function () {
                if (this.length > 0) {
                  var t = this[0],
                    e = t.getBoundingClientRect(),
                    i = document.body,
                    n = t.clientTop || i.clientTop || 0,
                    a = t.clientLeft || i.clientLeft || 0,
                    o = window.pageYOffset || t.scrollTop,
                    r = window.pageXOffset || t.scrollLeft;
                  return { top: e.top + o - n, left: e.left + r - a };
                }
                return null;
              },
              css: function (t, e) {
                var i;
                if (1 === arguments.length) {
                  if ("string" != typeof t) {
                    for (i = 0; i < this.length; i++)
                      for (var n in t) this[i].style[n] = t[n];
                    return this;
                  }
                  if (this[0])
                    return window
                      .getComputedStyle(this[0], null)
                      .getPropertyValue(t);
                }
                if (2 === arguments.length && "string" == typeof t) {
                  for (i = 0; i < this.length; i++) this[i].style[t] = e;
                  return this;
                }
                return this;
              },
              each: function (t) {
                for (var e = 0; e < this.length; e++)
                  t.call(this[e], e, this[e]);
                return this;
              },
              html: function (t) {
                if (void 0 === t) return this[0] ? this[0].innerHTML : void 0;
                for (var e = 0; e < this.length; e++) this[e].innerHTML = t;
                return this;
              },
              text: function (t) {
                if (void 0 === t)
                  return this[0] ? this[0].textContent.trim() : null;
                for (var e = 0; e < this.length; e++) this[e].textContent = t;
                return this;
              },
              is: function (i) {
                if (!this[0]) return !1;
                var n, a;
                if ("string" == typeof i) {
                  var o = this[0];
                  if (o === document) return i === document;
                  if (o === window) return i === window;
                  if (o.matches) return o.matches(i);
                  if (o.webkitMatchesSelector)
                    return o.webkitMatchesSelector(i);
                  if (o.mozMatchesSelector) return o.mozMatchesSelector(i);
                  if (o.msMatchesSelector) return o.msMatchesSelector(i);
                  for (n = e(i), a = 0; a < n.length; a++)
                    if (n[a] === this[0]) return !0;
                  return !1;
                }
                if (i === document) return this[0] === document;
                if (i === window) return this[0] === window;
                if (i.nodeType || i instanceof t) {
                  for (n = i.nodeType ? [i] : i, a = 0; a < n.length; a++)
                    if (n[a] === this[0]) return !0;
                  return !1;
                }
                return !1;
              },
              index: function () {
                if (this[0]) {
                  for (
                    var t = this[0], e = 0;
                    null !== (t = t.previousSibling);

                  )
                    1 === t.nodeType && e++;
                  return e;
                }
              },
              eq: function (e) {
                if (void 0 === e) return this;
                var i,
                  n = this.length;
                return e > n - 1
                  ? new t([])
                  : e < 0
                  ? ((i = n + e), new t(i < 0 ? [] : [this[i]]))
                  : new t([this[e]]);
              },
              append: function (e) {
                var i, n;
                for (i = 0; i < this.length; i++)
                  if ("string" == typeof e) {
                    var a = document.createElement("div");
                    for (a.innerHTML = e; a.firstChild; )
                      this[i].appendChild(a.firstChild);
                  } else if (e instanceof t)
                    for (n = 0; n < e.length; n++) this[i].appendChild(e[n]);
                  else this[i].appendChild(e);
                return this;
              },
              prepend: function (e) {
                var i, n;
                for (i = 0; i < this.length; i++)
                  if ("string" == typeof e) {
                    var a = document.createElement("div");
                    for (
                      a.innerHTML = e, n = a.childNodes.length - 1;
                      n >= 0;
                      n--
                    )
                      this[i].insertBefore(
                        a.childNodes[n],
                        this[i].childNodes[0]
                      );
                  } else if (e instanceof t)
                    for (n = 0; n < e.length; n++)
                      this[i].insertBefore(e[n], this[i].childNodes[0]);
                  else this[i].insertBefore(e, this[i].childNodes[0]);
                return this;
              },
              insertBefore: function (t) {
                for (var i = e(t), n = 0; n < this.length; n++)
                  if (1 === i.length)
                    i[0].parentNode.insertBefore(this[n], i[0]);
                  else if (i.length > 1)
                    for (var a = 0; a < i.length; a++)
                      i[a].parentNode.insertBefore(this[n].cloneNode(!0), i[a]);
              },
              insertAfter: function (t) {
                for (var i = e(t), n = 0; n < this.length; n++)
                  if (1 === i.length)
                    i[0].parentNode.insertBefore(this[n], i[0].nextSibling);
                  else if (i.length > 1)
                    for (var a = 0; a < i.length; a++)
                      i[a].parentNode.insertBefore(
                        this[n].cloneNode(!0),
                        i[a].nextSibling
                      );
              },
              next: function (i) {
                return new t(
                  this.length > 0
                    ? i
                      ? this[0].nextElementSibling &&
                        e(this[0].nextElementSibling).is(i)
                        ? [this[0].nextElementSibling]
                        : []
                      : this[0].nextElementSibling
                      ? [this[0].nextElementSibling]
                      : []
                    : []
                );
              },
              nextAll: function (i) {
                var n = [],
                  a = this[0];
                if (!a) return new t([]);
                for (; a.nextElementSibling; ) {
                  var o = a.nextElementSibling;
                  i ? e(o).is(i) && n.push(o) : n.push(o), (a = o);
                }
                return new t(n);
              },
              prev: function (i) {
                return new t(
                  this.length > 0
                    ? i
                      ? this[0].previousElementSibling &&
                        e(this[0].previousElementSibling).is(i)
                        ? [this[0].previousElementSibling]
                        : []
                      : this[0].previousElementSibling
                      ? [this[0].previousElementSibling]
                      : []
                    : []
                );
              },
              prevAll: function (i) {
                var n = [],
                  a = this[0];
                if (!a) return new t([]);
                for (; a.previousElementSibling; ) {
                  var o = a.previousElementSibling;
                  i ? e(o).is(i) && n.push(o) : n.push(o), (a = o);
                }
                return new t(n);
              },
              parent: function (t) {
                for (var i = [], n = 0; n < this.length; n++)
                  t
                    ? e(this[n].parentNode).is(t) && i.push(this[n].parentNode)
                    : i.push(this[n].parentNode);
                return e(e.unique(i));
              },
              parents: function (t) {
                for (var i = [], n = 0; n < this.length; n++)
                  for (var a = this[n].parentNode; a; )
                    t ? e(a).is(t) && i.push(a) : i.push(a), (a = a.parentNode);
                return e(e.unique(i));
              },
              find: function (e) {
                for (var i = [], n = 0; n < this.length; n++)
                  for (
                    var a = this[n].querySelectorAll(e), o = 0;
                    o < a.length;
                    o++
                  )
                    i.push(a[o]);
                return new t(i);
              },
              children: function (i) {
                for (var n = [], a = 0; a < this.length; a++)
                  for (var o = this[a].childNodes, r = 0; r < o.length; r++)
                    i
                      ? 1 === o[r].nodeType && e(o[r]).is(i) && n.push(o[r])
                      : 1 === o[r].nodeType && n.push(o[r]);
                return new t(e.unique(n));
              },
              remove: function () {
                for (var t = 0; t < this.length; t++)
                  this[t].parentNode && this[t].parentNode.removeChild(this[t]);
                return this;
              },
              add: function () {
                var t,
                  i,
                  n = this;
                for (t = 0; t < arguments.length; t++) {
                  var a = e(arguments[t]);
                  for (i = 0; i < a.length; i++)
                    (n[n.length] = a[i]), n.length++;
                }
                return n;
              },
            }),
            (e.fn = t.prototype),
            (e.unique = function (t) {
              for (var e = [], i = 0; i < t.length; i++)
                -1 === e.indexOf(t[i]) && e.push(t[i]);
              return e;
            }),
            e
          );
        })(),
        n = ["jQuery", "Zepto", "Dom7"],
        a = 0;
      a < n.length;
      a++
    )
      window[n[a]] &&
        (function (t) {
          t.fn.swiper = function (i) {
            var n;
            return (
              t(this).each(function () {
                var t = new e(this, i);
                n || (n = t);
              }),
              n
            );
          };
        })(window[n[a]]);
    var o;
    (o = void 0 === i ? window.Dom7 || window.Zepto || window.jQuery : i),
      o &&
        ("transitionEnd" in o.fn ||
          (o.fn.transitionEnd = function (t) {
            function e(o) {
              if (o.target === this)
                for (t.call(this, o), i = 0; i < n.length; i++) a.off(n[i], e);
            }
            var i,
              n = [
                "webkitTransitionEnd",
                "transitionend",
                "oTransitionEnd",
                "MSTransitionEnd",
                "msTransitionEnd",
              ],
              a = this;
            if (t) for (i = 0; i < n.length; i++) a.on(n[i], e);
            return this;
          }),
        "transform" in o.fn ||
          (o.fn.transform = function (t) {
            for (var e = 0; e < this.length; e++) {
              var i = this[e].style;
              i.webkitTransform =
                i.MsTransform =
                i.msTransform =
                i.MozTransform =
                i.OTransform =
                i.transform =
                  t;
            }
            return this;
          }),
        "transition" in o.fn ||
          (o.fn.transition = function (t) {
            "string" != typeof t && (t += "ms");
            for (var e = 0; e < this.length; e++) {
              var i = this[e].style;
              i.webkitTransitionDuration =
                i.MsTransitionDuration =
                i.msTransitionDuration =
                i.MozTransitionDuration =
                i.OTransitionDuration =
                i.transitionDuration =
                  t;
            }
            return this;
          })),
      (window.Swiper = e);
  })(),
  "undefined" != typeof module
    ? (module.exports = window.Swiper)
    : "function" == typeof define &&
      define.amd &&
      define("lib-app/Swiper/swiper", [], function () {
        "use strict";
        return window.Swiper;
      }),
  (function (t, e) {
    var i = (function (t, e) {
      "use strict";
      if (e.getElementsByClassName) {
        var i,
          n = e.documentElement,
          a = t.Date,
          o = t.HTMLPictureElement,
          r = "addEventListener",
          s = "getAttribute",
          l = t[r],
          d = t.setTimeout,
          p = t.requestAnimationFrame || d,
          c = t.requestIdleCallback,
          u = /^picture$/i,
          h = ["load", "error", "lazyincluded", "_lazyloaded"],
          f = {},
          m = Array.prototype.forEach,
          g = function (t, e) {
            return (
              f[e] || (f[e] = new RegExp("(\\s|^)" + e + "(\\s|$)")),
              f[e].test(t[s]("class") || "") && f[e]
            );
          },
          b = function (t, e) {
            g(t, e) ||
              t.setAttribute("class", (t[s]("class") || "").trim() + " " + e);
          },
          v = function (t, e) {
            var i;
            (i = g(t, e)) &&
              t.setAttribute("class", (t[s]("class") || "").replace(i, " "));
          },
          y = function (t, e, i) {
            var n = i ? r : "removeEventListener";
            i && y(t, e),
              h.forEach(function (i) {
                t[n](i, e);
              });
          },
          w = function (t, i, n, a, o) {
            var r = e.createEvent("CustomEvent");
            return r.initCustomEvent(i, !a, !o, n || {}), t.dispatchEvent(r), r;
          },
          C = function (e, n) {
            var a;
            !o && (a = t.picturefill || i.pf)
              ? a({ reevaluate: !0, elements: [e] })
              : n && n.src && (e.src = n.src);
          },
          _ = function (t, e) {
            return (getComputedStyle(t, null) || {})[e];
          },
          x = function (t, e, n) {
            for (
              n = n || t.offsetWidth;
              n < i.minSize && e && !t._lazysizesWidth;

            )
              (n = e.offsetWidth), (e = e.parentNode);
            return n;
          },
          S = (function () {
            var t,
              i,
              n = [],
              a = function () {
                var e;
                for (t = !0, i = !1; n.length; )
                  (e = n.shift()), e[0].apply(e[1], e[2]);
                t = !1;
              };
            return function (o) {
              t
                ? o.apply(this, arguments)
                : (n.push([o, this, arguments]),
                  i || ((i = !0), (e.hidden ? d : p)(a)));
            };
          })(),
          T = function (t, e) {
            return e
              ? function () {
                  S(t);
                }
              : function () {
                  var e = this,
                    i = arguments;
                  S(function () {
                    t.apply(e, i);
                  });
                };
          },
          k = function (t) {
            var e,
              i = 0,
              n = 999,
              o = function () {
                (e = !1), (i = a.now()), t();
              },
              r = c
                ? function () {
                    c(o, { timeout: n }), 999 !== n && (n = 999);
                  }
                : T(function () {
                    d(o);
                  }, !0);
            return function (t) {
              var o;
              (t = !0 === t) && (n = 66),
                e ||
                  ((e = !0),
                  (o = 125 - (a.now() - i)),
                  0 > o && (o = 0),
                  t || (9 > o && c) ? r() : d(r, o));
            };
          },
          E = function (t) {
            var e,
              i,
              n = function () {
                (e = null), t();
              },
              o = function () {
                var t = a.now() - i;
                99 > t ? d(o, 99 - t) : (c || n)(n);
              };
            return function () {
              (i = a.now()), e || (e = d(o, 99));
            };
          },
          A = (function () {
            var o,
              p,
              c,
              h,
              f,
              x,
              A,
              L,
              P,
              D,
              $,
              M,
              O,
              R,
              N,
              B = /^img$/i,
              F = /^iframe$/i,
              W = "onscroll" in t && !/glebot/.test(navigator.userAgent),
              j = 0,
              H = 0,
              z = -1,
              U = function (t) {
                H--,
                  t && t.target && y(t.target, U),
                  (!t || 0 > H || !t.target) && (H = 0);
              },
              G = function (t, i) {
                var a,
                  o = t,
                  r =
                    "hidden" == _(e.body, "visibility") ||
                    "hidden" != _(t, "visibility");
                for (
                  P -= i, M += i, D -= i, $ += i;
                  r && (o = o.offsetParent) && o != e.body && o != n;

                )
                  (r = (_(o, "opacity") || 1) > 0) &&
                    "visible" != _(o, "overflow") &&
                    ((a = o.getBoundingClientRect()),
                    (r =
                      $ > a.left &&
                      D < a.right &&
                      M > a.top - 1 &&
                      P < a.bottom + 1));
                return r;
              },
              V = function () {
                var t, a, r, l, d, u, h, m, g;
                if ((f = i.loadMode) && 8 > H && (t = o.length)) {
                  (a = 0),
                    z++,
                    null == R &&
                      ("expand" in i ||
                        (i.expand =
                          n.clientHeight > 500 && n.clientWidth > 500
                            ? 500
                            : 370),
                      (O = i.expand),
                      (R = O * i.expFactor)),
                    R > j && 1 > H && z > 2 && f > 2 && !e.hidden
                      ? ((j = R), (z = 0))
                      : (j = f > 1 && z > 1 && 6 > H ? O : 0);
                  for (; t > a; a++)
                    if (o[a] && !o[a]._lazyRace)
                      if (W)
                        if (
                          (((m = o[a][s]("data-expand")) && (u = 1 * m)) ||
                            (u = j),
                          g !== u &&
                            ((A = innerWidth + u * N),
                            (L = innerHeight + u),
                            (h = -1 * u),
                            (g = u)),
                          (r = o[a].getBoundingClientRect()),
                          (M = r.bottom) >= h &&
                            (P = r.top) <= L &&
                            ($ = r.right) >= h * N &&
                            (D = r.left) <= A &&
                            (M || $ || D || P) &&
                            ((c && 3 > H && !m && (3 > f || 4 > z)) ||
                              G(o[a], u)))
                        ) {
                          if ((tt(o[a]), (d = !0), H > 9)) break;
                        } else
                          !d &&
                            c &&
                            !l &&
                            4 > H &&
                            4 > z &&
                            f > 2 &&
                            (p[0] || i.preloadAfterLoad) &&
                            (p[0] ||
                              (!m &&
                                (M ||
                                  $ ||
                                  D ||
                                  P ||
                                  "auto" != o[a][s](i.sizesAttr)))) &&
                            (l = p[0] || o[a]);
                      else tt(o[a]);
                  l && !d && tt(l);
                }
              },
              q = k(V),
              K = function (t) {
                b(t.target, i.loadedClass),
                  v(t.target, i.loadingClass),
                  y(t.target, Q);
              },
              Y = T(K),
              Q = function (t) {
                Y({ target: t.target });
              },
              X = function (t, e) {
                try {
                  t.contentWindow.location.replace(e);
                } catch (i) {
                  t.src = e;
                }
              },
              J = function (t) {
                var e,
                  n,
                  a = t[s](i.srcsetAttr);
                (e = i.customMedia[t[s]("data-media") || t[s]("media")]) &&
                  t.setAttribute("media", e),
                  a && t.setAttribute("srcset", a),
                  e &&
                    ((n = t.parentNode),
                    n.insertBefore(t.cloneNode(), t),
                    n.removeChild(t));
              },
              Z = T(function (t, e, n, a, o) {
                var r, l, p, c, f, g;
                (f = w(t, "lazybeforeunveil", e)).defaultPrevented ||
                  (a &&
                    (n ? b(t, i.autosizesClass) : t.setAttribute("sizes", a)),
                  (l = t[s](i.srcsetAttr)),
                  (r = t[s](i.srcAttr)),
                  o &&
                    ((p = t.parentNode), (c = p && u.test(p.nodeName || ""))),
                  (g = e.firesLoad || ("src" in t && (l || r || c))),
                  (f = { target: t }),
                  g &&
                    (y(t, U, !0),
                    clearTimeout(h),
                    (h = d(U, 2500)),
                    b(t, i.loadingClass),
                    y(t, Q, !0)),
                  c && m.call(p.getElementsByTagName("source"), J),
                  l
                    ? t.setAttribute("srcset", l)
                    : r && !c && (F.test(t.nodeName) ? X(t, r) : (t.src = r)),
                  (l || c) && C(t, { src: r })),
                  S(function () {
                    t._lazyRace && delete t._lazyRace,
                      v(t, i.lazyClass),
                      (!g || t.complete) && (g ? U(f) : H--, K(f));
                  });
              }),
              tt = function (t) {
                var e,
                  n = B.test(t.nodeName),
                  a = n && (t[s](i.sizesAttr) || t[s]("sizes")),
                  o = "auto" == a;
                ((!o && c) ||
                  !n ||
                  (!t.src && !t.srcset) ||
                  t.complete ||
                  g(t, i.errorClass)) &&
                  ((e = w(t, "lazyunveilread").detail),
                  o && I.updateElem(t, !0, t.offsetWidth),
                  (t._lazyRace = !0),
                  H++,
                  Z(t, e, o, a, n));
              },
              et = function () {
                if (!c) {
                  if (a.now() - x < 999) return void d(et, 999);
                  var t = E(function () {
                    (i.loadMode = 3), q();
                  });
                  (c = !0),
                    (i.loadMode = 3),
                    q(),
                    l(
                      "scroll",
                      function () {
                        3 == i.loadMode && (i.loadMode = 2), t();
                      },
                      !0
                    );
                }
              };
            return {
              _: function () {
                (x = a.now()),
                  (o = e.getElementsByClassName(i.lazyClass)),
                  (p = e.getElementsByClassName(
                    i.lazyClass + " " + i.preloadClass
                  )),
                  (N = i.hFac),
                  l("scroll", q, !0),
                  l("resize", q, !0),
                  t.MutationObserver
                    ? new MutationObserver(q).observe(n, {
                        childList: !0,
                        subtree: !0,
                        attributes: !0,
                      })
                    : (n[r]("DOMNodeInserted", q, !0),
                      n[r]("DOMAttrModified", q, !0),
                      setInterval(q, 999)),
                  l("hashchange", q, !0),
                  [
                    "focus",
                    "mouseover",
                    "click",
                    "load",
                    "transitionend",
                    "animationend",
                    "webkitAnimationEnd",
                  ].forEach(function (t) {
                    e[r](t, q, !0);
                  }),
                  /d$|^c/.test(e.readyState)
                    ? et()
                    : (l("load", et), e[r]("DOMContentLoaded", q), d(et, 2e4)),
                  q(o.length > 0);
              },
              checkElems: q,
              unveil: tt,
            };
          })(),
          I = (function () {
            var t,
              n = T(function (t, e, i, n) {
                var a, o, r;
                if (
                  ((t._lazysizesWidth = n),
                  (n += "px"),
                  t.setAttribute("sizes", n),
                  u.test(e.nodeName || ""))
                )
                  for (
                    a = e.getElementsByTagName("source"), o = 0, r = a.length;
                    r > o;
                    o++
                  )
                    a[o].setAttribute("sizes", n);
                i.detail.dataAttr || C(t, i.detail);
              }),
              a = function (t, e, i) {
                var a,
                  o = t.parentNode;
                o &&
                  ((i = x(t, o, i)),
                  (a = w(t, "lazybeforesizes", { width: i, dataAttr: !!e })),
                  a.defaultPrevented ||
                    ((i = a.detail.width) &&
                      i !== t._lazysizesWidth &&
                      n(t, o, a, i)));
              },
              o = function () {
                var e,
                  i = t.length;
                if (i) for (e = 0; i > e; e++) a(t[e]);
              },
              r = E(o);
            return {
              _: function () {
                (t = e.getElementsByClassName(i.autosizesClass)),
                  l("resize", r);
              },
              checkElems: r,
              updateElem: a,
            };
          })(),
          L = function () {
            L.i || ((L.i = !0), I._(), A._());
          };
        return (
          (function () {
            var e,
              n = {
                lazyClass: "lazyload",
                loadedClass: "lazyloaded",
                loadingClass: "lazyloading",
                preloadClass: "lazypreload",
                errorClass: "lazyerror",
                autosizesClass: "lazyautosizes",
                srcAttr: "data-src",
                srcsetAttr: "data-srcset",
                sizesAttr: "data-sizes",
                minSize: 40,
                customMedia: {},
                init: !0,
                expFactor: 1.5,
                hFac: 0.8,
                loadMode: 2,
              };
            i = t.lazySizesConfig || t.lazysizesConfig || {};
            for (e in n) e in i || (i[e] = n[e]);
            (t.lazySizesConfig = i),
              d(function () {
                i.init && L();
              });
          })(),
          {
            cfg: i,
            autoSizer: I,
            loader: A,
            init: L,
            uP: C,
            aC: b,
            rC: v,
            hC: g,
            fire: w,
            gW: x,
            rAF: S,
          }
        );
      }
    })(t, t.document);
    (t.lazySizes = i),
      "object" == typeof module && module.exports && (module.exports = i);
  })(window),
  define("lib-app/lazysizes.min", function () {}),
  define(
    "storymaps/tpl/ui/mobile/MobileFeatureList",
    [
      "storymaps/common/utils/CommonHelper",
      "lib-build/css!./MobileFeatureList",
      "lib-build/css!lib-app/Swiper/swiper",
      "lib-app/Swiper/swiper",
      "lib-app/lazysizes.min",
    ],
    function (t) {
      return function (e, i, n, a) {
        function o() {
          $("#navThemeRight").on("click", function () {
            p.slideNext();
          }),
            $("#navThemeLeft").on("click", function () {
              p.slidePrev();
            });
        }
        function r(t) {
          0 === t && p.slides.length > 1
            ? ($("#navThemeLeft").css("display", "none"),
              $("#navThemeRight").css("display", "block"))
            : t == p.slides.length - 1
            ? ($("#navThemeRight").css("display", "none"),
              $("#navThemeLeft").css("display", "block"))
            : ($("#navThemeLeft").css("display", "block"),
              $("#navThemeRight").css("display", "block"));
        }
        function s(t) {
          return $.grep($("ul.mobileTileList li"), function (e, i) {
            return e.id == "item" + t;
          })[0];
        }
        var l = a,
          d = !0,
          p = null,
          c = $("#mobileThemeBarSlider");
        app.scrollList;
        /iPhone|iPod/.test(navigator.userAgent) && window.MSStream,
          /(android)/i.test(navigator.userAgent);
        (this.init = function () {
          (p = new Swiper("#mobileThemeSliderContainer", {
            speed: 0,
            direction: "horizontal",
          })),
            p.on("onSlideChangeEnd", function (t) {
              "visible" == $("#mobileThemeBar").css("visibility") &&
                l.activateLayer(p.activeIndex),
                r(p.activeIndex),
                $("#mobileThemeBar").css(
                  "background-color",
                  app.layerCurrent.color
                );
            }),
            o();
        }),
          (this.addTheme = function (t, e, i) {
            if (!$(".mobileThemeTitle")[i]) {
              if (e)
                $("#mobileThemeBar .swiper-container").css("display", "none"),
                  $("#navThemeLeft").css("display", "none"),
                  $("#navThemeRight").css("display", "none"),
                  $("#navThemeRight").css("display", "none");
              else {
                var n =
                  '<div class="mobileThemeTitle swiper-slide"><p style="margin-top: 7px;">' +
                  t.title +
                  "</p></div>";
                $(c).append(n);
              }
              p.update();
            }
          }),
          (this.showMobileList = function () {
            $("#mobileFeature").css("visibility", "hidden"),
              $("#mobileSupportedLayersView").css("visibility", "hidden"),
              $("#mobileThemeBarSlider").css("display", "block"),
              $("#mobilePaneList").show(),
              $("#returnIcon").css("display", "none"),
              $("#returnHiddenBar").css("display", "none"),
              $("#centerMapIconContainer").css("display", "none"),
              $("#navThemeLeft").css("visibility", "visible"),
              $("#navThemeRight").css("visibility", "visible"),
              l.selected &&
                (l.selected.symbol.setWidth(l.lutIconSpecs.tiny.getWidth()),
                l.selected.symbol.setHeight(l.lutIconSpecs.tiny.getHeight()),
                l.selected.symbol.setOffset(
                  l.lutIconSpecs.tiny.getOffsetX(),
                  l.lutIconSpecs.tiny.getOffsetY()
                ),
                l.selected.draw()),
              (l.selected = null),
              app.mapTips && app.mapTips.clean(!0),
              $(".detailContainer").hide(),
              p.update();
          }),
          (this.selectTheme = function (t) {
            d
              ? p.slideTo(t, 0)
              : (p.slideTo(t, 0), $("#mobileTitlePage").css("display", "none")),
              (d = !1),
              $("#mobileThemeBar").css(
                "background-color",
                app.layerCurrent.color
              ),
              r(t);
          }),
          (this.buildList = function (e, i, n) {
            0 === e && $("#mobileList").empty();
            var a = $(n).clone();
            $(a).data("shortlist-id", i.attributes.shortlist_id);
            var o = i.attributes,
              r =
                o[
                  $.grep(Object.keys(o), function (t) {
                    return "thumb_url" == t.toLowerCase();
                  })[0]
                ];
            r ||
              (r =
                o[
                  $.grep(Object.keys(o), function (t) {
                    return "pic_url" == t.toLowerCase();
                  })[0]
                ]);
            var s;
            r &&
              r.indexOf("sharing/rest/content/items/") > -1 &&
              (r = t.possiblyAddToken(r)),
              (s = $(
                '<div style="height: 75px; max-width: 100px; margin-bottom: 8px;"><div class="mobileTileListImg"></div></div>'
              )),
              $(s)
                .find(".mobileTileListImg")
                .css("background-image", "url(" + r + ")"),
              $(s).find(".mobileTileListImg").attr("alt", ""),
              $(a).append(s),
              $(a).on("tap", app.ui.tilePanel.tile_onClick),
              $(a).on("click", app.ui.tilePanel.tile_onClick),
              $("#mobileList").append(a);
          }),
          (this.setColor = function () {
            app.isInBuilder ||
              $("#mobileThemeBar").css(
                "background-color",
                app.layerCurrent.color
              );
          }),
          (this.refreshMobileList = function () {
            var t,
              e = !1;
            app.layerCurrent &&
              app.layerCurrent.graphics.length &&
              setTimeout(function () {
                $.each(app.layerCurrent.graphics, function (i, n) {
                  (t = s(n.attributes.shortlist_id)),
                    app.map.extent.contains(n.geometry)
                      ? ("none" == $(t).css("display") &&
                          $(t).css("display", "block"),
                        (e = !0))
                      : "none" != $(t).css("display") &&
                        $(t).css("display", "none");
                }),
                  $("#mobilePaneList").scrollTop(0),
                  e
                    ? $(".noFeature").css("display", "none")
                    : $(".noFeature").css("display", "block");
              }, 100);
          });
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/mapcontrols/command/MapCommand",
    [],
    function () {}
  ),
  define(
    "storymaps/common/mapcontrols/command/MapCommand",
    [
      "lib-build/css!./MapCommand",
      "dojo/has",
      "esri/geometry/Point",
      "dojo/on",
      "esri/symbols/PictureMarkerSymbol",
      "esri/layers/GraphicsLayer",
      "esri/graphic",
      "esri/config",
    ],
    function (t, e, i, n, a, o, r, s) {
      return function (t, l, d, p) {
        function c(e) {
          if (e)
            $(t.container).find(".mapCommandHomeBtn").addClass("loading"),
              (m = Date.now());
          else {
            var i = Date.now() - m,
              n = 0;
            i < 450 && (n = 450 - i),
              setTimeout(function () {
                $(t.container)
                  .find(".mapCommandHomeBtn")
                  .removeClass("loading"),
                  (m = 0);
              }, n);
          }
        }
        function u() {
          console.log("getDeviceLocation");
          var e = !1;
          setTimeout(function () {
            e || $(t.container).find(".mapCommandLocation").addClass("loading");
          }, 300),
            navigator.geolocation.getCurrentPosition(
              function (n) {
                (e = !0),
                  $(t.container)
                    .find(".mapCommandLocation")
                    .removeClass("loading");
                var a = new i(n.coords.longitude, n.coords.latitude);
                if (
                  (d && "function" == typeof d && d(!0, a, n),
                  102100 != t.spatialReference.wkid &&
                    4326 != t.spatialReference.wkid)
                )
                  return void s.defaults.geometryService.project(
                    [a],
                    t.spatialReference,
                    function (t) {
                      t && t[0] && h(t[0]);
                    }
                  );
                h(a);
              },
              function (t) {
                (e = !0), f(t);
              },
              { enableHighAccuracy: !0, maximumAge: 12e4, timeout: 1e4 }
            ),
            setTimeout(function () {
              e || f();
            }, 1e4);
        }
        function h(t) {
          v.clear(),
            v.add(new r(t, b)),
            setTimeout(function () {
              $("#locateLayer_layer image").fadeOut({ duration: 800 });
            }, 1e4);
        }
        function f(e) {
          console.log("getDeviceLocationError", e),
            $(t.container).find(".mapCommandLocation").removeClass("loading"),
            d(!1, null);
        }
        var m = 0,
          g = $(
            '<div class="esriSimpleSliderIncrementButton"><div class="mapCommandHomeBtn" title="' +
              (i18n.viewer.mapFromCommon
                ? i18n.viewer.mapFromCommon.home
                : "Zoom Home") +
              '" role="button" tabindex="0"></div></div>'
          ),
          b = new a(
            "resources/common/icons/mapcommand-location-marker.png",
            21,
            21
          ),
          v = new o({ id: "locateLayer" });
        g.on("click keydown", function (e) {
          ("keydown" === e.type && 32 !== e.keyCode && 13 !== e.keyCode) ||
            (0 !== m && $("body").hasClass("mobile-view")) ||
            (l && "function" == typeof l
              ? l(t._params.extent)
              : t.setExtent(t._params.extent));
        }),
          $(t.container).find(".esriSimpleSlider div:nth-child(1)").after(g),
          n(t, "update-start", function () {
            0 === m && c(!0);
          }),
          n(t, "update-end", function () {
            c(!1);
          }),
          (this.setMobile = function (e) {
            $(".esriSimpleSlider, .mapCommandHomeBtn", t.container).toggleClass(
              "touch",
              !!e
            );
          }),
          (this.destroy = function () {
            $(t.container).find(".esriSimpleSliderIncrementButton").remove(),
              $(t.container).find(".mapCommandLocation").remove();
          }),
          (this.startLoading = function () {
            c(!0);
          }),
          (this.stopLoading = function () {
            c(!1);
          }),
          (this.enableLocationButton = function (e) {
            $(t.container).toggleClass("has-locator", e),
              $(".mapCommandLocation", t.container).toggleClass("hidden", !e);
          }),
          navigator &&
            navigator.geolocation &&
            window.top === window.self &&
            window.location.protocol.search("https") >= 0 &&
            ($(".esriSimpleSlider", t.container).after(
              '<div class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"></div>'
            ),
            $(".mapCommandLocation", t.container).click(u),
            this.enableLocationButton(p),
            t.addLayer(v)),
          this.setMobile(
            app.appCfg.mapCommandLargerTouch ||
              (void 0 === app.appCfg.mapCommandLargerTouch && e("touch"))
          );
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/mapcontrols/legend/Legend",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p +=
            '<div class="legendContainer mapControls">\n\t<button class="titleBtn">\n\t\t<span class="collapseBtn" aria-hidden="true">\n\t\t\t<div class="glyphicon glyphicon-chevron-down"></div>\n\t\t\t<div class="glyphicon glyphicon-chevron-up"></div>\n\t\t</span>\n\t\t' +
            (null == (__t = title) ? "" : __t) +
            '\n\t</button>\n\n\t<div class="content">\n\t\t<div class="legendDijitContainer"></div>\n\t\t'),
            isInBuilder &&
              (__p +=
                '\n\t\t\t<div class="settingsGear glyphicon glyphicon-wrench"></div>\n\t\t\t<div class="settingsOverlay">\n\t\t\t\t<div class="settings-title">' +
                (null == (__t = settings) ? "" : __t) +
                '</div>\n\t\t\t\t<div class="settings-content">\n\t\t\t\t\t\x3c!-- Open by default --\x3e\n\t\t\t\t\t<div class="checkbox">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type="checkbox" class="expandStartup" />\n\t\t\t\t\t\t\t' +
                (null == (__t = openDefault) ? "" : __t) +
                "\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),
            (__p += "\n\t</div>\n</div>\n");
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/mapcontrols/legend/Legend",
    [],
    function () {}
  ),
  define(
    "lib-build/css!storymaps/common/mapcontrols/Common",
    [],
    function () {}
  ),
  define(
    "storymaps/common/mapcontrols/legend/Legend",
    [
      "lib-build/tpl!./Legend",
      "lib-build/css!./Legend",
      "lib-build/css!../Common",
      "storymaps/common/utils/CommonHelper",
      "esri/dijit/Legend",
      "esri/arcgis/utils",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o, r) {
      return function (e, i, s) {
        function l() {
          m
            .find(".legendDijitContainer")
            .html('<div class="legendDijit"></div>'),
            (h = new a(
              { map: e.map, layerInfos: o.getLegendLayers(e) },
              m.find(".legendDijit")[0]
            )),
            h.startup(),
            r.publish("story-created-legend", e.itemInfo.item.id);
        }
        function d() {
          h && h.destroy(), (h = null);
        }
        function p() {
          m.find(".legendContainer").toggleClass("collapsed"),
            m.find(".settingsOverlay").hide();
        }
        function c() {
          (f.openByDefault = m.find(".expandStartup").prop("checked")),
            r.publish("BUILDER_INCREMENT_COUNTER", 1);
        }
        var u = this,
          h = null,
          f = null,
          m = s.container,
          g = { isInBuilder: i, title: i18n.viewer.mapFromCommon.legend };
        i &&
          ((g.settings = i18n.commonMapControls.common.settings),
          (g.openDefault = i18n.commonMapControls.common.openDefault)),
          m.html(t(g)),
          (this.toggle = function (t) {
            m.toggle(!!t), t && !h ? l() : t || d();
          }),
          (this.toggleExpanded = function (t) {
            m.find(".legendContainer").toggleClass("collapsed", !t);
          }),
          (this.setColors = function (t) {
            m
              .find(".legendContainer")
              .css({ backgroundColor: t.mapControls, color: t.text }),
              m.find(".titleBtn").css("color", t.softText),
              m.find(".settingsGear, .collapseBtn").css("color", t.softBtn),
              n.addCSSRule(
                ".mainMediaContainer .legendContainer ::-webkit-scrollbar-thumb { background-color:" +
                  t.header +
                  "; }",
                "MapControlLegendDropdownScrollbar"
              );
          }),
          (this.updatePlacementSettings = function (t) {
            m
              .find(".legendContainer")
              .toggleClass("isInlined", "panel" == t.mode),
              t.container[0] != m[0] &&
                (t.container.html(m.find(".legendContainer")),
                (m = t.container));
          }),
          (this.setSettings = function (t) {
            (f = t), m.find(".expandStartup").prop("checked", f.openByDefault);
          }),
          (function () {
            m.find(".titleBtn").click(p),
              m.find(".settingsGear").click(function () {
                m.find(".settingsOverlay").is(":visible")
                  ? m.off("mouseleave")
                  : m.mouseleave(function () {
                      m.find(".settingsOverlay").toggle(),
                        m.off("mouseleave"),
                        m.find(".content").removeClass("settingsOpen");
                    }),
                  m.find(".settingsOverlay").toggle(),
                  m.find(".content").toggleClass("settingsOpen");
              }),
              m.find(".expandStartup").change(c),
              u.updatePlacementSettings(s);
          })();
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/mapcontrols/overview/Overview",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p +=
            '<div class="overviewContainer mapControls">\n\t<button class="titleBtn">\n\t\t<span class="collapseBtn" aria-hidden="true">\n\t\t\t<div class="glyphicon glyphicon-chevron-down"></div>\n\t\t\t<div class="glyphicon glyphicon-chevron-up"></div>\n\t\t</span>\n\t\t' +
            (null == (__t = title) ? "" : __t) +
            '\n\t</button>\n\n\t<div class="content">\n\t\t<div class="overviewMapContainer">\n\t\t\t\x3c!-- Map is injected here --\x3e\n\t\t</div>\n\t\t'),
            isInBuilder &&
              (__p +=
                '\n\t\t\t<div class="settingsGear glyphicon glyphicon-wrench"></div>\n\t\t\t<div class="settingsOverlay">\n\t\t\t\t<div class="settings-title">' +
                (null == (__t = settings) ? "" : __t) +
                '</div>\n\t\t\t\t<div class="settings-content">\n\t\t\t\t\t\x3c!-- Open by default --\x3e\n\t\t\t\t\t<div class="checkbox">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type="checkbox" class="expandStartup" />\n\t\t\t\t\t\t\t' +
                (null == (__t = openDefault) ? "" : __t) +
                '\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- Basemap --\x3e\n\t\t\t\t\t<div class="btn-group dropup basemap-dropdown">\n\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm dropdown-toggle basemapBtn" data-toggle="dropdown">\n\t\t\t\t\t\t\t' +
                (null == (__t = basemapGalleryBtnLabel) ? "" : __t) +
                ' <span class="caret"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<ul class="dropdown-menu basemaps dropdown-menu-form pull-right" role="menu"></ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="basemapGallery"></div>\n\n\t\t\t\t\t\x3c!-- Expand factor --\x3e\n\t\t\t\t\t<div class="spinnerLabel">\n\t\t\t\t\t\t<label for="expandFactorSpinner">' +
                (null == (__t = expandFactorLabel) ? "" : __t) +
                '</label>\n\t\t\t\t\t\t<a class="locateBtnHelp" data-original-title="" title="">\n\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;">\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="input-group expandFactorSpinner">\n\t\t\t\t\t\t<input type="text" class="form-control input-small input-xs" id="expandFactorSpinner" value="2">\n\t\t\t\t\t\t<div class="input-group-btn-vertical">\n\t\t\t\t\t\t\t<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-up"></i></button>\n\t\t\t\t\t\t\t<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-down"></i></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'),
            (__p += "\n\t</div>\n</div>\n");
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/mapcontrols/overview/Overview",
    [],
    function () {}
  ),
  define(
    "storymaps/common/mapcontrols/overview/Overview",
    [
      "lib-build/tpl!./Overview",
      "lib-build/css!./Overview",
      "lib-build/css!../Common",
      "esri/dijit/OverviewMap",
      "esri/dijit/BasemapGallery",
      "esri/layers/ArcGISTiledMapServiceLayer",
      "esri/arcgis/utils",
      "dojo/Deferred",
      "dojo/dom",
      "dojo/on",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p) {
      return function (e, i, a) {
        function o(t) {
          i
            .find(".overviewMapContainer")
            .html('<div class="overviewMap"></div>'),
            (d = new n(
              { map: e, visible: !0, color: "transparent", opacity: 1 },
              i.find(".overviewMap")[0]
            )),
            d.startup();
          var a = t ? t.header : u;
          a && i.find(".ovwHighlight").css("border", "3px solid " + a);
        }
        function r() {
          d && d.destroy(), (d = null);
        }
        function s() {
          i.find(".overviewContainer").toggleClass("collapsed"),
            i.find(".settingsOverlay").hide();
        }
        function l() {
          (c.openByDefault = i.find(".expandStartup").prop("checked")),
            p.publish("BUILDER_INCREMENT_COUNTER", 1);
        }
        var d = null,
          c = null,
          u = null,
          h = {
            isInBuilder: a,
            title: i18n.viewer.mapFromCommon.overview,
            overlayHeader: "",
            basemapGalleryBtnLabel: "",
            expandFactorLabel: "",
          };
        a &&
          ((h.settings = i18n.commonMapControls.common.settings),
          (h.openDefault = i18n.commonMapControls.common.openDefault),
          (h.basemapGalleryBtnLabel =
            i18n.commonMapControls.overview.basemapGalleryBtnLabel),
          (h.expandFactorLabel =
            i18n.commonMapControls.overview.expandFactorLabel)),
          i.append(t(h)),
          (this.toggle = function (t, e) {
            i.toggle(!!t), t && !d ? o(e) : t || r();
          }),
          (this.toggleExpanded = function (t) {
            i.find(".overviewContainer").toggleClass("collapsed", !t);
          }),
          (this.setColors = function (t) {
            (u = t.mapControls),
              i
                .find(".overviewContainer")
                .css({ backgroundColor: u, color: t.text }),
              i.find(".titleBtn").css("color", t.softText),
              i.find(".settingsGear, .collapseBtn").css("color", t.softBtn),
              i.find(".ovwHighlight").css("border", "3px solid " + u);
          }),
          (this.setSettings = function (t) {
            (c = t), i.find(".expandStartup").prop("checked", c.openByDefault);
          }),
          (function () {
            i.find(".titleBtn").click(s),
              i.find(".settingsGear").click(function () {
                i.find(".settingsOverlay").is(":visible")
                  ? i.off("mouseleave")
                  : i.mouseleave(function () {
                      i.find(".settingsOverlay").toggle(), i.off("mouseleave");
                    }),
                  i.find(".settingsOverlay").toggle();
              }),
              i.find(".expandStartup").change(l);
          })();
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/mapcontrols/geocoder/Geocoder",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="geocoderBtn">\n\t<div class="geocoderContainer"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/mapcontrols/geocoder/Geocoder",
    [],
    function () {}
  ),
  define(
    "storymaps/common/mapcontrols/geocoder/Geocoder",
    [
      "lib-build/tpl!./Geocoder",
      "lib-build/css!./Geocoder",
      "../../utils/CommonHelper",
    ],
    function (t, e, i) {
      return function (e, n, a, o) {
        function r() {
          var t = $(e.container).find(".geocoderBtn");
          s = i
            .createGeocoder({
              map: e,
              domNode: t.find(".geocoderContainer")[0],
              enableButtonMode: !0,
              searchOptions: o,
            })
            .then(function (e) {
              (d = e),
                t
                  .find(".esriGeocoderContainer input, .esriGeocoderSearch")
                  .attr("tabindex", "-1");
            });
        }
        var s,
          l = this,
          d = null;
        (this.toggle = function (t) {
          if (!app.isInBuilder) {
            var i = app.data.getWebAppData();
            if (
              i.getMapOptions &&
              (!i.getMapOptions().geocoder ||
                !i.getMapOptions().geocoder.enable)
            )
              return;
            if (i.getGeneralOptions && !i.getGeneralOptions().geocoder) return;
          }
          var n = $(e.container).find(".geocoderBtn");
          d || (s && !s.isRejected()) || r(),
            $(e.container).toggleClass("has-geocoder", t),
            n.toggle(t);
        }),
          (function () {
            $(e.container).find(".esriSimpleSlider").last().after(t({})),
              r(),
              l.toggle(a);
          })();
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/utils/SocialSharing",
    [],
    function () {}
  ),
  define(
    "lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator",
    [],
    function () {}
  ),
  define("lib-build/css!storymaps/tpl/ui/Common", [], function () {}),
  define("lib-build/css!storymaps/tpl/ui/mobile/Common", [], function () {}),
  define("lib-build/css!storymaps/tpl/ui/Responsive", [], function () {}),
  define(
    "lib-build/css!storymaps/tpl/ui/desktop/MultiTips",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/core/MainView",
    [
      "lib-build/css!./MainView",
      "./Config",
      "./Data",
      "./WebApplicationData",
      "./Helper",
      "./arcgis-html-sanitizer",
      "../ui/desktop/TestPanel",
      "../ui/desktop/TilePanel",
      "../ui/desktop/DetailPanel",
      "../ui/desktop/NavBar",
      "../ui/desktop/MultiTips",
      "storymaps/common/ui/autoplay/Autoplay",
      "../ui/mobile/MobileIntro",
      "../ui/mobile/MobileFeatureList",
      "storymaps/common/mapcontrols/command/MapCommand",
      "storymaps/common/mapcontrols/legend/Legend",
      "storymaps/common/mapcontrols/overview/Overview",
      "storymaps/common/mapcontrols/geocoder/Geocoder",
      "lib-build/css!storymaps/common/ui/Modal.css",
      "lib-build/css!storymaps/common/utils/SocialSharing.css",
      "lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator.css",
      "storymaps/common/utils/CommonHelper",
      "dojo/has",
      "dojo/topic",
      "dojo/on",
      "dojo/dom",
      "dojo/DeferredList",
      "dojo/_base/lang",
      "esri/arcgis/utils",
      "esri/geometry/Point",
      "esri/geometry/screenUtils",
      "esri/geometry/Extent",
      "esri/dijit/Search",
      "esri/SpatialReference",
      "esri/tasks/query",
      "esri/graphic",
      "esri/symbols/SimpleMarkerSymbol",
      "lib-build/css!../ui/Common",
      "lib-build/css!../ui/mobile/Common",
      "lib-build/css!../ui/Responsive",
      "lib-build/css!../ui/desktop/MultiTips",
    ],
    function (
      t,
      e,
      i,
      n,
      a,
      o,
      r,
      s,
      l,
      d,
      p,
      c,
      u,
      h,
      f,
      m,
      g,
      b,
      v,
      y,
      w,
      C,
      x,
      S,
      T,
      k,
      E,
      A,
      I,
      L,
      P,
      D,
      M,
      O,
      R,
      N,
      B
    ) {
      return function (t) {
        function r(t) {
          var e = t.itemInfo.itemData,
            i = e.applicationProperties,
            n = i && i.viewing && i.viewing.search,
            a = e.operationalLayers || [];
          if (n)
            return (
              n.layers.forEach(function (t) {
                _.find(a, function (e) {
                  if (e.id === t.id)
                    return (t.name = e.name), (t.title = e.title), !0;
                });
              }),
              n
            );
        }
        function m(t) {
          return (
            $.each(t, function (t, e) {
              e.attributes = app.sanitizer.sanitize(e.attributes);
            }),
            t
          );
        }
        function g(t) {
          var e,
            i = app.map.getLayer(
              app.data.getWebAppData().getShortlistLayerId()
            ),
            n = t.fields;
          if (
            ($.each(n, function (t, i) {
              "tab_name" == i.name.toLowerCase() && (e = !0);
            }),
            e)
          ) {
            var a = new B(),
              o = new esri.layers.GraphicsLayer({
                id: app.data.getWebAppData().getShortlistLayerId() + "_copy",
              });
            app.data.getWebAppItem().created > app.cfg.HTML_SANITIZER_DATE &&
              (t.features = m(t.features)),
              $.each(t.features, function (t, e) {
                var i = new N(e.geometry, a, e.attributes);
                o.add(i);
              }),
              (layerFound = !0),
              (o.fields = n),
              app.data.getWebAppData().setShortlistLayerId(o.id),
              app.map.removeLayer(i),
              app.map.addLayer(o),
              v(o);
          }
        }
        function v(t) {
          var e = [],
            i = [],
            a = t.fields,
            o = !1,
            r = !1,
            s = null;
          if (
            ($.each(a, function (t, e) {
              "name" == e.name.toLowerCase() && (o = !0),
                "pic_url" == e.name.toLowerCase() && (r = !0),
                s || "number" != e.name.toLowerCase() || (s = e.name),
                "placenumsl" == e.name.toLowerCase() && (s = e.name);
            }),
            !o || !r)
          ) {
            if (app.isInBuilder) {
              var l = i18n.builder.migration.migrationPattern.badData;
              (l +=
                '  (<a href="http://links.esri.com/storymaps/shortlist_layer_template" target="_blank" download="">' +
                i18n.builder.migration.migrationPattern.downloadTemplate +
                "</a>)"),
                $("#fatalError .error-msg").html(l),
                $("#fatalError").show();
            }
            return !1;
          }
          app.data.setShortlistLayerId(t.id),
            app.data.getWebAppData().setShortlistLayerId(t.id),
            t.setScaleRange(0, 0),
            t.on("mouse-over", K.layer_onMouseOver),
            t.on("mouse-out", K.layer_onMouseOut),
            t.on("click", K.layer_onClick);
          var d = [];
          $.each(app.map.graphicsLayerIds, function (e, i) {
            i !== t.id && d.push(app.map.getLayer(i));
          }),
            $.each(d, function (t, e) {
              e.on("click", P);
            }),
            app.isInBuilder &&
              (app.map.on("pan-start", function () {
                app.ui.mainView.mapIsPanning = !1;
              }),
              app.map.on("pan-end", function () {
                setTimeout(function () {
                  app.ui.mainView.mapIsPanning = !1;
                }, 800);
              }),
              app.map.on("zoom-start", function () {
                app.ui.mainView.mapIsZooming = !1;
              }),
              app.map.on("zoom-end", function () {
                setTimeout(function () {
                  app.ui.mainView.mapIsZooming = !1;
                }, 800);
              })),
            app.map.on("click", function (t) {
              K.mapIsPanning ||
                K.mapIsZooming ||
                (app.mapTips &&
                  (t.graphic
                    ? K.selected && (K.selected.hidden = !1)
                    : (app.mapTips.clean(!0),
                      K.selected &&
                        !app.isInBuilder &&
                        (K.selected.hidden = !0))));
            }),
            app.map.reorderLayer(t, app.map.graphicsLayerIds.length),
            $.each(t.graphics, function (n, a) {
              var o = t.graphics[n].attributes,
                r =
                  o[
                    $.grep(Object.keys(o), function (t) {
                      return "tab_name" == t.toLowerCase();
                    })[0]
                  ];
              if (r) {
                if (i.indexOf(r) < 0) {
                  i.push(r), e.push({ features: [], extent: null, title: r });
                  var l = e.length - 1;
                  e[l].id = l;
                  var d;
                  if (
                    app.data.getWebAppData().getTabs()[l] &&
                    app.data.getWebAppData().getTabs()[l].color
                  )
                    d = app.data.getWebAppData().getTabs()[l].color;
                  else {
                    var p = l;
                    p > 7 && (p %= 7);
                    var c = app.cfg.COLOR_ORDER.split(",");
                    d = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                      return t.name.toLowerCase() == $.trim(c[p].toLowerCase());
                    })[0].color;
                  }
                  (e[e.length - 1].color = d), app.data.setStory(l, r, d);
                }
                $.grep(e, function (t, i) {
                  t.title == r &&
                    ((a.attributes.tab_id = i),
                    (a.attributes.shortlist_id = e[i].features.length + 1),
                    (a.attributes.number = s
                      ? a.attributes[s]
                      : e[i].features.length + 1),
                    t.features.push(a));
                });
              }
            }),
            s &&
              ($.each(t.graphics, function (t, e) {
                e.attributes.number = e.attributes[s];
              }),
              t.graphics.sort(W));
          var p = {
            header: app.data.getWebAppData().getThemeOptions().headerColor,
            tabText: "#d8d8d8",
            tab: "#666",
            tabTextActive: "#fff",
            tabActive: app.data.getStory()[0].color,
            tabTextHover: "#fff",
            tabHover: "#666",
          };
          app.ui.navBar.init(e, 0, p, app.data.getWebAppData()),
            1 != e.length ||
              app.isInBuilder ||
              $(".entries").css("display", "none"),
            $.each(e, function (t, i) {
              K.buildLayer(i.features, i.color),
                app.ui.mobileIntro.fillList(t, i, e);
              var n = !1;
              1 == e.length &&
                ((n = !0),
                $("#navThemeLeft").addClass("hideButtons"),
                $("#navThemeRight").addClass("hideButtons")),
                app.ui.mobileFeatureList.addTheme(i, n, t);
            }),
            K.activateLayer(0, e),
            $("#basemapChooser").remove(),
            V.appInitComplete(n),
            app.data.getWebAppData().getIsExternalData() &&
              app.isWebMapFirstSave &&
              setTimeout(function () {
                V.displayApp();
              }, 0);
        }
        function y() {
          if (
            ($.isEmptyObject(app.data.getWebAppData().getThemeOptions()) &&
              app.data.getWebAppData().setDefaultThemeOptions(),
            app.data.getWebAppData().getIsExternalData())
          ) {
            var e = app.data.getWebMap().item.extent,
              i = new D(
                e[0][0],
                e[0][1],
                e[1][0],
                e[1][1],
                new O({ wkid: 4326 })
              );
            app.data.getWebAppData().setMapExtent(i);
          }
          if (
            (app.data.getWebAppData().getGeneralOptions().bookmarks &&
              app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo
                .itemData.bookmarks &&
              app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo
                .itemData.bookmarks.length &&
              app.ui.navBar.initBookmarks(),
            app.data.getWebAppData().getWebmap() &&
              (app.mapItem =
                app.maps[
                  app.data.getWebAppData().getWebmap()
                ].response.itemInfo),
            app.data.getWebAppData().getGeneralOptions().geocoder &&
              !app.isInBuilder &&
              app.maps[app.data.getWebAppData().getWebmap()].geocoder.toggle(
                !0
              ),
            app.map)
          ) {
            setTimeout(function () {
              if (app.data.getWebAppData().getMapExtent())
                setTimeout(function () {
                  var t = app.map.on("extent-change", function () {
                      t.remove(), V.displayApp();
                    }),
                    e = new D(app.data.getWebAppData().getMapExtent());
                  102100 != app.map.spatialReference.wkid &&
                  4326 != app.map.spatialReference.wkid
                    ? (e = esriConfig.defaults.geometryService.project(
                        [e],
                        app.map.spatialReference,
                        function (t) {
                          (e = t[0]), app.map.setExtent(e, !0);
                        }
                      ))
                    : app.map.setExtent(e, !0);
                }, 500);
              else if (
                app.data.getWebAppData().getTabs() &&
                app.data.getWebAppData().getTabs()[0] &&
                app.data.getWebAppData().getTabs()[0].extent
              ) {
                var t = new D(app.data.getWebAppData().getTabs()[0].extent);
                app.appCfg.mapExtentFit = !0;
                var e = app.map.on("extent-change", function () {
                  e.remove(), V.displayApp();
                });
                setTimeout(function () {
                  102100 != app.map.spatialReference.wkid &&
                  4326 != app.map.spatialReference.wkid
                    ? (t = esriConfig.defaults.geometryService.project(
                        [t],
                        app.map.spatialReference,
                        function (e) {
                          (t = e[0]), app.map.setExtent(t, !0);
                        }
                      ))
                    : app.map.setExtent(t, !0);
                }, 500);
              } else if (app.isDirectCreationFirstSave) {
                var e = app.map.on("extent-change", function () {
                  e.remove(), V.displayApp();
                });
                app.map.centerAndZoom([0, 0], 3);
              } else {
                var e = app.map.on("extent-change", function () {
                  e.remove(), V.displayApp();
                });
                setTimeout(function () {
                  app.map.setExtent(app.map._params.extent);
                }, 500);
              }
              app.map.on("extent-change", function () {
                setTimeout(function () {
                  app.data.getWebAppData().getGeneralOptions().filterByExtent &&
                    !app.isInBuilder &&
                    (app.ui.tilePanel.refreshList(),
                    app.ui.mobileFeatureList.refreshMobileList(),
                    app.ui.detailPanel.loaded &&
                      app.ui.detailPanel.refreshSlides());
                }, 0);
              });
            }, 750),
              app.ui.mobileIntro.setTitle();
            var a = app.data.getWebAppData().getThemeOptions().headerColor;
            $("#header").css("background-color", a),
              $("#mobileIntro").css("background-color", a),
              n.getTabs() &&
                $.each(n.getTabs(), function (t, e) {
                  app.data.setStory(t, e.title, e.color, e.extent);
                });
            var o = $.grep(app.map.graphicsLayerIds, function (t) {
              return t.split("_").slice(0, -1).join("_") ==
                n.getShortlistLayerId()
                ? t
                : t == n.getShortlistLayerId() && t;
            });
            app.data.setShortlistLayerId(o[0]),
              app.map.loaded
                ? w()
                : app.map.on("load", function () {
                    w();
                  }),
              T.once(app.map, "update-end", function () {
                w();
              }),
              t && t.storyDataReady();
          }
        }
        function w() {
          if (app.data.getWebAppData().getIsExternalData())
            return void K.processExternalData();
          app.map.resize(),
            app.map.on("click", function (t) {
              K.mapIsPanning ||
                K.mapIsZooming ||
                (app.mapTips &&
                  (t.graphic
                    ? K.selected && (K.selected.hidden = !1)
                    : (app.mapTips.clean(!0),
                      K.selected &&
                        !app.isInBuilder &&
                        (K.selected.hidden = !0))));
            });
          var t = [];
          if (
            ($.each(n.getTabs(), function (e, i) {
              t.push({
                features: [],
                title: i.title,
                color: i.color,
                extent: i.extent,
              });
            }),
            !app.data.getWebAppData().getIsExternalData())
          ) {
            var e = app.map.getLayer(
              app.data.getWebAppData().getShortlistLayerId()
            )
              ? app.data.getWebAppData().getShortlistLayerId()
              : app.data.getWebAppData().getShortlistLayerId() + "_0";
            app.data.getWebAppData().setShortlistLayerId(e);
          }
          if (app.data.getWebAppItem().created > app.cfg.HTML_SANITIZER_DATE) {
            app.map.getLayer(app.data.getWebAppData().getShortlistLayerId())
              .graphics;
            m(
              app.map.getLayer(app.data.getWebAppData().getShortlistLayerId())
                .graphics
            );
          }
          var i = app.map.getLayer(
            app.data.getWebAppData().getShortlistLayerId()
          );
          i.setScaleRange(0, 0),
            $.each(i.graphics, function (e, i) {
              if (
                (i.attributes.locationSet &&
                  i.attributes.name &&
                  "Unnamed Place" != i.attributes.name &&
                  i.attributes.pic_url &&
                  !app.isInBuilder &&
                  t[i.attributes.tab_id].features.push(i),
                app.data.getWebAppData().getIsExternalData())
              ) {
                var n = i.attributes,
                  a =
                    n[
                      $.grep(Object.keys(n), function (t) {
                        return "tab_name" == t.toLowerCase();
                      })[0]
                    ];
                $.grep(t, function (t, e) {
                  t.title == a && (i.attributes.tab_id = e);
                }),
                  t[i.attributes.tab_id].features.push(i),
                  (i.attributes.shortlist_id =
                    t[i.attributes.tab_id].features.length);
              } else app.isInBuilder && t[i.attributes.tab_id].features.push(i);
            }),
            i.on("click", K.layer_onClick),
            i.on("mouse-over", K.layer_onMouseOver),
            i.on("mouse-out", K.layer_onMouseOut);
          var a = [];
          if (
            ($.each(app.map.graphicsLayerIds, function (t, e) {
              e !== i.id && a.push(app.map.getLayer(e));
            }),
            $.each(a, function (t, e) {
              e.on("click", P);
            }),
            t.length > 1 || (app.isInBuilder && !app.isDirectCreationFirstSave))
          ) {
            if (
              ($("#divStrip").height("35px"),
              $.each(t, function (e, i) {
                app.ui.tilePanel.createTab(e, i),
                  app.ui.mobileIntro.fillList(e, i, t),
                  app.ui.mobileFeatureList.addTheme(i, null, e);
                var n = e;
                n > 7 && (n %= 7);
                var a = app.cfg.COLOR_ORDER.split(","),
                  o = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                    return t.name.toLowerCase() == $.trim(a[n].toLowerCase());
                  })[0],
                  r = i.color || o.color;
                if ((K.buildLayer(i.features.sort(W), r), app.isInBuilder)) {
                  app.data.setStory(e, i.title, o.color, i.extent);
                  var s = A.clone(app.data.getStory());
                  $.each(s, function (t, e) {
                    (e.title = i.title), (e.color = r);
                  }),
                    app.detailPanelBuilder.addDetailPanelSwiper(e);
                }
                app.data.setStory(e, i.title, i.color);
              }),
              !app.isDirectCreationFirstSave &&
                !app.data.getWebAppData().getIsExternalData())
            ) {
              var o = {
                header: app.data.getWebAppData().getThemeOptions().headerColor,
                tabText: "#d8d8d8",
                tab: "#666",
                tabTextActive: "#fff",
                tabActive: "#999",
                tabTextHover: "#fff",
                tabHover: "#666",
              };
              app.ui.navBar.init(t, 0, o, n), app.ui.tilePanel.setTabClick();
            }
          } else {
            if (t.length < 1) return !1;
            $.each(t, function (t, e) {
              app.ui.tilePanel.createTab(t, e),
                app.ui.mobileFeatureList.addTheme(e, !0, t);
              var i = app.cfg.COLOR_ORDER.split(","),
                n = $.grep(app.cfg.COLOR_SCHEMES, function (e) {
                  return e.name.toLowerCase() == $.trim(i[t].toLowerCase());
                })[0],
                a = e.color || n.color;
              if ((K.buildLayer(e.features.sort(W), a), app.isInBuilder)) {
                app.data.setStory(t, e.title, n.color);
                var o = A.clone(app.data.getStory());
                $.each(o, function (t, i) {
                  (i.title = e.title), (i.color = a);
                }),
                  app.detailPanelBuilder.addDetailPanelSwiper(t);
              }
            }),
              $(".tab").css("display", "none"),
              $("#mobileIntro").append("<br><hr></hr>"),
              $("#mobileIntro").append(
                '<ul id="mobileThemeList" class="mobileTileList">'
              );
            var r = $(
              '<li class="mobileTitleTheme" onclick="app.ui.mobileIntro.selectMobileTheme(0)">'
            ).append(
              '<div class="startButton"> ' +
                i18n.viewer.general.start +
                "</div>"
            );
            $("#mobileThemeList").append(r),
              $("#navThemeLeft").addClass("hideButtons"),
              $("#navThemeRight").addClass("hideButtons"),
              $("#nav-bar").show(),
              $("#nav-bar .entries").hide();
          }
          if (
            (V.handleWindowResize(),
            K.activateLayer(0),
            app.isInBuilder && app.detailPanelBuilder.buildSlides(),
            $(".entryLbl").css("outline-style", "none"),
            $("#zoomToggle").css("visibility", "visible"),
            $("#whiteOut").fadeOut("slow"),
            $("body").width() > 768)
          ) {
            var s = $("body").height(),
              l = 0;
            $(".mainViewAboveMap, .mainViewBelowMap").each(function (t, e) {
              var i = $(e);
              l += i.is(":visible") ? i.outerHeight() : 0;
            }),
              $("#paneLeft").height(
                s -
                  l -
                  25 -
                  $("#tabs").height() +
                  (app.embedBar && app.embedBar.initiated ? 26 : 0)
              ),
              $("#paneLeft").css("top", $("#divStrip").height()),
              $("#map").height($("#contentPanel").height()),
              $("#map").css("top", 0),
              $(".tilelist").height(
                $("#paneLeft").height() -
                  (app.isInBuilder &&
                  !app.data.getWebAppData().getIsExternalData()
                    ? 70
                    : 25) -
                  (app.embedBar && app.embedBar.initiated ? 5 : 0)
              );
          } else app.ui.mobileIntro.resizeMobileElements();
          V.appInitComplete(n),
            $("body").on("mousedown", "*", function (t) {
              ($(this).is(":focus") || $(this).is(t.target)) &&
                "none" == $(this).css("outline-style") &&
                ($(this)
                  .css("outline", "none")
                  .on("blur", function () {
                    $(this).off("blur").css("outline", "");
                  }),
                $(this).parents("#bookmarksToggle").length &&
                  $(this)
                    .parents("#bookmarksToggle")
                    .css("outline", "none")
                    .on("blur", function () {
                      $(this).off("blur").css("outline", "");
                    }));
            }),
            app.map.disableKeyboardNavigation(),
            $("body").keypress(function (t) {
              13 == t.which && $(document.activeElement).click(),
                43 == t.which &&
                  (app.map.setLevel(app.map.getLevel() + 1),
                  $("#zoomIn").focus(),
                  K.hideBookmarks()),
                45 == t.which &&
                  (app.map.setLevel(app.map.getLevel() - 1),
                  $("#zoomOut").focus(),
                  K.hideBookmarks());
            }),
            app.map.reorderLayer(
              app.data.getWebAppData().getShortlistLayerId(),
              app.map.graphicsLayerIds.length - 1
            );
        }
        function k(t, e) {
          var i = 4 * e,
            n = t.data;
          return [n[i], n[i + 1], n[i + 2], n[i + 3]];
        }
        function E(t) {
          var e = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
          t = t.replace(e, function (t, e, i, n) {
            return e + e + i + i + n + n;
          });
          var i = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);
          return i
            ? {
                r: parseInt(i[1], 16),
                g: parseInt(i[2], 16),
                b: parseInt(i[3], 16),
              }
            : null;
        }
        function L(t, e, i) {
          return new esri.symbol.PictureMarkerSymbol(
            e.toDataURL(),
            i.getWidth(),
            i.getHeight()
          ).setOffset(i.getOffsetX(), i.getOffsetY());
        }
        function P(t) {
          (K.selected = null), $("#mobileTitlePage").css("display", "none");
          var e = $(".esriPopup")[0];
          app.map.infoWindow.on("set-features", function () {
            app.ui.mainView.selected ||
              ($(".esriPopup").removeClass("app-hidden"), $(e).show());
          }),
            "small" != app.ui.mobileIntro.screenSize &&
              app.mapTips &&
              app.mapTips.clean();
        }
        function M() {
          function e() {
            if (
              ($.each(l, function (t, e) {
                "esriGeometryPoint" == e.geometryType &&
                  -1 == e.id.toLowerCase().indexOf("mapnotes") &&
                  e.graphics.length &&
                  a.push(e);
              }),
              a.length)
            ) {
              if (h) return;
              $.each(a, function (t, e) {
                var n = i.indexOf(e);
                i.splice(n, 1);
              }),
                t.openMigrationPopup(a, i),
                $("#loadingIndicator").hide(),
                clearTimeout(app.loadingTimeout),
                (app.loadingTimeout = null);
            } else {
              var e = {};
              if (
                (t.initPopupComplete(e),
                app.detailPanelBuilder.init(app.ui.mainView, t),
                app.data
                  .getWebAppData()
                  .setTitle(app.data.getResponse().itemInfo.item.title),
                app.data
                  .getWebAppData()
                  .setSubtitle(
                    app.data.getResponse().itemInfo.item.description
                  ),
                app.ui.headerDesktop.setTitleAndSubtitle(
                  app.data.getWebAppData().getTitle(),
                  app.data.getWebAppData().getSubtitle()
                ),
                app.data.getWebAppData().setDefaultThemeOptions(),
                app.data.getResponse().itemInfo.itemData.bookmarks &&
                  app.data.getResponse().itemInfo.itemData.bookmarks.length)
              ) {
                var o = {
                  extentMode: "default",
                  numberedIcons: !1,
                  filterByExtent: !0,
                  bookmarks: !0,
                  bookmarksAlias: "Zoom",
                };
                app.data.getWebAppData().setGeneralOptions(o),
                  app.ui.navBar.initBookmarks();
              }
              app.addFeatureBar.addLayer(),
                t.storyDataReady(),
                V.appInitComplete(n),
                V.displayApp();
            }
          }
          var i = [],
            a = [];
          $.each(app.map.graphicsLayerIds, function (t, e) {
            i.push(app.map.getLayer(e));
          });
          var o = {
            bookmarks: !1,
            bookmarksAlias: app.cfg.BOOKMARKS_ALIAS,
            extentMode: "customHome",
            filterByExtent: !0,
            numberedIcons: !1,
            geocoder: !1,
            locateButton: !1,
          };
          app.data.getWebAppData().setGeneralOptions(o),
            $.each(app.map.layerIds, function (t, e) {
              var n =
                app.data.getResponse().itemInfo.itemData.baseMap.baseMapLayers;
              $.grep(n, function (t) {
                return t.id == e;
              })[0] || i.push(app.map.getLayer(e));
            });
          var r,
            s,
            l = [],
            d = [],
            p = null;
          $.each(i, function (t, e) {
            (s = e.layerType ? e.layerType : e.type),
              "esriGeometryPoint" == e.geometryType &&
                -1 == e.id.toLowerCase().indexOf("mapnotes") &&
                e.graphics.length &&
                a.push(e),
              "esriGeometryPoint" != e.geometryType ||
                !e.url ||
                ("ArcGISFeatureLayer" !== s && "Feature Layer" !== s) ||
                ((r = !0), (p = e), l.push(e), d.push(t));
          });
          var c = !1,
            u = !1,
            h = !1;
          if (!c) {
            (c = !0), l.length;
            var f = !1;
            app.map.on("update-end", function () {
              f || ((f = !0), e());
            });
            var m = app.map.getLayer(
              app.data.getWebMap().itemData.baseMap.baseMapLayers[0].id
            );
            if (m.tileIndexUrl && m.loaded) {
              if (f) return;
              (f = !0), e();
            }
          }
          var g = app.data.getWebMap().item.extent,
            b = new D(
              g[0][0],
              g[0][1],
              g[1][0],
              g[1][1],
              new O({ wkid: 4326 })
            );
          app.map.setExtent(b, !0),
            (app.map._params.extent = new D(
              JSON.parse(JSON.stringify(app.map.extent.toJson()))
            )),
            app.data.getWebAppData().setMapExtent(b),
            $(".builder-share").toggleClass("disabled", !0),
            (app.isWebMapFirstSave = !0);
          var v = $.grep(l, function (t) {
            return "esriGeometryPoint" == t.geometryType;
          });
          if (a.length || v.length)
            l.length ||
              h ||
              ((h = !0),
              $.each(a, function (t, e) {
                var n = i.indexOf(e);
                i.splice(n, 1);
              }),
              t.openMigrationPopup(a, i),
              $("#loadingIndicator").hide(),
              clearTimeout(app.loadingTimeout),
              (app.loadingTimeout = null));
          else {
            var y = {};
            if (
              (t.initPopupComplete(y),
              app.detailPanelBuilder.init(app.ui.mainView, t),
              app.data
                .getWebAppData()
                .setTitle(app.data.getResponse().itemInfo.item.title),
              app.data
                .getWebAppData()
                .setSubtitle(app.data.getResponse().itemInfo.item.description),
              app.ui.headerDesktop.setTitleAndSubtitle(
                app.data.getWebAppData().getTitle(),
                app.data.getWebAppData().getSubtitle()
              ),
              parseInt(app.data.getWebMap().itemData.version) < 2.9 &&
                (app.data.getWebMap().itemData.version = "2.9"),
              (app.data.getWebMap().itemData.authoringApp =
                "StoryMapShortlist"),
              (app.data.getWebMap().itemData.authoringAppVersion = app.version),
              app.data.getResponse().itemInfo.itemData.bookmarks &&
                app.data.getResponse().itemInfo.itemData.bookmarks.length)
            ) {
              var w = {
                extentMode: "default",
                numberedIcons: !1,
                filterByExtent: !0,
                bookmarks: !0,
                bookmarksAlias: "Zoom",
              };
              app.data.getWebAppData().setGeneralOptions(w),
                app.ui.navBar.initBookmarks();
            }
            V.appInitComplete(n),
              setTimeout(
                function () {
                  u ||
                    (app.maps[app.data.getResponse().itemInfo.item.id] =
                      K.getMapConfig(app.data.getResponse())),
                    (u = !0);
                },
                app.data.getWebAppData().getAppGeocoders() ? 0 : 1e3
              );
          }
        }
        function F() {
          if (!n.isBlank() && n.getWebmap()) V.appInitComplete(n);
          else if (app.isInBuilder && app.data.getWebAppData().getWebmap()) {
            app.isGalleryCreation = !0;
            var e = K.loadWebmap(app.data.getWebAppData().getWebmap(), "map");
            e.then(function (i) {
              app.data.setResponse(i),
                (app.map = e.results[0].map),
                app.data.setWebMap(e.results[0].itemInfo),
                t.updateUI(),
                M();
            }),
              V.isProd() ? t.showInitPopup() : V.portalLogin().then();
          } else
            C.getAppID(V.isProd())
              ? app.data.userIsAppOwner()
                ? app.isInBuilder ||
                  setTimeout(function () {
                    C.switchToBuilder();
                  }, 1200)
                : V.initError("notConfiguredDesktop")
              : app.isInBuilder || V.initError("noLayer");
          if (t && !app.data.getWebAppData().getWebmap()) {
            $.isEmptyObject(app.data.getWebAppData().getThemeOptions()) &&
              app.data.getWebAppData().setDefaultThemeOptions();
            var e = K.loadWebmap(t.buildWebMap(), "map");
            e.then(function (i) {
              app.data.setResponse(i),
                (app.map = e.results[0].map),
                app.data.setWebMap(e.results[0].itemInfo);
              var a = i.itemInfo.item.id.length ? i.itemInfo.item.id : i.map.id;
              t.updateUI(),
                V.appInitComplete(n),
                !app.data.getWebAppData().getWebmap() &&
                  app.data.getWebAppItem().id &&
                  (app.data.getWebAppData().setWebmap(a),
                  setTimeout(
                    function () {
                      app.maps[a] = K.getMapConfig(i);
                    },
                    app.data.getWebAppData().getAppGeocoders() ? 0 : 1e3
                  )),
                t.storyDataReady(),
                V.displayApp();
            });
          }
        }
        function W(t, e) {
          var i = t.attributes.number || t.attributes.shortlist_id,
            n = e.attributes.number || e.attributes.shortlist_id;
          return window.chrome
            ? i < n
              ? -1
              : i == n
              ? -1
              : i > n
              ? 1
              : 0
            : i < n
            ? -1
            : i > n
            ? 1
            : 0;
        }
        function j() {
          var t = app.data.getWebAppData().getMapExtent()
            ? app.data.getWebAppData().getMapExtent()
            : app.data.getWebAppData().getTabs() &&
              app.data.getWebAppData().getTabs()[0].extent
            ? app.data.getWebAppData().getTabs()[0].extent
            : null;
          S.publish("CORE_UPDATE_EXTENT", new D(t));
        }
        function H(t, e, i, n) {
          var a = t,
            o = e,
            r = i,
            s = n;
          (this.getWidth = function () {
            return a;
          }),
            (this.getHeight = function () {
              return o;
            }),
            (this.getOffsetX = function () {
              return r;
            }),
            (this.getOffsetY = function () {
              return s;
            });
        }
        var z,
          U,
          G,
          V = null,
          q = new a(),
          K = this,
          Y = !1,
          Q = 0,
          X = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,
          J = C.getUrlParams(),
          Z = null;
        (K.mapIsPanning = !1), (K.mapIsZooming = !1);
        var tt = 0,
          et = 0;
        (this.init = function (e) {
          if (((V = e), app.isInBuilder && x("ie") && x("ie") < 10))
            return (
              (i18n.viewer.errors.noBuilderIE = i18n.viewer.errors.noBuilderIE
                .replace("%VERSION%", 10)
                .replace("%UPGRADE%", i18n.viewer.errors.upgradeBrowser)),
              V.initError("noBuilderIE"),
              !1
            );
          var a = navigator.appVersion.indexOf("Edge") > 0;
          if (app.isInBuilder && a) return V.initError("noBuilderEdge"), !1;
          if (x("ie") && x("ie") <= 8)
            return (
              (i18n.viewer.errors.noViewerIE = i18n.viewer.errors.noViewerIE
                .replace("%VERSION%", 9)
                .replace("%UPGRADE%", i18n.viewer.errors.upgradeBrowser)),
              V.initError("noViewerIE"),
              !1
            );
          (app.data = new i()),
            (app.sanitizer = new o(
              {
                whiteList: {
                  b: [],
                  i: [],
                  u: [],
                  hr: [],
                  source: ["src", "type"],
                  iframe: [
                    "src",
                    "height",
                    "width",
                    "border",
                    "allowfullscreen",
                    "mozallowfullscreen",
                    "webkitallowfullscreen",
                    "frameborder",
                    "scrolling",
                    "allowtransparency",
                    "data-unload",
                  ],
                },
              },
              !0
            )),
            (G = document.createElement("canvas")),
            (z = G.getContext("2d")),
            (U = new Image()),
            (U.src = app.cfg.ICON_SRC),
            (U.onload = function () {
              z.drawImage(U, 0, 0),
                (z.font = G.width / 3.8 + "pt open_sanssemibold, sans-serif");
            }),
            (K.themeSelected = !1),
            (app.ui.mainView = this),
            (app.ui.tilePanel = new s(
              $("#contentPanel"),
              K,
              n,
              app.isInBuilder
            )),
            setTimeout(function () {
              (app.ui.detailPanel = new l(
                $("#paneLeft"),
                app.isInBuilder,
                n,
                K,
                n
              )),
                app.ui.detailPanel.init();
            }, 100),
            (app.ui.navBar = new d(
              $("#nav-bar"),
              app.isInBuilder,
              K.activateLayer,
              t
            )),
            app.ui.tilePanel.init(),
            (app.ui.mobileIntro = new u(
              $("body"),
              app.isInBuilder,
              function () {},
              K
            )),
            (app.ui.mobileFeatureList = new h(
              $("#contentPanel"),
              app.isInBuilder,
              function () {},
              K
            )),
            app.ui.mobileIntro.init(),
            app.ui.mobileFeatureList.init();
          var r = {},
            p = esri.urlToObject(document.location.href).query;
          return (
            p &&
              $.each(p, function (t, e) {
                r[t.toLowerCase()] = e;
              }),
            $("body").on("mousedown", "*", function (t) {
              ($(this).is(":focus") || $(this).is(t.target)) &&
                "none" == $(this).css("outline-style") &&
                $(this)
                  .css("outline", "none")
                  .on("blur", function () {
                    $(this).off("blur").css("outline", "");
                  });
            }),
            app.isInBuilder ||
              void 0 === J.autoplay ||
              "false" === J.autoplay ||
              ((app.ui.autoplay = new c($("#autoplay"), function () {
                var t = $(".tilelist li").length;
                return (
                  0 === et || tt != $(".entry.active").index()
                    ? ($(".tilelist li")[0].click(),
                      (et = 0),
                      et++,
                      (tt = $(".entry.active").index()))
                    : et <= t - 1
                    ? (et++,
                      $(
                        "#detailView" + tt + " .swiper-slide-active img"
                      ).click())
                    : ($(".entries .entry.visible").length == tt - 1
                        ? (tt = 0)
                        : tt++,
                      (et = 0),
                      $(".entries .entry")[tt].click()),
                  tt
                );
              })),
              S.subscribe("tpl-ready", function () {
                $("body").hasClass("mobile-view") || app.ui.autoplay.start();
              })),
            !0
          );
        }),
          (this.webAppConfigLoaded = function () {
            app.isGalleryCreation = !app.data.getWebAppData().getWebmap();
          }),
          (this.loadFirstWebmap = function (t) {
            return this.loadWebmap(t, $("#map")[0]);
          }),
          (this.loadWebmapFromData = function () {
            y();
          }),
          (this.loadWebmap = function (t, e, i) {
            console.log("tpl.core.MainView - loadWebMap - webmapId:", t);
            var n = new esri.dijit.Popup({ highlight: !1 }, dojo.create("div"));
            return I.createMap(t, e, {
              mapOptions: {
                slider: !0,
                autoResize: !1,
                showAttribution: !0,
                infoWindow: n,
                extent: i,
                wrapAround180: !1,
              },
              usePopupManager: !0,
              bingMapsKey: app.cfg.BING_MAPS_KEY,
              editable: !1,
              layerMixins: app.data.getAppProxies(),
            });
          }),
          (this.firstWebmapLoaded = function () {
            y();
          }),
          (this.startFromScratch = function () {
            F();
          }),
          (this.getMapConfig = function (t) {
            var e =
              !!app.data.getWebAppData().getGeneralOptions().geocoder &&
              app.data.getWebAppData().getGeneralOptions().geocoder;
            return {
              response: t,
              mapCommand: new f(
                t.map,
                j,
                V.zoomToDeviceLocation,
                app.data.getWebAppData().getGeneralOptions().locateButton
              ),
              geocoder: new b(t.map, app.isInBuilder, e, r(t)),
            };
          }),
          (this.processExternalData = function () {
            if (!app.data.getShortlistLayerId()) {
              var t = [];
              $.each(app.map.graphicsLayerIds, function (e, i) {
                var n = app.map.getLayer(i);
                n.graphics &&
                  "esriGeometryPoint" === n.geometryType &&
                  t.push(n);
              }),
                t.reverse(),
                app.data.getWebAppData().setShortlistLayerId(t[0].id);
              var e,
                i = [],
                n = [],
                a = null,
                o = !1;
              $.each(t, function (r, s) {
                if (
                  ((e = s.layerType ? s.layerType : s.type),
                  s.url && "Feature Layer" === e && !s.id.match(/^csv_/))
                ) {
                  (a = s), i.push(s.url), n.push(r);
                  var l = new R();
                  (l.where = "1=1"),
                    (l.outFields = ["*"]),
                    s.queryFeatures(l, function (t) {
                      t.features.length > 0 && g(t);
                    });
                } else if (s.graphics.length < 1 && s.visibleAtMapScale)
                  T.once(s, "update-end", function () {
                    if (!o) {
                      var e,
                        i = s.fields;
                      if (
                        ($.each(i, function (t, i) {
                          "tab_name" == i.name.toLowerCase() && (e = !0);
                        }),
                        !e && r == t.length - 1)
                      ) {
                        if (!app.isInBuilder) return;
                        var n = i18n.builder.migration.migrationPattern.badData;
                        return (
                          (n +=
                            '  (<a href="http://links.esri.com/storymaps/shortlist_layer_template" target="_blank" download="">' +
                            i18n.builder.migration.migrationPattern
                              .downloadTemplate +
                            "</a>)"),
                          $("#fatalError .error-msg").html(n),
                          void $("#fatalError").show()
                        );
                      }
                      if (e) {
                        var a = s.graphics,
                          l = s.fields;
                        app.map.removeLayer(s);
                        var d = new esri.layers.GraphicsLayer({
                          id:
                            app.data.getWebAppData().getShortlistLayerId() +
                            "_copy",
                        });
                        (o = !0),
                          app.data.getWebAppItem().created >
                            app.cfg.HTML_SANITIZER_DATE &&
                            (newLayerGraphics = m(a)),
                          (d.graphics = a),
                          (d.fields = l),
                          app.map.addLayer(d),
                          app.data.getWebAppData().setShortlistLayerId(d.id),
                          v(d);
                      }
                    }
                  }),
                    s.on("update-end", function () {}),
                    app.map.on("zoom-start", function () {
                      s.hide();
                    }),
                    app.map.on("zoom-end", function () {
                      s.show();
                    });
                else {
                  if (o) return;
                  var d,
                    p = s.fields;
                  if (
                    ($.each(p, function (t, e) {
                      "tab_name" == e.name.toLowerCase() && (d = !0);
                    }),
                    d)
                  ) {
                    var c = s.graphics,
                      u = s.fields;
                    app.map.removeLayer(s);
                    var h = new esri.layers.GraphicsLayer({
                      id:
                        app.data.getWebAppData().getShortlistLayerId() +
                        "_copy",
                    });
                    app.data.getWebAppItem().created >
                      app.cfg.HTML_SANITIZER_DATE && (c = m(c)),
                      (h.graphics = c),
                      (h.fields = u),
                      app.map.addLayer(h),
                      app.data.getWebAppData().setShortlistLayerId(h.id),
                      v(h),
                      (o = !0);
                  }
                  if (!d && r == t.length - 1) {
                    var f = i18n.builder.migration.migrationPattern.badData;
                    return (
                      (f +=
                        '  (<a href="http://links.esri.com/storymaps/shortlist_layer_template" target="_blank" download="">' +
                        i18n.builder.migration.migrationPattern
                          .downloadTemplate +
                        "</a>)"),
                      $("#fatalError .error-msg").html(f),
                      void $("#fatalError").show()
                    );
                  }
                }
              }),
                $("home-location-save-btn").remove();
            }
          }),
          (this.activateLayer = function (t, e) {
            S.publish("story-tab-navigation", t);
            var i = [];
            e && (Z = e);
            var a = app.map.getLayer(app.data.getShortlistLayerId());
            app.isInBuilder && app.detailPanelBuilder.checkTempLayer(),
              $.each(a.graphics, function (e, n) {
                var a = n.attributes,
                  o =
                    a[
                      $.grep(Object.keys(a), function (t) {
                        return "tab_name" == t.toLowerCase();
                      })[0]
                    ];
                if (
                  app.data.getWebAppData().getIsExternalData() ||
                  a.tab_id == t
                )
                  if (
                    app.data.getWebAppData().getIsExternalData() &&
                    o != app.data.getStory()[t].title
                  )
                    n.hide();
                  else if (app.data.getWebAppData().getIsExternalData())
                    if (app.isInBuilder) n.show(), i.push(n);
                    else {
                      var r =
                          a[
                            $.grep(Object.keys(a), function (t) {
                              return "name" == t.toLowerCase();
                            })[0]
                          ],
                        s =
                          a[
                            $.grep(Object.keys(a), function (t) {
                              return "name" == t.toLowerCase();
                            })[0]
                          ];
                      r && s && (n.show(), i.push(n));
                    }
                  else
                    !app.isInBuilder &&
                    n.attributes.locationSet &&
                    n.attributes.name &&
                    "Unnamed Place" != n.attributes.name &&
                    n.attributes.pic_url
                      ? (n.show(), i.push(n))
                      : app.isInBuilder
                      ? (i.push(n),
                        n.attributes.locationSet ? n.show() : n.hide())
                      : n.hide();
                else n.hide();
              });
            var o = new esri.layers.GraphicsLayer();
            o.graphics = i;
            var r = app.data.getStory()[t].color;
            if (
              ((o.color = r),
              (app.layerCurrent = o),
              (app.layerCurrent.color = app.data.getStory()[t].color),
              a.redraw(),
              app.ui.mobileFeatureList.setColor(),
              app.mapTips && app.mapTips.clean(!0),
              K.preSelection(),
              (K.selected = null),
              K.postSelection(),
              !$.isEmptyObject(app.cfg.TAB_SPECIFIC_SUPPORT_LAYERS))
            ) {
              var s = n.getSupportLayers(),
                l = "tab" + String(t + 1),
                d = app.cfg.TAB_SPECIFIC_SUPPORT_LAYERS[l];
              $.each(s, function (t, e) {
                d && d.indexOf(e.name) > -1
                  ? e.setVisibility(!0)
                  : e.setVisibility(!1);
              });
            }
            $(".detailContainer").hide(),
              app.ui.tilePanel.buildTilePanel(),
              app.ui.navBar.showEntryIndex(t),
              setTimeout(function () {
                C.addCSSRule(
                  ".nav-bar .entry.active > .entryLbl, \t\t\t\t\t\t.nav-bar .dropdown.active .dropdown-toggle { \t\t\t\t\t\t\tbackground-color: " +
                    app.data.getStory()[t].color +
                    " !important; \t\t\t\t\t\t}",
                  "NavBarActive"
                );
              }, 0),
              $("#contentPanel").css(
                "border-top-color",
                app.data.getStory()[t].color
              ),
              $(".detailHeader").css(
                "border-top-color",
                app.data.getStory()[t].color
              );
            var p = 0 === t ? 500 : 100;
            setTimeout(function () {
              (app.isInBuilder &&
                !app.data.getWebAppData().getIsExternalData()) ||
                app.ui.detailPanel.buildFeatureViews(Z);
            }, p),
              app.isInBuilder && !app.data.getWebAppData().getIsExternalData()
                ? app.addFeatureBar.updateLocatedFeatures()
                : app.ui.detailPanel.refreshSlides();
          }),
          (this.unselect = function () {
            K.preSelection(), (K.selected = null), K.postSelection();
          }),
          (this.preSelection = function () {
            K.selected &&
              K.selected.symbol &&
              K.selected.symbol.setWidth &&
              (K.selected.symbol.setWidth(K.lutIconSpecs.tiny.getWidth()),
              K.selected.symbol.setHeight(K.lutIconSpecs.tiny.getHeight()),
              K.selected.symbol.setOffset(
                K.lutIconSpecs.tiny.getOffsetX(),
                K.lutIconSpecs.tiny.getOffsetY()
              ),
              K.selected.draw(),
              app.mapTips && app.mapTips.clean(!0));
          }),
          (this.postSelection = function () {
            if (null == K.selected) app.map.infoWindow.hide();
            else {
              if (
                !K.selected.attributes.locationSet &&
                !app.isInBuilder &&
                !app.data.getWebAppData().getIsExternalData()
              )
                return;
              app.map.extent.contains(K.selected.geometry) ||
                (!K.selected.attributes.locationSet &&
                  !app.data.getWebAppData().getIsExternalData()) ||
                app.map.centerAt(K.selected.geometry),
                setTimeout(function () {
                  K.buildMapTips();
                }, 250),
                app.isInBuilder && !app.data.getWebAppData().getIsExternalData()
                  ? app.detailPanelBuilder.showSlide(
                      K.selected.attributes.shortlist_id
                    )
                  : X
                  ? app.ui.detailPanel.buildSlide(K.selected)
                  : app.ui.detailPanel.showDetails(K.selected),
                app.ui.mobileIntro.hide(),
                app.ui.mobileFeatureList.setColor();
            }
          }),
          (this.buildMapTips = function (t) {
            setTimeout(function () {
              if (
                !K.selected ||
                !K.selected.attributes ||
                K.selected.hidden ||
                (!K.selected.attributes.locationSet &&
                  !app.data.getWebAppData().getIsExternalData())
              )
                return void (app.mapTips && app.mapTips.clean(!0));
              if (
                app.mapTips &&
                !app.map.extent.contains(K.selected.geometry) &&
                app.data.getWebAppData().getGeneralOptions().filterByExtent &&
                !app.isInBuilder
              )
                return void app.mapTips.clean(!0);
              if ($("body").hasClass("mobile-view"))
                return (
                  app.mapTips && app.mapTips.clean(!0),
                  void (K.selected && K.selectSymbol())
                );
              t && app.mapTips.clean(!0);
              var e = K.selected.attributes,
                i =
                  e[
                    $.grep(Object.keys(e), function (t) {
                      return "name" == t.toLowerCase();
                    })[0]
                  ];
              i || (K.selected.attributes.name = "Unnamed Place");
              var n = t || i;
              (app.mapTips = new p({
                map: app.map,
                content: n,
                selected:
                  K.selected && !0 !== K.selected.hidden ? K.selected : null,
                pointArray: [K.selected],
                labelDirection: "auto",
                backgroundColor: app.cfg.SELECTED_POPUP_BACKGROUND_COLOR,
                borderColor: app.cfg.SELECTED_POPUP_BORDER_COLOR,
                pointerColor: app.cfg.SELECTED_POPUP_ARROW_COLOR,
                textColor: "#ffffff",
                offsetTop: 44,
                topLeftNotAuthorizedArea: [40, 180],
                mapAuthorizedMinWidth: -1,
                mapAuthorizedWidth: -1,
                mapAuthorizedHeight: -1,
                visible: !0,
              })),
                K.selectSymbol();
            }, 100);
          }),
          (this.selectSymbol = function () {
            K.selected.symbol.width != K.lutIconSpecs.large.getWidth() &&
              (K.selected.symbol.setWidth(K.lutIconSpecs.large.getWidth()),
              K.selected.symbol.setHeight(K.lutIconSpecs.large.getHeight()),
              K.selected.symbol.setOffset(
                K.lutIconSpecs.large.getOffsetX(),
                K.lutIconSpecs.large.getOffsetY()
              ),
              K.selected.draw(),
              app.map
                .getLayer(app.data.getWebAppData().getShortlistLayerId())
                .redraw(),
              setTimeout(function () {
                try {
                  K.selected.getShape().moveToFront();
                } catch (t) {
                  console.log("problem with 'moveToFront()'...");
                }
              }, 10));
          }),
          (this.buildMapHoverTips = function (t, e) {
            if (
              app.mapTips &&
              ($("body").hasClass("mobile-view") ||
                (!e.attributes.locationSet &&
                  !app.data.getWebAppData().getIsExternalData()))
            )
              return void app.mapTips.clean(!0);
            var i = e == K.selected ? 44 : 33,
              n = e.attributes;
            n[
              $.grep(Object.keys(n), function (t) {
                return "name" == t.toLowerCase();
              })[0]
            ] || (e.attributes.name = "Unnamed Place"),
              (app.mapTips = new p({
                map: app.map,
                content: t,
                selected:
                  K.selected && !0 !== K.selected.hidden ? K.selected : null,
                pointArray: [e],
                labelDirection: "auto",
                backgroundColor: app.cfg.POPUP_BACKGROUND_COLOR,
                borderColor: app.cfg.POPUP_BORDER_COLOR,
                pointerColor: app.cfg.POPUP_ARROW_COLOR,
                textColor: "#ffffff",
                offsetTop: i,
                topLeftNotAuthorizedArea: [40, 180],
                mapAuthorizedMinWidth: -1,
                mapAuthorizedWidth: -1,
                mapAuthorizedHeight: -1,
                visible: !0,
              }));
          }),
          (this.buildMapSupportHoverTips = function (t, e) {
            if (app.mapTips && $("body").hasClass("mobile-view"))
              return void app.mapTips.clean(!0);
            app.mapTips = new p({
              map: app.map,
              content: t,
              selected:
                K.selected && !0 !== K.selected.hidden ? K.selected : null,
              pointArray: [e],
              labelDirection: "auto",
              backgroundColor: app.cfg.POPUP_BACKGROUND_COLOR,
              borderColor: app.cfg.POPUP_BORDER_COLOR,
              pointerColor: app.cfg.POPUP_ARROW_COLOR,
              textColor: "#ffffff",
              offsetTop: 5,
              topLeftNotAuthorizedArea: [40, 180],
              mapAuthorizedMinWidth: -1,
              mapAuthorizedWidth: -1,
              mapAuthorizedHeight: -1,
              visible: !0,
            });
          }),
          (this.moveGraphicToFront = function (t) {
            if (t) {
              var e = t.getDojoShape();
              e && e.moveToFront();
            }
          }),
          (this.buildLayer = function (t, e) {
            var i,
              a = K.lutIconSpecs.tiny,
              o = document.createElement("canvas");
            (o.width = U.width), (o.height = U.height);
            var r = o.getContext("2d");
            (r.font = o.width / 3.8 + "pt pt open_sanssemibold, sans-serif"),
              r.drawImage(G, 0, 0);
            var s = e;
            if (!i) {
              var l = r.getImageData(0, 0, G.width, G.height),
                d = k(l, 4804);
              if (d[0] != E(s).r || d[1] != E(s).g || d[2] != E(s).b) {
                for (var p = 0; p < l.data.length; p += 4)
                  l.data[p] == d[0] &&
                    l.data[p + 1] == d[1] &&
                    l.data[p + 2] == d[2] &&
                    ((l.data[p] = E(s).r),
                    (l.data[p + 1] = E(s).g),
                    (l.data[p + 2] = E(s).b));
                r.putImageData(l, 0, 0);
              }
              i = l;
            }
            $.each(t, function (t, e) {
              if (
                (t > 0 && r.putImageData(i, 0, 0),
                n.getGeneralOptions().numberedIcons)
              ) {
                var s = e.attributes.PLACENUMSL
                  ? e.attributes.PLACENUMSL
                  : e.attributes.number;
                (r.textAlign = "center"),
                  (r.fillStyle = "white"),
                  r.fillText(s, o.width / 3.2, o.height / 2);
              }
              e.setSymbol(L(t, o, a));
            }),
              app.map
                .getLayer(app.data.getWebAppData().getShortlistLayerId())
                .show();
          }),
          (this.layer_onClick = function (t) {
            if (
              !(
                $("body").hasClass("pickLocation") ||
                K.mapIsZooming ||
                K.mapIsPanning
              )
            ) {
              (Y = !0),
                K.preSelection(),
                (K.selected = null),
                (K.selected = t.graphic),
                K.postSelection(),
                $("#mobileTitlePage").css("display", "none");
              var e = $(".esriPopup");
              $(e).addClass("app-hidden"),
                setTimeout(function () {
                  Y = !1;
                }, 500),
                K.themeSelected || app.ui.mobileFeatureList.selectTheme(0),
                (K.themeSelected = !0);
            }
          }),
          (this.layer_onMouseOver = function (t) {
            if (
              !(
                Y ||
                $("body").hasClass("pickLocation") ||
                K.mapIsZooming ||
                K.mapIsPanning ||
                q.isMobile()
              )
            ) {
              app.map.setMapCursor("pointer");
              var e = t.graphic;
              app.map.toScreen(e.geometry);
              if (
                e != K.selected ||
                !0 === K.selected.hidden ||
                "block" != $("#header").css("display")
              ) {
                if (e == K.selected && !0 === K.selected.hidden) {
                  if (app.isInBuilder) return;
                } else
                  e.symbol.setWidth(K.lutIconSpecs.medium.getWidth()),
                    e.symbol.setHeight(K.lutIconSpecs.medium.getHeight()),
                    e.symbol.setOffset(
                      K.lutIconSpecs.medium.getOffsetX(),
                      K.lutIconSpecs.medium.getOffsetY()
                    ),
                    e.draw(),
                    q.isIE() || K.moveGraphicToFront(e);
                var i = e.attributes,
                  n =
                    i[
                      $.grep(Object.keys(i), function (t) {
                        return "name" == t.toLowerCase();
                      })[0]
                    ];
                K.buildMapHoverTips(n, e);
              }
            }
          }),
          (this.layer_onMouseOut = function (t) {
            if (
              !(
                $("body").hasClass("pickLocation") ||
                K.mapIsZooming ||
                K.mapIsPanning
              )
            ) {
              var e = t.graphic;
              (e == K.selected && app.isInBuilder) ||
                q.isMobile() ||
                (app.map.setMapCursor("default"),
                e != K.selected &&
                  (e.symbol.setWidth(K.lutIconSpecs.tiny.getWidth()),
                  e.symbol.setHeight(K.lutIconSpecs.tiny.getHeight()),
                  e.symbol.setOffset(
                    K.lutIconSpecs.tiny.getOffsetX(),
                    K.lutIconSpecs.tiny.getOffsetY()
                  ),
                  e.draw()),
                app.mapTips && app.mapTips.clean());
            }
          }),
          (this.updateUI = function () {}),
          (this.resize = function (t) {
            app.isInBuilder && (app.initScreenIsOpen = !0);
            var e = $(".entry.active").index();
            if (t.isMobileView)
              app.isInBuilder &&
                $("#mobileBuilderOverlay").attr(
                  "style",
                  "display: block !important"
                ),
                setTimeout(function () {
                  app.ui.mobileIntro.resizeMobileElements();
                }, 0),
                app.data.getStory()[e] &&
                  app.data.getStory()[e].color &&
                  ($(".detailHeader").css({
                    "border-top-width": "10px",
                    "border-top-style": "solid",
                    "border-top-color": app.data.getStory()[e].color,
                  }),
                  $("#contentPanel").css("border-top", "0px"),
                  $(".notNumbered").css("margin-top", "10px")),
                app.data.getWebAppData().getSettings().generalOptions &&
                  app.data.getWebAppData().getSettings().generalOptions
                    .bookmarks &&
                  $("#mobileBookmarksCon").show(),
                $("#header").height("0"),
                app.mapTips && app.mapTips.hide(),
                (Q < 2 || "block" == $("#mobileIntro").css("display")) && j();
            else {
              app.isInBuilder &&
                "block" == $("#mobileBuilderOverlay").css("display") &&
                (app.addFeatureBar.loaded ||
                  app.data.getWebAppData().getIsExternalData()) &&
                $("#mobileBuilderOverlay").attr(
                  "style",
                  "display: none !important"
                ),
                (app.ui.mobileIntro.screenSize = "desktop"),
                $("#mobilePaneList").hide(),
                $("#navThemeLeft").css("visibility", "hidden"),
                $("#navThemeRight").css("visibility", "hidden"),
                $("#mobileBookmarksCon").hide(),
                $("#bookmarksDiv").css("max-height", $("#map").height() - 100),
                app.data.getStory()[e] &&
                  app.data.getStory()[e].color &&
                  ($("#contentPanel").css({
                    "border-top-width": "10px",
                    "border-top-style": "solid",
                    "border-top-color": app.data.getStory()[e].color,
                  }),
                  $(".detailHeader").css("border-top", "0px"),
                  $(".notNumbered").css("margin-top", "20px"));
              var i = $("body").height(),
                n = 0;
              if (
                ($(".mainViewAboveMap, .mainViewBelowMap").each(function (
                  t,
                  e
                ) {
                  var i = $(e);
                  n += i.is(":visible") ? i.outerHeight() : 0;
                }),
                $("#paneLeft").height(
                  i -
                    n -
                    25 -
                    $("#tabs").height() -
                    (app.embedBar && app.embedBar.initiated ? 26 : 0)
                ),
                !(
                  J.embed ||
                  "" === J.embed ||
                  app.cfg.embed ||
                  J.forceEmbed ||
                  app.indexCfg.forceEmbed
                ))
              ) {
                var a = app.data.getWebAppData().getHeader().compactSize
                  ? "60px"
                  : "110px";
                $("#header").height(a);
              }
              if (
                ($(".tilelist").height(
                  $("#paneLeft").height() -
                    (app.isInBuilder &&
                    !app.data.getWebAppData().getIsExternalData()
                      ? 70
                      : 25) +
                    (app.embedBar && app.embedBar.initiated ? 5 : 0)
                ),
                $(".tilelist").css(
                  "top",
                  app.isInBuilder &&
                    !app.data.getWebAppData().getIsExternalData()
                    ? 50
                    : 28
                ),
                $("#paneLeft .noFeature").width($("#paneLeft").width()),
                $("#paneLeft").width() == app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN
                  ? $("#paneLeft .noFeatureText").css("margin-left", "20px")
                  : $("#paneLeft .noFeatureText").css("margin-left", "100px"),
                $("#map").height(
                  t.height -
                    10 +
                    (app.embedBar && app.embedBar.initiated ? -26 : 0)
                ),
                $("#map").css("top", 0),
                app.ui.navBar.resize(),
                app.ui.autoplay)
              ) {
                var o = $("#map").width() / 2 - $("#autoplay").width() / 2;
                $("#autoplay").css("left", o);
              }
              t.width <= app.cfg.TWO_COLUMN_THRESHOLD ||
              (t.width <= 1024 && t.height <= 768)
                ? (setTimeout(function () {
                    $("#mainStagePanel").width(
                      t.width - (app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN + 16)
                    ),
                      $("#mainStagePanel").css(
                        "left",
                        app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN + 16
                      ),
                      app.map && app.map.resize(),
                      K.selected &&
                        !app.map.extent.contains(K.selected.geometry) &&
                        app.mapTips &&
                        app.mapTips.clean(!0);
                  }, 0),
                  $("#paneLeft .noFeatureText").css("margin-left", "20px"),
                  app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN),
                  app.isInBuilder &&
                  !app.data.getWebAppData().getIsExternalData()
                    ? app.detailPanelBuilder.resize()
                    : app.ui.detailPanel.resize())
                : t.width <= app.cfg.THREE_COLUMN_THRESHOLD &&
                  t.width >= app.cfg.TWO_COLUMN_THRESHOLD
                ? (setTimeout(function () {
                    $("#mainStagePanel").width(
                      t.width - (app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN + 16)
                    ),
                      $("#mainStagePanel").css(
                        "left",
                        app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN + 16
                      ),
                      app.map && app.map.resize();
                  }, 0),
                  $("#paneLeft .noFeatureText").css("margin-left", "100px"),
                  app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN),
                  app.isInBuilder &&
                  !app.data.getWebAppData().getIsExternalData()
                    ? app.detailPanelBuilder.resize()
                    : app.ui.detailPanel.resize())
                : (setTimeout(function () {
                    $("#mainStagePanel").width(
                      t.width - (app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN + 16)
                    ),
                      $("#mainStagePanel").css(
                        "left",
                        app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN + 16
                      ),
                      app.map && app.map.resize();
                  }, 0),
                  $("#paneLeft .noFeatureText").css("margin-left", "170px"),
                  app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN),
                  app.isInBuilder &&
                  !app.data.getWebAppData().getIsExternalData()
                    ? app.detailPanelBuilder.resize()
                    : app.ui.detailPanel.resize());
            }
            Q++;
          }),
          (this.setMapExtent = function (t, e) {
            return V.setMapExtent(t, e);
          }),
          (this.getLayoutExtent = function (t) {
            return t;
          }),
          (this.checkConfigFileIsOK = function () {
            return e.checkConfigFileIsOK();
          }),
          (this.appInitComplete = function () {
            this.updateUI(),
              V.cleanLoadingTimeout(),
              $(window).resize(),
              app.isGalleryCreation;
            var t =
              app.data.getWebAppData().isBlank() ||
              "private" == app.data.getWebAppItem().access;
            app.ui.headerDesktop &&
              app.ui.headerDesktop.toggleSocialBtnAppSharing(t),
              S.publish("tpl-ready");
          }),
          (this.onHashChange = function () {}),
          (this.lutIconSpecs = {
            tiny: new H(31, 34, 6, 13),
            medium: new H(34, 38, 7, 15),
            large: new H(44, 48, 9, 20),
          }),
          (this.prepareMobileViewSwitch = function () {}),
          (this.initLocalization = function () {});
      };
    }
  ),
  define("lib-build/css!storymaps/common/builder/Builder", [], function () {}),
  define(
    "lib-build/css!lib-app/font-awesome/css/font-awesome.min",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/BuilderPanel",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<h3 class="appTitle">\x3c!--' +
            (null == (__t = title) ? "" : __t) +
            '--\x3e</h3>\n<div class="buttons btn-group">\n\t<button class="builder-cmd builder-settings" title="' +
            (null == (__t = btnSettings) ? "" : __t) +
            '">\n\t\t<span class="builder-cmd-hidden-label">' +
            (null == (__t = btnSettings) ? "" : __t) +
            '</span>\n\t</button>\n\t<button class="builder-cmd builder-share" data-title="' +
            (null == (__t = tooltipFirstSave) ? "" : __t) +
            '" data-placement="bottom" title="' +
            (null == (__t = btnShare) ? "" : __t) +
            '">\n\t\t<span class="builder-cmd-hidden-label">' +
            (null == (__t = btnShare) ? "" : __t) +
            '</span>\n\t</button>\n\t<button class="builder-cmd builder-preview" data-title="' +
            (null == (__t = tooltipNotShared) ? "" : __t) +
            '" data-placement="bottom" title="' +
            (null == (__t = btnPreview) ? "" : __t) +
            '">\n\t\t<span class="builder-cmd-hidden-label">' +
            (null == (__t = btnPreview) ? "" : __t) +
            '</span>\n\t</button>\n\t<button class="builder-cmd builder-help" title="' +
            (null == (__t = btnHelp) ? "" : __t) +
            '">\n\t\t<span class="builder-cmd-hidden-label">' +
            (null == (__t = btnHelp) ? "" : __t) +
            '</span>\n</div>\n<div class="status-bar">\n\t<div class="status-bar-info">\n\t\t<span class="status-msg"></span>\n\t\t<span class="status-btns">\n\t\t\t<button class="btn btn-warning check-story"></button>\n\t\t\t<button type="button" class="btn btn-default builder-save disabled" tabindex="-1">' +
            (null == (__t = btnSave) ? "" : __t) +
            '</button>\n\t\t</span>\n\t</div>\n</div>\n<div class="builder-mask"></div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/BuilderPanel",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/SaveErrorPopup",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<h4 class="modal-title">' +
            (null == (__t = title) ? "" : __t) +
            '</h4>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t' +
            (null == (__t = content) ? "" : __t) +
            '\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button type="button" class="btn btn-primary" data-dismiss="modal">' +
            (null == (__t = btnOk) ? "" : __t) +
            "</button>\n\t\t</div>\n\t</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/SaveErrorPopup",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/SaveErrorPopup",
    [
      "lib-build/tpl!./SaveErrorPopup",
      "lib-build/css!./SaveErrorPopup",
      "../utils/CommonHelper",
      "dojo/Deferred",
      "dojo/i18n!commonResources/nls/core.js?v=" + app.version,
    ],
    function (t, e, i, n, a) {
      return function (e) {
        e.append(
          t({
            title: a.commonCore.saveError.title,
            content:
              a.commonCore.saveError.err1Div1 +
              "<br /><br />" +
              a.commonCore.saveError.err1Div2,
            btnOk: a.commonCore.saveError.btnOk,
          })
        ),
          (this.present = function () {
            var t = new n();
            return (
              e.on("hide.bs.modal", function () {
                t.resolve();
              }),
              e.modal({ keyboard: !0 }),
              t
            );
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/SaveErrorPopupSocial",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<h4 class="modal-title">' +
            (null == (__t = title) ? "" : __t) +
            '</h4>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<div class="panel1">\n\t\t\t\t' +
            (null == (__t = panel1) ? "" : __t) +
            '\n\t\t\t\t<a href="#" class="help" data-toggle="tooltip">\n\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class="panel2">\n\t\t\t\t<div class="panel2lbl">' +
            (null == (__t = panel2) ? "" : __t) +
            '</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<div class="radio">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type="radio" name="optErrorSocial" value="story" checked>\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t' +
            (null == (__t = panel2q1) ? "" : __t) +
            '\n\t\t\t\t\t\t\t\t<a href="#" class="help" data-toggle="tooltip" title="' +
            (null == (__t = panel2q1tooltip) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="radio">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type="radio" name="optErrorSocial" value="item">\n\t\t\t\t\t\t\t<span>' +
            (null == (__t = panel2q2) ? "" : __t) +
            '</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="panel3">' +
            (null == (__t = panel3) ? "" : __t) +
            '</div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<div class="stop-asking">\n\t\t\t\t<div class="checkbox">\n\t\t\t\t\t<label class="disabled">\n\t\t\t\t\t\t<input type="checkbox" value="" disabled>\n\t\t\t\t\t\t' +
            (null == (__t = panel4) ? "" : __t) +
            '\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button type="button" class="btn btn-primary">' +
            (null == (__t = btnSave) ? "" : __t) +
            "</button>\n\t\t</div>\n\t</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/SaveErrorPopupSocial",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/SaveErrorPopupSocial",
    [
      "lib-build/tpl!./SaveErrorPopupSocial",
      "lib-build/css!./SaveErrorPopupSocial",
      "../utils/CommonHelper",
      "storymaps/tpl/core/WebApplicationData",
      "dojo/Deferred",
      "dojo/i18n!commonResources/nls/core.js?v=" + app.version,
    ],
    function (t, e, i, n, a, o) {
      return function (e) {
        var r = null;
        e.append(
          t({
            title: o.commonCore.saveErrorSocial.title,
            panel1: o.commonCore.saveErrorSocial.panel1,
            panel2: o.commonCore.saveErrorSocial.panel2,
            panel2q1: o.commonCore.saveErrorSocial.panel2q1,
            panel2q1tooltip: o.commonCore.saveErrorSocial.panel2q1tooltip,
            panel2q2: o.commonCore.saveErrorSocial.panel2q2,
            panel3: o.commonCore.saveErrorSocial.panel3.replace(
              "${MYSTORIES}",
              '<a href="' +
                i.getMyStoriesURL() +
                '" target="_blank">' +
                o.commonCore.common.mystories +
                "</a>"
            ),
            panel4: o.commonCore.saveErrorSocial.panel4,
            btnSave: o.commonCore.common.save,
          })
        ),
          (function () {
            e.find("input[name='optErrorSocial']").change(function () {
              "story" == e.find("input[name='optErrorSocial']:checked").val()
                ? (e
                    .find(".stop-asking input")
                    .attr("disabled", "disabled")
                    .prop("checked", !1),
                  e.find(".stop-asking label").addClass("disabled"))
                : (e.find(".stop-asking input").removeAttr("disabled"),
                  e.find(".stop-asking label").removeClass("disabled"));
            }),
              e.find(".btn-primary").click(function () {
                e.find(".stop-asking input").is(":checked") &&
                  n.setDoNotWarnTitle(!0),
                  r.resolve({
                    choice: e
                      .find("input[name='optErrorSocial']:checked")
                      .val(),
                  }),
                  e.modal("hide");
              });
          })(),
          (this.present = function () {
            return (
              (r = new a()),
              e
                .find(".panel1 .help")
                .tooltip({
                  title:
                    o.commonCore.saveErrorSocial.panel1tooltip +
                    '<img src="resources/tpl/builder/icons/builder-help-social.png"/>',
                  html: !0,
                  placement: "right",
                }),
              e.find(".panel2 .help").tooltip(),
              e.modal({ keyboard: !1 }),
              r
            );
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/BuilderPanel",
    [
      "lib-build/tpl!./BuilderPanel",
      "lib-build/css!./BuilderPanel",
      "dojo/i18n!commonResources/nls/core.js?v=" + app.version,
      "storymaps/common/utils/CommonHelper",
      "./SaveErrorPopup",
      "./SaveErrorPopupSocial",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o, r) {
      return function (e, s, l, d) {
        function p() {
          if (
            (console.log("common.builder.Builder - save"),
            e.find(".builder-save").hasClass("disabled"))
          )
            return void (
              app.appCfg.noAppTitleInitScreen &&
              !app.data.getWebAppData().getTitle() &&
              $("#headerDesktop").find(".title").addClass("titleEmpty")
            );
          if (
            (e
              .find(".builder-save")
              .addClass("saving")
              .html(
                '<span class="small-loader"></span>' +
                  i.commonCore.builderPanel.buttonSaving
              ),
            y(),
            app.isDirectCreationFirstSave)
          ) {
            var t = app.data.getWebAppData().getTitle(),
              n = app.data.getWebAppData().getSubtitle();
            if (!t) return void x.saveFailed("NONAME");
            app.portal
              .getPortalUser()
              .getItems()
              .then(function (a) {
                var o = !1;
                a &&
                  $.each(a, function (e, i) {
                    i.title &&
                      i.title.toLowerCase() == t.toLowerCase() &&
                      (o = !0);
                  }),
                  o
                    ? (e
                        .find(".builder-save")
                        .removeClass("saving")
                        .html(i.commonCore.common.save),
                      T.present().then(function () {
                        app.appCfg.useStandardHeader
                          ? app.ui.headerDesktop.setTitleError()
                          : app.builder.openEditPopup({
                              sectionIndex: 0,
                              displayTab: "main-stage",
                            });
                      }))
                    : l(t, n);
              });
          } else if (app.appCfg.useWebmapInApp && app.isGalleryCreation) d();
          else {
            var a = "",
              o = "";
            if (
              (app.data.getWebAppData().getTitle() &&
                (a = app.data.getWebAppData().getTitle().trim()),
              app.data.getWebAppItem() &&
                app.data.getWebAppItem().title &&
                (o = app.data.getWebAppItem().title.trim()),
              app.builder.titleMatchOnLoad ||
                app.data.getWebAppData().getDoNotWarnTitle() ||
                "public" != app.data.getWebAppItem().access ||
                a == o)
            ) {
              var r =
                app.data.getWebAppData().getDoNotWarnTitle() ||
                ("public" != app.data.getWebAppItem().access &&
                  !app.builder.titleMatchOnLoad);
              s(r);
            } else
              app.builder.titleMatchDialogDisplayed
                ? s(app.builder.titleFromItem)
                : ((app.builder.titleMatchDialogDisplayed = !0),
                  k.present().then(function (t) {
                    (app.builder.titleFromItem = t && "item" == t.choice),
                      s(app.builder.titleFromItem);
                  }));
          }
        }
        function c() {
          g(), S.openSettingPopup(!1);
        }
        function u() {
          g(), r.publish("OPEN_HELP");
        }
        function h() {
          $(this).hasClass("disabled") ||
            window.open(n.getAppViewModeURL() + "&preview", "_blank");
        }
        function f() {
          $(this).hasClass("disabled") || app.builder.openSharePopup(!1);
        }
        function m() {
          e
            .find(".save-counter")
            .removeClass("pendingChanges")
            .html(i.commonCore.builderPanel.noPendingChange),
            e.find(".builder-save").addClass("disabled");
        }
        function g() {
          e.find(".builder-save").tooltip("hide");
        }
        function b() {
          var t = "#" + e.attr("id");
          e.find(".builder-save").tooltip("destroy"),
            e
              .find(".builder-save")
              .tooltip({
                html: !0,
                trigger: "manual",
                placement: "left",
                title:
                  '<script>$("' +
                  t +
                  ' .builder-save").next(".tooltip").addClass("save-fail-popover");$("' +
                  t +
                  ' .builder-save").next(".tooltip").find(".stepHidden").css("display", "none");</script><div class="stepHidden stepFailed" style="color: red; width: 180px;">' +
                  i.commonCore.builderPanel.saveError +
                  ' <button type="button" class="btn btn-xs" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">' +
                  i.commonCore.common.close +
                  "</button> </div>",
              });
        }
        function v() {
          e.find(".builder-save").tooltip("hide");
        }
        function y() {
          x.updateSharingStatus(), x.resize();
        }
        function w() {
          e.find(".status-msg").show();
          var t = app.data.getWebAppItem().access;
          app.isDirectCreationFirstSave || app.isGalleryCreation
            ? e.find(".status-msg").html(i.commonCore.builderPanel.status6)
            : app.mystories && app.mystories.hasCheckErrors
            ? "public" == t
              ? e.find(".status-msg").html(i.commonCore.builderPanel.status1)
              : "account" == t || "org" == t
              ? e.find(".status-msg").html(i.commonCore.builderPanel.status1)
              : e.find(".status-msg").html(i.commonCore.builderPanel.status2)
            : "public" == t
            ? e.find(".status-msg").html(i.commonCore.builderPanel.status3)
            : "account" == t || "org" == t
            ? e.find(".status-msg").html(i.commonCore.builderPanel.status4)
            : e.find(".status-msg").html(i.commonCore.builderPanel.status5),
            x.resize();
        }
        function C() {
          app.builder.openSharePopup();
        }
        function _(t) {
          var n = e.find(".check-story");
          app.data.getStoryLength()
            ? "start" == t
              ? (n
                  .html(
                    '<span class="small-loader"></span>' +
                      i.commonCore.builderPanel.checking
                  )
                  .show()
                  .css("cursor", "default")
                  .off("click"),
                e.find(".status-msg").hide())
              : "error" == t
              ? (n
                  .html(i.commonCore.builderPanel.fix)
                  .show()
                  .css("cursor", "pointer")
                  .click(C),
                x.updateSharingStatus())
              : (n.hide(), x.updateSharingStatus())
            : n.hide();
        }
        e.append(
          t({
            title: i.commonCore.builderPanel.panelHeader.replace(
              "%TPL_NAME%",
              app.cfg.TPL_NAME
            ),
            btnSave: i.commonCore.common.save,
            btnShare: i.commonCore.builderPanel.buttonShare,
            btnSettings: i.commonCore.builderPanel.buttonSettings,
            btnHelp: i.commonCore.builderPanel.buttonHelp,
            btnPreview: i.commonCore.builderPanel.buttonPreview,
            tooltipFirstSave: i.commonCore.builderPanel.tooltipFirstSave,
            tooltipNotShared: i.commonCore.builderPanel.tooltipNotShared2,
            saveCounter: i.commonCore.builderPanel.noPendingChange,
          })
        );
        var x = this,
          S = null,
          T = null,
          k = null;
        (this.init = function (t) {
          (S = t),
            (T = new a($("#saveErrorPopup"))),
            (k = new o($("#saveErrorPopupSocial"))),
            e.removeClass("hide"),
            (app.builder.hideSaveConfirmation = v),
            e.find(".builder-save").click(p),
            e.find(".builder-share").click(f),
            e.find(".builder-settings").click(c),
            e.find(".builder-help").click(u),
            e.find(".builder-preview").click(h),
            $(window).bind("keydown", function (t) {
              (t.ctrlKey || t.metaKey) &&
                "s" == String.fromCharCode(t.which).toLowerCase() &&
                (e.find(".builder-save").attr("disabled") ||
                  app.initScreenIsOpen ||
                  (t.preventDefault(), p()));
            }),
            b(),
            r.subscribe("MYSTORIES_SCAN", _),
            _("start");
        }),
          (this.saveSucceeded = function () {
            (app.isDirectCreationFirstSave || app.isGalleryCreation) &&
              app.builder.openSharePopup(!0),
              m(),
              y(),
              e
                .find(".builder-save")
                .html(
                  '<span class="glyphicon glyphicon-ok"></span> ' +
                    i.commonCore.builderPanel.buttonSaved
                ),
              setTimeout(function () {
                e.find(".builder-save")
                  .removeClass("saving")
                  .html(i.commonCore.common.save);
              }, 3500);
          }),
          (this.saveFailed = function () {
            e
              .find(".builder-save")
              .removeClass("saving")
              .html(i.commonCore.common.save),
              e.find(".builder-save").tooltip("show"),
              e
                .find(".builder-save")
                .next(".tooltip")
                .find(".stepFailed")
                .css("display", "block"),
              y();
          }),
          (this.hasPendingChange = function () {
            return !e.find(".builder-save").hasClass("disabled");
          }),
          (this.incrementSaveCounter = function () {
            var t = "";
            (t = i.commonCore.builderPanel.unSavedChangePlural),
              e.find(".save-counter").addClass("pendingChanges").html(t),
              e
                .find(".builder-save")
                .toggleClass(
                  "disabled",
                  (app.isDirectCreationFirstSave &&
                    !app.data.getStoryLength()) ||
                    !app.data.getWebAppData().getTitle()
                ),
              app.isDirectCreationFirstSave &&
                app.data.getStoryLength() &&
                e.find(".status-bar").removeClass("hideCounterAndSharing");
          }),
          (this.updateSharingStatus = function () {
            var t =
                app.isDirectCreationFirstSave ||
                app.isGalleryCreation ||
                app.isWebMapCreation ||
                app.isWebMapFirstSave,
              n =
                "private" == app.data.getWebAppItem().access ||
                "shared" == app.data.getWebAppItem().access;
            e.find(".builder-share").toggleClass("disabled", !!t),
              e
                .find(".builder-preview")
                .tooltip("destroy")
                .removeClass("disabled"),
              t
                ? e.find(".builder-share").tooltip({ trigger: "hover" })
                : e.find(".builder-share").tooltip("destroy"),
              t || app.isWebMapFirstSave
                ? e
                    .find(".builder-preview")
                    .addClass("disabled")
                    .tooltip({
                      trigger: "hover",
                      title: i.commonCore.builderPanel.tooltipFirstSave,
                    })
                : n
                ? e
                    .find(".builder-preview")
                    .tooltip({
                      trigger: "hover",
                      title: i.commonCore.builderPanel.tooltipNotShared2,
                    })
                : e.find(".builder-preview").tooltip("destroy"),
              app.ui.headerDesktop &&
                app.ui.headerDesktop.toggleSocialBtnAppSharing(n),
              app.ui.mobileHeader &&
                app.ui.mobileHeader.toggleSocialBtnAppSharing(n),
              w();
          }),
          (this.resize = function () {
            var t = e.find(".status-msg"),
              i = e.find(".status-btns button");
            e.removeClass("conflicting-text more-conflicting-text"),
              i.removeClass("btn-xs"),
              t.css("max-width", "auto");
            var n = e.find(".buttons")[0],
              a = t[0];
            if (n && a) {
              n.getBoundingClientRect().right + 10 >=
                a.getBoundingClientRect().left &&
                e.addClass("conflicting-text"),
                n.getBoundingClientRect().right + 10 >=
                  a.getBoundingClientRect().left &&
                  e.addClass("more-conflicting-text");
              var o = n.getBoundingClientRect().right;
              o + 10 >= a.getBoundingClientRect().left &&
                (i.addClass("btn-xs"),
                t.css(
                  "max-width",
                  parseInt(a.getBoundingClientRect().right - o, 10)
                ));
            }
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/settings/SettingsPopup",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<h3 class="modal-title"></h3>\n\t\t</div>\n\t\t<ul class="settingsPopupHeader modal-tabs nav nav-tabs">\n\t\t\t\x3c!-- Tab injected here --\x3e\n\t\t</ul>\n\t\t<div class="modal-body">\n\t\t\t\x3c!-- Views injected here --\x3e\n\t\t</div>\n\t\t<div class="modal-footer">\n\t\t\t<span class="error"></span>\n\t\t\t<button class="btnSave btn btn-primary" data-dismiss="modal"></button>\n\t\t\t<button class="btnClose btn btn-naked btn-close" data-dismiss="modal" aria-hidden="true"></button>\n\t\t</div>\n\t</div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/settings/SettingsPopup",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/settings/SettingsPopup",
    [
      "lib-build/tpl!./SettingsPopup",
      "lib-build/css!./SettingsPopup",
      "storymaps/common/utils/CommonHelper",
      "dojo/topic",
    ],
    function (t, e, i, n) {
      var a = null;
      return function (e) {
        function o() {
          $(this).hasClass("disabled") || s($(this).index());
        }
        function r() {
          var t = [],
            e = -1;
          if (
            ($.each(l, function (i, n) {
              var a = n.save();
              !1 === a && (e = i), t.push(a);
            }),
            -1 != e)
          )
            return s(e), !1;
          n.publish("SETTINGS_POPUP_SAVE", { settings: t });
        }
        function s(t) {
          d.removeClass("active disabled"),
            p.hide(),
            d.eq(t).addClass("active"),
            l[t].show(),
            p.eq(t).show(),
            (a = t);
        }
        e.append(t({}));
        var l = [],
          d = null,
          p = e.find(".tab-content"),
          c = e.find(".btnSave"),
          u = e.find(".btnClose");
        (this.init = function (t) {
          (l = t.getSettingsTab()),
            e.find(".settingsPopupHeader").empty(),
            e.find(".modal-body").empty(),
            $.each(l, function () {
              e
                .find(".settingsPopupHeader")
                .append('<li class="tab"><a></a></li>'),
                e.find(".modal-body").append('<div class="tab-content"></div>');
            }),
            (d = e.find(".tab")),
            (p = e.find(".tab-content")),
            $.each(l, function (t, e) {
              e.init(d.eq(t).find("a"), p.eq(t)), e.initLocalization();
            }),
            d.click(o),
            c.click(r);
        }),
          (this.present = function (t, n) {
            var o = 0,
              r =
                !app.isProduction && i.getUrlParams().debugParam
                  ? i.getUrlParams().debugParam
                  : null;
            d.removeClass("disabled"),
              u.removeAttr("disabled"),
              $(".error-msg", e).hide(),
              $(".modal-header .close", e).attr("data-dismiss", "modal"),
              $(".modal-footer .error", e).hide(),
              $.each(l, function (e, i) {
                i.present(t[e], e == n);
              }),
              n ? (o = n) : r ? (o = r) : a && (o = a),
              s(o),
              n &&
                (d.addClass("disabled"),
                d.eq(n).removeClass("disabled"),
                u.attr("disabled", "disabled"),
                $(".modal-header .close", e).attr("data-dismiss", "none")),
              e.modal({ keyboard: !n });
          }),
          (this.initLocalization = function () {
            e.find(".modal-title").html(i18n.commonCore.settings.header),
              e.find(".btnClose").html(i18n.commonCore.common.cancel),
              e.find(".btnSave").html(i18n.commonCore.common.apply),
              e.find(".error").html(i18n.commonCore.settings.tabError);
          });
      };
    }
  ),
  define("storymaps/common/builder/BuilderHelper", [], function () {
    return {
      getBlankAppJSON: function () {
        return {
          itemType: "text",
          guid: null,
          name: null,
          type: "Web Mapping Application",
          typeKeywords: app.cfg.WEBAPP_KEYWORD_GENERIC.concat(
            app.cfg.WEBAPP_KEYWORD_APP
          ),
          description: null,
          tags: app.cfg.WEBAPP_TAG,
          snippet: null,
          thumbnail: "thumbnail/ago_downloaded.png",
          documentation: null,
          extent: [],
          lastModified: -1,
          spatialReference: null,
          accessInformation: null,
          licenseInfo: null,
          culture: "en-us",
          properties: null,
          size: 116,
          appCategories: [],
          industries: [],
          languages: [],
          largeThumbnail: null,
          banner: null,
          screenshots: [],
          listed: !1,
          ownerFolder: null,
          commentsEnabled: !0,
          numComments: 0,
          numRatings: 0,
          avgRating: 0,
          numViews: 1,
        };
      },
      getBlankWebmapJSON: function () {
        var t = { latestWkid: 3857, wkid: 102100 };
        return (
          app.map && app.map.spatialReference && (t = app.map.spatialReference),
          {
            item: {
              id: "",
              guid: null,
              name: null,
              type: "Web Map",
              typeKeywords: app.cfg.WEBMAP_KEYWORD,
              description: null,
              tags: app.cfg.WEBMAP_TAG,
              snippet: null,
              thumbnail: "thumbnail/ago_downloaded.png",
              documentation: null,
              extent: [
                [-180, -90],
                [180, 90],
              ],
              spatialReference: null,
              accessInformation: null,
              licenseInfo: null,
              culture: "en-us",
              properties: null,
              url: null,
              size: 233,
              appCategories: [],
              industries: [],
              languages: [],
              largeThumbnail: null,
              banner: null,
              screenshots: [],
              listed: !1,
              ownerFolder: null,
              commentsEnabled: !0,
              numComments: 0,
              numRatings: 0,
              avgRating: 0,
              numViews: 1,
            },
            itemData: {
              operationalLayers: [],
              baseMap: {
                baseMapLayers: [
                  {
                    id: "defaultBasemap",
                    opacity: 1,
                    visibility: !0,
                    url: "http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
                  },
                ],
                title: "Topographic",
              },
              spatialReference: t,
              version: "2.9",
            },
          }
        );
      },
    };
  }),
  define(
    "storymaps/common/utils/WebMapHelper",
    [
      "esri/request",
      "esri/renderers/jsonUtils",
      "dojo/Deferred",
      "dojo/_base/lang",
      "dojo/_base/array",
    ],
    function (t, e, i, n, a) {
      return {
        findLayerTypeById: function (t, e) {
          var i = "";
          return (
            a.forEach(t.operationalLayers, function (t) {
              t.id == e && (i = t.type);
            }),
            i
          );
        },
        saveWebmap: function (t, e) {
          var a = new i();
          this.prepareWebmapItemForCloning(t);
          var o = n.clone(t.item),
            r = n.clone(t.itemData);
          (o.tags = o.tags ? o.tags.join(",") : ""),
            (o.typeKeywords = o.typeKeywords ? o.typeKeywords.join(",") : "");
          var s = e.getPortalUser(),
            l =
              this.getSharingURL(e) +
              "content/users/" +
              (app.appCfg.useWebmapOwnerAsSave
                ? o.owner
                : s.credential.userId) +
              (o.ownerFolder ? "/" + o.ownerFolder : "") +
              (o.id ? "/items/" + o.id + "/update" : "/addItem"),
            d = {
              item: o.item,
              title: o.title,
              tags: o.tags,
              extent: JSON.stringify(o.extent),
              text: JSON.stringify(r),
              type: o.type,
              typeKeywords: o.typeKeywords,
              overwrite: !0,
              thumbnailURL: o.thumbnailURL,
            };
          return (
            this.request(l, d, !0).then(
              function (t) {
                a.resolve(t);
              },
              function (t) {
                a.reject(t);
              }
            ),
            a
          );
        },
        serializeGraphicsLayerToFeatureCollection: function (t) {
          return this._serializeGraphicsLayerToFeatureCollection(
            t,
            t.visible,
            t.graphics
          );
        },
        _serializeGraphicsLayerToFeatureCollection: function (t, e, i) {
          var n = {
            layers: [
              {
                featureSet: { features: [], geometryType: t.geometryType },
                id: t.id,
                layerDefinition: {
                  geometryType: t.geometryType,
                  objectIdField: t.objectIdField,
                  name: t.name,
                  type: t.type,
                  typeIdField: t.typeIdField,
                  drawingInfo: {
                    renderer: {
                      type: "simple",
                      symbol: {
                        type: "esriPMS",
                        url: "http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",
                        imageData:
                          "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",
                        contentType: "image/png",
                        width: 15,
                        height: 15,
                      },
                    },
                  },
                  fields: [],
                  types: [],
                  capabilities: t.capabilities,
                },
                layerObject: null,
                opacity: t.opacity,
                visibility: e,
              },
            ],
            showLegend: !0,
          };
          return (
            $.each(t.fields, function (t, e) {
              n.layers[0].layerDefinition.fields.push({
                name: e.name,
                alias: e.alias,
                type: e.type,
                editable: e.editable,
                domain: null,
              });
            }),
            $.each(i, function (t, e) {
              n.layers[0].featureSet.features.push({
                attributes: e.attributes,
                geometry: e.geometry,
              });
            }),
            n
          );
        },
        request: function (e, i, a, o) {
          var r = a || !1;
          return (
            (i = i || {}),
            (o = o || ""),
            t(
              {
                url: e,
                content: n.mixin(i, { f: "json", token: o }),
                callbackParamName: "callback",
                handleAs: "json",
              },
              { usePost: r }
            )
          );
        },
        prepareWebmapItemForCloning: function (t) {
          var i = { latestWkid: 3857, wkid: 102100 };
          app.map && app.map.spatialReference && (i = app.map.spatialReference),
            t.itemData.spatialReference || (t.itemData.spatialReference = i),
            (t.itemData.authoringApp = "StoryMapShortlist"),
            (t.itemData.authoringAppVersion = app.version),
            parseFloat(t.itemData.version) < 2.9 &&
              (t.itemData.version = "2.9"),
            delete t.itemData._ssl,
            a.forEach(t.itemData.baseMap.baseMapLayers, function (t) {
              delete t.errors,
                delete t.layerObject,
                delete t.resourceInfo,
                delete t.firstLayer,
                delete t.baseMapLayer;
            }),
            a.forEach(t.itemData.operationalLayers, function (t) {
              delete t.errors,
                delete t.layerObject,
                delete t.resourceInfo,
                t.id.indexOf("shortlist-layer") >= 0 &&
                  !t.layerType &&
                  (t.layerType = "ArcGISFeatureLayer"),
                t.featureCollection &&
                  t.featureCollection.layers &&
                  a.forEach(t.featureCollection.layers, function (t) {
                    delete t.layerObject;
                  }),
                t.featureCollection &&
                  t.featureCollection.featureSet &&
                  t.featureCollection.featureSet.features &&
                  a.forEach(
                    t.featureCollection.featureSet.features,
                    function (t) {
                      delete t._shape, delete t._graphicsLayer;
                    }
                  ),
                "CSV" == t.type &&
                  t.featureCollection &&
                  delete t.featureCollection,
                a.forEach(t.layers, function (t) {
                  delete t.drawingInfo,
                    t.layerDefinition &&
                      t.layerDefinition.drawingInfo &&
                      t.layerDefinition.drawingInfo.renderer &&
                      (t.layerDefinition.drawingInfo.renderer = e
                        .fromJson(t.layerDefinition.drawingInfo.renderer)
                        .toJson());
                }),
                t.layerDefinition &&
                  t.layerDefinition.drawingInfo &&
                  t.layerDefinition.drawingInfo.renderer &&
                  (t.layerDefinition.drawingInfo.renderer = e
                    .fromJson(t.layerDefinition.drawingInfo.renderer)
                    .toJson());
            });
        },
        getSharingURL: function (t) {
          var e = t.portalUrl;
          return (
            e.match("/sharing/rest/$")
              ? (e = e.split("/").slice(0, -2).join("/") + "/")
              : e.match("/sharing/rest$")
              ? (e = e.split("/").slice(0, -1).join("/") + "/")
              : e.match("/sharing$") && (e += "/"),
            e
          );
        },
      };
    }
  ),
  define(
    "storymaps/common/builder/media/image/ImageUploadHelper",
    ["dojo/Deferred", "dojo/_base/lang"],
    function (t, e) {
      return {
        photoSettings: {
          maxFileSize: 1e7,
          widths: [1920],
          thumbHeight: 150,
          logoWidth: 250,
          logoName: "sm_series_logo",
          quality: 0.8,
        },
        loadImageFromFile: function (e, i) {
          var n = new t();
          return (
            e.type.indexOf("gif") >= 0
              ? this.handleGifFile(e, i).then(n.resolve, n.reject)
              : this.handleImageFile(e, i).then(n.resolve, n.reject),
            n
          );
        },
        processLogo: function (i) {
          var n = new t(),
            a = this.getExt(i.name, i.type);
          return (
            this.createNewImage(i).then(
              e.hitch(this, function (t) {
                if (i.type.indexOf("gif") >= 0) {
                  if (
                    !this.validateDimensions(t, {
                      width: this.photoSettings.logoWidth,
                    })
                  )
                    return void n.reject({
                      reason: "gif dimensions",
                      details: this.photoSettings.logoWidth,
                    });
                } else {
                  var e = this.createCanvasAndDataUrl(t, i.type, {
                    width: this.photoSettings.logoWidth,
                  });
                  i = e.file;
                }
                if (!this.validateFileSize(i))
                  return void n.reject({ reason: "filesize" });
                n.resolve({
                  type: "image",
                  height: t.height,
                  width: t.width,
                  file: i,
                  logoName: this.photoSettings.logoName,
                  name:
                    this.photoSettings.logoName +
                    "__" +
                    new Date().getTime() +
                    "." +
                    a,
                });
              })
            ),
            n
          );
        },
        getExt: function (t, e) {
          var i = t.lastIndexOf(".");
          return i >= 0
            ? t.substr(i + 1).toLowerCase()
            : e.substr(e.indexOf("/") + 1);
        },
        handleGifFile: function (i) {
          var n = new t();
          return this.validateFileSize(i)
            ? (this.createNewImage(i).then(
                e.hitch(this, function (t) {
                  n.resolve({
                    type: "image",
                    file: i,
                    width: t.width,
                    height: t.height,
                    dataUrl: null,
                  });
                }),
                n.reject
              ),
              n)
            : (console.warn("gif file size too big!"),
              n.reject({ reason: "filesize" }),
              n);
        },
        handleImageFile: function (i, n) {
          var a = new t();
          return (
            this.createNewImage(i).then(
              e.hitch(this, function (t) {
                var e,
                  o = [],
                  r = _.sortBy(this.photoSettings.widths).reverse();
                _.each(
                  r,
                  function (n) {
                    var r = this.createCanvasAndDataUrl(t, i.type, {
                      width: n,
                    });
                    if (!this.validateFileSize(r.file))
                      return void a.reject({ reason: "compressed filesize" });
                    (o.length && o[o.length - 1].width === r.width) ||
                      o.push(_.omit(r, "dataUrl")),
                      (e = e || r.dataUrl);
                  },
                  this
                );
                var s;
                s = app.appCfg.imageUploadThumbWidth
                  ? this.createCanvasAndDataUrl(t, i.type, {
                      width: app.appCfg.imageUploadThumbWidth,
                    })
                  : this.createCanvasAndDataUrl(t, i.type, {
                      height: this.photoSettings.thumbHeight,
                    });
                var l = n ? e : s.dataUrl;
                a.resolve({
                  type: "image",
                  files: o,
                  width: o[0].width,
                  height: o[0].height,
                  dataUrl: l,
                  thumb: s.file,
                });
              }),
              a.reject
            ),
            a
          );
        },
        createCanvasAndDataUrl: function (t, e, i) {
          var n = this.createNewCanvas(t, i),
            a = n.toDataURL(e, this.photoSettings.quality),
            o = this.dataURItoBlob(a);
          return { width: n.width, height: n.height, dataUrl: a, file: o };
        },
        validateFileSize: function (t) {
          return t.size <= this.photoSettings.maxFileSize;
        },
        validateDimensions: function (t, e) {
          return e.width
            ? t.width <= e.width
            : e.height
            ? t.height <= e.height
            : (console.warn(
                "trying to validateDimensions without dimensionOptions",
                e
              ),
              !1);
        },
        createNewImage: function (e) {
          var i = new t(),
            n = new Image(),
            a = window.URL || window.webkitURL;
          return a
            ? ((n.src = a.createObjectURL(e)),
              (n.onload = function () {
                (this.onload = null), a.revokeObjectURL(e), i.resolve(this);
              }),
              i)
            : void i.reject({ reason: "no window.URL" });
        },
        createNewCanvas: function (t, e) {
          var i = this.getPhotoSize(t, e),
            n = document.createElement("canvas");
          return (
            (n.width = i.width),
            (n.height = i.height),
            n
              .getContext("2d")
              .drawImage(t, 0, 0, t.width, t.height, 0, 0, i.width, i.height),
            n
          );
        },
        getPhotoSize: function (t, e) {
          var i = t.height,
            n = t.width;
          if (!this.validateDimensions(t, e)) {
            var a = n / i;
            e.width
              ? ((n = e.width), (i = n / a))
              : e.height
              ? ((i = e.height), (n = a * i))
              : console.warn("sizeOptions dont include width or height", e);
          }
          return { height: Math.round(i), width: Math.round(n) };
        },
        dataURItoBlob: function (t) {
          var e;
          e =
            t.split(",")[0].indexOf("base64") >= 0
              ? atob(t.split(",")[1])
              : unescape(t.split(",")[1]);
          for (
            var i = t.split(",")[0].split(":")[1].split(";")[0],
              n = new Uint8Array(e.length),
              a = 0;
            a < e.length;
            a++
          )
            n[a] = e.charCodeAt(a);
          return new Blob([n], { type: i });
        },
      };
    }
  ),
  define(
    "storymaps/common/builder/media/image/FileUploadHelper",
    [
      "dojo/Deferred",
      "dojo/promise/all",
      "dojo/_base/lang",
      "esri/request",
      "./ImageUploadHelper",
    ],
    function (t, e, i, n, a) {
      return {
        uploadTypesAccepted: { image: ["png", "jpeg", "jpg", "gif", "bmp"] },
        ignoreNames: [a.photoSettings.logoName],
        checkDnD: function () {
          return (
            !navigator.userAgent.match(
              /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i
            ) &&
            "draggable" in document.createElement("span") &&
            void 0 !== window.FileReader
          );
        },
        disableWindowDnD: function () {
          window.dndDisabled ||
            ((window.dndDisabled = !0),
            window.addEventListener("dragover", this.preventEvent),
            window.addEventListener("drop", this.preventEvent));
        },
        preventEvent: function (t) {
          t && t.preventDefault();
        },
        preventAndStopEvent: function (t) {
          t && (t.preventDefault(), t.stopPropagation());
        },
        findFilesFromDrop: function (t) {
          return (
            (t = t.originalEvent || t),
            !!(
              t.dataTransfer &&
              t.dataTransfer.files &&
              t.dataTransfer.files.length
            ) && t.dataTransfer.files
          );
        },
        validateTypeOnDrag: function (t) {
          for (var e = 0, i = !0; e < t.length && i; ) {
            var n = this.getSimplifiedType(t[e].type);
            (i = _.has(this.uploadTypesAccepted, n)), e++;
          }
          return i;
        },
        validateFile: function (t) {
          var e = this.getExt(t.name, t.type),
            i = this.getSimplifiedType(t.type);
          return _.flatten(
            _.map(this.uploadTypesAccepted, function (t) {
              return t;
            })
          ).some(function (n) {
            return n === e || n === t.type || n === i;
          });
        },
        getSimplifiedType: function (t) {
          return t.substring(0, t.indexOf("/"));
        },
        getExt: function (t, e) {
          var i = t.lastIndexOf(".");
          return i >= 0
            ? t.substr(i + 1).toLowerCase()
            : e.substr(e.indexOf("/") + 1);
        },
        getNameWithoutExtension: function (t) {
          var e = t.lastIndexOf(".");
          return e >= 0 ? t.substr(0, e) : t;
        },
        getStrippedName: function (t) {
          return (
            (t = this.getNameWithoutExtension(t)),
            t
              .replace("__thumb", "")
              .replace(/__[0-9]{13}/, "")
              .replace(/__w[0-9]+/, "")
          );
        },
        getResourceWidth: function (t) {
          var e = t.match(/__w[0-9]+/);
          return e ? parseInt(e[0].slice(3), 10) : null;
        },
        getDateNum: function (t) {
          var e = t.match(/__[0-9]{13}/);
          return e ? parseInt(e[0].slice(2), 10) : "";
        },
        getFileIdFromUrl: function (t) {
          var e = this.getResourcesUrl()
              .replace(/http[s]?\:\/\//, "")
              .replace(/^\/\//, "")
              .replace("//", "/"),
            i = t
              .replace(/http[s]?\:\/\//, "")
              .replace(/^\/\//, "")
              .replace("//", "/");
          if (i.indexOf(e) < 0) return "";
          var n = decodeURIComponent(i.substr(i.lastIndexOf("/") + 1));
          return this.getStrippedName(n) + "_" + this.getDateNum(n);
        },
        getUploadBaseName: function (t, e) {
          var i = this.getNameWithoutExtension(t.name).replace(
              /[<>"'()*%!?&]/g,
              ""
            ),
            n = this.getExt(t.name, t.type);
          return i + "__" + (new Date().getTime() + (e || 0)) + "." + n;
        },
        processFile: function (t, e) {
          var i = this.getSimplifiedType(t.type);
          switch (i) {
            case "image":
              return a.loadImageFromFile(t, e);
            case "audio":
            case "video":
              return void console.warn("unhandled file type", i);
            default:
              return void console.warn("unknown file type", t);
          }
        },
        uploadSingleResource: function (e) {
          var a = new t(),
            o = this.getUploadUrl();
          if (!o) return a.reject(), a;
          var r = e.baseName || e.name,
            s = this.getNameWithoutExtension(r),
            l = this.getExt(r);
          e.thumb && (e.thumbName = s + "__thumb." + l),
            _.each(e.files, function (t) {
              t.name = s + "__w" + t.width + "." + l;
            });
          var d = this.getFormDataFromFileDetails(e);
          return (
            n({ url: o, handleAs: "json", form: d }, { usePost: !0 }).then(
              i.hitch(this, function (t) {
                if (t.success) {
                  var i = this.getResourcesUrl();
                  if (!i) return void a.reject("No resourcesUrl");
                  e.files
                    ? (t.sizes = _.map(
                        e.files,
                        function (t) {
                          return this.getSizesObj(t.name);
                        },
                        this
                      ))
                    : e.file &&
                      ((t.picUrl = this.getSizesObj(r).url), (t.name = r)),
                    e.baseName &&
                      (t.displayName =
                        this.getStrippedName(e.baseName) + "." + l),
                    e.thumb &&
                      (t.thumbUrl = i + "/" + encodeURIComponent(e.thumbName)),
                    a.resolve(t);
                }
              })
            ),
            a
          );
        },
        getSizesObj: function (t) {
          return {
            name: t,
            url: this.getResourcesUrl() + "/" + encodeURIComponent(t),
            width: this.getResourceWidth(t),
          };
        },
        getAppItem: function () {
          return app.data && app.data.getWebAppItem && app.data.getWebAppItem();
        },
        getUploadUrl: function () {
          var t = this.getOwnerItemUrl();
          return !!t && t + "/addResources";
        },
        getRemoveUrl: function () {
          var t = this.getOwnerItemUrl();
          return !!t && t + "/removeResources";
        },
        getOwnerItemUrl: function () {
          var t = this.getAppItem(),
            e = this.getSharingUrl();
          if (!t || !e) return !1;
          var i = e + "/content/users/" + t.owner,
            n = t.ownerFolder;
          return i + (n ? "/" + n : "") + "/items/" + t.id;
        },
        getSharingUrl: function () {
          var t = app.portal;
          return (
            !!t &&
            "https://" + t.portalHostname.replace(/\/$/, "") + "/sharing/rest"
          );
        },
        getResourcesUrl: function () {
          var t = this.getAppItem(),
            e = this.getSharingUrl();
          return !(!t || !e) && e + "/content/items/" + t.id + "/resources";
        },
        getPlainResources: function () {
          var e = new t(),
            i = this.getResourcesUrl();
          return i
            ? n({ url: i, handleAs: "json", content: { num: 1e3, f: "json" } })
            : (e.reject(), e);
        },
        getStoryResources: function () {
          var e = new t();
          return (
            this.getPlainResources().then(
              i.hitch(this, this.handleResourceReturn, e),
              i.hitch(this, this.handleQueryError)
            ),
            e
          );
        },
        handleResourceReturn: function (t, e) {
          var i = this.formatResults(e.resources);
          t.resolve(i);
        },
        removeResources: function (i) {
          var n = new t();
          if (!this.getRemoveUrl()) return n.reject(), n;
          var a = [];
          return (
            i.file && a.push(this.removeResource(i.file)),
            i.thumbFile && a.push(this.removeResource(i.thumbFile)),
            i.sizes &&
              _.map(
                i.sizes,
                function (t) {
                  a.push(this.removeResource(t.name));
                },
                this
              ),
            e(a).then(function (t) {
              _.every(t, function (t) {
                return t.success;
              })
                ? n.resolve()
                : n.reject();
            }),
            n
          );
        },
        removeResource: function (t) {
          return n(
            {
              url: this.getRemoveUrl(),
              handleAs: "json",
              content: { resource: t, f: "json" },
            },
            { usePost: !0 }
          );
        },
        cleanupLogos: function (t) {
          t = t || "";
          var e = t.slice(t.lastIndexOf("/") + 1);
          this.removeResourcesWithPrefix(a.photoSettings.logoName, e);
        },
        removeResourcesWithPrefix: function (n, a) {
          var o = new t(),
            r = this.getAppItem();
          return r && r.id
            ? ((a = a || ""),
              this.getPlainResources().then(
                i.hitch(this, function (t) {
                  var i = [];
                  _.each(
                    t.resources,
                    function (t) {
                      var e = t.resource;
                      e.match("^" + n) &&
                        e !== a &&
                        i.push(this.removeResource(t.resource));
                    },
                    this
                  ),
                    i.length && e(i).then(o.resolve, o.reject),
                    o.resolve();
                }),
                o.reject
              ),
              o)
            : (o.resolve(), o);
        },
        formatResults: function (t) {
          var e = this.getResourcesUrl(),
            n = this,
            a = {};
          return (
            t.forEach(
              i.hitch(this, function (t) {
                var i = t.resource;
                if (
                  !_.some(this.ignoreNames, function (t) {
                    return 0 === i.indexOf(t);
                  })
                ) {
                  _.contains(this.ignoreNames, i);
                  var o = n.getExt(i);
                  if (n.getResourceType(o)) {
                    var r = n.getStrippedName(i),
                      s = n.getDateNum(i),
                      l = r + "_" + s;
                    a[l] ||
                      (a[l] = {
                        fileId: l,
                        sizes: [],
                        displayName: decodeURIComponent(r) + "." + o,
                        modified: s ? new Date(s) : "",
                        thumbFile: "",
                        resourcesUrl: e,
                      }),
                      i.match("__thumb")
                        ? (a[l].thumbFile = i)
                        : a[l].sizes.push({
                            name: i,
                            url: e + "/" + encodeURIComponent(i),
                            width: n.getResourceWidth(i) || 0,
                          });
                  }
                }
              })
            ),
            _.each(a, function (t, e) {
              t.sizes.length || delete a[e];
            }),
            _.toArray(a)
          );
        },
        getResourceType: function (t) {
          if (!t) return !1;
          t = t.toLowerCase();
          var e;
          return (
            _.some(this.uploadTypesAccepted, function (i, n) {
              if (_.contains(i, t)) return (e = n), !0;
            }),
            e || !1
          );
        },
        handleQueryError: function (t, e) {
          t.reject(e);
        },
        getFormDataFromFileDetails: function (t) {
          var e = new FormData();
          return e.append("f", "json"), this.addFilesToFormData(e, t), e;
        },
        addFilesToFormData: function (t, e) {
          e.files
            ? _.each(e.files, function (e, i) {
                t.append("file" + i, e.file, e.name);
              })
            : t.append("file", e.file, e.baseName || e.name),
            e.thumb && t.append("thumb", e.thumb, e.thumbName);
        },
      };
    }
  ),
  define(
    "storymaps/common/ui/bannerNotification/BannerNotification",
    [],
    function () {
      "use strict";
      var t = [],
        e = function (e) {
          return !(t.indexOf(e) >= 0) && (t.push(e), !0);
        };
      return function (t) {
        var i,
          n = { strings: i18n.commonCore.bannerNotification },
          a = {
            id: t.id,
            primaryColor: t.primaryColor || "#027bd2",
            secondaryColor: t.secondaryColor || "#fff",
            bannerMainActionText: t.bannerMainActionText || n.strings.learnMore,
            bannerCloseActionText: t.bannerCloseActionText || n.strings.close,
            dontShowAgainText: t.dontShowAgainText || n.strings.dontShowAgain,
            bannerMsg: t.bannerMsg,
            mainMsgHtml: t.mainMsgHtml,
            actions: [].concat(t.actions),
            cookie: {
              domain: t.cookie.domain,
              path: t.cookie.path,
              maxAge: t.cookie.maxAge || 0,
            },
            autohideAfter: void 0 !== t.autohideAfter ? t.autohideAfter : 2,
            fadeAfter: void 0 !== t.fadeAfter ? t.fadeAfter : 3e4,
            blockingNotifications: t.blockingNotifications || [],
          },
          o = "bannerNotification_" + a.id + "_hidden",
          r = function (t) {
            var e = a.cookie.domain ? "domain=" + a.cookie.domain + ";" : "",
              i = a.cookie.path ? "path=" + a.cookie.path + ";" : "",
              n = new Date(
                new Date().getTime() + 1e3 * a.cookie.maxAge
              ).toUTCString(),
              r = document.querySelector(
                "#" + a.id + "-banner-notification-dont-show"
              );
            if (r && r.checked)
              document.cookie = o + "=true;expires=" + n + ";" + e + i;
            else if (!0 === t) {
              var s = document.cookie.replace(
                  new RegExp(
                    "(?:(?:^|.*;\\s*)" + o + "\\s*\\=\\s*([^;]*).*$)|^.*$"
                  ),
                  "$1"
                ),
                l = parseInt(s, 10);
              0 === a.autohideAfter
                ? (document.cookie = o + "=true;expires=" + n + ";" + e + i)
                : 0 === s.length
                ? (document.cookie = o + "=0;expires=" + n + ";" + e + i)
                : l !== isNaN && l < a.autohideAfter - 1
                ? (document.cookie =
                    o + "=" + (l + 1) + ";expires=" + n + ";" + e + i)
                : l !== isNaN &&
                  l >= a.autohideAfter - 1 &&
                  (window.onbeforeunload = function () {
                    "false" !==
                      document.cookie.replace(
                        new RegExp(
                          "(?:(?:^|.*;\\s*)" + o + "\\s*\\=\\s*([^;]*).*$)|^.*$"
                        ),
                        "$1"
                      ) &&
                      (document.cookie =
                        o + "=true;expires=" + n + ";" + e + i);
                  });
            } else document.cookie = o + "=false;expires=" + n + ";" + e + i;
          },
          s = function () {
            for (
              var t = !1, e = [].concat(a.blockingNotifications), i = 0;
              i < e.length;
              i++
            )
              "true" !==
                document.cookie.replace(
                  new RegExp(
                    "(?:(?:^|.*;\\s*)bannerNotification_" +
                      e[i] +
                      "_hidden\\s*\\=\\s*([^;]*).*$)|^.*$"
                  ),
                  "$1"
                ) && (t = !0);
            return t;
          };
        if (
          !(function () {
            var t = document.cookie.replace(
              new RegExp(
                "(?:(?:^|.*;\\s*)" + o + "\\s*\\=\\s*([^;]*).*$)|^.*$"
              ),
              "$1"
            );
            return 0 === a.autohideAfter
              ? (r(!0), !0)
              : !!(s() || window.location.href.search(a.cookie.domain) < 0) ||
                  (r(!0), "true" === t);
          })() &&
          e(a.id)
        ) {
          var l =
              '        <style type="text/css">        .mobile-view .banner-notification {            display: none;          }          .banner-notification {            position: fixed;            top: 0;            width: 100%;            z-index: 9999;            animation-duration: 1s;            animation-name: slideInBannerNotificationMiniMessage;            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;          }          #' +
              a.id +
              ".banner-notification .mini-msg-popup {            background-color: " +
              a.primaryColor +
              ";            color: " +
              a.secondaryColor +
              ";            padding: 10px 45px 10px 8px;            text-align: center;            font-size: 16px;            cursor: pointer;            height: 50px;          }          .banner-notification button {            border: solid 1px;            margin: 0;            padding: 3px 6px;            border-radius: 3px;            text-transform: uppercase;            width: auto;            overflow: visible;            background: inherit;            font: inherit;            color: inherit;            cursor: pointer;            text-align: inherit;            -webkit-font-smoothing: inherit;            -moz-osx-font-smoothing: inherit;            -webkit-appearance: none;          }          .banner-notification .mini-msg-popup p {            display: inline-block;            font-size: 16px;            padding: 3px;          }          #" +
              a.id +
              ".banner-notification .mini-msg-btn {            border-color: " +
              a.secondaryColor +
              ";\t\t\tbackground-color: " +
              a.primaryColor +
              ";            font-size: 13px;          }          #" +
              a.id +
              ".banner-notification .mini-msg-btn:hover,          #" +
              a.id +
              ".banner-notification .mini-msg-btn:focus {            color: " +
              a.primaryColor +
              ";            background-color: " +
              a.secondaryColor +
              ";          }          .banner-notification .mini-close {            position: absolute;            border: none;            right: 1px;            top: -1px;            border-radius: 0;            background: none;            padding: 0 10px 4px;            font-size: 36px;            line-height: 1;            opacity: 0.6;            overflow: hidden;          }          @media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {            .banner-notification .mini-close {              top: 3px;            }          }          @supports (-ms-ime-align:auto) {            .banner-notification .mini-close {              top: 3px;            }          }          .banner-notification .mini-close:hover,          .banner-notification .mini-close:focus {            opacity: 1;          }          @keyframes slideInBannerNotificationMiniMessage {            from {              top: -50px;            }            to: {              top: 0            }          }                    .banner-notification .main-msg-wrapper {            display: none;            width: 100%;            background-color: #fff;            overflow: auto;            -webkit-overflow-scrolling: touch;          }          .banner-notification.msg-visible .main-msg-wrapper {            display: block;          }          .banner-notification.msg-visible .banner-notification-learn-more-btn {            display: none;          }          .banner-notification .text-column-wrapper {            width: 100%;            max-width: 700px;            margin: auto;            padding: 20px 10px;            line-height: 1.6em;          }          .banner-notification .text-column-wrapper-inner {            width: 100%;            margin: 0 15px;          }          .banner-notification .text-column-wrapper h1 {            font-size: 1.9em;            margin: 25px 0 15px;            font-weight: 400;          }          .banner-notification .text-column-wrapper h2 {            font-size: 1.5em;            margin: 30px 0 -10px;            font-weight: 400;          }          .banner-notification .text-column-wrapper h3 {            font-size: 1.3em;            margin: 30px 0 -10px;            font-weight: 400;          }          .banner-notification .text-column-wrapper p {            margin: 20px 0 0;            font-size: 1.1em;            font-weight: 200;           }          .banner-notification .text-column-wrapper p strong{            font-weight: 400;          }          #" +
              a.id +
              ".banner-notification .text-column-wrapper p a {            font-weight: 200;            color: " +
              a.primaryColor +
              ";          }          #" +
              a.id +
              ".banner-notification .main-msg-btn {            margin: 15px 7px 0 0;            padding: 3px 22px;            border-color: " +
              a.primaryColor +
              ";            font-size: 15px;          }          #" +
              a.id +
              ".banner-notification .primary-action {            color: " +
              a.secondaryColor +
              ";            background-color: " +
              a.primaryColor +
              ";          }          #" +
              a.id +
              ".banner-notification .primary-action:hover,          #" +
              a.id +
              ".banner-notification .primary-action:focus {            color: " +
              a.primaryColor +
              ";            background-color: " +
              a.secondaryColor +
              ";          }          #" +
              a.id +
              ".banner-notification .secondary-action {            color: " +
              a.primaryColor +
              ";            background-color: " +
              a.secondaryColor +
              ";          }          #" +
              a.id +
              ".banner-notification .secondary-action:hover,          #" +
              a.id +
              ".banner-notification .secondary-action:focus {            color: " +
              a.secondaryColor +
              ";            background-color: " +
              a.primaryColor +
              ";          }          .banner-notification .banner-notification-dont-show {            margin: 25px 0 0 0;          }          .banner-notification .banner-notification-dont-show label {            display: inline;            font-size: 0.9em;            vertical-align: middle;          }          .banner-notification .actions-buttons {            padding-bottom: 15px;          }                              .banner-notification.msg-visible .main-msg-wrapper {            opacity: 1;            animation-duration: 0.5s;             animation-name: openBannerNotificationMainMessage;           }          @keyframes openBannerNotificationMainMessage {            from {              opacity: 0;            }            to: {              opacity: 1;            }          }          .banner-notification.closing {            opacity: 0;            animation-duration: 0.5s;             animation-name: closeBannerNotificationMessage;           }          @keyframes closeBannerNotificationMessage {            from {              opacity: 1;            }            to: {              opacity: 0;            }          }        </style>      ",
            d =
              '        <div class="mini-msg-popup">          <p>' +
              a.bannerMsg +
              '</p>&nbsp;          <button type="button" class="mini-msg-btn banner-notification-learn-more-btn">' +
              a.bannerMainActionText +
              '</button>          <button type="button" class="banner-notification-close-btn mini-close" title=' +
              a.bannerCloseActionText +
              ">&times;</button>        </div>      ",
            p =
              '        <div class="main-msg-wrapper">          <div class="text-column-wrapper">            ' +
              a.mainMsgHtml +
              '            <form class="banner-notification-dont-show">            <input type="checkbox" id="' +
              a.id +
              '-banner-notification-dont-show">            <label for="' +
              a.id +
              '-banner-notification-dont-show">' +
              a.dontShowAgainText +
              '</label>            </form>            <div class="actions-buttons"></div>          </div>        </div>      ',
            c = function () {
              for (
                var t = document.querySelector(
                    "#" + a.id + " .actions-buttons"
                  ),
                  e = 0;
                e < a.actions.length;
                e++
              ) {
                var i = a.actions[e],
                  n = document.createElement("button");
                (n.innerHTML = i.string),
                  n.setAttribute("type", "button"),
                  n.classList.add("main-msg-btn"),
                  i.primary
                    ? n.classList.add("primary-action")
                    : n.classList.add("secondary-action"),
                  i.closeOnAction &&
                    n.classList.add("banner-notification-close-btn"),
                  "function" == typeof i.action &&
                    (n.addEventListener("click", i.action),
                    n.addEventListener("keypress", function (t) {
                      13 === t.keyCode && i.action();
                    })),
                  t.appendChild(n);
              }
            },
            u = function (t) {
              27 === t.keyCode && m();
            },
            h = function () {
              var t =
                document.body.offsetHeight -
                document.querySelector(
                  "#" + a.id + ".banner-notification .mini-msg-popup"
                ).offsetHeight;
              document.querySelector(
                "#" + a.id + " .main-msg-wrapper"
              ).style.height = t + "px";
            },
            f = function () {
              document
                .querySelector("#" + a.id + ".banner-notification")
                .classList.add("msg-visible"),
                document.addEventListener("keyup", u),
                (document.querySelector(
                  "#" + a.id + "-banner-notification-dont-show"
                ).checked = !0),
                r(),
                clearTimeout(i);
            },
            m = function (t) {
              t && t.stopPropagation && t.stopPropagation(),
                document.removeEventListener("keyup", u),
                window.removeEventListener("resize", h);
              var e = document.querySelector(
                "#" + a.id + ".banner-notification"
              );
              e.classList.add("closing"),
                setTimeout(function () {
                  e.parentNode.removeChild(e);
                }, 500);
            },
            g = function () {
              document.querySelector("body").appendChild(v), c();
              var t = document.querySelector("#" + a.id + " .mini-msg-popup"),
                e = document.querySelectorAll(
                  "#" + a.id + " .banner-notification-close-btn"
                ),
                n = document.querySelector(
                  "#" + a.id + "-banner-notification-dont-show"
                );
              window.addEventListener("resize", h),
                t.addEventListener("click", f),
                t.addEventListener("keypress", function (t) {
                  13 === t.keyCode && f();
                });
              for (var o = 0; o < e.length; o++) {
                var s = e[o];
                s.addEventListener("click", m),
                  s.addEventListener("keypress", function (t) {
                    13 == t.keyCode && m(t);
                  });
              }
              (i = setTimeout(m, a.fadeAfter)),
                n.addEventListener("click", r),
                n.addEventListener("keypress", function (t) {
                  13 === t.keyCode && r();
                }),
                t.focus(),
                h();
            },
            b = l + d + p,
            v = document.createElement("div");
          v.setAttribute("id", a.id),
            (v.className = "banner-notification"),
            (v.innerHTML = b),
            setTimeout(function () {
              g();
            }, 2e3);
        }
      };
    }
  ),
  define(
    "storymaps/common/builder/Builder",
    [
      "lib-build/css!./Builder",
      "lib-build/css!lib-app/font-awesome/css/font-awesome.min",
      "esri/arcgis/Portal",
      "./BuilderPanel",
      "./settings/SettingsPopup",
      "./BuilderHelper",
      "./MyStoriesWrapper",
      "../utils/CommonHelper",
      "../utils/WebMapHelper",
      "./media/image/FileUploadHelper",
      "dojo/_base/lang",
      "dojo/_base/array",
      "dojo/_base/Color",
      "dojo/has",
      "esri/arcgis/utils",
      "esri/IdentityManager",
      "esri/request",
      "dojo/topic",
      "storymaps/common/ui/bannerNotification/BannerNotification",
      "lib-app/history.min",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h, f, m, g, b, v) {
      function y(t, e) {
        if (
          ((Q = t),
          (X = e),
          (Z = new a($("#settingsPopup"))),
          console.log("common.builder.Builder - init"),
          !s.getAppID(Q.isProd()) && !app.isDirectCreation)
        )
          return void console.error(
            "common.builder.Builder - abort builder initialization, no appid supplied"
          );
        app.isDirectCreation
          ? console.log(
              "common.builder.Builder - Builder start in direct creation mode"
            )
          : app.isGalleryCreation &&
            console.log(
              "common.builder.Builder - Builder start in gallery creation mode"
            ),
          $("body").addClass("builder-mode"),
          X.init(Z),
          J.init(X),
          Z.init(X),
          Z.initLocalization(),
          b.subscribe("BUILDER_INCREMENT_COUNTER", J.incrementSaveCounter),
          b.subscribe("HEADER_EDITED", O),
          b.subscribe("BUILDER-MY-STORIES-CHECK", r.scanStory),
          (window.onbeforeunload = function (t) {
            if (((t = t || window.event), J.hasPendingChange()))
              return (
                t &&
                  (t.returnValue =
                    i18n.commonCore.builderPanel.closeWithPendingChange),
                i18n.commonCore.builderPanel.closeWithPendingChange
              );
          }),
          (app.builder.cleanApp = Y),
          b.subscribe("tpl-ready", function () {
            if (!app.isPortal) {
              var t = i18n.commonCore.httpsTransitionMessage;
              new v({
                id: "httpsTransitionMessage",
                bannerMsg: t.bannerMsg,
                mainMsgHtml:
                  "\t\t\t\t\t\t\t<h2>" +
                  t.s1h1 +
                  "</h2>\t\t\t\t\t\t\t<p>" +
                  t.s1p1 +
                  "</p>\t\t\t\t\t\t\t<p>" +
                  t.s1p2 +
                  "</p>\t\t\t\t\t\t\t<h2>" +
                  t.s2h1 +
                  "</h2>\t\t\t\t\t\t\t<p>" +
                  t.s2p1 +
                  "</p>\t\t\t\t\t\t",
                actions: [
                  { primary: !0, string: t.action1, closeOnAction: !0 },
                  {
                    string: t.action2,
                    action: function () {
                      window.open(
                        "https://storymaps.arcgis.com/en/my-stories/"
                      );
                    },
                  },
                  {
                    string: t.action3,
                    action: function () {
                      window.open(
                        "https://links.esri.com/storymaps/web_security_faq"
                      );
                    },
                  },
                ],
                cookie: { domain: "arcgis.com", path: "/", maxAge: 31536e3 },
              });
            }
          });
      }
      function w() {
        var t = "",
          e = "";
        app.data.getWebAppData().getTitle() &&
          (t = app.data.getWebAppData().getTitle().trim()),
          app.data.getWebAppItem() &&
            app.data.getWebAppItem().title &&
            (e = app.data.getWebAppItem().title.trim()),
          (app.builder.titleMatchOnLoad = e == t),
          app.data.getWebAppData().isBlank() &&
            (app.builder.titleMatchOnLoad = !0),
          app.data.getWebAppData().getAppGeocoders && S();
        var i;
        (i = app.portal) &&
          (i = i.portalProperties) &&
          (i = i.sharedTheme) &&
          (C(i) && !app.appCfg.noAppThemes && k(i), x(i) && I(i)),
          app.appCfg.noAppThemes || L();
        var n;
        if (
          !app.appCfg.noAppThemes &&
          (n = app.data.getWebAppData().getTheme()) &&
          (n = n.colors) &&
          n.name &&
          n.name.match(/-org$|-modified$/)
        ) {
          $("body").addClass("builder-shadows");
          var a =
            s.colorsAreSimilar(n.media, "#67AAE5") ||
            s.colorsAreSimilar(n.media, "#418abb");
          $("body").toggleClass("media-blues", a);
          var o = s.colorsAreSimilar(n.media, "#404040");
          $("body").toggleClass("media-dark", o);
          var r = s.colorsAreSimilar(n.media, "#939393");
          $("body").toggleClass("media-gray", r);
          var l = s.colorsAreSimilar(n.panel, "#418abb");
          $("body").toggleClass("panel-blues", l);
        }
        J.updateSharingStatus(), X.appInitComplete();
      }
      function C(t) {
        var e = !1;
        return (
          t.header && (e = E(t.header.text) || E(t.header.background)),
          !e &&
            t.body &&
            (e = E(t.body.text) || E(t.body.background) || E(t.body.link)),
          !e && t.button && (e = E(t.button.text) || E(t.button.background)),
          e
        );
      }
      function x(t) {
        return t.logo && t.logo.small;
      }
      function S() {
        app.data.getWebAppData().getAppGeocoders() || T();
      }
      function T() {
        if (
          app.portal.helperServices.geocode &&
          app.portal.helperServices.geocode.length
        ) {
          var t = [],
            e = [];
          $.each(app.portal.helperServices.geocode, function (i, n) {
            if (n.url) {
              if (
                "https:" == window.location.protocol &&
                n.url.indexOf("https") < 0
              )
                return;
              t.push($.getJSON(n.url + "?f=json")), e.push(n);
            }
          }),
            $.when.apply($, t).done(function () {
              var i = t.length > 1 ? arguments : [arguments],
                n = [];
              if (
                ($.each(i, function (t, i) {
                  var a = i[0],
                    o = i[1];
                  if (
                    a &&
                    !a.error &&
                    a.singleLineAddressField &&
                    o &&
                    "success" === o
                  ) {
                    var r = e[t];
                    n.push({
                      singleLineFieldName: a.singleLineAddressField.name,
                      name: a.name || r.name,
                      placeholder: r.placeholder,
                      url: r.url,
                    });
                  }
                }),
                app.data.getWebAppData().setAppGeocoders(n),
                app.data.getWebAppItem().id)
              ) {
                if (
                  app.isGalleryCreation &&
                  app.appCfg.disableGalleryCreationSaveGeocoders
                )
                  return;
                F(!1, function () {});
              }
            });
        }
      }
      function k(t) {
        var e = app.data.getWebAppData(),
          i = {
            header: {
              text: E(t.header.text) || "#fff",
              background: E(t.header.background) || "#333",
            },
            body: {
              text: E(t.body.text) || "#333",
              background: E(t.body.background) || "#fff",
              link: E(t.body.link || t.body.text) || "#666",
            },
            button: {
              text: E(t.button.text) || "#ccc",
              background: E(t.button.background) || "#999",
            },
          },
          n = i.body.link || i.body.text,
          a = {
            group: "org",
            themeMajor: P(i.header.background),
            header: i.header.background,
            headerText: i.header.text,
            headerTitle: i.header.text,
            panel: i.body.background,
            text: i.body.text,
            textLink: n,
            media: "#eee",
            mapControls: i.body.background,
            softText: i.body.text,
            softBtn: i.body.text,
            esriLogo: P(i.header.background),
            esriLogoMobile: "black",
          },
          o = app.isInitializing && !e.getTheme().colors;
        if (
          (app.cfg.LAYOUTS.forEach(function (t) {
            if (
              !t.themes.some(function (t) {
                return !!t.name.match(/-org$/);
              })
            ) {
              var r = { name: t.id + "-org" };
              "tab" === t.id || "bullet" === t.id
                ? p.mixin(r, {
                    tabActive: i.button.background,
                    tabTextActive: i.button.text,
                    tab: A(i.button.background, 0.75),
                    tabText: A(i.button.text, 0.6),
                    tabHover: A(i.button.background, 0.9),
                    tabTextHover: A(i.button.text, 0.8),
                  })
                : "accordion" === t.id &&
                  p.mixin(r, {
                    accordionNumber: n,
                    accordionTitle: n,
                    accordionArrowActive: n,
                    accordionArrow: A(n, 0.6),
                    accordionArrowHover: A(n, 0.8),
                  }),
                t.themes.push(p.mixin(r, a));
            }
            o &&
              t.id === e.getLayout().id &&
              (e.setTheme({ colors: t.themes[t.themes.length - 1] }),
              b.publish("CORE_UPDATE_UI"));
          }),
          o && !e.getLayout().id)
        ) {
          var r = app.cfg.LAYOUTS[0];
          e.setTheme({ colors: r[r.length - 1] });
        }
      }
      function E(t) {
        return !(!t || "no-color" === t) && t;
      }
      function A(t, e) {
        var i = new u(t);
        return (i.a = e), i.toString();
      }
      function I(t) {
        if (
          ((app.cfg.HEADER_ORG_LOGO_URL = t.logo.small),
          app.isInitializing && !app.data.getWebAppData().getHeader().logoURL)
        ) {
          var e = Q.getHeaderUserCfg(),
            i = t.logo.link ? t.logo.link.trim() : "";
          p.mixin(e, { logoURL: t.logo.small, logoTarget: i }),
            app.data.getWebAppData().setHeader(e),
            b.publish("CORE_UPDATE_UI");
        }
      }
      function L() {
        var t = app.data.getWebAppData().getTheme(),
          e = t.colors;
        if (e && e.name) {
          var i = e.name.split("-"),
            n = i[0],
            a = [
              "header",
              "headerText",
              "headerTitle",
              "panel",
              "text",
              "textLink",
              "media",
              "mapControls",
              "softText",
              "softBtn",
            ],
            o = [
              "tab",
              "tabActive",
              "tabHover",
              "tabText",
              "tabTextHover",
              "tabTextActive",
            ],
            r = [
              "accordionArrow",
              "accordionArrowHover",
              "accordionArrowActive",
              "accordionNumber",
              "accordionTitle",
            ];
          app.cfg.LAYOUTS.some(function (t) {
            if (n !== t.id) return !1;
            var i;
            return (
              "tab" === t.id || "bullet" === t.id
                ? (i = a.concat(o))
                : "accordion" === t.id && (i = a.concat(r)),
              t.themes.some(function (t) {
                return i.every(function (i) {
                  return e[i] === t[i];
                });
              })
            );
          }) ||
            app.cfg.LAYOUTS.forEach(function (t) {
              var a = {
                name: t.id + "-" + i.slice(1).join("-"),
                group: "modified",
              };
              if (
                (a.name.match(/-modified$/) || (a.name += "-modified"),
                n === t.id)
              )
                return (
                  p.mixin(e, a),
                  app.data.getWebAppData().setTheme({ colors: e }),
                  b.publish("CORE_UPDATE_UI"),
                  void t.themes.push(e)
                );
              var o;
              if ("tab" === t.id || "bullet" === t.id) {
                for (o in e)
                  e.hasOwnProperty(o) &&
                    r.indexOf(o) < 0 &&
                    "name" !== o &&
                    "group" !== o &&
                    (a[o] = e[o]);
                a = p.mixin(
                  {
                    tabActive: "#333",
                    tabTextActive: "#eee",
                    tab: A("#333", 0.75),
                    tabText: A("#eee", 0.6),
                    tabHover: A("#333", 0.9),
                    tabTextHover: A("#eee", 0.8),
                    group: "modified",
                  },
                  e,
                  a
                );
              } else if ("accordion" === t.id) {
                for (o in e)
                  e.hasOwnProperty(o) &&
                    r.indexOf(o) < 0 &&
                    "name" !== o &&
                    (a[o] = e[o]);
                a = p.mixin(
                  {
                    accordionNumber: e.textLink,
                    accordionTitle: e.textLink,
                    accordionArrowActive: e.textLink,
                    accordionArrow: A(e.textLink, 0.6),
                    accordionArrowHover: A(e.textLink, 0.8),
                    group: "modified",
                  },
                  e,
                  a
                );
              }
              t.themes.push(a);
            });
        }
      }
      function P(t) {
        return D(t) >= 128 ? "black" : "white";
      }
      function D(t) {
        var e = new u(t),
          i = e.toRgb();
        return (299 * i[0] + 587 * i[1] + 114 * i[2]) / 1e3;
      }
      function M(t) {
        J.resize(), X.resize(t);
      }
      function O(t) {
        t.src &&
          ("title" == t.src
            ? (t.value == i18n.commonCore.inlineFieldEdit.enterTitle &&
                (t.value = ""),
              app.data.getWebMap() && t.value == app.data.getWebMap().item.title
                ? app.data.getWebAppData().setTitle("")
                : t.value != app.data.getWebAppData().getTitle() &&
                  (app.data.getWebAppData().setTitle(t.value),
                  J.incrementSaveCounter()))
            : "subtitle" == t.src &&
              (t.value == i18n.commonCore.inlineFieldEdit.enterSubtitle &&
                (t.value = ""),
              app.data.getWebMap() &&
              t.value == app.data.getWebMap().item.snippet
                ? app.data.getWebAppData().setSubtitle("")
                : t.value != app.data.getWebAppData().getSubtitle() &&
                  (app.data.getWebAppData().setSubtitle(t.value),
                  J.incrementSaveCounter())));
      }
      function R(t) {
        if (!app.portal)
          return console.error("Fatal error - not signed in"), void q("APP");
        app.portal.signIn().then(
          function () {
            F(t, function (t) {
              if (!t || !t.success) return void q("APP");
              app.data.getWebAppData().getIsExternalData &&
              app.data.getWebAppData().getIsExternalData()
                ? app.data.getWebAppData().getIsExternalData() &&
                  V({ success: !0 })
                : H(function (t) {
                    if (!t || !t.success) return void q("WEBMAP");
                    V({ success: !0 });
                  });
            });
          },
          function (t) {
            q("APP", t);
          }
        );
      }
      function N(t, e) {
        if (!app.portal)
          return console.error("Fatal error - not signed in"), void q("APP");
        var i = m.findCredential(K()).userId;
        app.data.setWebAppItem(
          p.mixin(o.getBlankAppJSON(), {
            title: t,
            snippet: e,
            uploaded: Date.now(),
            modified: Date.now(),
            owner: i,
            access: "private",
          })
        );
        var n = function (t) {
          if (!t || !t.success) return void q("APP");
          var e =
            document.location.protocol +
            "//" +
            document.location.host +
            document.location.pathname;
          e.match(/index\.html$/) || (e += "index.html"),
            app.data.setWebAppItem(
              p.mixin(app.data.getWebAppItem(), {
                id: t.id,
                item: t.item,
                url: e + "?appid=" + t.id,
              })
            ),
            app.isDirectCreationOpenData &&
              (app.data.getWebAppItem().tags.push("open-data-favorite"),
              (app.data.getWebAppItem().properties = {
                content: "story map",
                datasetType: "story map",
                url: e + "?appid=" + t.id,
              }));
          var i = function () {
            F(!1, function (t) {
              if (!t || !t.success) return void q("APP");
              console.log(
                "common.builder.Builder - firstSaveForDirectCreation - appid:",
                t.id,
                " webmap:",
                null
              ),
                V({ success: !0 }),
                (app.isDirectCreationFirstSave = !1),
                J.updateSharingStatus(),
                b.publish("DIRECT_CREATION_SAVE"),
                History.replaceState(
                  {},
                  "",
                  "index.html?appid=" + t.id + "&edit"
                );
            });
          };
          if (app.isDirectCreationOpenData) {
            var n = app.portal.getPortalUser().favGroupId,
              a = K() + "/sharing/rest/content/items/" + t.id + "/share";
            g(
              {
                url: a,
                handleAs: "json",
                content: { everyone: !1, org: !1, groups: n, items: t.id },
              },
              { usePost: !0 }
            ).then(i, i);
          } else i();
        };
        app.portal.signIn().then(
          function () {
            if (app.appCfg.webmapStory) {
              var a = app.data.getWebMap();
              p.mixin(a.item, {
                title: t,
                snippet: e,
                uploaded: Date.now(),
                modified: Date.now(),
                owner: i,
                access: "private",
              }),
                H(function (t) {
                  if (!t || !t.success) return void q("WEBMAP");
                  app.data.getWebAppData().setWebmap(t.id);
                  var e = app.data.getWebMap();
                  p.mixin(e.item, { id: t.id, item: t.item }), G(), F(!1, n);
                });
            } else F(!1, n);
          },
          function (t) {
            q("APP", t);
          }
        );
      }
      function B() {
        if (!app.portal)
          return console.error("Fatal error - not signed in"), void q("APP");
        var t = m.findCredential(K()).userId,
          e = app.data.getWebMap();
        p.mixin(e.item, {
          title: app.data.getWebMap().item.title
            ? app.data.getWebMap().item.title
            : app.data.getWebAppItem().title,
          uploaded: Date.now(),
          modified: Date.now(),
          owner: t,
        }),
          app.data.getWebAppItem().ownerFolder &&
            (e.item.ownerFolder = app.data.getWebAppItem().ownerFolder),
          app.portal.signIn().then(
            function () {
              H(function (t) {
                if (!t || !t.success || !t.id) return void q("WEBMAP");
                app.data.getWebAppData().setWebmap(t.id);
                var e = app.data.getWebMap();
                p.mixin(e.item, { id: t.id, item: t.item }),
                  G(),
                  F(!1, function (e) {
                    if (!e || !e.success) return void q("APP");
                    var i = function () {
                        console.log(
                          "common.builder.Builder - builderGalleryCreationFirstSave - appid:",
                          e.id,
                          " webmap:",
                          t.id
                        ),
                          V({ success: !0 }),
                          (app.isGalleryCreation = !1),
                          J.updateSharingStatus(),
                          History.replaceState(
                            {},
                            "",
                            "index.html?appid=" + e.id + "&edit"
                          );
                      },
                      n = app.data.getWebAppItem().access;
                    if ("private" != n) {
                      var a = [app.data.getWebMap().item.id];
                      U(a.join(","), n).then(function (t) {
                        var e = t && t.results && t.results.length == a.length;
                        e
                          ? ($.each(t.results, function (t, i) {
                              i.success || (e = !1);
                            }),
                            e ? i() : q("WEBMAP"))
                          : q("WEBMAP");
                      });
                    } else i();
                  });
              });
            },
            function (t) {
              q("APP", t);
            }
          );
      }
      function F(t, e) {
        var i = K(),
          n = p.clone(app.data.getWebAppItem()),
          a = n.owner || m.findCredential(i).userId,
          o = m.findCredential(i).token;
        delete n.avgRating,
          delete n.modified,
          delete n.numComments,
          delete n.numRatings,
          delete n.numViews,
          delete n.size,
          n.typeKeywords || (n.typeKeywords = []),
          (n.typeKeywords = n.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_APP)),
          (n.typeKeywords = n.typeKeywords.concat(
            app.cfg.WEBAPP_KEYWORD_GENERIC
          ));
        var r = $.map(app.cfg.LAYOUTS, function (t) {
          return "layout-" + t.id;
        });
        (n.typeKeywords = $.grep(n.typeKeywords, function (t) {
          return -1 == $.inArray(t, r);
        })),
          n.typeKeywords.push(
            "layout-" + app.data.getWebAppData().getLayoutId()
          ),
          (n.typeKeywords = $.grep(n.typeKeywords, function (t, e) {
            return e == $.inArray(t, n.typeKeywords);
          })),
          (n.tags = n.tags ? n.tags.join(",") : ""),
          (n.typeKeywords = n.typeKeywords.join(",")),
          (n.serviceProxyParams = JSON.stringify(n.serviceProxyParams)),
          t || (n.title = app.data.getWebAppData().getTitle()),
          n.properties && (n.properties = JSON.stringify(n.properties)),
          n.url &&
            n.url.match(/apps\/[a-zA-Z]+\/\?appid=/) &&
            (n.url = n.url.replace("/?appid=", "/index.html?appid=")),
          (n = p.mixin(n, { f: "json", token: o, overwrite: !0, text: W() }));
        var s =
          i +
          "/sharing/rest/content/users/" +
          a +
          (n.ownerFolder ? "/" + n.ownerFolder : "");
        n.id ? (s += "/items/" + n.id + "/update") : (s += "/addItem"),
          g({ url: s, handleAs: "json", content: n }, { usePost: !0 }).then(
            e,
            q
          );
      }
      function W() {
        var t = app.data.getWebAppData().get(),
          e =
            t &&
            t.values &&
            t.values.settings &&
            t.values.settings.header &&
            t.values.settings.header.logoURL;
        e && ((e = j(e, e)), (t.values.settings.header.logoURL = e));
        var i = s.isAppResource(e) ? e : $("#uploadLogoInput").val();
        i && (i = s.possiblyRemoveToken(i)), d.cleanupLogos(i);
        var n = $(".settings-simulator .imgLogo"),
          a = n.attr("src");
        a && a.indexOf(e) < 0 && n.attr("src", e);
        var o = t && t.values && t.values.story && t.values.story.entries;
        return (
          o &&
            _.each(o, function (t) {
              var e = $(t.description);
              _.each(e.find("img"), function (e) {
                t.description = j(t.description, e.src);
              });
            }),
          JSON.stringify(t)
        );
      }
      function j(t, e) {
        var i = s.possiblyRemoveToken(e);
        if (e !== i) {
          var n = i.replace(/^https?\:\/\//, "//"),
            a = e.replace(/^https?\:\/\//, "//").split("?");
          return t.match(a[0] + "\\?" + a[1])
            ? t.replace(a[0] + "?" + a[1], n)
            : t.replace(decodeURI(a[0]) + "?" + a[1], n);
        }
        return t;
      }
      function H(t) {
        app.isDirectCreationFirstSave ||
        (app.appCfg.useWebmapInApp && app.isGalleryCreation) ||
        app.appCfg.webmapStory
          ? (X.preWebmapSave && X.preWebmapSave(),
            l.saveWebmap(app.data.getWebMap(), app.portal).then(function (e) {
              if (
                app.maps[app.data.getWebAppData().getWebmap()] &&
                app.data.getWebAppItem() &&
                app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo
                  .item.owner != app.data.getWebAppItem().owner
              ) {
                var i = app.data.getWebMap();
                p.mixin(i.item, { id: e.id, item: e.item }),
                  app.data.getWebAppData().setWebmap(e.id);
                var n = K(),
                  a = p.clone(app.data.getWebAppItem()),
                  o = a.owner || m.findCredential(n).userId,
                  r = m.findCredential(n).token;
                a = p.mixin(a, {
                  f: "json",
                  token: r,
                  overwrite: !0,
                  text: JSON.stringify(app.data.getWebAppData().get()),
                });
                var s =
                  n +
                  "/sharing/rest/content/users/" +
                  o +
                  (a.ownerFolder ? "/" + a.ownerFolder : "");
                s += "/items/" + a.id + "/update";
                g(
                  { url: s, handleAs: "json", content: a },
                  { usePost: !0 }
                ).then(t, q);
              }
              t(e);
            }, q))
          : t({ success: !0 });
      }
      function z(t, e) {
        "public" != t && "account" != t && "org" != t && (t = "public");
        var i = [];
        "account" == t || "org" == t
          ? (app.data.getWebMap() &&
              "private" == app.data.getWebMap().item.access &&
              app.data.getWebMap().item.owner ==
                app.portal.getPortalUser().username &&
              i.push(app.data.getWebMap().item.id),
            "private" == app.data.getWebAppItem().access &&
              i.push(app.data.getWebAppItem().id))
          : (app.data.getWebMap() &&
              "public" != app.data.getWebMap().item.access &&
              app.data.getWebMap().item.owner ==
                app.portal.getPortalUser().username &&
              i.push(app.data.getWebMap().item.id),
            "public" != app.data.getWebAppItem().access &&
              i.push(app.data.getWebAppItem().id)),
          U(i.join(","), t).then(function (n) {
            var a = n && n.results && n.results.length == i.length;
            a &&
              ($.each(n.results, function (t, e) {
                e.success || (a = !1);
              }),
              app.data.getWebMap() && (app.data.getWebMap().item.access = t),
              (app.data.getWebAppItem().access = t),
              J.updateSharingStatus()),
              e(a);
          });
      }
      function U(t, e) {
        var i = K(),
          n = m.findCredential(i).userId,
          a = m.findCredential(i).token,
          o = {
            f: "json",
            token: a,
            items: t,
            groups: "",
            everyone: "",
            org: "",
          };
        return (
          "public" == e && (o.everyone = !0),
          ("account" != e && "org" != e) || (o.org = !0),
          g(
            {
              url: i + "/sharing/rest/content/users/" + n + "/shareItems",
              handleAs: "json",
              content: o,
            },
            { usePost: !0 }
          )
        );
      }
      function G() {
        var t = K(),
          e = m.findCredential(t).userId,
          i = m.findCredential(t).token,
          n = app.data.getWebMap().item.id;
        return g(
          {
            url:
              t +
              "/sharing/rest/content/users/" +
              e +
              "/items/" +
              n +
              "/protect",
            handleAs: "json",
            content: { f: "json", token: i, groups: "", everyone: "", org: "" },
          },
          { usePost: !0 }
        );
      }
      function V(t) {
        t && t.success
          ? ((app.mystories = app.mystories || {}),
            (app.mystories.isChecking = !0),
            (app.isWebMapCreation = !1),
            J.saveSucceeded(),
            app.data.updateAfterSave(),
            app.isGalleryCreation ||
            app.isDirectCreationFirstSave ||
            app.isWebMapFirstSave
              ? ((app.isDirectCreationFirstSave = !1),
                (app.isGalleryCreation = !1),
                (app.isWebMapFirstSave = !1),
                setTimeout(window.myStoriesInit, 200))
              : r.scanStory(),
            J.updateSharingStatus())
          : q();
      }
      function q(t, e) {
        J.saveFailed(t, e);
      }
      function K() {
        return f.arcgisUrl.split("/sharing/")[0];
      }
      function Y() {
        return app.portal
          ? (app.portal.signIn().then(
              function () {
                var t = K(),
                  e = m.findCredential(t).userId,
                  i = m.findCredential(t).token,
                  n = p.clone(app.data.getWebAppItem());
                delete n.avgRating,
                  delete n.modified,
                  delete n.numComments,
                  delete n.numRatings,
                  delete n.numViews,
                  delete n.size,
                  (n = p.mixin(n, {
                    f: "json",
                    token: i,
                    overwrite: !0,
                    text: JSON.stringify(app.data.getWebAppData().getBlank()),
                  })),
                  g(
                    {
                      url:
                        t +
                        "/sharing/rest/content/users/" +
                        e +
                        (n.ownerFolder ? "/" + n.ownerFolder : "") +
                        "/addItem",
                      handleAs: "json",
                      content: n,
                    },
                    { usePost: !0 }
                  ).then(
                    function () {
                      console.log("Web Application data cleaned successfully");
                    },
                    function () {
                      console.log("Web Application data cleaning has failed");
                    }
                  );
              },
              function (t) {
                console.error("Web Application data cleaning has failed", t);
              }
            ),
            "Cleaning ...")
          : void console.error("Fatal error - not signed in");
      }
      var Q = null,
        X = null,
        J = new n($("#builderPanel"), R, N, B),
        Z = null;
      return { init: y, resize: M, appInitComplete: w, shareAppAndWebmap: z };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/BuilderView", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="modal fade" id="settingsPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal" id="initPopup" role="dialog" data-backdrop="static"></div>\r\n\r\n<div class="modal fade builderShare" id="sharePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade builderShareError" id="sharePopupError" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade saveErrorPopup" id="saveErrorPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade saveErrorPopupSocial" id="saveErrorPopupSocial" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade addEditPopup" id="addEditPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade editorDialog editorDialogInlineMedia" id="editorDialogInlineMedia" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade organizePopup" id="organizePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade migrationPopup" id="migrationPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade builderHelp" id="builderHelp" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n';
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/builder/BuilderView", [], function () {}),
  define("lib-build/css!storymaps/tpl/builder/Common", [], function () {}),
  define("lib-build/tpl!storymaps/common/builder/Landing", [], function () {
    return function (obj) {
      function print() {
        __p += __j.call(arguments, "");
      }
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape,
        __j = Array.prototype.join;
      with (obj)
        (__p +=
          '<div class="builderLanding">\n\t<div class="landing-add-container">\n\t\t<div class="landing-lbl">' +
          (null == (__t = lblAdd) ? "" : __t) +
          '</div>\n\t\t<div class="add-title-wrapper">\n\t\t\t<input type="text" class="form-control add-title" spellcheck="true" placeholder="' +
          (null == (__t = phAdd) ? "" : __t) +
          '"/>\n\t\t\t<span class="landing-btn disabled"></span>\n\t\t</div>\n\t</div>\n\n\t<div class="btnSeparator '),
          hasBuilderTour || (__p += " disabled "),
          (__p +=
            '" >\n\t\t<span class="solidline"></span>\n\t\t' +
            (null == (__t = lblOR) ? "" : __t) +
            '\n\t\t<span class="solidline"></span>\n\t</div>\n\n\t<div class="landing-tour-container '),
          hasBuilderTour || (__p += " disabled "),
          (__p +=
            '">\n\t\t<div class="landing-btn"></div>\n\t\t<div class="landing-lbl">' +
            (null == (__t = lblHelp) ? "" : __t) +
            "</div>\n\t</div>\n</div>\n");
      return __p;
    };
  }),
  define("lib-build/css!storymaps/common/builder/Landing", [], function () {}),
  define(
    "storymaps/common/builder/Landing",
    ["lib-build/tpl!./Landing", "lib-build/css!./Landing"],
    function (t) {
      return function (e, i, n) {
        function a() {
          return e.find(".landing-add-container .add-title").val();
        }
        function o() {
          e.find(".landing-add-container .landing-btn").toggleClass(
            "disabled",
            !a()
          );
        }
        function r() {
          if (!$(this).hasClass("disabled")) {
            var t = $(".add-title-wrapper input").val().trim();
            if (!t) return;
            if (
              l &&
              _.some(l, function (e) {
                return e.title && e.title.toLowerCase() === t.toLowerCase();
              }) &&
              app.data.getWebAppItem().title !== t
            )
              return void $("#saveErrorPopup").modal("show");
            app.data.getWebAppData().setTitle(t),
              $(".builder-save").removeClass("disabled").trigger("click"),
              setTimeout(function () {
                i(a());
              }, 1e3),
              $("#sharePopup").one("show.bs.modal", function (t) {
                t.stopImmediatePropagation(), t.preventDefault();
              }),
              $("#sharePopupError").one("show.bs.modal", function (t) {
                t.stopImmediatePropagation(), t.preventDefault();
              });
          }
        }
        function s(t) {
          13 == t.keyCode && $(this).val() && r();
        }
        var l,
          d = [
            [i18n.builder.landing.quote0, "––J.K. Rowling"],
            [i18n.builder.landing.quote1, "––Robert McKee"],
            [i18n.builder.landing.quote2, "––Michael Margolis"],
            [i18n.builder.landing.quote3, "––Anthony de Mello"],
            [i18n.builder.landing.quote4, "––Annette Simmons"],
            [i18n.builder.landing.quote5, "––Scott Harrison"],
            [i18n.builder.landing.quote6, "––Annette Simmons"],
            [i18n.builder.landing.quote7, "––Barbara Greene"],
            [i18n.builder.landing.quote8, "––Siberian Elder"],
            [i18n.builder.landing.quote9, "––Robert McKee"],
            [i18n.builder.landing.quote10, "––Maya Angelou"],
            [i18n.builder.landing.quote11, "––Brené Brown"],
            [i18n.builder.landing.quote12, "––Howard Gardner"],
            [i18n.builder.landing.quote13, "––Marion Dane Bauer"],
          ];
        e.append(
          t({
            lblAdd: i18n.builder.landing.lblAdd,
            phAdd: i18n.builder.landing.phAdd,
            lblOR: i18n.builder.landing.lblOR,
            lblHelp: i18n.builder.landing.lblHelp,
            hasBuilderTour: !app.appCfg.disableBuilderTour,
          })
        ),
          (function () {
            e
              .find(".landing-add-container .add-title")
              .bind("input propertychange", o)
              .keyup(s),
              e.find(".landing-add-container .landing-btn").click(r),
              e.find(".landing-tour-container").click(n);
            var t = d[Math.floor(Math.random() * d.length)].join("<br />");
            $("#builderQuotes").html("<div>" + t + "</div>");
          })(),
          (this.toggle = function (t) {
            i18n.builder.landing.lblAdd.match("%LAYOUT_TITLE%") &&
              e
                .find(".landing-add-container .landing-lbl")
                .html(
                  i18n.builder.landing.lblAdd.replace(
                    "%LAYOUT_TITLE%",
                    app.data.getCurrentLayoutStaticConfig().title
                  )
                ),
              a() ||
                (!app.isGalleryCreation && !app.isWebMapCreation) ||
                (e
                  .find(".landing-add-container .add-title")
                  .val(app.data.getWebAppItem().title)
                  .select(),
                o()),
              !l &&
                app.portal &&
                app.portal.getPortalUser &&
                app.portal
                  .getPortalUser()
                  .getItems()
                  .then(function (t) {
                    l = t;
                  }),
              e.toggle(t),
              $("#builderQuotes").toggle(t),
              focus();
          }),
          (this.focus = function () {
            e.find(".landing-add-container .add-title").focus();
          });
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/Help", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="modal-dialog">\r\n\t<div class="modal-content">\r\n\t\t<div class="modal-logo"></div>\r\n\t\t<div class="modal-header">\r\n\t\t\t<h4 class="modal-title">' +
          (null == (__t = title) ? "" : __t) +
          '</h4>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-body">\r\n\t\t\t<p>\r\n\t\t\t' +
          (null == (__t = shortlistHelp1) ? "" : __t) +
          "\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t" +
          (null == (__t = shortlistHelp2) ? "" : __t) +
          "\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t" +
          (null == (__t = shortlistHelp3) ? "" : __t) +
          ' <a href="http://www.arcgis.com/home" target="_blank">ArcGIS Online</a>, ' +
          (null == (__t = shortlistHelp4) ? "" : __t) +
          "\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\r\n\t\t\t<h3>" +
          (null == (__t = shortlistHelp5) ? "" : __t) +
          '</h3>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href="//storymaps.arcgis.com/en/app-list/shortlist" target="_blank">' +
          (null == (__t = shortlistHelp6) ? "" : __t) +
          '</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a href="//links.esri.com/storymaps/faq_shortlist" target="_blank">' +
          (null == (__t = shortlistFAQ) ? "" : __t) +
          '</a>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-footer">\r\n\t\t\t<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">' +
          (null == (__t = btnClose) ? "" : __t) +
          "</button>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n";
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/builder/Help", [], function () {}),
  define(
    "storymaps/tpl/builder/Help",
    ["lib-build/tpl!./Help", "lib-build/css!./Help"],
    function (t, e) {
      return function (e) {
        e.append(
          t({
            title: i18n.builder.help.title,
            shortlistHelp1: i18n.builder.help.shortlistHelp1,
            shortlistHelp2: i18n.builder.help.shortlistHelp2,
            shortlistHelp3: i18n.builder.help.shortlistHelp3,
            shortlistHelp4: i18n.builder.help.shortlistHelp4,
            shortlistHelp5: i18n.builder.help.shortlistHelp5,
            shortlistHelp6: i18n.builder.help.shortlistHelp6,
            shortlistFAQ: i18n.builder.help.shortlistFAQ,
            geonetForum: i18n.builder.help.geonetForum,
            btnClose: i18n.commonCore.common.close,
          })
        ),
          (this.present = function () {
            e.modal({ keyboard: !0 });
          });
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/InitPopup", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="modal-dialog">\r\n\t<div class="modal-content">\r\n\t\t<div class="modal-header">\r\n\t\t\t<h3 class="modal-title">' +
          (null == (__t = title) ? "" : __t) +
          '</h3>\r\n\t\t</div>\r\n\t\t<div class="modal-body">\r\n\t\t\tReady?\r\n\t\t</div>\r\n\t\t<div class="modal-footer">\r\n\t\t\t<span class="modal-footer-left"></span>\r\n\t\t\t<button class="btnNext btn btn-primary"></button>\r\n\t\t</div>\r\n\t</div>\r\n</div>';
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/builder/InitPopup", [], function () {}),
  define(
    "storymaps/tpl/builder/InitPopup",
    ["lib-build/tpl!./InitPopup", "lib-build/css!./InitPopup", "dojo/Deferred"],
    function (t, e, i) {
      return function (e) {
        function n() {
          o && o.resolve({ ok: !0, pickWebmap: !1 });
        }
        function a(t) {
          13 == t.keyCode && n();
        }
        e.append(
          t({
            title:
              i18n.builder.initPopup.title +
              '<span class="builder-logo"></span>',
          })
        );
        var o = null,
          r = e.find(".btnNext");
        !(function () {
          $("body").bind("keydown", a);
        })(),
          (this.init = function () {}),
          (this.present = function () {
            return (
              (o = new i()),
              r.removeAttr("disabled"),
              r.html(i18n.builder.initPopup.startBtn).show(),
              r.click(n),
              e.modal({ keyboard: !1 }),
              n(),
              o
            );
          }),
          (this.initLocalization = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/common/builder/SharePopup", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<h3 class="modal-title">' +
          (null == (__t = title) ? "" : __t) +
          '</h3>\n\t\t</div>\n\t\t<div class="modal-body">\n\t\t\t<div class="sharing-container">\n\t\t\t\t<div class="btn-group app-sharing-container">\n\t\t\t\t\t<div class="app-sharing-wrapper">\n\t\t\t\t\t\t<div class="app-sharing-loading"></div>\n\t\t\t\t\t\t<button class="app-sharing-icon glyphicon glyphicon-user" data-sharing="private" title="' +
          (null == (__t = btnPrivateTooltip) ? "" : __t) +
          '"><span class="app-sharing-private">' +
          (null == (__t = btnPrivate) ? "" : __t) +
          '</span></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="app-sharing-wrapper">\n\t\t\t\t\t\t<div class="app-sharing-loading"></div>\n\t\t\t\t\t\t<button class="app-sharing-icon share-group" data-sharing="organization" title="' +
          (null == (__t = btnOrgTooltip) ? "" : __t) +
          '">' +
          (null == (__t = btnOrg) ? "" : __t) +
          '</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="app-sharing-wrapper">\n\t\t\t\t\t\t<div class="app-sharing-loading"></div>\n\t\t\t\t\t\t<button class="app-sharing-icon share-globe" data-sharing="public" title="' +
          (null == (__t = btnPublicTooltip) ? "" : __t) +
          '">' +
          (null == (__t = btnPublic) ? "" : __t) +
          '</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="preview-container">\n\t\t\t\t\t\t<button class="btn btn-naked btn-link btn-open"></button>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="sharing-action-result hide"></div>\n\t\t\t</div>\n\n\t\t\t<div class="story-checked-container hide">\n\t\t\t\t<div class="story-status"></div>\n\n\t\t\t\t<div class="views">\n\t\t\t\t\t<div class="view view-share active" style="text-align: center">\n\t\t\t\t\t\t<table style="width: 100%">\n\t\t\t\t\t\t\t<tr style="vertical-align: top;">\n\t\t\t\t\t\t\t\t<td style="width: 50%">\n\t\t\t\t\t\t\t\t\t<div class="socialize-title">' +
          (null == (__t = socialize) ? "" : __t) +
          '</div>\n\t\t\t\t\t\t\t\t\t<div class="share-url-panel"></div>\n\t\t\t\t\t\t\t\t\t<div class="social-container">\n\t\t\t\t\t\t\t\t\t\t<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="shareIcon blackHover share_twitter icon-twitter"></i>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td style="width: 50%">\n\t\t\t\t\t\t\t\t\t<div class="embed-title">' +
          (null == (__t = embedTitle) ? "" : __t) +
          '</div>\n\t\t\t\t\t\t\t\t\t<div class="share-embed-panel"></div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t\t<div class="my-stories-call">' +
          (null == (__t = mystoriesinvite2) ? "" : __t) +
          '</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="view view-my-stories">\n\t\t\t\t\t\t<iframe id="my-stories-frame"></iframe>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="view view-private-story">\n\t\t\t\t\t\t<div class="private-story-call-to-action"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="view-toggle-container">\n\t\t\t\t\t<div class="btn btn-default view-toggle-btn">' +
          (null == (__t = btnToggle) ? "" : __t) +
          '</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="story-checking-container">\n\t\t\t\t<div style="margin: 20px 0;">\n\t\t\t\t\t<img src="resources/tpl/viewer/icons/loading-light.gif" />\n\t\t\t\t</div>\n\t\t\t\t' +
          (null == (__t = loadingMessage) ? "" : __t) +
          '\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="modal-footer">\n\t\t\t<span class="footer-msg"></span>\n\t\t\t<button class="btnClose btn btn-naked btn-close" data-dismiss="modal" aria-hidden="true">' +
          (null == (__t = close) ? "" : __t) +
          "</button>\n\t\t</div>\n\t</div>\n</div>\n";
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/common/builder/SharePopup",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/SharePopupError",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<h4 class="modal-title">' +
            (null == (__t = title) ? "" : __t) +
            '</h4>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<div class="error-msg"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t<span class="error"></span>\n\t\t\t<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">' +
            (null == (__t = btnClose) ? "" : __t) +
            "</button>\n\t\t</div>\n\t</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/SharePopupError",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/SharePopupError",
    ["lib-build/tpl!./SharePopupError", "lib-build/css!./SharePopupError"],
    function (t) {
      return function (e) {
        e.html(
          t({
            title: i18n.commonCore.share.shareTitle,
            btnClose: i18n.commonCore.common.close,
          })
        ),
          (this.present = function (t) {
            var i = "";
            "DOMAIN" == t.error
              ? (i += i18n.commonCore.share.notavailable1.replace(
                  "%PRODUCT%",
                  t.isPortal ? "Portal for ArcGIS" : "ArcGIS Online"
                ))
              : "PORTAL" == t.error
              ? (i += i18n.commonCore.share.notavailable2)
              : "DEV" == t.error && (i += i18n.commonCore.share.notavailable6),
              (i += "<br /><br />"),
              "DOMAIN" == t.error
                ? (i += i18n.commonCore.share.notavailable3.replace(
                    "%LINK%",
                    '<a href="' +
                      t.mystoriesURL +
                      '" target="_blank">' +
                      i18n.commonCore.share.notavailable4 +
                      "</a>"
                  ))
                : ((i += i18n.commonCore.share.notavailable3.replace(
                    "%LINK%",
                    '<a href="' +
                      t.itemURL +
                      '" target="_blank">' +
                      i18n.commonCore.share.notavailable5 +
                      "</a>"
                  )),
                  (i += " "),
                  (i += i18n.commonCore.share.notavailable7.replace(
                    "%MYCONTENT%",
                    '<a href="' +
                      t.mycontentURL +
                      '" target="_blank">' +
                      i18n.commonCore.share.notavailable8 +
                      "</a>"
                  ))),
              e.find(".error-msg").html(i),
              e.modal({ keyboard: !0 });
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/SharePopup",
    [
      "lib-build/tpl!./SharePopup",
      "lib-build/css!./SharePopup",
      "./SharePopupError",
      "./MyStoriesWrapper",
      "../utils/CommonHelper",
      "../ui/share/ShareURLPanel",
      "../ui/share/ShareEmbedPanel",
      "../utils/HeaderHelper",
      "dojo/topic",
      "dojo/has",
    ],
    function (t, e, i, n, a, o, r, s, l, d) {
      return function (e) {
        function p() {
          var t =
            "private" == app.data.getWebAppItem().access ||
            "shared" == app.data.getWebAppItem().access;
          e.find(".views .view-my-stories").hasClass("active")
            ? (t
                ? (e.find(".views .view-share").toggleClass("active", !1),
                  e.find(".views .view-my-stories").toggleClass("active", !1),
                  e
                    .find(".views .view-private-story")
                    .toggleClass("active", !0),
                  e
                    .find(".view-toggle-btn")
                    .html(i18n.commonCore.share.viewToggle1))
                : (e.find(".views .view-share").toggleClass("active", !0),
                  e.find(".views .view-my-stories").toggleClass("active", !1),
                  e
                    .find(".views .view-private-story")
                    .toggleClass("active", !1),
                  e
                    .find(".view-toggle-btn")
                    .html(i18n.commonCore.share.viewToggle1)),
              d("ff") &&
                $("#my-stories-hidden-container").removeClass("active"))
            : (e.find(".views .view-share").toggleClass("active", !1),
              e.find(".views .view-my-stories").toggleClass("active", !0),
              e.find(".views .view-private-story").toggleClass("active", !1),
              e
                .find(".view-toggle-btn")
                .html(i18n.commonCore.share.viewToggle2),
              m.updateMyStoriesPosition());
        }
        function c() {
          var t = $(this).data("sharing"),
            i = "private" == t ? 0 : "organization" == t ? 1 : 2,
            n = e.find(".app-sharing-icon.active").index();
          console.log("Changing sharing level to:", t),
            e.find(".app-sharing-icon").removeClass("active"),
            $(this).addClass("active"),
            e.find(".app-sharing-icon").addClass("locked"),
            e.find(".sharing-action-result").addClass("hide"),
            e
              .find(".app-sharing-wrapper")
              .eq(i)
              .find(".app-sharing-loading")
              .show(),
            e.find(".btn-open").addClass("disabled"),
            app.mystories.share(t).then(u, function (t) {
              t.needsUserInput && t.delayPromise
                ? ((app.mystories.hasCheckErrors = !0),
                  t.delayPromise.then(u, function (t) {
                    h(t, n);
                  }),
                  f({
                    postSharing: !0,
                    previousLevelIndex: n,
                    targetLevelIndex: i,
                    needsUserInput: !0,
                  }))
                : h(t, n);
            });
        }
        function u(t) {
          console.log(t),
            (app.mystories.hasCheckErrors = !t.allClear),
            e.find(".app-sharing-icon").removeClass("locked"),
            e.find(".app-sharing-loading").hide(),
            e.find(".btn-open").removeClass("disabled"),
            t.storyAndContent &&
              e
                .find(".sharing-action-result")
                .removeClass("hide")
                .addClass("status-ok")
                .html(t.message),
            "private" == t.targetAccess
              ? (app.data.getWebAppItem().access = "private")
              : "organization" == t.targetAccess
              ? (app.data.getWebAppItem().access = "org")
              : "public" == t.targetAccess &&
                (app.data.getWebAppItem().access = "public"),
            f();
        }
        function h(t, i) {
          console.error("sharing failed"),
            (app.mystories.hasCheckErrors = !t.allClear),
            e.find(".app-sharing-icon").removeClass("locked active"),
            e.find(".app-sharing-icon").eq(i).addClass("active"),
            e.find(".app-sharing-loading").hide(),
            e.find(".btn-open").removeClass("disabled"),
            e
              .find(".sharing-action-result")
              .removeClass("hide status-ok")
              .html(t.message);
        }
        function f(t) {
          var i = app.data.getWebAppItem().access,
            n = "private" == i || "shared" == i,
            a = "account" == i || "org" == i,
            o = app.isDirectCreationFirstSave || app.isGalleryCreation,
            r = n ? 0 : a ? 1 : 2,
            s = "";
          (t = t || {}),
            e
              .find(".story-checked-container")
              .toggleClass("hide", app.mystories.isChecking),
            e
              .find(".story-checking-container")
              .toggleClass("hide", !app.mystories.isChecking),
            e.find(".app-sharing-icon").removeClass("locked active"),
            o
              ? e.find(".app-sharing-icon").addClass("locked")
              : n || (t.needsUserInput && 0 === t.targetLevelIndex)
              ? e.find(".app-sharing-icon").eq(0).addClass("active")
              : a || (t.needsUserInput && 1 === t.targetLevelIndex)
              ? e.find(".app-sharing-icon").eq(1).addClass("active")
              : e.find(".app-sharing-icon").eq(2).addClass("active");
          var p;
          if (
            (o ||
              app.mystories.forcedIgnoreIssues ||
              (t.needsUserInput
                ? ((p = t.targetLevelIndex),
                  e.find(".app-sharing-loading").hide(),
                  2 == p
                    ? e
                        .find(".app-sharing-icon")
                        .eq(2)
                        .toggleClass("locked", !0)
                    : 1 == p
                    ? (e
                        .find(".app-sharing-icon")
                        .eq(2)
                        .toggleClass("locked", !0),
                      e
                        .find(".app-sharing-icon")
                        .eq(1)
                        .toggleClass("locked", !0))
                    : 0 === p &&
                      e
                        .find(".app-sharing-icon")
                        .eq(0)
                        .toggleClass("locked", !0))
                : app.mystories.hasCheckErrors
                ? ((p = t.postSharing ? t.previousLevelIndex : r),
                  2 == p
                    ? e.find(".app-sharing-icon").toggleClass("locked", !1)
                    : 1 == p
                    ? (e.find(".app-sharing-icon").toggleClass("locked", !0),
                      e
                        .find(".app-sharing-icon")
                        .eq(0)
                        .toggleClass("locked", !1))
                    : 0 === p &&
                      e.find(".app-sharing-icon").toggleClass("locked", !0))
                : e
                    .find(".app-sharing-icon")
                    .toggleClass("locked", app.mystories.isChecking)),
            !app.mystories.isChecking)
          ) {
            if (
              ((app.mystories.hasCheckErrors ||
                app.mystories.forcedIgnoreIssues) &&
                (s += i18n.commonCore.share.statusError),
              e.find(".story-status").hide(),
              app.mystories.hasCheckErrors || app.mystories.forcedIgnoreIssues)
            ) {
              if ((e.find(".story-status").html(s).show(), n)) {
                var c = i18n.commonCore.share.statusPrivate;
                (c += "<br />"),
                  (c += i18n.commonCore.share.statusNoErrPrivate),
                  e.find(".private-story-call-to-action").html(c);
              }
            } else
              n &&
                ((s += i18n.commonCore.share.statusPrivate),
                (s += "<br />"),
                (s += i18n.commonCore.share.statusNoErrPrivate),
                e.find(".private-story-call-to-action").html(s));
            if (!t.isRefresh || app.mystories.forcedIgnoreIssues) {
              var u = !!(
                (app.mystories.hasCheckErrors &&
                  !app.mystories.forcedIgnoreIssues) ||
                t.needsUserInput ||
                o
              );
              e
                .find(".views .view-share")
                .toggleClass(
                  "active",
                  !(
                    (app.mystories.hasCheckErrors &&
                      !app.mystories.forcedIgnoreIssues) ||
                    t.needsUserInput ||
                    n ||
                    o
                  )
                ),
                e.find(".views .view-my-stories").toggleClass("active", u),
                e
                  .find(".views .view-private-story")
                  .toggleClass(
                    "active",
                    (!app.mystories.hasCheckErrors ||
                      app.mystories.forcedIgnoreIssues) &&
                      !t.needsUserInput &&
                      n
                  ),
                d("ff") &&
                  ($("#my-stories-hidden-container").toggleClass("active", u),
                  u && m.updateMyStoriesPosition());
            }
          }
          e.find(".btn-open").toggle(!o),
            e
              .find(".btn-open")
              .html(
                n
                  ? i18n.commonCore.share.preview
                  : i18n.commonCore.share.viewlive
              ),
            e
              .find(".view-toggle-container")
              .toggleClass(
                "hide",
                (app.mystories.hasCheckErrors &&
                  !app.mystories.forcedIgnoreIssues) ||
                  o
              ),
            e.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1),
            l.publish(
              "MYSTORIES_SCAN",
              app.mystories.hasCheckErrors || t.needsUserInput ? "error" : null
            );
        }
        e.append(
          t({
            title: i18n.commonCore.share.shareTitle,
            btnPrivate: i18n.commonCore.share.btnPrivate,
            btnPrivateTooltip: i18n.commonCore.share.btnPrivateTooltip,
            btnOrg: i18n.commonCore.share.btnOrg,
            btnOrgTooltip: i18n.commonCore.share.btnOrgTooltip,
            btnPublic: i18n.commonCore.share.btnPublic,
            btnPublicTooltip: i18n.commonCore.share.btnPublicTooltip,
            loadingMessage: i18n.commonCore.share.loadingMessage,
            btnToggle: i18n.commonCore.share.viewToggle1,
            socialize: i18n.commonCore.share.socialize,
            embedTitle: i18n.viewer.shareFromCommon.embed,
            mystoriesinvite2: i18n.commonCore.share.mystoriesinvite2.replace(
              "${MYSTORIES}",
              '<a href="' +
                a.getMyStoriesURL() +
                '" target="_blank">' +
                i18n.commonCore.common.mystories +
                "</a>"
            ),
            close: i18n.commonCore.common.close,
          })
        );
        var m = this,
          g = new i($("#sharePopupError")),
          b = new o(e.find(".share-url-panel")),
          v = new r(e.find(".share-embed-panel"));
        !(function () {
          e.find(".app-sharing-icon").click(c),
            e.find(".view-toggle-btn").click(p),
            e
              .find(".btn-open")
              .off("click")
              .click(function () {
                window.open(a.getAppViewModeURL() + "&preview", "_blank");
              }),
            e.on("hide.bs.modal", function () {
              d("ff") &&
                $("#my-stories-hidden-container").removeClass("active");
            }),
            e.on("shown.bs.modal", function () {
              d("ff") && m.updateMyStoriesPosition();
            });
        })(),
          l.subscribe("MY-STORIES-REFRESH", function () {
            f({ isRefresh: !0 });
          }),
          (this.present = function (t, i) {
            var o = a.getAppViewModeURL();
            if (
              !app.portal.hasMyStories ||
              !app.isProduction ||
              !n.myStoriesIsSameDomain()
            ) {
              var r = "";
              if (
                (app.isProduction || app.portal.hasMyStories
                  ? app.isProduction &&
                    app.isPortal &&
                    n.myStoriesIsSameDomain() &&
                    !app.portal.hasMyStories
                    ? (r = "PORTAL")
                    : !app.isProduction ||
                      (app.portal.hasMyStories && n.myStoriesIsSameDomain()) ||
                      (r = "DOMAIN")
                  : (r = "DEV"),
                r)
              )
                return void g.present({
                  error: r,
                  isPortal: app.isPortal,
                  itemURL: a.getItemURL(app.data.getWebAppItem().id),
                  mycontentURL: a.getMyContentURL(),
                  mystoriesURL: a.getMyStoriesURL(),
                });
            }
            if (
              (b.present(o, !1),
              v.present(o),
              s.setSocial(e, i),
              s.initEvents(e, "bottom"),
              app.mystories)
            ) {
              e
                .find(".app-sharing-icon")
                .tooltip({
                  placement: "top",
                  container: ".app-sharing-container",
                  trigger: "hover",
                }),
                f();
              var l =
                '<a href="' +
                a.getMyStoriesURL() +
                '" target="_blank">' +
                i18n.commonCore.share.mystoriesinvite +
                "</a>";
              e.find(".footer-msg").html(l);
            } else
              e.find(".app-sharing-icon")
                .removeClass("active")
                .addClass("locked");
            e.find(".sharing-action-result").addClass("hide");
            var d = !1 !== app.portal.isOrganization,
              p = app.data.getWebAppItem().access,
              c =
                d &&
                $.inArray(
                  "portal:user:shareToOrg",
                  app.portal.getPortalUser().privileges
                ) > -1,
              u =
                !d ||
                $.inArray(
                  "portal:user:shareToPublic",
                  app.portal.getPortalUser().privileges
                ) > -1,
              h = app.data.getWebAppItem().itemControl,
              m = "private" == p || "shared" == p,
              y = "account" == p || "org" == p,
              w =
                app.data.getWebAppItem().owner ==
                app.portal.getPortalUser().username;
            "update" == h
              ? ((c = !1), (u = !1))
              : "admin" != h ||
                w ||
                ((c =
                  $.inArray(
                    "portal:admin:shareToOrg",
                    app.portal.getPortalUser().privileges
                  ) > -1),
                (u =
                  $.inArray(
                    "portal:admin:shareToPublic",
                    app.portal.getPortalUser().privileges
                  ) > -1)),
              y ? (c = !0) : m || (u = !0),
              e.find(".app-sharing-wrapper").eq(0).addClass("enabled"),
              e.find(".app-sharing-wrapper").eq(1).toggleClass("enabled", c),
              e.find(".app-sharing-wrapper").eq(2).toggleClass("enabled", u),
              e.find(".app-sharing-wrapper.enabled:last").addClass("lastBtn"),
              e.modal({ keyboard: !0 });
          }),
          (this.updateMyStoriesPosition = function () {
            if (d("ff")) {
              var t = e.find(".view-my-stories")[0].getBoundingClientRect();
              $("#my-stories-hidden-container")
                .addClass("active")
                .css({
                  top: t.top,
                  left: t.left,
                  width: t.right - t.left,
                  height: e.find(".story-status").is(":visible") ? 270 : 300,
                });
            }
          });
      };
    }
  ),
  define("storymaps/tpl/builder/BuilderHelper", [], function () {
    return {
      getNewLayerJSON: function (t) {
        return {
          id: "shortlist-layer" + new Date().getTime(),
          title: "Shortlist layer (DO NOT REMOVE OR EDIT)",
          visibility: !0,
          opacity: 1,
          layerType: "ArcGISFeatureLayer",
          featureCollection: { layers: [t], showLegend: !0 },
        };
      },
      getFeatureCollectionTemplate: function (t) {
        var e = {
          layerDefinition: null,
          featureSet: { features: [], geometryType: "esriGeometryPoint" },
        };
        return (
          (e.layerDefinition = {
            geometryType: "esriGeometryPoint",
            objectIdField: "__OBJECTID",
            name: "Shortlist-layer",
            type: "Feature Layer",
            typeIdField: "",
            drawingInfo: {
              renderer: {
                type: "simple",
                symbol: {
                  type: "esriPMS",
                  url: "http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",
                  imageData:
                    "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",
                  contentType: "image/png",
                  width: 15,
                  height: 15,
                },
              },
            },
            fields: [
              {
                name: "__OBJECTID",
                alias: "__OBJECTID",
                type: "esriFieldTypeOID",
                editable: !1,
                domain: null,
              },
            ],
            types: [],
            capabilities: "Query",
          }),
          (e.layerDefinition.fields = t
            ? [
                {
                  name: "__OBJECTID",
                  alias: "__OBJECTID",
                  type: "esriFieldTypeOID",
                  editable: !1,
                  domain: null,
                },
                {
                  name: "name",
                  type: "esriFieldTypeString",
                  alias: "Name",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "description",
                  type: "esriFieldTypeString",
                  alias: "Description",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 1e3,
                },
                {
                  name: "pic_url",
                  type: "esriFieldTypeString",
                  alias: "Picture URL",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "thumb_url",
                  type: "esriFieldTypeString",
                  alias: "Thumbnail URL",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "website",
                  type: "esriFieldTypeString",
                  alias: "Website",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "shortlist_id",
                  type: "esriFieldTypeInteger",
                  alias: "Shortlist Id",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "number",
                  type: "esriFieldTypeInteger",
                  alias: "Number",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "tab_id",
                  type: "esriFieldTypeInteger",
                  alias: "Tab index",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
                {
                  name: "locationSet",
                  type: "esriFieldTypeInteger",
                  alias: "Location Set",
                  domain: null,
                  editable: !0,
                  nullable: !0,
                  length: 254,
                },
              ]
            : [
                {
                  name: "__OBJECTID",
                  alias: "__OBJECTID",
                  type: "esriFieldTypeOID",
                  editable: !1,
                  domain: null,
                },
              ]),
          e
        );
      },
      serializeGraphicsLayerToFeatureCollection: function (t, e, i) {
        var n = {
          layers: [
            {
              featureSet: { features: [], geometryType: t.geometryType },
              layerDefinition: {
                geometryType: t.geometryType,
                objectIdField: t.objectIdField,
                name: t.name,
                type: t.type,
                typeIdField: t.typeIdField,
                drawingInfo: {
                  renderer: {
                    type: "simple",
                    symbol: {
                      type: "esriPMS",
                      url: "http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",
                      imageData:
                        "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",
                      contentType: "image/png",
                      width: 15,
                      height: 15,
                    },
                  },
                },
                fields: [
                  {
                    name: "__OBJECTID",
                    alias: "__OBJECTID",
                    type: "esriFieldTypeOID",
                    editable: !1,
                    domain: null,
                  },
                  {
                    name: "name",
                    type: "esriFieldTypeString",
                    alias: "Name",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "description",
                    type: "esriFieldTypeString",
                    alias: "Description",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 1e3,
                  },
                  {
                    name: "pic_url",
                    type: "esriFieldTypeString",
                    alias: "Picture URL",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "thumb_url",
                    type: "esriFieldTypeString",
                    alias: "Thumbnail URL",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "website",
                    type: "esriFieldTypeString",
                    alias: "Website",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "shortlist_id",
                    type: "esriFieldTypeInteger",
                    alias: "Shortlist Id",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "number",
                    type: "esriFieldTypeInteger",
                    alias: "Number",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "tab_id",
                    type: "esriFieldTypeInteger",
                    alias: "Tab index",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                  {
                    name: "set",
                    type: "esriFieldTypeInteger",
                    alias: "Location Set",
                    domain: null,
                    editable: !0,
                    nullable: !0,
                    length: 254,
                  },
                ],
                types: [],
                capabilities: t.capabilities,
              },
            },
          ],
          showLegend: !0,
        };
        return (
          $.each(t.fields, function (t, e) {
            n.layers[0].layerDefinition.fields.push({
              name: e.name,
              alias: e.alias,
              type: e.type,
              editable: e.editable,
              domain: null,
            });
          }),
          $.each(i, function (t, e) {
            n.layers[0].featureSet.features.push({
              attributes: e.attributes,
              geometry: e.geometry,
            });
          }),
          n
        );
      },
      getBlankWebmapJSON: function () {
        var t = { latestWkid: 3857, wkid: 102100 };
        return (
          app.map && app.map.spatialReference && (t = app.map.spatialReference),
          {
            item: {
              id: "",
              guid: null,
              name: null,
              type: "Web Map",
              typeKeywords: [
                "ArcGIS Online",
                "Explorer Web Map",
                "Map",
                "Online Map",
                "Web Map",
                "Story Maps",
                "Shortlist",
              ],
              description: null,
              tags: ["map"],
              snippet: null,
              thumbnail: "thumbnail/ago_downloaded.png",
              documentation: null,
              extent: [
                [-180, -90],
                [180, 90],
              ],
              spatialReference: null,
              accessInformation: null,
              licenseInfo: null,
              culture: "en-us",
              properties: null,
              url: null,
              size: 233,
              appCategories: [],
              industries: [],
              languages: [],
              largeThumbnail: null,
              banner: null,
              screenshots: [],
              listed: !1,
              ownerFolder: null,
              commentsEnabled: !0,
              numComments: 0,
              numRatings: 0,
              avgRating: 0,
              numViews: 1,
            },
            itemData: {
              operationalLayers: [],
              baseMap: {
                baseMapLayers: [
                  {
                    id: "defaultBasemap",
                    opacity: 1,
                    visibility: !0,
                    url: "http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Base/MapServer",
                    layerType: "ArcGISTiledMapServiceLayer",
                  },
                  {
                    id: "referenceOverlay",
                    opacity: 1,
                    visibility: !0,
                    url: "http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Reference/MapServer",
                    layerType: "Feature Layer",
                  },
                ],
                title: "Light Gray",
              },
              spatialReference: t,
              version: "2.9",
            },
          }
        );
      },
    };
  }),
  define(
    "storymaps/common/builder/browse-dialog/js/_RefreshMixin",
    ["dojo/_base/declare", "dojo/_base/lang", "dojo/_base/Deferred", "dojo/on"],
    function (t, e, i, n) {
      function a(t) {
        if (
          ("object" != typeof t && (t = new Error(t)), "cancel" !== t.dojoType)
        ) {
          t.grid = this;
          var e = { grid: this, error: t, cancelable: !0, bubbles: !0 };
          n.emit(this.domNode, "dgrid-error", e) && console.warn(t);
        }
      }
      return t(null, {
        _trackError: function (t) {
          var o;
          "string" == typeof t && (t = e.hitch(this, t));
          try {
            o = t();
          } catch (t) {
            a.call(this, t);
          }
          return i.when(
            o,
            e.hitch(this, function () {
              n.emit(this.domNode, "refresh", { cancelable: !0, bubbles: !0 });
            }),
            e.hitch(this, a)
          );
        },
      });
    }
  ),
  define(
    "storymaps/common/builder/browse-dialog/js/PortalItemStore",
    ["dojo/_base/declare", "dojo/_base/lang", "esri/arcgis/Portal"],
    function (t, e, i) {
      return t(null, {
        idProperty: "id",
        constructor: function (e) {
          t.safeMixin(this, e),
            (this.portalUrl = this.portal && this.portal.portalUrl);
        },
        getIdentity: function (t) {
          return t[this.idProperty];
        },
        query: function (t, n) {
          var t = t,
            a = e.isObject(t) ? t : { q: t };
          if (
            n &&
            ((a = e.mixin(a, { num: n.count, start: (n.start || 0) + 1 })),
            n.sort && n.sort.length)
          ) {
            var o = n.sort[0];
            a = e.mixin(a, {
              sortField: encodeURIComponent(
                "created" === o.attribute ? "uploaded" : o.attribute
              ),
              sortOrder: o.descending ? "desc" : "asc",
            });
          }
          if ("webmap" === this.galleryType)
            var r = this.portal.queryItems(a).then(function (t) {
              return (t.results.total = t.total), t.results;
            });
          else
            var r = this.portal.queryGroups(a).then(function (t) {
              return (t.results.total = t.total), t.results;
            });
          return i.PortalResult(r);
        },
      });
    }
  ),
  define(
    "storymaps/common/builder/browse-dialog/js/Grid",
    [
      "dojo/_base/declare",
      "dojo/Evented",
      "dojo/string",
      "dojo/_base/lang",
      "dojo/_base/array",
      "dijit/_WidgetBase",
      "dijit/_TemplatedMixin",
      "dijit/_WidgetsInTemplateMixin",
      "dgrid/Grid",
      "./_RefreshMixin",
      "dgrid/Selection",
      "dgrid/extensions/Pagination",
      "dojo/query",
      "dojo/store/Memory",
      "dojo/store/Cache",
      "./PortalItemStore",
      "dojo/store/Observable",
      "put-selector/put",
      "dgrid/util/mouse",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h, f, m, g, b, v) {
      return t([o, e], {
        postMixInProperties: function () {
          this.inherited(arguments),
            (this._supportedViews = ["gallery", "details"]),
            (this._galleryTemplate =
              this._galleryTemplate ||
              "<div class='itemGrid'><img alt='' src='${thumbnailUrl:_formatThumbnail}'><div class='itemTitle'>${title:_formatTitle}</div><div class='itemOwner'>${owner}</div><p class='itemText snippet' style='display:none;'>${snippet}</p></div>"),
            (this._renderers = n.mixin(this._renderers || {}, {
              gallery: n.hitch(this, function (e) {
                e.snippet = e.snippet || e.description || e.title || "";
                var n = b("div"),
                  a = new (t([o, r, s], {
                    templateString: i.substitute(
                      this._galleryTemplate,
                      e,
                      null,
                      this
                    ),
                  }))();
                return n.appendChild(a.domNode), n;
              }),
            }));
        },
        _formatTitle: function (t) {
          return t || (t = ""), t;
        },
        _formatThumbnail: function (t) {
          return t || "resources/common/icons/browse-dialog/default.png";
        },
        buildRendering: function () {
          this.inherited(arguments);
          var e = t([l, c, p, d]),
            i = this.columns || {
              id: { label: "id" },
              title: { label: "title" },
              type: { label: "type" },
              modified: { label: "last modified" },
              snippet: { label: "snippet" },
            };
          (this._view = this.view || "gallery"),
            (this._query = this.query),
            (this._queryOptions = this.queryOptions || {
              sort: this.sort || [{ attribute: "modified", descending: !0 }],
            }),
            (this._store =
              this.store ||
              new f(
                new m({ portal: this.portal, galleryType: this.galleryType }),
                new h({ data: [] })
              )),
            (this._rowsPerPage = this.rowsPerPage || 8),
            (this._sort = this.sort || [
              { attribute: "title", descending: !1 },
            ]),
            (this._pagingLinks = !!this.pagingLinks && 3),
            (this._grid = new e(
              {
                columns: i,
                showHeader: !1,
                selectionMode: "single",
                renderRow: this._renderers[this._view],
                store: this._store,
                query: this._query,
                loadingMessage: i18n.commonWebmap.selector.loadingResults,
                noDataMessage: i18n.commonWebmap.selector.noResults,
                showLoadingMessage: !0,
                firstLastArrows: this._pagingLinks,
                previousNextArrows: this._pagingLinks,
                rowsPerPage: this._rowsPerPage,
                pagingLinks: this._pagingLinks,
                pagingTextBox: !0,
                sort: this._sort,
              },
              this.domNode
            )),
            this._grid.startup();
        },
        postCreate: function () {
          this.inherited(arguments),
            this.own(
              this._grid.on(v.enterRow, n.hitch(this, "_showSnippet", !0)),
              this._grid.on(v.leaveRow, n.hitch(this, "_showSnippet", !1)),
              this._grid.on("refresh", n.hitch(this, "_onGridRefresh")),
              this._grid.on(".dgrid-row:click", n.hitch(this, "_onRowClick"))
            );
        },
        _onGridRefresh: function (t) {
          this.emit("onRefresh", { currentPage: this._grid._currentPage }),
            this._pagingLinks &&
              (u(".dgrid-navigation")[
                this._grid._total <= this._grid.rowsPerPage
                  ? "addClass"
                  : "removeClass"
              ]("hide"),
              u(".dgrid-pagination")[
                0 === this._grid._total ? "addClass" : "removeClass"
              ]("hide"));
        },
        _onRowClick: function (t) {
          this.emit("onItemClick", { row: this._grid.row(t) });
        },
        _showSnippet: function (t, e) {
          var i = this._grid.row(e);
          i &&
            (u(".itemGrid .itemTitle", i.element)[
              t ? "addClass" : "removeClass"
            ]("hover"),
            u(".itemGrid .itemOwner", i.element).style(
              "display",
              t ? "none" : ""
            ),
            u(".itemGrid > img", i.element).style("display", t ? "none" : ""));
        },
        _getGridAttr: function () {
          return this._grid;
        },
        refresh: function () {
          this._grid &&
            this._grid.set("query", this._query, this._queryOptions);
        },
        gotoPage: function (t) {
          (this._grid.query = this._query),
            (this._grid.queryOptions = this._queryOptions),
            (this._grid._sort = this._queryOptions.sort),
            this._grid.gotoPage(t);
        },
        _setViewAttr: function (t) {
          (t = -1 === a.indexOf(this._supportedViews, t) ? this._view : t),
            (this._view = t),
            this._grid &&
              ((this._grid.renderRow = this._renderers[t]),
              b(this._grid.domNode, "!gallery!details." + t));
        },
        _setStoreAttr: function (t) {
          this._store = t;
        },
        _setQueryAttr: function (t, e) {
          (this._query = t || this._query),
            (this._queryOptions = e || this._queryOptions);
        },
        _setItemsAttr: function (t) {
          (this._store = this._store || new g(h({ data: t }))),
            this._store && this._store.setData
              ? this._store.setData(t)
              : (this._store = new g(h({ data: t }))),
            this.set("store", this._store),
            this.set("view", this._view);
        },
      });
    }
  ),
  define(
    "text!storymaps/common/builder/browse-dialog/js/templates/BrowseIdDlg.html",
    [],
    function () {
      return '<div class="widgetContent" >\n  <div data-dojo-type="dijit/Dialog" id="browse-id-dialog" title="${i18n.title}" execute="">\n    <div data-dojo-attach-point="formNode" class="esriItemLinks dijitDialogPaneContentArea">\n      <div id="browse-id-box" style="border:#333 1px solid; width:565px; min-height:330px; padding:0; overflow:hidden;">\n        <div class="esriFloatLeading esriLeadingMargin1" style="width:160px; margin-top:10px;">\n          <select data-dojo-attach-point="_filterSelect"  data-dojo-type="dijit/form/Select" sortByLabel="false" maxHeight=\'350\' style="width:160px;">\n          </select>\n        </div>\n        <div class="search esriFloatTrailing esriTrailingMargin1" style="width:350px;">\n          <div id="search-form" style="position:relative;">\n            <input class="esriSearchBox" type="text" data-dojo-type="dijit/form/TextBox" trim="true" id="browse-id-search-box" data-dojo-attach-point="searchText" data-dojo-attach-event="onKeyPress:_onSearchKeyPress,onFocus:_onSearchBoxFocus,onBlur:_onSearchBoxBlur" alt="${i18n.searchTitle}" title="${i18n.searchTitle}" placeholder="${i18n.placeholder}" />\n            <button class="esriLeadingMargin13 esriSearchButton dijitDialogCloseIcon hide" id="clear-box_submit" alt="${i18n.searchTitle}" title="searchTitle" data-dojo-attach-point="clearButton" data-dojo-attach-event="onclick:_onSearchClear" >&nbsp;&nbsp;</button>\n          </div>\n        </div>\n        <div style="position:relative; width:565px;clear:both;" data-dojo-attach-point="gallery"  id="gallery"></div>\n      </div>\n    </div>\n    <div class="submitButtons dijitDialogPaneActionBar esriPositionRight0">\n      <input data-dojo-type="dijit/form/Button" name="cancel" class="cancel esriFloatTrailing" type="button" data-dojo-attach-event="onClick:onCancel" label="${i18n.cancel}">\n      <input data-dojo-type="dijit/form/Button" name="ok" class="ok esriFloatTrailing calcite blue" type="button" data-dojo-attach-event="onClick:onClose" label="${i18n.ok}">\n    </div>\n  </div>\n</div>\n';
    }
  ),
  define(
    "storymaps/common/builder/browse-dialog/js/BrowseIdDlg",
    [
      "require",
      "dojo/_base/declare",
      "dojo/_base/connect",
      "dojo/_base/lang",
      "dojo/_base/event",
      "dojo/dom-class",
      "dojo/keys",
      "dijit/registry",
      "dojo/on",
      "dojo/i18n!commonResources/nls/webmap.js?v=" + app.version,
      "dijit/_WidgetBase",
      "dijit/_TemplatedMixin",
      "dijit/_WidgetsInTemplateMixin",
      "./Grid",
      "esri/arcgis/Portal",
      "text!./templates/BrowseIdDlg.html",
      "dijit/Dialog",
      "dijit/form/Select",
      "dijit/form/Button",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h, f, m) {
      return e([p, c, u], {
        templateString: m,
        constructor: function (t) {
          n.mixin(this, t);
        },
        postMixInProperties: function () {
          this.inherited(arguments),
            (this.i18n = {}),
            "webmap" === this.galleryType
              ? (this.i18n = d.configure.mapdlg)
              : (this.i18n = d.configure.groupdlg),
            (this.selected = null);
        },
        postCreate: function () {
          var t = [];
          t.push(
            { label: this.i18n.items.contentLabel, value: "content" },
            { label: this.i18n.items.organizationLabel, value: "org" },
            {
              label: app.isPortal
                ? app.portal.name
                : this.i18n.items.onlineLabel,
              value: "online",
            }
          ),
            "webmap" === this.galleryType &&
              t.push({
                label: this.i18n.items.favoritesLabel,
                value: "favorites",
              }),
            this._filterSelect.set("options", t),
            (this._filterSelectHandler = l(
              this._filterSelect,
              "change",
              n.hitch(this, "doSearch")
            ));
          var e = {},
            i = this.portal.user;
          i.username && (e.q = "owner: " + i.username),
            "webmap" === this.galleryType &&
              (e.q += ' type:"Web Map" -type:"Web Mapping Application"'),
            (this._grid = new h(
              {
                portal: this.portal,
                query: e,
                pagingLinks: !0,
                galleryType: this.galleryType,
                view: "gallery",
              },
              "gallery"
            )),
            this._grid.refresh(),
            l(
              this._grid,
              "onItemClick",
              n.hitch(this, function (t) {
                var e = t.row;
                t.row.data && t.row.data.id && (this.selected = e.data);
              })
            ),
            $(
              "#dijit_form_Button_2_label, .dijitSelectLabel, .dijitButtonText, .dijitButtonContents, .dijitArrowButtonInner, .dijitArrowButtonContainer, .dijitMenuItem, .dijitMenuItemLabel"
            ).addClass("needsclick");
        },
        destroy: function () {
          this._filterSelectHandler.remove(), this.inherited(arguments);
        },
        doSearch: function () {
          var t = this._filterSelect.get("value"),
            e = this.portal.user,
            i = null,
            a = [];
          if (
            this.searchText.getValue() &&
            this.searchText.getValue().match(/^[A-Fa-f0-9]{32}$/)
          )
            a.id = this.searchText.getValue();
          else if (
            (this.searchText.getValue() && (i = this.searchText.getValue()),
            "org" === t && (a.orgid = e.orgId),
            "content" === t && (a.owner = e.username),
            "favorites" === t && (a.group = e.favGroupId),
            "online" === t && "group" === this.galleryType)
          ) {
            var o = this.searchText.getValue();
            "" === o && (a.access = "public");
          }
          "webmap" === this.galleryType &&
            (a.type = '"Web Map" -type:"Web Mapping Application"');
          var r = "";
          for (var s in a) {
            r += s + ":" + a[s] + " ";
          }
          var l = {};
          i && (r = i + " " + r),
            (l.q = n.trim(r)),
            console.log(l.q),
            this._grid.set("query", l),
            this._grid.refresh();
        },
        _onSearchClear: function (t) {
          a.stop(t),
            null != t && t.prefentDefault && t.preventDefault(),
            this.searchText.setValue(""),
            o.add("clear-box_submit", "hide"),
            this.doSearch();
        },
        _onSearchBoxFocus: function (t) {},
        _onSearchBoxBlur: function (t) {
          this.searchText.getValue();
        },
        _onSearchKeyPress: function (t) {
          t.keyCode == r.ENTER && (a.stop(t), this.doSearch()),
            8 == t.keyCode && 1 == this.searchText.getValue().length
              ? o.add("clear-box_submit", "hide")
              : o.remove("clear-box_submit", "hide"),
            this.onSearchFieldKeyPress(t);
        },
        onSearchFieldKeyPress: function (t) {},
        onClose: function () {
          s.byId("browse-id-dialog").hide();
        },
        onCancel: function () {
          this.set("selected", null), s.byId("browse-id-dialog").hide();
        },
        show: function (t) {
          s.byId("browse-id-dialog").show(), this._grid.refresh();
        },
      });
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/browse-dialog/css/browse-dialog",
    [],
    function () {}
  ),
  define(
    "lib-build/css!storymaps/common/builder/browse-dialog/storymaps-override",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/settings/ViewGeneralOptions",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="settings-generaloptions">\r\n\r\n\t<div class="generalSettingsButtons">\r\n\t\t<div class="checkbox opt-container">\r\n\t\t\t<label>\r\n\t\t\t\t<input type="checkbox" class="opt-checkbox-numbered-icons" />\r\n\t\t\t\t' +
            (null == (__t = numberedPlaces) ? "" : __t) +
            '\r\n\t\t\t</label>\r\n\t\t</div>\r\n\t\t<div class="checkbox opt-container">\r\n\t\t\t<label>\r\n\t\t\t\t<input type="checkbox" class="opt-checkbox-filter-by-extent" />\r\n\t\t\t\t' +
            (null == (__t = extentSensitive) ? "" : __t) +
            '\r\n\t\t\t\t<span class="extentSensitiveTooltip" data-placement="top" data-title="' +
            (null == (__t = extentSensitiveTooltip) ? "" : __t) +
            '" >\r\n\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n\t\t\t\t</span>\r\n\t\t\t</label>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/settings/ViewGeneralOptions",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/settings/ViewGeneralOptions",
    [
      "lib-build/tpl!./ViewGeneralOptions",
      "lib-build/css!./ViewGeneralOptions",
    ],
    function (t) {
      return function () {
        var e = null,
          i = null,
          n = null;
        (this.init = function (n, a) {
          (e = n),
            (i = a),
            i.append(
              t({
                numberedPlaces: i18n.builder.settings.numberedPlaces,
                extentSensitive: i18n.builder.settings.extentSensitive,
                extentSensitiveTooltip:
                  i18n.builder.settings.extentSensitiveTooltip,
              })
            ),
            i.find(".extentSensitiveTooltip").tooltip({ trigger: "hover" });
        }),
          (this.present = function (t) {
            i
              .find(".opt-checkbox-numbered-icons")
              .prop("checked", t.numberedIcons),
              i
                .find(".opt-checkbox-filter-by-extent")
                .prop("checked", t.filterByExtent),
              (n = t);
          }),
          (this.show = function () {}),
          (this.save = function () {
            return {
              numberedIcons: i
                .find(".opt-checkbox-numbered-icons")
                .prop("checked"),
              filterByExtent: i
                .find(".opt-checkbox-filter-by-extent")
                .prop("checked"),
            };
          }),
          (this.initLocalization = function () {
            e.html(i18n.builder.settings.generalOptions);
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/settings/ViewMapOptions",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="settings-mapoptions">\r\n\t<table class="tab-cfg">\r\n\t\t<tr class="tab-cfg-row tab-cfg-extent-mode">\r\n\t\t\t<td class="tab-cfg-title" style="outline: none;">\r\n\t\t\t\t<div class="homeLocation">' +
            (null == (__t = defaultMapLocation) ? "" : __t) +
            '</div>\r\n\t\t\t</td>\r\n\t\t\t<td class="tab-cfg-extent-btns">\r\n\t\t\t\t<div class="regular-control" style="display: block;">\r\n\t\t\t\t\t<span class="btn-group">\r\n\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs btn-primary defaultExtent" data-value="default" data-placement="top" data-title="' +
            (null == (__t = autoTooltip) ? "" : __t) +
            '">\r\n\t\t\t\t\t\t\t' +
            (null == (__t = auto) ? "" : __t) +
            '\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs customHomeExtent" data-value="customHome" data-placement="top" data-title="' +
            (null == (__t = customTooltip) ? "" : __t) +
            '">\r\n\t\t\t\t\t\t\t' +
            (null == (__t = custom) ? "" : __t) +
            '&nbsp;\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</td>\r\n\t\t\t<td>\r\n\t\t\t\t<span class="extentModeTooltip" data-placement="right" data-title="' +
            (null == (__t = mapLocationTooltip) ? "" : __t) +
            '" >\r\n\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n\t\t\t\t</span>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<div class="checkbox">\r\n\t\t<label>\r\n\t\t\t<input type="checkbox" class="opt-checkbox-locateBtn" />\r\n\t\t\t' +
            (null == (__t = locateButton) ? "" : __t) +
            '\r\n\t\t\t<span class="locateButtonTooltip" data-placement="right" data-title="' +
            (null == (__t = locateButtonTooltip) ? "" : __t) +
            '" >\r\n\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n\t\t\t</span>\r\n\t\t</label>\r\n\t</div>\r\n\t<div class="checkbox">\r\n\t\t<label>\r\n\t\t\t<input type="checkbox" class="opt-checkbox-place-finder" />\r\n\t\t\t' +
            (null == (__t = geocoder) ? "" : __t) +
            '\r\n\t\t\t<span class="searchWidgetTooltip" data-placement="right" data-title="' +
            (null == (__t = geocoderTooltip) ? "" : __t) +
            '" >\r\n\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n\t\t\t</span>\r\n\t\t</label>\r\n\t</div>\r\n\t<div class="bookmarksContainer">\r\n\t\t<div class="checkbox opt-container" >\r\n\t\t\t<label>\r\n\t\t\t\t<input type="checkbox" class="opt-checkbox-bookmarks" />\r\n\t\t\t\t' +
            (null == (__t = bookmarks) ? "" : __t) +
            '\r\n\t\t\t\t<span class="bookmarkTooltip" data-placement="right" data-title="' +
            (null == (__t = bookmarksHelp) ? "" : __t) +
            '" >\r\n\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n\t\t\t\t</span>\r\n\t\t\t</label>\r\n\t\t\t<div class="opt-bookmarks-alias-cont">\r\n\t\t\t\t<label>\r\n\t\t\t\t\t' +
            (null == (__t = bookmarksMenuName) ? "" : __t) +
            '\r\n\t\t\t\t\t<input type="text" class="opt-bookmarks-alias" />\r\n\t\t\t\t</label>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/settings/ViewMapOptions",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/settings/ViewMapOptions",
    ["lib-build/tpl!./ViewMapOptions", "lib-build/css!./ViewMapOptions"],
    function (t) {
      return function () {
        var e = null,
          i = null,
          n = null;
        (this.init = function (n, o) {
          (e = n),
            (i = o),
            i.append(
              t({
                defaultMapLocation: i18n.builder.settings.defaultMapLocation,
                auto: i18n.builder.settings.auto,
                autoTooltip: i18n.builder.settings.autoTooltip,
                custom: i18n.builder.settings.custom,
                customTooltip: i18n.builder.settings.customTooltip,
                mapLocationTooltip: i18n.builder.settings.mapLocationTooltip,
                locateButton: i18n.builder.settings.locateButton,
                locateButtonTooltip: i18n.builder.settings.locateButtonTooltip,
                geocoder: i18n.builder.settings.geocoder,
                geocoderTooltip: i18n.commonWebmap.selector.tooltipGeocoder,
                bookmarks: i18n.builder.settings.bookmarks,
                bookmarksMenuName: i18n.builder.settings.bookmarksMenuName,
                bookmarksHelp: i18n.builder.settings.bookmarksHelp,
              })
            ),
            i.find(".extentModeTooltip").tooltip({ trigger: "hover" }),
            i.find(".defaultExtent").tooltip({ trigger: "hover" }),
            i.find(".customHomeExtent").tooltip({ trigger: "hover" }),
            i.find(".locateButtonTooltip").tooltip({ trigger: "hover" }),
            i.find(".searchWidgetTooltip").tooltip({ trigger: "hover" }),
            i.find(".bookmarkTooltip").tooltip({ trigger: "hover" }),
            i.find(".help").tooltip({ trigger: "hover" }),
            a();
        }),
          (this.present = function (t) {
            "default" == t.extentMode &&
              ($('.tab-cfg-extent-mode .btn[data-value="default"]').addClass(
                "btn-primary"
              ),
              $(
                '.tab-cfg-extent-mode .btn[data-value="customHome"]'
              ).removeClass("btn-primary"),
              $(
                '.tab-cfg-extent-mode .btn[data-value="customTheme"]'
              ).removeClass("btn-primary")),
              "customHome" == t.extentMode &&
                ($(
                  '.tab-cfg-extent-mode .btn[data-value="customHome"]'
                ).addClass("btn-primary"),
                $(
                  '.tab-cfg-extent-mode .btn[data-value="default"]'
                ).removeClass("btn-primary"),
                $(
                  '.tab-cfg-extent-mode .btn[data-value="customTheme"]'
                ).removeClass("btn-primary"));
            var e = app.data.getResponse()
              ? app.data.getResponse().itemInfo.itemData.bookmarks
              : app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo
                  .itemData.bookmarks;
            e && e.length
              ? i.find(".bookmarkTooltip").tooltip({ trigger: "hover" })
              : (i.find(".opt-checkbox-bookmarks").addClass("disabled"),
                i.find(".opt-checkbox-bookmarks").prop("disabled", !0),
                i.find(".opt-checkbox-bookmarks").click(!1),
                i.find(".opt-bookmarks-alias-cont input").prop("disabled", !0),
                i.find(".bookmarkTooltip").tooltip({ trigger: "hover" })),
              i.find(".opt-checkbox-bookmarks").prop("checked", t.bookmarks),
              i.find(".opt-bookmarks-alias").val(t.bookmarksAlias),
              i.find(".opt-checkbox-locateBtn").prop("checked", t.locateButton),
              i.find(".opt-checkbox-place-finder").prop("checked", t.geocoder),
              (n = t);
          }),
          (this.show = function () {}),
          (this.save = function () {
            return app.data.getWebAppData().getIsExternalData()
              ? {
                  extentMode: "customHome",
                  locateButton: i
                    .find(".opt-checkbox-locateBtn")
                    .prop("checked"),
                  geocoder: i
                    .find(".opt-checkbox-place-finder")
                    .prop("checked"),
                  bookmarks: i.find(".opt-checkbox-bookmarks").prop("checked"),
                  bookmarksAlias: i.find(".opt-bookmarks-alias").val(),
                }
              : {
                  extentMode: i.find(".tab-cfg-extent-mode .btn-primary").data()
                    .value,
                  locateButton: i
                    .find(".opt-checkbox-locateBtn")
                    .prop("checked"),
                  geocoder: i
                    .find(".opt-checkbox-place-finder")
                    .prop("checked"),
                  bookmarks: i.find(".opt-checkbox-bookmarks").prop("checked"),
                  bookmarksAlias: i.find(".opt-bookmarks-alias").val(),
                };
          });
        var a = function () {
          $('.tab-cfg-extent-mode .btn[data-value="default"]').click(
            function () {
              $('.tab-cfg-extent-mode .btn[data-value="default"]').addClass(
                "btn-primary"
              ),
                $(
                  '.tab-cfg-extent-mode .btn[data-value="customHome"]'
                ).removeClass("btn-primary"),
                $(
                  '.tab-cfg-extent-mode .btn[data-value="customTheme"]'
                ).removeClass("btn-primary");
            }
          ),
            $('.tab-cfg-extent-mode .btn[data-value="customHome"]').click(
              function () {
                $(
                  '.tab-cfg-extent-mode .btn[data-value="customHome"]'
                ).addClass("btn-primary"),
                  $(
                    '.tab-cfg-extent-mode .btn[data-value="default"]'
                  ).removeClass("btn-primary"),
                  $(
                    '.tab-cfg-extent-mode .btn[data-value="customTheme"]'
                  ).removeClass("btn-primary");
              }
            );
        };
        this.initLocalization = function () {
          e.html(i18n.builder.settings.mapOptions);
        };
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/settings/ViewThemeOptions",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="settings-themeoptions">\r\n\r\n\t<div class="themeSettingsButtons">\r\n\t\t<table class="tab-cfg">\r\n\t\t\t<tbody>\r\n\t\t\t\t<tr class="tab-cfg-row ">\r\n\t\t\t\t\t<td class="tab-cfg-title" style="outline: none;">\r\n\t\t\t\t\t\t' +
            (null == (__t = headerColor) ? "" : __t) +
            '\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td class="tab-cfg-btns">\r\n\t\t\t\t\t\t<div class="header-color-control">\r\n\t\t\t\t\t\t\t<input type="text" id="headerColorpicker" style="display: none;">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</tbody>\r\n\t\t</table>\r\n\t</div>\r\n</div>\r\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/settings/ViewThemeOptions",
    [],
    function () {}
  ),
  define("lib-build/css!lib-app/spectrum/spectrum", [], function () {}),
  (function (t) {
    "use strict";
    "function" == typeof define && define.amd
      ? define("lib-app/spectrum/spectrum", ["jquery"], t)
      : "object" == typeof exports && "object" == typeof module
      ? (module.exports = t(require("jquery")))
      : t(jQuery);
  })(function (t, e) {
    "use strict";
    function i(e, i, n, a) {
      for (var o = [], r = 0; r < e.length; r++) {
        var s = e[r];
        if (s) {
          var l = tinycolor(s),
            d =
              l.toHsl().l < 0.5
                ? "sp-thumb-el sp-thumb-dark"
                : "sp-thumb-el sp-thumb-light";
          d += tinycolor.equals(i, s) ? " sp-thumb-active" : "";
          var p = l.toString(a.preferredFormat || "rgb"),
            c = g
              ? "background-color:" + l.toRgbString()
              : "filter:" + l.toFilter();
          o.push(
            '<span title="' +
              p +
              '" data-color="' +
              l.toRgbString() +
              '" class="' +
              d +
              '"><span class="sp-thumb-inner" style="' +
              c +
              ';" /></span>'
          );
        } else {
          o.push(
            t("<div />")
              .append(
                t(
                  '<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>'
                ).attr("title", a.noColorSelectedText)
              )
              .html()
          );
        }
      }
      return "<div class='sp-cf " + n + "'>" + o.join("") + "</div>";
    }
    function n() {
      for (var t = 0; t < f.length; t++) f[t] && f[t].hide();
    }
    function a(e, i) {
      var n = t.extend({}, h, e);
      return (
        (n.callbacks = {
          move: d(n.move, i),
          change: d(n.change, i),
          show: d(n.show, i),
          hide: d(n.hide, i),
          beforeShow: d(n.beforeShow, i),
        }),
        n
      );
    }
    function o(o, s) {
      function d() {
        if (
          (G.showPaletteOnly && (G.showPalette = !0),
          Nt.text(
            G.showPaletteOnly
              ? G.togglePaletteMoreText
              : G.togglePaletteLessText
          ),
          G.palette)
        ) {
          (ut = G.palette.slice(0)),
            (ht = t.isArray(ut[0]) ? ut : [ut]),
            (ft = {});
          for (var e = 0; e < ht.length; e++)
            for (var i = 0; i < ht[e].length; i++) {
              var n = tinycolor(ht[e][i]).toRgbString();
              ft[n] = !0;
            }
        }
        _t.toggleClass("sp-flat", V),
          _t.toggleClass("sp-input-disabled", !G.showInput),
          _t.toggleClass("sp-alpha-enabled", G.showAlpha),
          _t.toggleClass("sp-clear-enabled", Yt),
          _t.toggleClass("sp-buttons-disabled", !G.showButtons),
          _t.toggleClass("sp-palette-buttons-disabled", !G.togglePaletteOnly),
          _t.toggleClass("sp-palette-disabled", !G.showPalette),
          _t.toggleClass("sp-palette-only", G.showPaletteOnly),
          _t.toggleClass("sp-initial-disabled", !G.showInitial),
          _t.addClass(G.className).addClass(G.containerClassName),
          F();
      }
      function h() {
        if (K && window.localStorage) {
          try {
            var e = window.localStorage[K].split(",#");
            e.length > 1 &&
              (delete window.localStorage[K],
              t.each(e, function (t, e) {
                y(e);
              }));
          } catch (t) {}
          try {
            mt = window.localStorage[K].split(";");
          } catch (t) {}
        }
      }
      function y(e) {
        if (q) {
          var i = tinycolor(e).toRgbString();
          if (!ft[i] && -1 === t.inArray(i, mt))
            for (mt.push(i); mt.length > gt; ) mt.shift();
          if (K && window.localStorage)
            try {
              window.localStorage[K] = mt.join(";");
            } catch (t) {}
        }
      }
      function w() {
        var t = [];
        if (G.showPalette)
          for (var e = 0; e < mt.length; e++) {
            var i = tinycolor(mt[e]).toRgbString();
            ft[i] || t.push(mt[e]);
          }
        return t.reverse().slice(0, G.maxSelectionSize);
      }
      function C() {
        var e = $(),
          n = t.map(ht, function (t, n) {
            return i(t, e, "sp-palette-row sp-palette-row-" + n, G);
          });
        h(),
          mt && n.push(i(w(), e, "sp-palette-row sp-palette-row-selection", G)),
          Dt.html(n.join(""));
      }
      function _() {
        if (G.showInitial) {
          var t = Gt,
            e = $();
          $t.html(i([t, e], e, "sp-palette-row-initial", G));
        }
      }
      function x() {
        (et <= 0 || tt <= 0 || nt <= 0) && F(),
          (Z = !0),
          _t.addClass(bt),
          (vt = null),
          wt.trigger("dragstart.spectrum", [$()]);
      }
      function S() {
        (Z = !1), _t.removeClass(bt), wt.trigger("dragstop.spectrum", [$()]);
      }
      function T() {
        var t = Pt.val();
        if ((null !== t && "" !== t) || !Yt) {
          var e = tinycolor(t);
          e.isValid() ? (D(e), B(!0)) : Pt.addClass("sp-validation-error");
        } else D(null), B(!0);
      }
      function k() {
        J ? L() : E();
      }
      function E() {
        var e = t.Event("beforeShow.spectrum");
        if (J) return void F();
        wt.trigger(e, [$()]),
          !1 === Q.beforeShow($()) ||
            e.isDefaultPrevented() ||
            (n(),
            (J = !0),
            t(yt).bind("keydown.spectrum", A),
            t(yt).bind("click.spectrum", I),
            t(window).bind("resize.spectrum", X),
            jt.addClass("sp-active"),
            _t.removeClass("sp-hidden"),
            F(),
            R(),
            (Gt = $()),
            _(),
            Q.show(Gt),
            wt.trigger("show.spectrum", [Gt]));
      }
      function A(t) {
        27 === t.keyCode && L();
      }
      function I(t) {
        2 != t.button && (Z || (qt ? B(!0) : P(), L()));
      }
      function L() {
        J &&
          !V &&
          ((J = !1),
          t(yt).unbind("keydown.spectrum", A),
          t(yt).unbind("click.spectrum", I),
          t(window).unbind("resize.spectrum", X),
          jt.removeClass("sp-active"),
          _t.addClass("sp-hidden"),
          Q.hide($()),
          wt.trigger("hide.spectrum", [$()]));
      }
      function P() {
        D(Gt, !0);
      }
      function D(t, e) {
        if (tinycolor.equals(t, $())) return void R();
        var i, n;
        !t && Yt
          ? (Kt = !0)
          : ((Kt = !1),
            (i = tinycolor(t)),
            (n = i.toHsv()),
            (lt = (n.h % 360) / 360),
            (dt = n.s),
            (pt = n.v),
            (ct = n.a)),
          R(),
          i && i.isValid() && !e && (Vt = G.preferredFormat || i.getFormat());
      }
      function $(t) {
        return (
          (t = t || {}),
          Yt && Kt
            ? null
            : tinycolor.fromRatio(
                { h: lt, s: dt, v: pt, a: Math.round(100 * ct) / 100 },
                { format: t.format || Vt }
              )
        );
      }
      function M() {
        return !Pt.hasClass("sp-validation-error");
      }
      function O() {
        R(), Q.move($()), wt.trigger("move.spectrum", [$()]);
      }
      function R() {
        Pt.removeClass("sp-validation-error"), N();
        var t = tinycolor.fromRatio({ h: lt, s: 1, v: 1 });
        St.css("background-color", t.toHexString());
        var e = Vt;
        ct < 1 &&
          (0 !== ct || "name" !== e) &&
          (("hex" !== e && "hex3" !== e && "hex6" !== e && "name" !== e) ||
            (e = "rgb"));
        var i = $({ format: e }),
          n = "";
        if (
          (zt.removeClass("sp-clear-display"),
          zt.css("background-color", "transparent"),
          !i && Yt)
        )
          zt.addClass("sp-clear-display");
        else {
          var a = i.toHexString(),
            o = i.toRgbString();
          if (
            (g || 1 === i.alpha
              ? zt.css("background-color", o)
              : (zt.css("background-color", "transparent"),
                zt.css("filter", i.toFilter())),
            G.showAlpha)
          ) {
            var r = i.toRgb();
            r.a = 0;
            var s = tinycolor(r).toRgbString(),
              l = "linear-gradient(left, " + s + ", " + a + ")";
            m
              ? At.css("filter", tinycolor(s).toFilter({ gradientType: 1 }, a))
              : (At.css("background", "-webkit-" + l),
                At.css("background", "-moz-" + l),
                At.css("background", "-ms-" + l),
                At.css(
                  "background",
                  "linear-gradient(to right, " + s + ", " + a + ")"
                ));
          }
          n = i.toString(e);
        }
        G.showInput && Pt.val(n), G.showPalette && C(), _();
      }
      function N() {
        var t = dt,
          e = pt;
        if (Yt && Kt) Lt.hide(), Et.hide(), Tt.hide();
        else {
          Lt.show(), Et.show(), Tt.show();
          var i = t * tt,
            n = et - e * et;
          (i = Math.max(-it, Math.min(tt - it, i - it))),
            (n = Math.max(-it, Math.min(et - it, n - it))),
            Tt.css({ top: n + "px", left: i + "px" });
          var a = ct * ot;
          Lt.css({ left: a - rt / 2 + "px" });
          var o = lt * nt;
          Et.css({ top: o - st + "px" });
        }
      }
      function B(t) {
        var e = $(),
          i = "",
          n = !tinycolor.equals(e, Gt);
        e && ((i = e.toString(Vt)), y(e)),
          Bt && wt.val(i),
          t && n && (Q.change(e), wt.trigger("change", [e]));
      }
      function F() {
        J &&
          ((tt = St.width()),
          (et = St.height()),
          (it = Tt.height()),
          (at = kt.width()),
          (nt = kt.height()),
          (st = Et.height()),
          (ot = It.width()),
          (rt = Lt.width()),
          V ||
            (_t.css("position", "absolute"),
            G.offset ? _t.offset(G.offset) : _t.offset(r(_t, Ht))),
          N(),
          G.showPalette && C(),
          wt.trigger("reflow.spectrum"));
      }
      function W() {
        wt.show(),
          Ht.unbind("click.spectrum touchstart.spectrum"),
          _t.remove(),
          jt.remove(),
          (f[Qt.id] = null);
      }
      function j(i, n) {
        return i === e
          ? t.extend({}, G)
          : n === e
          ? G[i]
          : ((G[i] = n),
            "preferredFormat" === i && (Vt = G.preferredFormat),
            void d());
      }
      function H() {
        (Ct = !1), wt.attr("disabled", !1), Ht.removeClass("sp-disabled");
      }
      function z() {
        L(), (Ct = !0), wt.attr("disabled", !0), Ht.addClass("sp-disabled");
      }
      function U(t) {
        (G.offset = t), F();
      }
      var G = a(s, o),
        V = G.flat,
        q = G.showSelectionPalette,
        K = G.localStorageKey,
        Y = G.theme,
        Q = G.callbacks,
        X = c(F, 10),
        J = !1,
        Z = !1,
        tt = 0,
        et = 0,
        it = 0,
        nt = 0,
        at = 0,
        ot = 0,
        rt = 0,
        st = 0,
        lt = 0,
        dt = 0,
        pt = 0,
        ct = 1,
        ut = [],
        ht = [],
        ft = {},
        mt = G.selectionPalette.slice(0),
        gt = G.maxSelectionSize,
        bt = "sp-dragging",
        vt = null,
        yt = o.ownerDocument,
        wt = (yt.body, t(o)),
        Ct = !1,
        _t = t(v, yt).addClass(Y),
        xt = _t.find(".sp-picker-container"),
        St = _t.find(".sp-color"),
        Tt = _t.find(".sp-dragger"),
        kt = _t.find(".sp-hue"),
        Et = _t.find(".sp-slider"),
        At = _t.find(".sp-alpha-inner"),
        It = _t.find(".sp-alpha"),
        Lt = _t.find(".sp-alpha-handle"),
        Pt = _t.find(".sp-input"),
        Dt = _t.find(".sp-palette"),
        $t = _t.find(".sp-initial"),
        Mt = _t.find(".sp-cancel"),
        Ot = _t.find(".sp-clear"),
        Rt = _t.find(".sp-choose"),
        Nt = _t.find(".sp-palette-toggle"),
        Bt = wt.is("input"),
        Ft = Bt && "color" === wt.attr("type") && u(),
        Wt = Bt && !V,
        jt = Wt
          ? t(b).addClass(Y).addClass(G.className).addClass(G.replacerClassName)
          : t([]),
        Ht = Wt ? jt : wt,
        zt = jt.find(".sp-preview-inner"),
        Ut = G.color || (Bt && wt.val()),
        Gt = !1,
        Vt = G.preferredFormat,
        qt = !G.showButtons || G.clickoutFiresChange,
        Kt = !Ut,
        Yt = G.allowEmpty && !Ft;
      !(function () {
        function e(e) {
          return (
            e.data && e.data.ignore
              ? (D(t(e.target).closest(".sp-thumb-el").data("color")), O())
              : (D(t(e.target).closest(".sp-thumb-el").data("color")),
                O(),
                B(!0),
                G.hideAfterPaletteSelect && L()),
            !1
          );
        }
        if (
          (m && _t.find("*:not(input)").attr("unselectable", "on"),
          d(),
          Wt && wt.after(jt).hide(),
          Yt || Ot.hide(),
          V)
        )
          wt.after(_t).hide();
        else {
          var i = "parent" === G.appendTo ? wt.parent() : t(G.appendTo);
          1 !== i.length && (i = t("body")), i.append(_t);
        }
        h(),
          Ht.bind("click.spectrum touchstart.spectrum", function (e) {
            Ct || k(),
              e.stopPropagation(),
              t(e.target).is("input") || e.preventDefault();
          }),
          (wt.is(":disabled") || !0 === G.disabled) && z(),
          _t.click(l),
          Pt.change(T),
          Pt.bind("paste", function () {
            setTimeout(T, 1);
          }),
          Pt.keydown(function (t) {
            13 == t.keyCode && T();
          }),
          Mt.text(G.cancelText),
          Mt.bind("click.spectrum", function (t) {
            t.stopPropagation(), t.preventDefault(), P(), L();
          }),
          Ot.attr("title", G.clearText),
          Ot.bind("click.spectrum", function (t) {
            t.stopPropagation(), t.preventDefault(), (Kt = !0), O(), V && B(!0);
          }),
          Rt.text(G.chooseText),
          Rt.bind("click.spectrum", function (t) {
            t.stopPropagation(),
              t.preventDefault(),
              m && Pt.is(":focus") && Pt.trigger("change"),
              M() && (B(!0), L());
          }),
          Nt.text(
            G.showPaletteOnly
              ? G.togglePaletteMoreText
              : G.togglePaletteLessText
          ),
          Nt.bind("click.spectrum", function (t) {
            t.stopPropagation(),
              t.preventDefault(),
              (G.showPaletteOnly = !G.showPaletteOnly),
              G.showPaletteOnly ||
                V ||
                _t.css("left", "-=" + (xt.outerWidth(!0) + 5)),
              d();
          }),
          p(
            It,
            function (t, e, i) {
              (ct = t / ot),
                (Kt = !1),
                i.shiftKey && (ct = Math.round(10 * ct) / 10),
                O();
            },
            x,
            S
          ),
          p(
            kt,
            function (t, e) {
              (lt = parseFloat(e / nt)),
                (Kt = !1),
                G.showAlpha || (ct = 1),
                O();
            },
            x,
            S
          ),
          p(
            St,
            function (t, e, i) {
              if (i.shiftKey) {
                if (!vt) {
                  var n = dt * tt,
                    a = et - pt * et,
                    o = Math.abs(t - n) > Math.abs(e - a);
                  vt = o ? "x" : "y";
                }
              } else vt = null;
              var r = !vt || "x" === vt,
                s = !vt || "y" === vt;
              r && (dt = parseFloat(t / tt)),
                s && (pt = parseFloat((et - e) / et)),
                (Kt = !1),
                G.showAlpha || (ct = 1),
                O();
            },
            x,
            S
          ),
          Ut
            ? (D(Ut),
              R(),
              (Vt = G.preferredFormat || tinycolor(Ut).format),
              y(Ut))
            : R(),
          V && E();
        var n = m ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
        Dt.delegate(".sp-thumb-el", n, e),
          $t.delegate(".sp-thumb-el:nth-child(1)", n, { ignore: !0 }, e);
      })();
      var Qt = {
        show: E,
        hide: L,
        toggle: k,
        reflow: F,
        option: j,
        enable: H,
        disable: z,
        offset: U,
        set: function (t) {
          D(t), B();
        },
        get: $,
        destroy: W,
        container: _t,
      };
      return (Qt.id = f.push(Qt) - 1), Qt;
    }
    function r(e, i) {
      var n = e.outerWidth(),
        a = e.outerHeight(),
        o = i.outerHeight(),
        r = e[0].ownerDocument,
        s = r.documentElement,
        l = s.clientWidth + t(r).scrollLeft(),
        d = s.clientHeight + t(r).scrollTop(),
        p = i.offset();
      return (
        (p.top += o),
        (p.left -= Math.min(
          p.left,
          p.left + n > l && l > n ? Math.abs(p.left + n - l) : 0
        )),
        (p.top -= Math.min(
          p.top,
          p.top + a > d && d > a ? Math.abs(a + o - 0) : 0
        )),
        p
      );
    }
    function s() {}
    function l(t) {
      t.stopPropagation();
    }
    function d(t, e) {
      var i = Array.prototype.slice,
        n = i.call(arguments, 2);
      return function () {
        return t.apply(e, n.concat(i.call(arguments)));
      };
    }
    function p(e, i, n, a) {
      function o(t) {
        t.stopPropagation && t.stopPropagation(),
          t.preventDefault && t.preventDefault(),
          (t.returnValue = !1);
      }
      function r(t) {
        if (p) {
          if (m && d.documentMode < 9 && !t.button) return l();
          var n =
              t.originalEvent &&
              t.originalEvent.touches &&
              t.originalEvent.touches[0],
            a = (n && n.pageX) || t.pageX,
            r = (n && n.pageY) || t.pageY,
            s = Math.max(0, Math.min(a - c.left, h)),
            g = Math.max(0, Math.min(r - c.top, u));
          f && o(t), i.apply(e, [s, g, t]);
        }
      }
      function s(i) {
        (i.which ? 3 == i.which : 2 == i.button) ||
          p ||
          (!1 !== n.apply(e, arguments) &&
            ((p = !0),
            (u = t(e).height()),
            (h = t(e).width()),
            (c = t(e).offset()),
            t(d).bind(g),
            t(d.body).addClass("sp-dragging"),
            r(i),
            o(i)));
      }
      function l() {
        p &&
          (t(d).unbind(g),
          t(d.body).removeClass("sp-dragging"),
          setTimeout(function () {
            a.apply(e, arguments);
          }, 0)),
          (p = !1);
      }
      (i = i || function () {}),
        (n = n || function () {}),
        (a = a || function () {});
      var d = document,
        p = !1,
        c = {},
        u = 0,
        h = 0,
        f = "ontouchstart" in window,
        g = {};
      (g.selectstart = o),
        (g.dragstart = o),
        (g["touchmove mousemove"] = r),
        (g["touchend mouseup"] = l),
        t(e).bind("touchstart mousedown", s);
    }
    function c(t, e, i) {
      var n;
      return function () {
        var a = this,
          o = arguments,
          r = function () {
            (n = null), t.apply(a, o);
          };
        i && clearTimeout(n), (!i && n) || (n = setTimeout(r, e));
      };
    }
    function u() {
      return t.fn.spectrum.inputTypeColorSupport();
    }
    var h = {
        beforeShow: s,
        move: s,
        change: s,
        show: s,
        hide: s,
        color: !1,
        flat: !1,
        showInput: !1,
        allowEmpty: !1,
        showButtons: !0,
        clickoutFiresChange: !0,
        showInitial: !1,
        showPalette: !1,
        showPaletteOnly: !1,
        hideAfterPaletteSelect: !1,
        togglePaletteOnly: !1,
        showSelectionPalette: !0,
        localStorageKey: !1,
        appendTo: "body",
        maxSelectionSize: 7,
        cancelText: "cancel",
        chooseText: "choose",
        togglePaletteMoreText: "more",
        togglePaletteLessText: "less",
        clearText: "Clear Color Selection",
        noColorSelectedText: "No Color Selected",
        preferredFormat: !1,
        className: "",
        containerClassName: "",
        replacerClassName: "",
        showAlpha: !1,
        theme: "sp-light",
        palette: [
          [
            "#ffffff",
            "#000000",
            "#ff0000",
            "#ff8000",
            "#ffff00",
            "#008000",
            "#0000ff",
            "#4b0082",
            "#9400d3",
          ],
        ],
        selectionPalette: [],
        disabled: !1,
        offset: null,
      },
      f = [],
      m = !!/msie/i.exec(window.navigator.userAgent),
      g = (function () {
        function t(t, e) {
          return !!~("" + t).indexOf(e);
        }
        var e = document.createElement("div"),
          i = e.style;
        return (
          (i.cssText = "background-color:rgba(0,0,0,.5)"),
          t(i.backgroundColor, "rgba") || t(i.backgroundColor, "hsla")
        );
      })(),
      b = [
        "<div class='sp-replacer'>",
        "<div class='sp-preview'><div class='sp-preview-inner'></div></div>",
        "<div class='sp-dd'>&#9660;</div>",
        "</div>",
      ].join(""),
      v = (function () {
        var t = "";
        if (m)
          for (var e = 1; e <= 6; e++) t += "<div class='sp-" + e + "'></div>";
        return [
          "<div class='sp-container sp-hidden'>",
          "<div class='sp-palette-container'>",
          "<div class='sp-palette sp-thumb sp-cf'></div>",
          "<div class='sp-palette-button-container sp-cf'>",
          "<button type='button' class='sp-palette-toggle'></button>",
          "</div>",
          "</div>",
          "<div class='sp-picker-container'>",
          "<div class='sp-top sp-cf'>",
          "<div class='sp-fill'></div>",
          "<div class='sp-top-inner'>",
          "<div class='sp-color'>",
          "<div class='sp-sat'>",
          "<div class='sp-val'>",
          "<div class='sp-dragger'></div>",
          "</div>",
          "</div>",
          "</div>",
          "<div class='sp-clear sp-clear-display'>",
          "</div>",
          "<div class='sp-hue'>",
          "<div class='sp-slider'></div>",
          t,
          "</div>",
          "</div>",
          "<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>",
          "</div>",
          "<div class='sp-input-container sp-cf'>",
          "<input class='sp-input' type='text' spellcheck='false'  />",
          "</div>",
          "<div class='sp-initial sp-thumb sp-cf'></div>",
          "<div class='sp-button-container sp-cf'>",
          "<a class='sp-cancel' href='#'></a>",
          "<button type='button' class='sp-choose'></button>",
          "</div>",
          "</div>",
          "</div>",
        ].join("");
      })();
    (t.fn.spectrum = function (e, i) {
      if ("string" == typeof e) {
        var n = this,
          a = Array.prototype.slice.call(arguments, 1);
        return (
          this.each(function () {
            var i = f[t(this).data("spectrum.id")];
            if (i) {
              var o = i[e];
              if (!o) throw new Error("Spectrum: no such method: '" + e + "'");
              "get" == e
                ? (n = i.get())
                : "container" == e
                ? (n = i.container)
                : "option" == e
                ? (n = i.option.apply(i, a))
                : "destroy" == e
                ? (i.destroy(), t(this).removeData("spectrum.id"))
                : o.apply(i, a);
            }
          }),
          n
        );
      }
      return this.spectrum("destroy").each(function () {
        var i = t.extend({}, e, t(this).data()),
          n = o(this, i);
        t(this).data("spectrum.id", n.id);
      });
    }),
      (t.fn.spectrum.load = !0),
      (t.fn.spectrum.loadOpts = {}),
      (t.fn.spectrum.draggable = p),
      (t.fn.spectrum.defaults = h),
      (t.fn.spectrum.inputTypeColorSupport = function e() {
        if (void 0 === e._cachedResult) {
          var i = t("<input type='color'/>")[0];
          e._cachedResult = "color" === i.type && "" !== i.value;
        }
        return e._cachedResult;
      }),
      (t.spectrum = {}),
      (t.spectrum.localization = {}),
      (t.spectrum.palettes = {}),
      (t.fn.spectrum.processNativeColorInputs = function () {
        var e = t("input[type=color]");
        e.length && !u() && e.spectrum({ preferredFormat: "hex6" });
      }),
      (function () {
        function t(t) {
          var i = { r: 0, g: 0, b: 0 },
            a = 1,
            r = !1,
            s = !1;
          return (
            "string" == typeof t && (t = P(t)),
            "object" == typeof t &&
              (t.hasOwnProperty("r") &&
              t.hasOwnProperty("g") &&
              t.hasOwnProperty("b")
                ? ((i = e(t.r, t.g, t.b)),
                  (r = !0),
                  (s = "%" === String(t.r).substr(-1) ? "prgb" : "rgb"))
                : t.hasOwnProperty("h") &&
                  t.hasOwnProperty("s") &&
                  t.hasOwnProperty("v")
                ? ((t.s = A(t.s)),
                  (t.v = A(t.v)),
                  (i = o(t.h, t.s, t.v)),
                  (r = !0),
                  (s = "hsv"))
                : t.hasOwnProperty("h") &&
                  t.hasOwnProperty("s") &&
                  t.hasOwnProperty("l") &&
                  ((t.s = A(t.s)),
                  (t.l = A(t.l)),
                  (i = n(t.h, t.s, t.l)),
                  (r = !0),
                  (s = "hsl")),
              t.hasOwnProperty("a") && (a = t.a)),
            (a = C(a)),
            {
              ok: r,
              format: t.format || s,
              r: N(255, B(i.r, 0)),
              g: N(255, B(i.g, 0)),
              b: N(255, B(i.b, 0)),
              a: a,
            }
          );
        }
        function e(t, e, i) {
          return { r: 255 * _(t, 255), g: 255 * _(e, 255), b: 255 * _(i, 255) };
        }
        function i(t, e, i) {
          (t = _(t, 255)), (e = _(e, 255)), (i = _(i, 255));
          var n,
            a,
            o = B(t, e, i),
            r = N(t, e, i),
            s = (o + r) / 2;
          if (o == r) n = a = 0;
          else {
            var l = o - r;
            switch (((a = s > 0.5 ? l / (2 - o - r) : l / (o + r)), o)) {
              case t:
                n = (e - i) / l + (e < i ? 6 : 0);
                break;
              case e:
                n = (i - t) / l + 2;
                break;
              case i:
                n = (t - e) / l + 4;
            }
            n /= 6;
          }
          return { h: n, s: a, l: s };
        }
        function n(t, e, i) {
          function n(t, e, i) {
            return (
              i < 0 && (i += 1),
              i > 1 && (i -= 1),
              i < 1 / 6
                ? t + 6 * (e - t) * i
                : i < 0.5
                ? e
                : i < 2 / 3
                ? t + (e - t) * (2 / 3 - i) * 6
                : t
            );
          }
          var a, o, r;
          if (((t = _(t, 360)), (e = _(e, 100)), (i = _(i, 100)), 0 === e))
            a = o = r = i;
          else {
            var s = i < 0.5 ? i * (1 + e) : i + e - i * e,
              l = 2 * i - s;
            (a = n(l, s, t + 1 / 3)),
              (o = n(l, s, t)),
              (r = n(l, s, t - 1 / 3));
          }
          return { r: 255 * a, g: 255 * o, b: 255 * r };
        }
        function a(t, e, i) {
          (t = _(t, 255)), (e = _(e, 255)), (i = _(i, 255));
          var n,
            a,
            o = B(t, e, i),
            r = N(t, e, i),
            s = o,
            l = o - r;
          if (((a = 0 === o ? 0 : l / o), o == r)) n = 0;
          else {
            switch (o) {
              case t:
                n = (e - i) / l + (e < i ? 6 : 0);
                break;
              case e:
                n = (i - t) / l + 2;
                break;
              case i:
                n = (t - e) / l + 4;
            }
            n /= 6;
          }
          return { h: n, s: a, v: s };
        }
        function o(t, e, i) {
          (t = 6 * _(t, 360)), (e = _(e, 100)), (i = _(i, 100));
          var n = O.floor(t),
            a = t - n,
            o = i * (1 - e),
            r = i * (1 - a * e),
            s = i * (1 - (1 - a) * e),
            l = n % 6;
          return {
            r: 255 * [i, r, o, o, s, i][l],
            g: 255 * [s, i, i, r, o, o][l],
            b: 255 * [o, o, s, i, i, r][l],
          };
        }
        function r(t, e, i, n) {
          var a = [
            E(R(t).toString(16)),
            E(R(e).toString(16)),
            E(R(i).toString(16)),
          ];
          return n &&
            a[0].charAt(0) == a[0].charAt(1) &&
            a[1].charAt(0) == a[1].charAt(1) &&
            a[2].charAt(0) == a[2].charAt(1)
            ? a[0].charAt(0) + a[1].charAt(0) + a[2].charAt(0)
            : a.join("");
        }
        function s(t, e, i, n) {
          return [
            E(I(n)),
            E(R(t).toString(16)),
            E(R(e).toString(16)),
            E(R(i).toString(16)),
          ].join("");
        }
        function l(t, e) {
          e = 0 === e ? 0 : e || 10;
          var i = W(t).toHsl();
          return (i.s -= e / 100), (i.s = x(i.s)), W(i);
        }
        function d(t, e) {
          e = 0 === e ? 0 : e || 10;
          var i = W(t).toHsl();
          return (i.s += e / 100), (i.s = x(i.s)), W(i);
        }
        function p(t) {
          return W(t).desaturate(100);
        }
        function c(t, e) {
          e = 0 === e ? 0 : e || 10;
          var i = W(t).toHsl();
          return (i.l += e / 100), (i.l = x(i.l)), W(i);
        }
        function u(t, e) {
          e = 0 === e ? 0 : e || 10;
          var i = W(t).toRgb();
          return (
            (i.r = B(0, N(255, i.r - R((-e / 100) * 255)))),
            (i.g = B(0, N(255, i.g - R((-e / 100) * 255)))),
            (i.b = B(0, N(255, i.b - R((-e / 100) * 255)))),
            W(i)
          );
        }
        function h(t, e) {
          e = 0 === e ? 0 : e || 10;
          var i = W(t).toHsl();
          return (i.l -= e / 100), (i.l = x(i.l)), W(i);
        }
        function f(t, e) {
          var i = W(t).toHsl(),
            n = (R(i.h) + e) % 360;
          return (i.h = n < 0 ? 360 + n : n), W(i);
        }
        function m(t) {
          var e = W(t).toHsl();
          return (e.h = (e.h + 180) % 360), W(e);
        }
        function g(t) {
          var e = W(t).toHsl(),
            i = e.h;
          return [
            W(t),
            W({ h: (i + 120) % 360, s: e.s, l: e.l }),
            W({ h: (i + 240) % 360, s: e.s, l: e.l }),
          ];
        }
        function b(t) {
          var e = W(t).toHsl(),
            i = e.h;
          return [
            W(t),
            W({ h: (i + 90) % 360, s: e.s, l: e.l }),
            W({ h: (i + 180) % 360, s: e.s, l: e.l }),
            W({ h: (i + 270) % 360, s: e.s, l: e.l }),
          ];
        }
        function v(t) {
          var e = W(t).toHsl(),
            i = e.h;
          return [
            W(t),
            W({ h: (i + 72) % 360, s: e.s, l: e.l }),
            W({ h: (i + 216) % 360, s: e.s, l: e.l }),
          ];
        }
        function y(t, e, i) {
          (e = e || 6), (i = i || 30);
          var n = W(t).toHsl(),
            a = 360 / i,
            o = [W(t)];
          for (n.h = (n.h - ((a * e) >> 1) + 720) % 360; --e; )
            (n.h = (n.h + a) % 360), o.push(W(n));
          return o;
        }
        function w(t, e) {
          e = e || 6;
          for (
            var i = W(t).toHsv(), n = i.h, a = i.s, o = i.v, r = [], s = 1 / e;
            e--;

          )
            r.push(W({ h: n, s: a, v: o })), (o = (o + s) % 1);
          return r;
        }
        function C(t) {
          return (
            (t = parseFloat(t)), (isNaN(t) || t < 0 || t > 1) && (t = 1), t
          );
        }
        function _(t, e) {
          T(t) && (t = "100%");
          var i = k(t);
          return (
            (t = N(e, B(0, parseFloat(t)))),
            i && (t = parseInt(t * e, 10) / 100),
            O.abs(t - e) < 1e-6 ? 1 : (t % e) / parseFloat(e)
          );
        }
        function x(t) {
          return N(1, B(0, t));
        }
        function S(t) {
          return parseInt(t, 16);
        }
        function T(t) {
          return (
            "string" == typeof t && -1 != t.indexOf(".") && 1 === parseFloat(t)
          );
        }
        function k(t) {
          return "string" == typeof t && -1 != t.indexOf("%");
        }
        function E(t) {
          return 1 == t.length ? "0" + t : "" + t;
        }
        function A(t) {
          return t <= 1 && (t = 100 * t + "%"), t;
        }
        function I(t) {
          return Math.round(255 * parseFloat(t)).toString(16);
        }
        function L(t) {
          return S(t) / 255;
        }
        function P(t) {
          t = t.replace(D, "").replace($, "").toLowerCase();
          var e = !1;
          if (j[t]) (t = j[t]), (e = !0);
          else if ("transparent" == t)
            return { r: 0, g: 0, b: 0, a: 0, format: "name" };
          var i;
          return (i = z.rgb.exec(t))
            ? { r: i[1], g: i[2], b: i[3] }
            : (i = z.rgba.exec(t))
            ? { r: i[1], g: i[2], b: i[3], a: i[4] }
            : (i = z.hsl.exec(t))
            ? { h: i[1], s: i[2], l: i[3] }
            : (i = z.hsla.exec(t))
            ? { h: i[1], s: i[2], l: i[3], a: i[4] }
            : (i = z.hsv.exec(t))
            ? { h: i[1], s: i[2], v: i[3] }
            : (i = z.hsva.exec(t))
            ? { h: i[1], s: i[2], v: i[3], a: i[4] }
            : (i = z.hex8.exec(t))
            ? {
                a: L(i[1]),
                r: S(i[2]),
                g: S(i[3]),
                b: S(i[4]),
                format: e ? "name" : "hex8",
              }
            : (i = z.hex6.exec(t))
            ? { r: S(i[1]), g: S(i[2]), b: S(i[3]), format: e ? "name" : "hex" }
            : !!(i = z.hex3.exec(t)) && {
                r: S(i[1] + "" + i[1]),
                g: S(i[2] + "" + i[2]),
                b: S(i[3] + "" + i[3]),
                format: e ? "name" : "hex",
              };
        }
        var D = /^[\s,#]+/,
          $ = /\s+$/,
          M = 0,
          O = Math,
          R = O.round,
          N = O.min,
          B = O.max,
          F = O.random,
          W = function (e, i) {
            if (((e = e || ""), (i = i || {}), e instanceof W)) return e;
            if (!(this instanceof W)) return new W(e, i);
            var n = t(e);
            (this._originalInput = e),
              (this._r = n.r),
              (this._g = n.g),
              (this._b = n.b),
              (this._a = n.a),
              (this._roundA = R(100 * this._a) / 100),
              (this._format = i.format || n.format),
              (this._gradientType = i.gradientType),
              this._r < 1 && (this._r = R(this._r)),
              this._g < 1 && (this._g = R(this._g)),
              this._b < 1 && (this._b = R(this._b)),
              (this._ok = n.ok),
              (this._tc_id = M++);
          };
        (W.prototype = {
          isDark: function () {
            return this.getBrightness() < 128;
          },
          isLight: function () {
            return !this.isDark();
          },
          isValid: function () {
            return this._ok;
          },
          getOriginalInput: function () {
            return this._originalInput;
          },
          getFormat: function () {
            return this._format;
          },
          getAlpha: function () {
            return this._a;
          },
          getBrightness: function () {
            var t = this.toRgb();
            return (299 * t.r + 587 * t.g + 114 * t.b) / 1e3;
          },
          setAlpha: function (t) {
            return (
              (this._a = C(t)), (this._roundA = R(100 * this._a) / 100), this
            );
          },
          toHsv: function () {
            var t = a(this._r, this._g, this._b);
            return { h: 360 * t.h, s: t.s, v: t.v, a: this._a };
          },
          toHsvString: function () {
            var t = a(this._r, this._g, this._b),
              e = R(360 * t.h),
              i = R(100 * t.s),
              n = R(100 * t.v);
            return 1 == this._a
              ? "hsv(" + e + ", " + i + "%, " + n + "%)"
              : "hsva(" + e + ", " + i + "%, " + n + "%, " + this._roundA + ")";
          },
          toHsl: function () {
            var t = i(this._r, this._g, this._b);
            return { h: 360 * t.h, s: t.s, l: t.l, a: this._a };
          },
          toHslString: function () {
            var t = i(this._r, this._g, this._b),
              e = R(360 * t.h),
              n = R(100 * t.s),
              a = R(100 * t.l);
            return 1 == this._a
              ? "hsl(" + e + ", " + n + "%, " + a + "%)"
              : "hsla(" + e + ", " + n + "%, " + a + "%, " + this._roundA + ")";
          },
          toHex: function (t) {
            return r(this._r, this._g, this._b, t);
          },
          toHexString: function (t) {
            return "#" + this.toHex(t);
          },
          toHex8: function () {
            return s(this._r, this._g, this._b, this._a);
          },
          toHex8String: function () {
            return "#" + this.toHex8();
          },
          toRgb: function () {
            return { r: R(this._r), g: R(this._g), b: R(this._b), a: this._a };
          },
          toRgbString: function () {
            return 1 == this._a
              ? "rgb(" +
                  R(this._r) +
                  ", " +
                  R(this._g) +
                  ", " +
                  R(this._b) +
                  ")"
              : "rgba(" +
                  R(this._r) +
                  ", " +
                  R(this._g) +
                  ", " +
                  R(this._b) +
                  ", " +
                  this._roundA +
                  ")";
          },
          toPercentageRgb: function () {
            return {
              r: R(100 * _(this._r, 255)) + "%",
              g: R(100 * _(this._g, 255)) + "%",
              b: R(100 * _(this._b, 255)) + "%",
              a: this._a,
            };
          },
          toPercentageRgbString: function () {
            return 1 == this._a
              ? "rgb(" +
                  R(100 * _(this._r, 255)) +
                  "%, " +
                  R(100 * _(this._g, 255)) +
                  "%, " +
                  R(100 * _(this._b, 255)) +
                  "%)"
              : "rgba(" +
                  R(100 * _(this._r, 255)) +
                  "%, " +
                  R(100 * _(this._g, 255)) +
                  "%, " +
                  R(100 * _(this._b, 255)) +
                  "%, " +
                  this._roundA +
                  ")";
          },
          toName: function () {
            return 0 === this._a
              ? "transparent"
              : !(this._a < 1) && (H[r(this._r, this._g, this._b, !0)] || !1);
          },
          toFilter: function (t) {
            var e = "#" + s(this._r, this._g, this._b, this._a),
              i = e,
              n = this._gradientType ? "GradientType = 1, " : "";
            if (t) {
              i = W(t).toHex8String();
            }
            return (
              "progid:DXImageTransform.Microsoft.gradient(" +
              n +
              "startColorstr=" +
              e +
              ",endColorstr=" +
              i +
              ")"
            );
          },
          toString: function (t) {
            var e = !!t;
            t = t || this._format;
            var i = !1,
              n = this._a < 1 && this._a >= 0;
            return e ||
              !n ||
              ("hex" !== t && "hex6" !== t && "hex3" !== t && "name" !== t)
              ? ("rgb" === t && (i = this.toRgbString()),
                "prgb" === t && (i = this.toPercentageRgbString()),
                ("hex" !== t && "hex6" !== t) || (i = this.toHexString()),
                "hex3" === t && (i = this.toHexString(!0)),
                "hex8" === t && (i = this.toHex8String()),
                "name" === t && (i = this.toName()),
                "hsl" === t && (i = this.toHslString()),
                "hsv" === t && (i = this.toHsvString()),
                i || this.toHexString())
              : "name" === t && 0 === this._a
              ? this.toName()
              : this.toRgbString();
          },
          _applyModification: function (t, e) {
            var i = t.apply(null, [this].concat([].slice.call(e)));
            return (
              (this._r = i._r),
              (this._g = i._g),
              (this._b = i._b),
              this.setAlpha(i._a),
              this
            );
          },
          lighten: function () {
            return this._applyModification(c, arguments);
          },
          brighten: function () {
            return this._applyModification(u, arguments);
          },
          darken: function () {
            return this._applyModification(h, arguments);
          },
          desaturate: function () {
            return this._applyModification(l, arguments);
          },
          saturate: function () {
            return this._applyModification(d, arguments);
          },
          greyscale: function () {
            return this._applyModification(p, arguments);
          },
          spin: function () {
            return this._applyModification(f, arguments);
          },
          _applyCombination: function (t, e) {
            return t.apply(null, [this].concat([].slice.call(e)));
          },
          analogous: function () {
            return this._applyCombination(y, arguments);
          },
          complement: function () {
            return this._applyCombination(m, arguments);
          },
          monochromatic: function () {
            return this._applyCombination(w, arguments);
          },
          splitcomplement: function () {
            return this._applyCombination(v, arguments);
          },
          triad: function () {
            return this._applyCombination(g, arguments);
          },
          tetrad: function () {
            return this._applyCombination(b, arguments);
          },
        }),
          (W.fromRatio = function (t, e) {
            if ("object" == typeof t) {
              var i = {};
              for (var n in t)
                t.hasOwnProperty(n) && (i[n] = "a" === n ? t[n] : A(t[n]));
              t = i;
            }
            return W(t, e);
          }),
          (W.equals = function (t, e) {
            return !(!t || !e) && W(t).toRgbString() == W(e).toRgbString();
          }),
          (W.random = function () {
            return W.fromRatio({ r: F(), g: F(), b: F() });
          }),
          (W.mix = function (t, e, i) {
            i = 0 === i ? 0 : i || 50;
            var n,
              a = W(t).toRgb(),
              o = W(e).toRgb(),
              r = i / 100,
              s = 2 * r - 1,
              l = o.a - a.a;
            (n = s * l == -1 ? s : (s + l) / (1 + s * l)), (n = (n + 1) / 2);
            var d = 1 - n,
              p = {
                r: o.r * n + a.r * d,
                g: o.g * n + a.g * d,
                b: o.b * n + a.b * d,
                a: o.a * r + a.a * (1 - r),
              };
            return W(p);
          }),
          (W.readability = function (t, e) {
            var i = W(t),
              n = W(e),
              a = i.toRgb(),
              o = n.toRgb(),
              r = i.getBrightness(),
              s = n.getBrightness(),
              l =
                Math.max(a.r, o.r) -
                Math.min(a.r, o.r) +
                Math.max(a.g, o.g) -
                Math.min(a.g, o.g) +
                Math.max(a.b, o.b) -
                Math.min(a.b, o.b);
            return { brightness: Math.abs(r - s), color: l };
          }),
          (W.isReadable = function (t, e) {
            var i = W.readability(t, e);
            return i.brightness > 125 && i.color > 500;
          }),
          (W.mostReadable = function (t, e) {
            for (var i = null, n = 0, a = !1, o = 0; o < e.length; o++) {
              var r = W.readability(t, e[o]),
                s = r.brightness > 125 && r.color > 500,
                l = (r.brightness / 125) * 3 + r.color / 500;
              ((s && !a) || (s && a && l > n) || (!s && !a && l > n)) &&
                ((a = s), (n = l), (i = W(e[o])));
            }
            return i;
          });
        var j = (W.names = {
            aliceblue: "f0f8ff",
            antiquewhite: "faebd7",
            aqua: "0ff",
            aquamarine: "7fffd4",
            azure: "f0ffff",
            beige: "f5f5dc",
            bisque: "ffe4c4",
            black: "000",
            blanchedalmond: "ffebcd",
            blue: "00f",
            blueviolet: "8a2be2",
            brown: "a52a2a",
            burlywood: "deb887",
            burntsienna: "ea7e5d",
            cadetblue: "5f9ea0",
            chartreuse: "7fff00",
            chocolate: "d2691e",
            coral: "ff7f50",
            cornflowerblue: "6495ed",
            cornsilk: "fff8dc",
            crimson: "dc143c",
            cyan: "0ff",
            darkblue: "00008b",
            darkcyan: "008b8b",
            darkgoldenrod: "b8860b",
            darkgray: "a9a9a9",
            darkgreen: "006400",
            darkgrey: "a9a9a9",
            darkkhaki: "bdb76b",
            darkmagenta: "8b008b",
            darkolivegreen: "556b2f",
            darkorange: "ff8c00",
            darkorchid: "9932cc",
            darkred: "8b0000",
            darksalmon: "e9967a",
            darkseagreen: "8fbc8f",
            darkslateblue: "483d8b",
            darkslategray: "2f4f4f",
            darkslategrey: "2f4f4f",
            darkturquoise: "00ced1",
            darkviolet: "9400d3",
            deeppink: "ff1493",
            deepskyblue: "00bfff",
            dimgray: "696969",
            dimgrey: "696969",
            dodgerblue: "1e90ff",
            firebrick: "b22222",
            floralwhite: "fffaf0",
            forestgreen: "228b22",
            fuchsia: "f0f",
            gainsboro: "dcdcdc",
            ghostwhite: "f8f8ff",
            gold: "ffd700",
            goldenrod: "daa520",
            gray: "808080",
            green: "008000",
            greenyellow: "adff2f",
            grey: "808080",
            honeydew: "f0fff0",
            hotpink: "ff69b4",
            indianred: "cd5c5c",
            indigo: "4b0082",
            ivory: "fffff0",
            khaki: "f0e68c",
            lavender: "e6e6fa",
            lavenderblush: "fff0f5",
            lawngreen: "7cfc00",
            lemonchiffon: "fffacd",
            lightblue: "add8e6",
            lightcoral: "f08080",
            lightcyan: "e0ffff",
            lightgoldenrodyellow: "fafad2",
            lightgray: "d3d3d3",
            lightgreen: "90ee90",
            lightgrey: "d3d3d3",
            lightpink: "ffb6c1",
            lightsalmon: "ffa07a",
            lightseagreen: "20b2aa",
            lightskyblue: "87cefa",
            lightslategray: "789",
            lightslategrey: "789",
            lightsteelblue: "b0c4de",
            lightyellow: "ffffe0",
            lime: "0f0",
            limegreen: "32cd32",
            linen: "faf0e6",
            magenta: "f0f",
            maroon: "800000",
            mediumaquamarine: "66cdaa",
            mediumblue: "0000cd",
            mediumorchid: "ba55d3",
            mediumpurple: "9370db",
            mediumseagreen: "3cb371",
            mediumslateblue: "7b68ee",
            mediumspringgreen: "00fa9a",
            mediumturquoise: "48d1cc",
            mediumvioletred: "c71585",
            midnightblue: "191970",
            mintcream: "f5fffa",
            mistyrose: "ffe4e1",
            moccasin: "ffe4b5",
            navajowhite: "ffdead",
            navy: "000080",
            oldlace: "fdf5e6",
            olive: "808000",
            olivedrab: "6b8e23",
            orange: "ffa500",
            orangered: "ff4500",
            orchid: "da70d6",
            palegoldenrod: "eee8aa",
            palegreen: "98fb98",
            paleturquoise: "afeeee",
            palevioletred: "db7093",
            papayawhip: "ffefd5",
            peachpuff: "ffdab9",
            peru: "cd853f",
            pink: "ffc0cb",
            plum: "dda0dd",
            powderblue: "b0e0e6",
            purple: "800080",
            rebeccapurple: "663399",
            red: "f00",
            rosybrown: "bc8f8f",
            royalblue: "4169e1",
            saddlebrown: "8b4513",
            salmon: "fa8072",
            sandybrown: "f4a460",
            seagreen: "2e8b57",
            seashell: "fff5ee",
            sienna: "a0522d",
            silver: "c0c0c0",
            skyblue: "87ceeb",
            slateblue: "6a5acd",
            slategray: "708090",
            slategrey: "708090",
            snow: "fffafa",
            springgreen: "00ff7f",
            steelblue: "4682b4",
            tan: "d2b48c",
            teal: "008080",
            thistle: "d8bfd8",
            tomato: "ff6347",
            turquoise: "40e0d0",
            violet: "ee82ee",
            wheat: "f5deb3",
            white: "fff",
            whitesmoke: "f5f5f5",
            yellow: "ff0",
            yellowgreen: "9acd32",
          }),
          H = (W.hexNames = (function (t) {
            var e = {};
            for (var i in t) t.hasOwnProperty(i) && (e[t[i]] = i);
            return e;
          })(j)),
          z = (function () {
            var t = "(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",
              e =
                "[\\s|\\(]+(" +
                t +
                ")[,|\\s]+(" +
                t +
                ")[,|\\s]+(" +
                t +
                ")\\s*\\)?",
              i =
                "[\\s|\\(]+(" +
                t +
                ")[,|\\s]+(" +
                t +
                ")[,|\\s]+(" +
                t +
                ")[,|\\s]+(" +
                t +
                ")\\s*\\)?";
            return {
              rgb: new RegExp("rgb" + e),
              rgba: new RegExp("rgba" + i),
              hsl: new RegExp("hsl" + e),
              hsla: new RegExp("hsla" + i),
              hsv: new RegExp("hsv" + e),
              hsva: new RegExp("hsva" + i),
              hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
              hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
              hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
            };
          })();
        window.tinycolor = W;
      })(),
      t(function () {
        t.fn.spectrum.load && t.fn.spectrum.processNativeColorInputs();
      });
  }),
  define(
    "storymaps/tpl/builder/settings/ViewThemeOptions",
    [
      "lib-build/tpl!./ViewThemeOptions",
      "lib-build/css!./ViewThemeOptions",
      "lib-build/css!lib-app/spectrum/spectrum",
      "lib-app/spectrum/spectrum",
    ],
    function (t, e, i, n) {
      return function () {
        function e(t) {
          $("#header").css("background-color", t),
            $("#nav-bar").css("background-color", t);
        }
        var i = null,
          n = null,
          a = null;
        (this.init = function (e, a) {
          (i = e),
            (n = a),
            n.append(t({ headerColor: i18n.builder.settings.headerColor }));
        }),
          (this.present = function (t) {
            $("#headerColorpicker").spectrum() &&
              $("#headerColorpicker").spectrum("destroy"),
              $("#headerColorpicker").spectrum({
                color: t.headerColor || "#444",
                showInput: !0,
                preferredFormat: "hex",
                showPalette: !0,
                palette: [
                  "#444",
                  "000",
                  "07194d",
                  "#541416",
                  "#76401d",
                  "#673d22",
                  "#6a5b24",
                  "#274620",
                  "#314069",
                  "#3e2544",
                ],
                chooseText: i18n.builder.settings.choose,
                cancelText: i18n.builder.detailPanelBuilder.cancel,
              }),
              (a = t);
          }),
          (this.show = function () {}),
          (this.save = function () {
            var t = "#" + $("#headerColorpicker").spectrum("get").toHex();
            return e(t), { headerColor: t };
          }),
          (this.initLocalization = function () {
            i.html(i18n.commonCore.settingsTheme.title);
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/settings/ViewHeader",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="settings-header">\n\t<div class="settings-simulator">\n\t\t<img class="imgLogo"/>\n\t</div>\n\t<div class="settings-content">\n\t\t<form role="form" class="form1">\n\t\t\t<div class="form-group form-inline form-horizontal">\n\t\t\t\t<div class="radio">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="radio" name="optionsLogo" id="optionsRadios1" value="esri" checked>\n\t\t\t\t\t\t<span class="logoText">' +
            (null == (__t = logoEsriRadio) ? "" : __t) +
            '</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="radio orgLogo">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="radio" name="optionsLogo" id="optionsRadios2" value="org">\n\t\t\t\t\t\t<span class="logoText">' +
            (null == (__t = logoOrgRadio) ? "" : __t) +
            '</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="radio">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="radio" name="optionsLogo" id="optionsRadios3" value="custom">\n\t\t\t\t\t\t<span class="logoText">' +
            (null == (__t = logoCustomRadio) ? "" : __t) +
            '</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="radio">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="radio" name="optionsLogo" id="optionsRadios4" value="none">\n\t\t\t\t\t\t<span class="logoText">' +
            (null == (__t = logoNoneRadio) ? "" : __t) +
            '</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="optionsLogoCustom">\n\t\t\t\t\t<table class="settings-table">\n\t\t\t\t\t\t<tr class="hide-except-custom">\n\t\t\t\t\t\t\t<td class="td-lbl">' +
            (null == (__t = logoCustomLabel) ? "" : __t) +
            '</td>\n\t\t\t\t\t\t\t<td class="td-first">\n\t\t\t\t\t\t\t\t<div class="logo-btn-group btn-group">\n\t\t\t\t\t\t\t\t\t<button type="button" id="uploadRadio" class="btn btn-default btn-sm active" title="' +
            (null == (__t = logoCustomUploadTooltip) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t\t\t\t<span class="fa fa-upload"></span>\n\t\t\t\t\t\t      </button>\n\t\t\t\t\t\t\t\t\t<button type="button" id="linkRadio" class="btn btn-default btn-sm" title="' +
            (null == (__t = logoCustomLinkTooltip) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t\t\t\t<span class="fa fa-link"></span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="td-input">\n\t\t\t\t\t\t\t\t\t<div id="uploadBtn" class="btn btn-default btn-sm btn-file" title="' +
            (null == (__t = logoCustomUploadTooltip) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t\t\t\t<span class="fa fa-upload"></span>\n\t\t\t\t\t\t\t\t\t\t<span>' +
            (null == (__t = logoCustomUploadButton) ? "" : __t) +
            '</span>\n\t\t\t\t\t\t\t        <input class="file-input" type="file" accept=".png,.jpeg,.jpg,.gif,.bmp"></input>\n\t\t\t\t\t\t      </div>\n\t\t\t\t\t\t\t\t<input class="form-control input-sm" id="logoInput" type="text" placeholder="' +
            (null == (__t = logoCustomLinkPlaceholderHTTPS) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t\t<input class="hidden" id="uploadLogoInput" type="text"">\n\t\t\t\t\t\t\t\t<span class="uploadHelp fa fa-info-circle" data-toggle="tooltip" data-title="' +
            (null == (__t = logoCustomUploadHelp) ? "" : __t) +
            '"></span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="upload-warnings hidden">\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td class="td-input" colspan="2">\n\t\t\t\t\t\t\t\t<span class="info-text"></span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="td-lbl">' +
            (null == (__t = logoLink) ? "" : __t) +
            '</td>\n\t\t\t\t\t\t\t<td class="td-input variable-colspan" colspan="2">\n\t\t\t\t\t\t\t\t<input class="form-control input-sm" id="logoTargetInput" type="text" spellcheck="true" placeholder="' +
            (null == (__t = logoCustomTargetPlaceholder) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\n\t\t<form class="form2">\n\t\t\t<div class="form-group socialConfig">\n\t\t\t\t<div class="checkbox">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="checkbox" class="enableFB" />\n\t\t\t\t\t\t<span class="social-lbl">Facebook</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="checkbox">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="checkbox" class="enableTwitter" />\n\t\t\t\t\t\t<span class="social-lbl">Twitter</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="checkbox">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="checkbox" class="enableBitly" />\n\t\t\t\t\t\t<span class="social-lbl" style="word-break: break-all;">' +
            (null == (__t = share) ? "" : __t) +
            '</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<table class="settings-table">\n\t\t\t\t<tr>\n\t\t\t\t\t<td class="td-lbl">' +
            (null == (__t = logoSocialText) ? "" : __t) +
            '</td>\n\t\t\t\t\t<td class="td-input"><input id="selectSocialText" type="text" class="form-control input-sm" /></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class="td-lbl">' +
            (null == (__t = logoLink) ? "" : __t) +
            '</td>\n\t\t\t\t\t<td class="td-input"><input id="selectSocialLink" type="text" class="form-control input-sm" /></td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</form>\n\t</div>\n\t<form class="form-config-size">\n\t\t<div class="checkbox">\n\t\t\t<label>\n\t\t\t\t<input type="checkbox" class="enableCompact" />\n\t\t\t\t<span>' +
            (null == (__t = lblSmallHeader) ? "" : __t) +
            "</span>\n\t\t\t</label>\n\t\t</div>\n\t</form>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/settings/ViewHeader",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/settings/ViewHeader",
    [
      "lib-build/tpl!./ViewHeader",
      "lib-build/css!./ViewHeader",
      "../media/image/FileUploadHelper",
      "../media/image/ImageUploadHelper",
      "../../utils/CommonHelper",
      "dojo/_base/lang",
    ],
    function (t, e, i, n, a, o) {
      return function (e) {
        function r() {
          var t = $("input[name='optionsLogo']:checked", k).val(),
            e = "custom" !== t,
            i = e && "org" !== t,
            n = "custom" === t ? "2" : "1",
            a = k.find(".optionsLogoCustom").toggleClass("hidden", i);
          a.find(".hide-except-custom").toggleClass("hidden", e),
            a.find(".variable-colspan").attr("colspan", n);
        }
        function s(t) {
          var e;
          if ("link" === t) e = $("#linkRadio");
          else if ("upload" === t) e = $("#uploadRadio");
          else if (((e = $(t.target).closest(".btn")), e.attr("disabled")))
            return;
          l(e), C();
        }
        function l(t) {
          var e = k.find(".logo-btn-group");
          t = t || e.find(".btn.active");
          var i = 1 === t.closest("#uploadRadio").length;
          e.find(".btn").removeClass("active"),
            t.addClass("active"),
            k.find("#uploadBtn").toggleClass("hidden", !i),
            k.find("#logoInput").toggleClass("hidden", i);
        }
        function d() {
          l($("#linkRadio")), $("#uploadRadio").attr("disabled", "disabled");
        }
        function p(t) {
          var e = t.target.files ? t.target.files[0] : null;
          return e
            ? i.validateFile(e)
              ? void n.processLogo(e).then(o.hitch(this, c), o.hitch(this, g))
              : (console.warn("file not valid"), void m())
            : void console.warn("no file", t);
        }
        function c(t) {
          i.uploadSingleResource(t).then(o.hitch(this, u), o.hitch(this, h));
        }
        function u(t) {
          var e = a.prependURLHTTP(a.possiblyAddToken(t.picUrl));
          k.find("#uploadLogoInput").val(e),
            k.find(".imgLogo").attr("src", e).show(),
            f();
        }
        function h(t) {
          console.warn("uploadFileError", t), m(), f();
        }
        function f() {
          var t = A.find("input");
          t.length && (t[0].value = "");
        }
        function m(t) {
          k.find(".info-text").text(
            t || i18n.commonCore.settingsHeader.logoUploadGenericError
          );
          var e = k.find(".upload-warnings");
          e.removeClass("hidden"),
            setTimeout(function () {
              e.addClass("hidden");
            }, 6e3);
        }
        function g(t) {
          if ((console.warn("processError", t), t && t.reason)) {
            var e;
            "gif dimensions" === t.reason &&
              (e = i18n.commonCore.settingsHeader.logoUploadSizeError.replace(
                "${PIXEL-WIDTH}",
                t.details
              )),
              m(e),
              f();
          }
        }
        function b() {
          S();
        }
        function v() {}
        function y() {
          (L = !0), k.find(".imgLogo").hide();
        }
        function w(t) {
          if (13 == t.keyCode) return (L = !1), C(), !1;
          8 == t.keyCode &&
            ($("#logoTargetInput").focus(), $("#logoInput").focus());
        }
        function C() {
          var t = $("#linkRadio", k).hasClass("active")
              ? "#logoInput"
              : "#uploadLogoInput",
            e = $(t, k).val().trim();
          app.cfg.HEADER_ORG_LOGO_URL &&
            app.cfg.HEADER_ORG_LOGO_URL === e &&
            (e = ""),
            k
              .find(".imgLogo")
              .attr("src", a.prependURLHTTP(a.possiblyAddToken(e)))
              .show();
        }
        function x(t) {
          8 == t.keyCode &&
            ($("#logoInput").focus(), $("#logoTargetInput").focus());
        }
        function S() {
          var t = $("input[name=optionsLogo]:checked", k).val();
          k.find(".imgLogo").hide(),
            "custom" == t
              ? a.getItemId()
                ? ($("#uploadRadio").removeAttr("disabled"), l(), C())
                : d()
              : "esri" == t
              ? k
                  .find(".imgLogo")
                  .attr("src", "resources/tpl/viewer/icons/esri-logo.png")
                  .show()
              : "org" == t &&
                k
                  .find(".imgLogo")
                  .attr("src", app.cfg.HEADER_ORG_LOGO_URL)
                  .show();
        }
        var T = null,
          k = null,
          E = null,
          A = null,
          I = null,
          L = !1;
        (e = e || {}),
          (this.init = function (i, n) {
            (T = i),
              (k = n),
              k.append(
                t(
                  _.extend({}, i18n.commonCore.settingsHeader, {
                    share: i18n.commonCore.builderPanel.buttonShare,
                  })
                )
              ),
              (E = k.find("#logoInput")),
              (I = k.find("#logoTargetInput")),
              E.keydown(w),
              E.focusout(C),
              I.keydown(x),
              (A = k.find("#uploadBtn")),
              A.on("change", p),
              $(".logo-btn-group").on("click", s),
              $("input[type=radio]", k).click(b),
              $("#imgLogo", k).error(y),
              $("#imgLogo", k).load(v),
              $("input[name='optionsLogo']", k).change(r),
              k.find(".form-config-size").toggle(e.smallSizeOpt),
              k.find(".uploadHelp").tooltip({ trigger: "hover" });
          }),
          (this.present = function (t) {
            var e,
              i = t.logoURL,
              n = app.data.getWebAppData().getColors();
            $("#headerSimulator", k).css("background-color", n),
              i == app.cfg.HEADER_LOGO_URL || null == i
                ? ((e = $('input[value="esri"]', k)),
                  $("#imgLogo", k).show(),
                  E.val(""),
                  I.val(""))
                : "NO_LOGO" === i
                ? ((e = $('input[value="none"]', k)), E.val(""), I.val(""))
                : ($("#imgLogo", k).attr("src", i).show(),
                  I.val(t.logoTarget),
                  i === app.cfg.HEADER_ORG_LOGO_URL
                    ? (e = $('input[value="org"]', k))
                    : ((e = $('input[value="custom"]', k)),
                      a.isAppResource(i)
                        ? ($("#uploadLogoInput", k).val(i), s("upload"))
                        : ($("#logoInput", k).val(i), s("link")))),
              e.attr("checked", "checked"),
              r(),
              $("#selectSocialText", k).val(
                void 0 === t.linkText ? app.cfg.HEADER_LINK_TEXT : t.linkText
              ),
              $("#selectSocialLink", k).val(
                void 0 === t.linkURL ? app.cfg.HEADER_LINK_URL : t.linkURL
              ),
              $("#selectSocialText", k).blur(function () {
                $(window).scrollTop(0);
              }),
              $("#selectSocialLink", k).blur(function () {
                $(window).scrollTop(0);
              }),
              $("#logoInput", k).blur(function () {
                $(window).scrollTop(0);
              }),
              I.blur(function () {
                $(window).scrollTop(0);
              }),
              app.cfg.HEADER_SOCIAL.facebook
                ? (t.social && !t.social.facebook) ||
                  $(".enableFB", k).prop("checked", !0)
                : $(".enableFB", k)
                    .attr("disabled", "disabled")
                    .parent()
                    .addClass("disabled")
                    .attr("title", i18n.commonCore.common.disabledAdmin),
              app.cfg.HEADER_SOCIAL.twitter
                ? (t.social && !t.social.twitter) ||
                  $(".enableTwitter", k).prop("checked", !0)
                : $(".enableTwitter", k)
                    .attr("disabled", "disabled")
                    .parent()
                    .addClass("disabled")
                    .attr("title", i18n.commonCore.common.disabledAdmin),
              app.cfg.HEADER_SOCIAL.bitly &&
              app.cfg.HEADER_SOCIAL.bitly.enable &&
              app.cfg.HEADER_SOCIAL.bitly.login &&
              app.cfg.HEADER_SOCIAL.bitly.key
                ? (t.social && !t.social.bitly) ||
                  $(".enableBitly", k).prop("checked", !0)
                : $(".enableBitly", k)
                    .attr("disabled", "disabled")
                    .parent()
                    .addClass("disabled")
                    .attr("title", i18n.commonCore.common.disabledAdmin),
              app.cfg.HEADER_ORG_LOGO_URL || $(".orgLogo", k).hide(),
              S(),
              k
                .find(".enableCompact")
                .prop("checked", t.compactSize || void 0 === t.compactSize);
          }),
          (this.show = function () {}),
          (this.save = function () {
            var t,
              e,
              i = k.find("input[name=optionsLogo]:checked").val(),
              n = k.find(".imgLogo").attr("src");
            "esri" == i
              ? ((t = null), (e = ""))
              : "none" != i && n
              ? ((t = L ? app.cfg.HEADER_LOGO_URL : a.prependURLHTTP(n)),
                (e = I.val()))
              : ((t = "NO_LOGO"), (e = ""));
            var o = $("#selectSocialText", k).val() || "";
            o = o.replace(/<\/?script>/g, "");
            var r = $("#selectSocialLink", k).val() || "";
            return (
              (r = r.replace(/<\/?script>/g, "")),
              {
                linkText: o,
                linkURL: a.prependURLHTTP(r),
                logoURL: t,
                logoTarget: a.prependURLHTTP(e),
                social: {
                  facebook: $(".enableFB").prop("checked"),
                  twitter: $(".enableTwitter").prop("checked"),
                  bitly: $(".enableBitly").prop("checked"),
                },
                compactSize: k.find(".enableCompact").prop("checked"),
              }
            );
          }),
          (this.initLocalization = function () {
            T.html(i18n.commonCore.settingsHeader.title);
          });
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/MapExtentSave", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div title="' +
          (null == (__t = saveExtent) ? "" : __t) +
          '" class="home-location-save-btn btn btn-default location-changed">\r\n\t<div class="home-location-save-logo" tabindex="0"></div>\r\n</div>\r\n';
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/builder/MapExtentSave",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/MapExtentSave",
    [
      "lib-build/tpl!./MapExtentSave",
      "lib-build/css!./MapExtentSave",
      "storymaps/common/utils/CommonHelper",
      "esri/geometry/Extent",
      "dojo/topic",
    ],
    function (t, e, i, n, a) {
      return function (e, o) {
        function r() {
          l.hide(),
            (app.data.getWebMap().item.extent = p.serializeExtentToItem(
              app.map.extent
            )),
            app.data.getWebAppData().setMapExtent(new n(app.map.extent)),
            $.each(app.data.getStory(), function (t) {
              app.data.setStory(t, null, null, app.map.extent);
            }),
            a.publish("BUILDER_INCREMENT_COUNTER", 1);
        }
        function s() {
          $(".home-location-save-btn").click(r),
            app.map.on("extent-change", function () {
              var t = d.serializeExtentToItem(app.map.extent);
              d.serializedExtentEquals(t, app.data.getWebMap().item.extent)
                ? l.hide()
                : setTimeout(function () {
                    l.show();
                  }, 250);
            }),
            (l.initDone = !0);
        }
        var l = this,
          d = i,
          p = o;
        (this.init = function () {
          l.initDone ||
            $(".home-location-save-btn").length ||
            ($("#map_zoom_slider").append(
              t({ saveExtent: i18n.builder.settings.saveHomeLocation })
            ),
            s());
        }),
          (this.initDone = !1),
          (this.present = function () {
            s();
          }),
          (this.show = function () {
            app.data.getWebAppData().getIsExternalData() ||
              ($(".home-location-save-btn").find(
                ".esriSimpleSliderIncrementButton"
              ) &&
                $(".home-location-save-btn")
                  .find(".esriSimpleSliderIncrementButton")
                  .remove(),
              $(".home-location-save-btn").show());
          }),
          (this.reinit = function () {
            $(".home-location-save-btn").css("visibility", "visible"),
              $(".home-location-save-btn").show();
          }),
          (this.hide = function () {
            $(".home-location-save-btn").hide();
          }),
          (this.hideAlways = function () {
            $(".home-location-save-btn").css("visibility", "hidden");
          });
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/Workflow", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div id="addFeatures" tabindex="-1">\r\n\tWould you like to build your shortlist by adding features?\r\n</div>\r\n\r\n<div id="addWebMap" tabindex="-1">\r\n\tOr would you like to build your shortlist from an existing web map?\r\n</div>\r\n';
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/builder/Workflow", [], function () {}),
  define("lib-build/tpl!storymaps/tpl/builder/Data", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div id="oneLayer" tabindex="-1">\r\n\tAre all of your features in one layer and need to be split up into different tabs?\r\n</div>\r\n\r\n<div id="multiLayers" tabindex="-1">\r\n\tOr do you have several layers that will each make up a tab?\r\n</div>\r\n';
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/builder/Data", [], function () {}),
  define(
    "storymaps/tpl/builder/Data",
    ["lib-build/tpl!./Data", "lib-build/css!./Data"],
    function (t, e) {
      return function (e) {
        function i() {
          console.log("$$$");
        }
        function n() {
          e.find(".btnNext").attr("disabled"),
            e.find(".btnNext").click(i),
            (a = !0);
        }
        var a = !1;
        (this.present = function (i) {
          e.find(".modal-body").empty(), e.find(".modal-body").append(t()), n();
        }),
          (this.close = function () {});
      };
    }
  ),
  define(
    "storymaps/tpl/builder/Workflow",
    ["lib-build/tpl!./Workflow", "lib-build/css!./Workflow", "./Data"],
    function (t, e, i) {
      return function (e) {
        function n() {
          r.present();
        }
        function a() {
          e.find(".btnNext").attr("disabled"),
            e.find(".btnNext").click(n),
            (o = !0);
        }
        var o = !1,
          r = new i(e);
        (this.present = function (i) {
          e.find(".modal-body").empty(), e.find(".modal-body").append(t()), a();
        }),
          (this.close = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/AddFeatureBar", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div id="addFeatureBar">\r\n\t<button id="addFeature" class="btn btn-success">' +
          (null == (__t = add) ? "" : __t) +
          '</button>\r\n\t<button id="importFeature" class="btn btn-success">' +
          (null == (__t = importFeatures) ? "" : __t) +
          '</button>\r\n\t<button id="organizeFeatures" class="btn btn-primary">' +
          (null == (__t = organize) ? "" : __t) +
          '</button>\r\n\t<button id="locateFeatures" class="btn btn-warning" data-toggle="tooltip" data-title="' +
          (null == (__t = locateFeaturesTooltip) ? "" : __t) +
          '">\r\n\t\t<span class="unlocatedFeatures"></span>\r\n\t</button>\r\n\t<button id="completeOrganization" class="btn btn-success">' +
          (null == (__t = done) ? "" : __t) +
          '</button>\r\n\t<button id="deleteFeatures" class="btn btn-danger disabled">' +
          (null == (__t = deleteFeature) ? "" : __t) +
          '</button>\r\n\t<div id="moveFeaturesContainer" class="dropdown">\r\n\t\t<button class="btn btn-default dropdown-toggle disabled" type="button" id="moveFeaturesDropdownMenu" data-toggle="dropdown">\r\n\t\t\t' +
          (null == (__t = move) ? "" : __t) +
          '\r\n\t\t\t<span class="caret"></span>\r\n\t\t</button>\r\n\t\t<ul id="tabSelector" class="dropdown-menu" >\r\n\t\t</ul>\r\n\t</div>\r\n</div>\r\n';
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/builder/AddFeatureBar",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/AddFeatureBar",
    [
      "lib-build/tpl!./AddFeatureBar",
      "lib-build/css!./AddFeatureBar",
      "../core/WebApplicationData",
      "../core/Helper",
      "./BuilderHelper",
      "storymaps/common/builder/media/image/FileUploadHelper",
      "esri/geometry/Point",
      "esri/geometry/Extent",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/layers/GraphicsLayer",
      "esri/SpatialReference",
      "esri/geometry/webMercatorUtils",
      "esri/graphicsUtils",
      "esri/layers/FeatureLayer",
      "esri/graphic",
      "dojo/topic",
      "dojo/_base/lang",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h, f, m, g) {
      return function (e, s) {
        function g() {
          var t = {};
          (t.mode = "import"),
            E.present(t).then(function (t) {
              if (($("body").addClass("loadingPlaces"), t)) {
                var e = !1,
                  i = new d();
                $.each(t, function (t, n) {
                  if ((k.addFeature(n, !1, null, !0), n.lng && n.lat)) {
                    var a = new r(n.lng, n.lat, new p({ wkid: 4326 })),
                      o = new f(a);
                    i.graphics.push(o), (e = !0);
                  }
                });
                var n;
                i.graphics.length > 1 && (n = u.graphicsExtent(i.graphics)),
                  setTimeout(function () {
                    if (
                      ("default" ==
                        app.data.getWebAppData().getGeneralOptions()
                          .extentMode && S.updateShortlistExtent(),
                      t.length > 1 && e)
                    ) {
                      var i = c.project(n, app.map);
                      app.map.setExtent(i, !0),
                        app.map
                          .getLayer(app.data.getShortlistLayerId())
                          .redraw();
                    }
                  }, 500),
                  $("#editorDialogInlineMedia").hide(),
                  k.updateLocatedFeatures(),
                  setTimeout(function () {
                    var t = $(".entry.active").index(),
                      e = $(".detailContainer")[t];
                    $(e).hide(), $("body").removeClass("loadingPlaces");
                  }, 0);
              }
            });
        }
        function b() {
          $("body").addClass("organizeFeatures"),
            $(".builder-content-panel .builder-content-panel-group").addClass(
              "disabled"
            ),
            $(".builder-lbl").addClass("disabled"),
            $(".builder-content-panel.inline .builder-btn").addClass(
              "disabled"
            ),
            app.ui.tilePanel.initSortable(),
            $("#addFeature").hide(),
            $("#importFeature").hide(),
            $("#organizeFeatures").hide(),
            $("#locateFeatures").hide(),
            $("#deleteFeatures").addClass("disabled"),
            $("#deleteFeatures").prop("disabled", !0),
            $("#moveFeaturesDropdownMenu").addClass("disabled"),
            $("#completeOrganization").show(),
            $("#deleteFeatures").show();
          var t = $(".entry.active").index();
          $(".dropdown-menu .entry").length > 1 &&
            ($("#tabSelector").empty(),
            $.each($(".dropdown-menu .entry"), function (e) {
              var i = app.data.getStory()[e].title;
              e == t
                ? $("#tabSelector").append(
                    $('<li class="disabledTab"><a href="#">' + i + "</a></li>")
                  )
                : $("#tabSelector").append(
                    $('<li class="enabledTab"><a href="#">' + i + "</a></li>")
                  );
            }),
            0 === t && $("#tabSelector option:eq(1)"),
            $("#moveFeaturesContainer").css("display", "inline-block")),
            e.find("#moveFeaturesContainer li.enabledTab").on("click", y),
            $("#myList")
              .find("li")
              .on("click", function () {
                $("body").hasClass("organizeFeatures") &&
                  ($(this).toggleClass("selected"),
                  $("#myList").find("li.selected").length
                    ? ($("#deleteFeatures").removeClass("disabled"),
                      $("#deleteFeatures").prop("disabled", !1),
                      $("#moveFeaturesDropdownMenu").removeClass("disabled"))
                    : ($("#deleteFeatures").addClass("disabled"),
                      $("#moveFeaturesDropdownMenu").addClass("disabled")));
              });
        }
        function v() {
          var t = $("#myList").find("li.selected"),
            e = app.map.getLayer(app.data.getShortlistLayerId());
          $.each(t, function (t, i) {
            var n = $.grep(e.graphics, function (t) {
              return t.attributes.shortlist_id == $(i).data("shortlist-id");
            });
            n[0].attributes.resource &&
              o.removeResources(n[0].attributes.resource),
              e.remove(n[0]);
          });
          var i = $(".entry.active").index(),
            n = [];
          $.each(e.graphics, function (t, e) {
            e.attributes.tab_id == i
              ? (n.push(e), e.attributes.locationSet && e.show())
              : e.hide();
          }),
            (app.layerCurrent.graphics = n),
            S.updateAllFeatures(),
            S.updateShortlistExtent(),
            app.ui.tilePanel.buildTilePanel(),
            app.detailPanelBuilder.buildSlides(),
            k.updateLocatedFeatures(),
            $("#myList")
              .find("li")
              .on("click", function () {
                $("body").hasClass("organizeFeatures") &&
                  $(this).toggleClass("selected");
              }),
            $("#deleteFeatures").addClass("disabled"),
            $("#moveFeaturesDropdownMenu").addClass("disabled"),
            k.exitOrganizeMode();
        }
        function y() {
          var t = $(this).index(),
            e = $("#myList").find("li.selected"),
            n = app.map.getLayer(app.data.getShortlistLayerId()),
            a = 900;
          $.each(e, function (e, i) {
            var o = $.grep(n.graphics, function (t) {
              return t.attributes.shortlist_id == $(i).data("shortlist-id");
            });
            (o[0].attributes.tab_id = t),
              (o[0].attributes.number = a),
              o[0].attr("number", a),
              a++;
          }),
            S.updateAllFeatures();
          var o = $(".entry.active").index(),
            r = [];
          $.each(n.graphics, function (t, e) {
            e.attributes.tab_id == o ? (e.show(), r.push(e)) : e.hide();
          }),
            (app.layerCurrent.graphics = r),
            app.ui.tilePanel.buildTilePanel(),
            k.updateLocatedFeatures(!0),
            $("#deleteFeatures").addClass("disabled"),
            $("#moveFeaturesDropdownMenu").addClass("disabled"),
            k.exitOrganizeMode(!0),
            i.getTitle() && m.publish("BUILDER_INCREMENT_COUNTER");
        }
        function w() {
          $("body").addClass("locateFeatures"),
            $(".located").hide(),
            $("#addFeature").hide(),
            $("#importFeature").hide(),
            $("#organizeFeatures").hide(),
            $("#completeOrganization").show(),
            $("#locateFeatures").hide(),
            app.detailPanelBuilder.buildUnlocatedSlides();
        }
        function C() {
          T = !0;
        }
        function _() {
          e.find("#addFeature").on("click", k.addFeature),
            e.find("#importFeature").on("click", g),
            e.find("#organizeFeatures").on("click", b),
            e.find("#locateFeatures").on("click", w),
            e.find("#completeOrganization").on("click", k.exitOrganizeMode),
            e.find("#deleteFeatures").on("click", v),
            e.find("#locateFeatures").tooltip({ html: !0, trigger: "hover" });
        }
        var x,
          S,
          T = !1,
          k = this,
          E = s;
        new n();
        (this.loaded = !1),
          (this.init = function (i, n) {
            (k.loaded = !0),
              (x = i),
              (S = n),
              setTimeout(function () {
                e
                  .find("#paneLeft")
                  .prepend(
                    t({
                      add: i18n.builder.addFeatureBar.add,
                      importFeatures: i18n.builder.addFeatureBar.import,
                      organize: i18n.builder.organizePopup.title,
                      done: i18n.builder.addFeatureBar.done,
                      deleteFeature: i18n.builder.addFeatureBar.deleteFeature,
                      move: i18n.builder.addFeatureBar.move,
                      locateFeaturesTooltip:
                        i18n.builder.addFeatureBar.locateFeaturesTooltip,
                    })
                  ),
                  C(),
                  _(),
                  k.updateLocatedFeatures();
              }, 0),
              $("#importFeature").prop("disabled", !0),
              $("#myList").addClass("builder");
          }),
          (this.close = function () {}),
          (this.addLayer = function (t) {
            if (!app.data.getWebAppData().getShortlistLayerId()) {
              var e = a.getNewLayerJSON(a.getFeatureCollectionTemplate(!0));
              app.data.getWebMap().itemData.operationalLayers.push(e),
                i.setShortlistLayerId(e.id);
              var n = new h(e.featureCollection.layers[0]);
              if (
                ((n.id = e.id),
                app.map
                  ? app.map.addLayer(n)
                  : setTimeout(function () {
                      app.map.addLayer(n);
                    }, 500),
                app.data.setShortlistLayerId(e.id),
                (app.layerCurrent = n),
                n.on("mouse-over", app.ui.mainView.layer_onMouseOver),
                n.on("mouse-out", app.ui.mainView.layer_onMouseOut),
                n.on("click", app.ui.mainView.layer_onClick),
                app.isInBuilder &&
                  (app.isDirectCreationFirstSave || t || app.isGalleryCreation))
              ) {
                app.detailPanelBuilder.addDetailPanelSwiper(0);
                var o = app.cfg.COLOR_ORDER.split(","),
                  r = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                    return t.name.toLowerCase() == $.trim(o[0].toLowerCase());
                  })[0];
                app.data.setStory(0, "Tab 1", r.color),
                  i.setTabs(app.data.getStory()),
                  app.ui.mainView.activateLayer(0);
              }
            }
          }),
          (this.addFeature = function (t, n, a, o) {
            t && "click" == t.type && (t = null);
            var s = $(".entry.active").index();
            s < 0 && (s = 0);
            var d = app.map.getLayer(app.data.getShortlistLayerId()),
              u = -1;
            d.graphics.length &&
              (u = Math.max.apply(
                Math,
                d.graphics.map(function (t) {
                  return t.attributes.__OBJECTID;
                })
              ));
            var h = d.graphics.length + 1,
              g = $.grep(d.graphics, function (t) {
                return t.attributes.tab_id == s;
              });
            app.detailPanelBuilder.addSlide(g.length + 1, h, t);
            var b = g.length,
              v = s;
            v > 7 && (v %= 7);
            var y,
              w = app.data.getStory()[v].color,
              C = t && t.name ? t.name : "Unnamed Place",
              _ = t && t.thumb_url ? t.thumb_url : null;
            _ || (_ = t && t.pic_url ? t.pic_url : null),
              _ &&
                (y = $(
                  '<li tabindex="0" id="item' +
                    (b + 1) +
                    '" style="display:block"><div class="footer"><div class="blurb  ">' +
                    C +
                    '</div></div><div class="tileImage" style="outline: none; background-image: url(' +
                    _ +
                    ');"></div></li>'
                )),
              _ ||
                (y = $(
                  '<li tabindex="0" id="item' +
                    (b + 1) +
                    '" style="display:block"><div class="footer"><div class="blurb  ">' +
                    C +
                    '</div></div><div class="tileImage" style="outline: none;" ><i class=" fa fa-camera" aria-hidden="true"></i></div></li>'
                )),
              i.getGeneralOptions().numberedIcons &&
                $(y)
                  .find(".footer")
                  .prepend(
                    $(
                      '<div class="num" style="background-color:' +
                        w +
                        '">' +
                        (b + 1) +
                        "</div>"
                    )
                  ),
              e.find("#myList").append(y),
              $(y).data("shortlist-id", h),
              $(y).on("click", function () {
                var t = this;
                $("body").hasClass("organizeFeatures") ||
                  (app.detailPanelBuilder.showSlide(
                    $(this).data("shortlist-id")
                  ),
                  app.ui.mainView.preSelection(),
                  (app.ui.mainView.selected = $.grep(d.graphics, function (e) {
                    return (
                      e.attributes.shortlist_id == $(t).data("shortlist-id")
                    );
                  })[0]),
                  app.ui.mainView.postSelection());
              }),
              $(y).on("mouseover", app.ui.tilePanel.tile_onMouseOver),
              $(y).on("mouseout", app.ui.tilePanel.tile_onMouseOut),
              o || app.detailPanelBuilder.showSlide(h);
            var x,
              T = {
                __OBJECTID: u + 1,
                name: t && t.name ? t.name : "",
                description: t && t.description ? t.description : "",
                pic_url: t && t.pic_url ? t.pic_url : "",
                thumb_url: t && t.thumb_url ? t.thumb_url : "",
                shortlist_id: h,
                number: g.length + 1,
                tab_id: s,
                locationSet: a ? 1 : 0,
              };
            if (a) $(y).addClass("located"), (x = a);
            else {
              var E = 45,
                A = 45,
                I = 0;
              t && t.lng && t.lat
                ? ((E = t.lng), (A = t.lat), (I = 1), $(y).addClass("located"))
                : $(y)
                    .find(".tileImage")
                    .append(
                      '<div class="unlocated" style="outline: none;"></div>'
                    );
              var L = new r(E, A, new p({ wkid: 4326 }));
              (x = c.geographicToWebMercator(L)), (T.locationSet = I);
            }
            var P = new l(),
              D = new f(x, P, T),
              M = S.addMapIcon(D, app.data.getStory()[s].color);
            d.add(M),
              app.layerCurrent.add(M),
              g.push(M),
              T.locationSet || M.hide(),
              k.updateLocatedFeatures(),
              i.getTitle() && m.publish("BUILDER_INCREMENT_COUNTER");
          }),
          (this.exitOrganizeMode = function (t) {
            $("body").hasClass("organizeFeatures") &&
              app.ui.tilePanel.destroySortable(),
              $("#myList").find("li").removeClass("selected"),
              $(
                ".builder-content-panel .builder-content-panel-group"
              ).removeClass("disabled"),
              $(".builder-lbl").removeClass("disabled"),
              $(".builder-content-panel.inline .builder-btn").removeClass(
                "disabled"
              ),
              $(".located").show(),
              $("#addFeature").show(),
              $("#importFeature").show(),
              $("#organizeFeatures").show(),
              $("body").removeClass("locateFeatures"),
              k.updateLocatedFeatures(),
              $("#completeOrganization").hide(),
              $("#deleteFeatures").hide(),
              $("#moveFeaturesContainer").hide(),
              $("#myList").find("li").off(),
              $("#myList").find("li").click(app.ui.tilePanel.tile_onClick),
              $("#myList")
                .find("li")
                .mouseover(app.ui.tilePanel.tile_onMouseOver),
              $("#myList")
                .find("li")
                .mouseout(app.ui.tilePanel.tile_onMouseOut),
              app.layerCurrent.graphics.length
                ? t
                  ? app.detailPanelBuilder.buildAllSlides()
                  : app.detailPanelBuilder.buildSlides()
                : ($("#locateFeatures").hide(), $("#organizeFeatures").hide());
          }),
          (this.updateLocatedFeatures = function (t) {
            var e = [];
            app.layerCurrent && (e = app.layerCurrent.graphics);
            var i = t || $(".entry.active").index();
            i < 0 && (i = 0);
            var n = $.grep(e, function (t) {
              return t.attributes.tab_id == i;
            });
            setTimeout(function () {
              !n.length ||
              $("body").hasClass("organizeFeatures") ||
              $("body").hasClass("locateFeatures")
                ? $("#organizeFeatures").hide()
                : $("#organizeFeatures").show();
            }, 50);
            var a = $.grep(n, function (t) {
              return !t.attributes.locationSet;
            });
            if (
              ($(".unlocatedFeatures").text(a.length),
              a.length > 0 &&
                !$("body").hasClass("organizeFeatures") &&
                !$("body").hasClass("locateFeatures"))
            )
              $("#locateFeatures").show();
            else {
              if (app.isLoading) return;
              $("#locateFeatures").hide();
            }
            0 === a.length && $("#locateFeatures").hide(),
              0 === e.length && $("#organizeFeatures").hide();
          }),
          (this.updateNumber = function () {
            $.each($(".tilelist li"), function (t, e) {
              ($.grep(app.layerCurrent.graphics, function (t) {
                return t.attributes.shortlist_id == $(e).data("shortlist-id");
              })[0].attributes.number = t + 1),
                $(e).attr("id", "item" + t),
                $(e)
                  .find(".num")
                  .text(t + 1),
                app.layerCurrent.graphics.sort(function (t, e) {
                  return t.attributes.number - e.attributes.number;
                });
            });
            var t = $(".entry.active").index(),
              e = app.data.getStory()[t].color;
            $.each(app.layerCurrent.graphics, function (t, i) {
              S.addMapIcon(i, e, !0);
            }),
              app.map.getLayer(app.data.getShortlistLayerId()).redraw(),
              setTimeout(function () {
                app.detailPanelBuilder.buildSlides();
              }, 500),
              i.getTitle() && m.publish("BUILDER_INCREMENT_COUNTER");
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/DetailPanelBuilder",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="detailContainer swiper-container">\r\n\t<button type="button" class=\'detailClose ion-android-close\' style=""></button>\r\n\t<div class="detail-btn-container detail-btn-left">\r\n\t\t<div class="detail-btn ion-chevron-left" style="outline: none;"></div>\r\n\t</div>\r\n\t<div class="detail-btn-container detail-btn-right">\r\n\t\t<div class="detail-btn ion-chevron-right" style="outline: none;"></div>\r\n\t</div>\r\n\t<div class="detail-btn-container detail-btn-add" data-toggle="tooltip" title="Add another place">\r\n\t\t<div class="detail-btn" style="outline: none;"> + </div>\r\n\t</div>\r\n\t<div class="detailView swiper-wrapper"></div>\r\n</div>\r\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/DetailPanelBuilderSlide",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class=\'swiper-slide\'>\r\n\t<div class=\'detailHeader\'>\r\n\t\t<div class="detailFeatureNum" ></div>\r\n\t\t<div class=\'detailFeatureTitle\'></div>\r\n\t</div>\r\n\t<div class="detailTextContainer">\r\n\t\t<div class="detailPictureDiv uploader drag-area drag-default">\r\n\t\t\t<span class="uploadWait smallLoader hidden"></span>\r\n\t\t\t<img style="max-width: 506px; max-height: 493px;" >\r\n\t\t\t<div class="imagePicker">\r\n\t\t\t\t<span>' +
            (null == (__t = addImage) ? "" : __t) +
            '<span>\r\n\t\t\t</div>\r\n\t\t\t<div class="resources"></div>\r\n\t\t\t<div class="warningText"></div>\r\n\t\t</div>\r\n\t\t<div class=\'description detailFeatureDesc editable\'></div>\r\n\t\t<div class="website"></div>\r\n\t</div>\r\n\t<div class="editLocationContainer">\r\n\t\t<button class="setLocation btn btn-warning" >' +
            (null == (__t = setLocation) ? "" : __t) +
            '</button>\r\n\t\t<button class="editLocation btn btn-primary" >' +
            (null == (__t = changeLocation) ? "" : __t) +
            '</button>\r\n\t\t<button class="updateLocation btn btn-success" >' +
            (null == (__t = update) ? "" : __t) +
            '</button>\r\n\t\t<button class="cancelLocation btn btn-danger" >' +
            (null == (__t = cancel) ? "" : __t) +
            "</button>\r\n\t</div>\r\n</div>\r\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/DetailPanelBuilder",
    [],
    function () {}
  ),
  "classList" in document.createElement("_") ||
    (function (t) {
      "use strict";
      if ("Element" in t) {
        var e = t.Element.prototype,
          i = Object,
          n =
            String.prototype.trim ||
            function () {
              return this.replace(/^\s+|\s+$/g, "");
            },
          a =
            Array.prototype.indexOf ||
            function (t) {
              for (var e = 0, i = this.length; e < i; e++)
                if (e in this && this[e] === t) return e;
              return -1;
            },
          o = function (t, e) {
            (this.name = t), (this.code = DOMException[t]), (this.message = e);
          },
          r = function (t, e) {
            if ("" === e)
              throw new o(
                "SYNTAX_ERR",
                "An invalid or illegal string was specified"
              );
            if (/\s/.test(e))
              throw new o(
                "INVALID_CHARACTER_ERR",
                "String contains an invalid character"
              );
            return a.call(t, e);
          },
          s = function (t) {
            for (
              var e = n.call(t.getAttribute("class") || ""),
                i = e ? e.split(/\s+/) : [],
                a = 0,
                o = i.length;
              a < o;
              a++
            )
              this.push(i[a]);
            this._updateClassName = function () {
              t.setAttribute("class", this.toString());
            };
          },
          l = (s.prototype = []),
          d = function () {
            return new s(this);
          };
        if (
          ((o.prototype = Error.prototype),
          (l.item = function (t) {
            return this[t] || null;
          }),
          (l.contains = function (t) {
            return (t += ""), -1 !== r(this, t);
          }),
          (l.add = function () {
            var t,
              e = arguments,
              i = 0,
              n = e.length,
              a = !1;
            do {
              (t = e[i] + ""), -1 === r(this, t) && (this.push(t), (a = !0));
            } while (++i < n);
            a && this._updateClassName();
          }),
          (l.remove = function () {
            var t,
              e,
              i = arguments,
              n = 0,
              a = i.length,
              o = !1;
            do {
              for (t = i[n] + "", e = r(this, t); -1 !== e; )
                this.splice(e, 1), (o = !0), (e = r(this, t));
            } while (++n < a);
            o && this._updateClassName();
          }),
          (l.toggle = function (t, e) {
            t += "";
            var i = this.contains(t),
              n = i ? !0 !== e && "remove" : !1 !== e && "add";
            return n && this[n](t), !0 === e || !1 === e ? e : !i;
          }),
          (l.toString = function () {
            return this.join(" ");
          }),
          i.defineProperty)
        ) {
          var p = { get: d, enumerable: !0, configurable: !0 };
          try {
            i.defineProperty(e, "classList", p);
          } catch (t) {
            -2146823252 === t.number &&
              ((p.enumerable = !1), i.defineProperty(e, "classList", p));
          }
        } else
          i.prototype.__defineGetter__ && e.__defineGetter__("classList", d);
      }
    })(self),
  (function (t) {
    "use strict";
    if (((t.URL = t.URL || t.webkitURL), t.Blob && t.URL))
      try {
        return void new Blob();
      } catch (t) {}
    var e =
      t.BlobBuilder ||
      t.WebKitBlobBuilder ||
      t.MozBlobBuilder ||
      (function (t) {
        var e = function (t) {
            return Object.prototype.toString
              .call(t)
              .match(/^\[object\s(.*)\]$/)[1];
          },
          i = function () {
            this.data = [];
          },
          n = function (t, e, i) {
            (this.data = t),
              (this.size = t.length),
              (this.type = e),
              (this.encoding = i);
          },
          a = i.prototype,
          o = n.prototype,
          r = t.FileReaderSync,
          s = function (t) {
            this.code = this[(this.name = t)];
          },
          l =
            "NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(
              " "
            ),
          d = l.length,
          p = t.URL || t.webkitURL || t,
          c = p.createObjectURL,
          u = p.revokeObjectURL,
          h = p,
          f = t.btoa,
          m = t.atob,
          g = t.ArrayBuffer,
          b = t.Uint8Array,
          v = /^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;
        for (n.fake = o.fake = !0; d--; ) s.prototype[l[d]] = d + 1;
        return (
          p.createObjectURL ||
            (h = t.URL =
              function (t) {
                var e,
                  i = document.createElementNS(
                    "http://www.w3.org/1999/xhtml",
                    "a"
                  );
                return (
                  (i.href = t),
                  "origin" in i ||
                    ("data:" === i.protocol.toLowerCase()
                      ? (i.origin = null)
                      : ((e = t.match(v)), (i.origin = e && e[1]))),
                  i
                );
              }),
          (h.createObjectURL = function (t) {
            var e,
              i = t.type;
            return (
              null === i && (i = "application/octet-stream"),
              t instanceof n
                ? ((e = "data:" + i),
                  "base64" === t.encoding
                    ? e + ";base64," + t.data
                    : "URI" === t.encoding
                    ? e + "," + decodeURIComponent(t.data)
                    : f
                    ? e + ";base64," + f(t.data)
                    : e + "," + encodeURIComponent(t.data))
                : c
                ? c.call(p, t)
                : void 0
            );
          }),
          (h.revokeObjectURL = function (t) {
            "data:" !== t.substring(0, 5) && u && u.call(p, t);
          }),
          (a.append = function (t) {
            var i = this.data;
            if (b && (t instanceof g || t instanceof b)) {
              for (var a = "", o = new b(t), l = 0, d = o.length; l < d; l++)
                a += String.fromCharCode(o[l]);
              i.push(a);
            } else if ("Blob" === e(t) || "File" === e(t)) {
              if (!r) throw new s("NOT_READABLE_ERR");
              var p = new r();
              i.push(p.readAsBinaryString(t));
            } else
              t instanceof n
                ? "base64" === t.encoding && m
                  ? i.push(m(t.data))
                  : "URI" === t.encoding
                  ? i.push(decodeURIComponent(t.data))
                  : "raw" === t.encoding && i.push(t.data)
                : ("string" != typeof t && (t += ""),
                  i.push(unescape(encodeURIComponent(t))));
          }),
          (a.getBlob = function (t) {
            return (
              arguments.length || (t = null),
              new n(this.data.join(""), t, "raw")
            );
          }),
          (a.toString = function () {
            return "[object BlobBuilder]";
          }),
          (o.slice = function (t, e, i) {
            var a = arguments.length;
            return (
              a < 3 && (i = null),
              new n(
                this.data.slice(t, a > 1 ? e : this.data.length),
                i,
                this.encoding
              )
            );
          }),
          (o.toString = function () {
            return "[object Blob]";
          }),
          (o.close = function () {
            (this.size = 0), delete this.data;
          }),
          i
        );
      })(t);
    t.Blob = function (t, i) {
      var n = i ? i.type || "" : "",
        a = new e();
      if (t)
        for (var o = 0, r = t.length; o < r; o++)
          Uint8Array && t[o] instanceof Uint8Array
            ? a.append(t[o].buffer)
            : a.append(t[o]);
      var s = a.getBlob(n);
      return !s.slice && s.webkitSlice && (s.slice = s.webkitSlice), s;
    };
    var i =
      Object.getPrototypeOf ||
      function (t) {
        return t.__proto__;
      };
    t.Blob.prototype = i(new t.Blob());
  })(
    ("undefined" != typeof self && self) ||
      ("undefined" != typeof window && window) ||
      this.content ||
      this
  ),
  (function (t, e) {
    "use strict";
    ("object" == typeof module &&
      process &&
      process.versions &&
      process.versions.electron) ||
    "object" != typeof module
      ? "function" == typeof define && define.amd
        ? define(
            "lib-app/medium-editor/dist/js/medium-editor",
            [],
            function () {
              return e;
            }
          )
        : (t.MediumEditor = e)
      : (module.exports = e);
  })(
    this,
    (function () {
      "use strict";
      function t(t, e) {
        return this.init(t, e);
      }
      return (
        (t.extensions = {}),
        (function (e) {
          function i(t, e) {
            var i,
              n = Array.prototype.slice.call(arguments, 2);
            e = e || {};
            for (var a = 0; a < n.length; a++) {
              var o = n[a];
              if (o)
                for (i in o)
                  o.hasOwnProperty(i) &&
                    void 0 !== o[i] &&
                    (t || !1 === e.hasOwnProperty(i)) &&
                    (e[i] = o[i]);
            }
            return e;
          }
          var n = !1;
          try {
            var a = document.createElement("div"),
              o = document.createTextNode(" ");
            a.appendChild(o), (n = a.contains(o));
          } catch (t) {}
          var r = {
            isIE:
              "Microsoft Internet Explorer" === navigator.appName ||
              ("Netscape" === navigator.appName &&
                null !==
                  new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(
                    navigator.userAgent
                  )),
            isEdge: null !== /Edge\/\d+/.exec(navigator.userAgent),
            isFF: navigator.userAgent.toLowerCase().indexOf("firefox") > -1,
            isMac: e.navigator.platform.toUpperCase().indexOf("MAC") >= 0,
            keyCode: {
              BACKSPACE: 8,
              TAB: 9,
              ENTER: 13,
              ESCAPE: 27,
              SPACE: 32,
              DELETE: 46,
              K: 75,
              M: 77,
              V: 86,
            },
            isMetaCtrlKey: function (t) {
              return !!((r.isMac && t.metaKey) || (!r.isMac && t.ctrlKey));
            },
            isKey: function (t, e) {
              var i = r.getKeyCode(t);
              return !1 === Array.isArray(e) ? i === e : -1 !== e.indexOf(i);
            },
            getKeyCode: function (t) {
              var e = t.which;
              return (
                null === e &&
                  (e = null !== t.charCode ? t.charCode : t.keyCode),
                e
              );
            },
            blockContainerElementNames: [
              "p",
              "h1",
              "h2",
              "h3",
              "h4",
              "h5",
              "h6",
              "blockquote",
              "pre",
              "ul",
              "li",
              "ol",
              "address",
              "article",
              "aside",
              "audio",
              "canvas",
              "dd",
              "dl",
              "dt",
              "fieldset",
              "figcaption",
              "figure",
              "footer",
              "form",
              "header",
              "hgroup",
              "main",
              "nav",
              "noscript",
              "output",
              "section",
              "video",
              "table",
              "thead",
              "tbody",
              "tfoot",
              "tr",
              "th",
              "td",
            ],
            emptyElementNames: [
              "br",
              "col",
              "colgroup",
              "hr",
              "img",
              "input",
              "source",
              "wbr",
            ],
            extend: function () {
              var t = [!0].concat(Array.prototype.slice.call(arguments));
              return i.apply(this, t);
            },
            defaults: function () {
              var t = [!1].concat(Array.prototype.slice.call(arguments));
              return i.apply(this, t);
            },
            createLink: function (t, e, i, n) {
              var a = t.createElement("a");
              return (
                r.moveTextRangeIntoElement(e[0], e[e.length - 1], a),
                a.setAttribute("href", i),
                n && a.setAttribute("target", n),
                a
              );
            },
            findOrCreateMatchingTextNodes: function (t, e, i) {
              for (
                var n = t.createTreeWalker(e, NodeFilter.SHOW_ALL, null, !1),
                  a = [],
                  o = 0,
                  s = !1,
                  l = null,
                  d = null;
                null !== (l = n.nextNode());

              )
                if (!(l.nodeType > 3))
                  if (3 === l.nodeType) {
                    if (
                      (!s &&
                        i.start < o + l.nodeValue.length &&
                        ((s = !0),
                        (d = r.splitStartNodeIfNeeded(l, i.start, o))),
                      s && r.splitEndNodeIfNeeded(l, d, i.end, o),
                      s && o === i.end)
                    )
                      break;
                    if (s && o > i.end + 1)
                      throw new Error("PerformLinking overshot the target!");
                    s && a.push(d || l),
                      (o += l.nodeValue.length),
                      null !== d && ((o += d.nodeValue.length), n.nextNode()),
                      (d = null);
                  } else
                    "img" === l.tagName.toLowerCase() &&
                      (!s && i.start <= o && (s = !0), s && a.push(l));
              return a;
            },
            splitStartNodeIfNeeded: function (t, e, i) {
              return e !== i ? t.splitText(e - i) : null;
            },
            splitEndNodeIfNeeded: function (t, e, i, n) {
              var a, o;
              (a =
                n +
                (e || t).nodeValue.length +
                (e ? t.nodeValue.length : 0) -
                1),
                (o = (e || t).nodeValue.length - (a + 1 - i)),
                a >= i && n !== a && 0 !== o && (e || t).splitText(o);
            },
            splitByBlockElements: function (e) {
              if (3 !== e.nodeType && 1 !== e.nodeType) return [];
              var i = [],
                n = t.util.blockContainerElementNames.join(",");
              if (3 === e.nodeType || 0 === e.querySelectorAll(n).length)
                return [e];
              for (var a = 0; a < e.childNodes.length; a++) {
                var o = e.childNodes[a];
                if (3 === o.nodeType) i.push(o);
                else if (1 === o.nodeType) {
                  var r = o.querySelectorAll(n);
                  0 === r.length
                    ? i.push(o)
                    : (i = i.concat(t.util.splitByBlockElements(o)));
                }
              }
              return i;
            },
            findAdjacentTextNodeWithContent: function (t, e, i) {
              var n,
                a = !1,
                o = i.createNodeIterator(t, NodeFilter.SHOW_TEXT, null, !1);
              for (n = o.nextNode(); n; ) {
                if (n === e) a = !0;
                else if (
                  a &&
                  3 === n.nodeType &&
                  n.nodeValue &&
                  n.nodeValue.trim().length > 0
                )
                  break;
                n = o.nextNode();
              }
              return n;
            },
            findPreviousSibling: function (t) {
              if (!t || r.isMediumEditorElement(t)) return !1;
              for (
                var e = t.previousSibling;
                !e && !r.isMediumEditorElement(t.parentNode);

              )
                (t = t.parentNode), (e = t.previousSibling);
              return e;
            },
            isDescendant: function (t, e, i) {
              if (!t || !e) return !1;
              if (t === e) return !!i;
              if (1 !== t.nodeType) return !1;
              if (n || 3 !== e.nodeType) return t.contains(e);
              for (var a = e.parentNode; null !== a; ) {
                if (a === t) return !0;
                a = a.parentNode;
              }
              return !1;
            },
            isElement: function (t) {
              return !(!t || 1 !== t.nodeType);
            },
            throttle: function (t, e) {
              var i,
                n,
                a,
                o = null,
                r = 0,
                s = function () {
                  (r = Date.now()),
                    (o = null),
                    (a = t.apply(i, n)),
                    o || (i = n = null);
                };
              return (
                e || 0 === e || (e = 50),
                function () {
                  var l = Date.now(),
                    d = e - (l - r);
                  return (
                    (i = this),
                    (n = arguments),
                    d <= 0 || d > e
                      ? (o && (clearTimeout(o), (o = null)),
                        (r = l),
                        (a = t.apply(i, n)),
                        o || (i = n = null))
                      : o || (o = setTimeout(s, d)),
                    a
                  );
                }
              );
            },
            traverseUp: function (t, e) {
              if (!t) return !1;
              do {
                if (1 === t.nodeType) {
                  if (e(t)) return t;
                  if (r.isMediumEditorElement(t)) return !1;
                }
                t = t.parentNode;
              } while (t);
              return !1;
            },
            htmlEntities: function (t) {
              return String(t)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;");
            },
            insertHTMLCommand: function (e, i) {
              var n,
                a,
                o,
                s,
                l,
                d,
                p,
                c = !1,
                u = ["insertHTML", !1, i];
              if (!t.util.isEdge && e.queryCommandSupported("insertHTML"))
                try {
                  return e.execCommand.apply(e, u);
                } catch (t) {}
              if (((n = e.getSelection()), n.rangeCount)) {
                if (
                  ((a = n.getRangeAt(0)),
                  (p = a.commonAncestorContainer),
                  r.isMediumEditorElement(p) && !p.firstChild)
                )
                  a.selectNode(p.appendChild(e.createTextNode("")));
                else if (
                  (3 === p.nodeType &&
                    0 === a.startOffset &&
                    a.endOffset === p.nodeValue.length) ||
                  (3 !== p.nodeType && p.innerHTML === a.toString())
                ) {
                  for (
                    ;
                    !r.isMediumEditorElement(p) &&
                    p.parentNode &&
                    1 === p.parentNode.childNodes.length &&
                    !r.isMediumEditorElement(p.parentNode);

                  )
                    p = p.parentNode;
                  a.selectNode(p);
                }
                for (
                  a.deleteContents(),
                    o = e.createElement("div"),
                    o.innerHTML = i,
                    s = e.createDocumentFragment();
                  o.firstChild;

                )
                  (l = o.firstChild), (d = s.appendChild(l));
                a.insertNode(s),
                  d &&
                    ((a = a.cloneRange()),
                    a.setStartAfter(d),
                    a.collapse(!0),
                    t.selection.selectRange(e, a)),
                  (c = !0);
              }
              return (
                e.execCommand.callListeners &&
                  e.execCommand.callListeners(u, c),
                c
              );
            },
            execFormatBlock: function (e, i) {
              var n,
                a = r.getTopBlockContainer(t.selection.getSelectionStart(e));
              if ("blockquote" === i) {
                if (
                  a &&
                  ((n = Array.prototype.slice.call(a.childNodes)),
                  n.some(function (t) {
                    return r.isBlockContainer(t);
                  }))
                )
                  return e.execCommand("outdent", !1, null);
                if (r.isIE) return e.execCommand("indent", !1, i);
              }
              if (
                (a && i === a.nodeName.toLowerCase() && (i = "p"),
                r.isIE && (i = "<" + i + ">"),
                a && "blockquote" === a.nodeName.toLowerCase())
              ) {
                if (r.isIE && "<p>" === i)
                  return e.execCommand("outdent", !1, i);
                if ((r.isFF || r.isEdge) && "p" === i)
                  return (
                    (n = Array.prototype.slice.call(a.childNodes)),
                    n.some(function (t) {
                      return !r.isBlockContainer(t);
                    }) && e.execCommand("formatBlock", !1, i),
                    e.execCommand("outdent", !1, i)
                  );
              }
              return e.execCommand("formatBlock", !1, i);
            },
            setTargetBlank: function (t, e) {
              var i,
                n = e || !1;
              if ("a" === t.nodeName.toLowerCase()) t.target = "_blank";
              else
                for (
                  t = t.getElementsByTagName("a"), i = 0;
                  i < t.length;
                  i += 1
                )
                  (!1 !== n && n !== t[i].attributes.href.value) ||
                    (t[i].target = "_blank");
            },
            removeTargetBlank: function (t, e) {
              var i;
              if ("a" === t.nodeName.toLowerCase()) t.removeAttribute("target");
              else
                for (
                  t = t.getElementsByTagName("a"), i = 0;
                  i < t.length;
                  i += 1
                )
                  e === t[i].attributes.href.value &&
                    t[i].removeAttribute("target");
            },
            addClassToAnchors: function (t, e) {
              var i,
                n,
                a = e.split(" ");
              if ("a" === t.nodeName.toLowerCase())
                for (n = 0; n < a.length; n += 1) t.classList.add(a[n]);
              else
                for (
                  t = t.getElementsByTagName("a"), i = 0;
                  i < t.length;
                  i += 1
                )
                  for (n = 0; n < a.length; n += 1) t[i].classList.add(a[n]);
            },
            isListItem: function (t) {
              if (!t) return !1;
              if ("li" === t.nodeName.toLowerCase()) return !0;
              for (
                var e = t.parentNode, i = e.nodeName.toLowerCase();
                "li" === i || (!r.isBlockContainer(e) && "div" !== i);

              ) {
                if ("li" === i) return !0;
                if (!(e = e.parentNode)) return !1;
                i = e.nodeName.toLowerCase();
              }
              return !1;
            },
            cleanListDOM: function (e, i) {
              if ("li" === i.nodeName.toLowerCase()) {
                var n = i.parentElement;
                "p" === n.parentElement.nodeName.toLowerCase() &&
                  (r.unwrap(n.parentElement, e),
                  t.selection.moveCursor(
                    e,
                    i.firstChild,
                    i.firstChild.textContent.length
                  ));
              }
            },
            splitOffDOMTree: function (t, e, i) {
              for (var n = e, a = null, o = !i; n !== t; ) {
                var r,
                  s = n.parentNode,
                  l = s.cloneNode(!1),
                  d = o ? n : s.firstChild;
                for (a && (o ? l.appendChild(a) : (r = a)), a = l; d; ) {
                  var p = d.nextSibling;
                  d === n
                    ? (d.hasChildNodes()
                        ? (d = d.cloneNode(!1))
                        : d.parentNode.removeChild(d),
                      d.textContent && a.appendChild(d),
                      (d = o ? p : null))
                    : (d.parentNode.removeChild(d),
                      (d.hasChildNodes() || d.textContent) && a.appendChild(d),
                      (d = p));
                }
                r && a.appendChild(r), (n = s);
              }
              return a;
            },
            moveTextRangeIntoElement: function (t, e, i) {
              if (!t || !e) return !1;
              var n = r.findCommonRoot(t, e);
              if (!n) return !1;
              if (e === t) {
                var a = t.parentNode,
                  o = t.nextSibling;
                return (
                  a.removeChild(t),
                  i.appendChild(t),
                  o ? a.insertBefore(i, o) : a.appendChild(i),
                  i.hasChildNodes()
                );
              }
              for (var s, l, d, p = [], c = 0; c < n.childNodes.length; c++)
                if (((d = n.childNodes[c]), s)) {
                  if (r.isDescendant(d, e, !0)) {
                    l = d;
                    break;
                  }
                  p.push(d);
                } else r.isDescendant(d, t, !0) && (s = d);
              var u = l.nextSibling,
                h = n.ownerDocument.createDocumentFragment();
              return (
                s === t
                  ? (s.parentNode.removeChild(s), h.appendChild(s))
                  : h.appendChild(r.splitOffDOMTree(s, t)),
                p.forEach(function (t) {
                  t.parentNode.removeChild(t), h.appendChild(t);
                }),
                l === e
                  ? (l.parentNode.removeChild(l), h.appendChild(l))
                  : h.appendChild(r.splitOffDOMTree(l, e, !0)),
                i.appendChild(h),
                l.parentNode === n
                  ? n.insertBefore(i, l)
                  : u
                  ? n.insertBefore(i, u)
                  : n.appendChild(i),
                i.hasChildNodes()
              );
            },
            depthOfNode: function (t) {
              for (var e = 0, i = t; null !== i.parentNode; )
                (i = i.parentNode), e++;
              return e;
            },
            findCommonRoot: function (t, e) {
              for (
                var i = r.depthOfNode(t), n = r.depthOfNode(e), a = t, o = e;
                i !== n;

              )
                i > n
                  ? ((a = a.parentNode), (i -= 1))
                  : ((o = o.parentNode), (n -= 1));
              for (; a !== o; ) (a = a.parentNode), (o = o.parentNode);
              return a;
            },
            isElementAtBeginningOfBlock: function (t) {
              for (
                var e, i;
                !r.isBlockContainer(t) && !r.isMediumEditorElement(t);

              ) {
                for (i = t; (i = i.previousSibling); )
                  if (
                    ((e = 3 === i.nodeType ? i.nodeValue : i.textContent),
                    e.length > 0)
                  )
                    return !1;
                t = t.parentNode;
              }
              return !0;
            },
            isMediumEditorElement: function (t) {
              return (
                t &&
                t.getAttribute &&
                !!t.getAttribute("data-medium-editor-element")
              );
            },
            getContainerEditorElement: function (t) {
              return r.traverseUp(t, function (t) {
                return r.isMediumEditorElement(t);
              });
            },
            isBlockContainer: function (t) {
              return (
                t &&
                3 !== t.nodeType &&
                -1 !==
                  r.blockContainerElementNames.indexOf(t.nodeName.toLowerCase())
              );
            },
            getClosestBlockContainer: function (t) {
              return r.traverseUp(t, function (t) {
                return r.isBlockContainer(t) || r.isMediumEditorElement(t);
              });
            },
            getTopBlockContainer: function (t) {
              var e = !!r.isBlockContainer(t) && t;
              return (
                r.traverseUp(t, function (t) {
                  return (
                    r.isBlockContainer(t) && (e = t),
                    !(e || !r.isMediumEditorElement(t)) && ((e = t), !0)
                  );
                }),
                e
              );
            },
            getFirstSelectableLeafNode: function (t) {
              for (; t && t.firstChild; ) t = t.firstChild;
              if (
                ((t = r.traverseUp(t, function (t) {
                  return (
                    -1 === r.emptyElementNames.indexOf(t.nodeName.toLowerCase())
                  );
                })),
                "table" === t.nodeName.toLowerCase())
              ) {
                var e = t.querySelector("th, td");
                e && (t = e);
              }
              return t;
            },
            getFirstTextNode: function (t) {
              return (
                r.warn(
                  "getFirstTextNode is deprecated and will be removed in version 6.0.0"
                ),
                r._getFirstTextNode(t)
              );
            },
            _getFirstTextNode: function (t) {
              if (3 === t.nodeType) return t;
              for (var e = 0; e < t.childNodes.length; e++) {
                var i = r._getFirstTextNode(t.childNodes[e]);
                if (null !== i) return i;
              }
              return null;
            },
            ensureUrlHasProtocol: function (t) {
              return -1 === t.indexOf("://") ? "http://" + t : t;
            },
            warn: function () {
              void 0 !== e.console &&
                "function" == typeof e.console.warn &&
                e.console.warn.apply(e.console, arguments);
            },
            deprecated: function (t, e, i) {
              var n = t + " is deprecated, please use " + e + " instead.";
              i && (n += " Will be removed in " + i), r.warn(n);
            },
            deprecatedMethod: function (t, e, i, n) {
              r.deprecated(t, e, n),
                "function" == typeof this[e] && this[e].apply(this, i);
            },
            cleanupAttrs: function (t, e) {
              e.forEach(function (e) {
                t.removeAttribute(e);
              });
            },
            cleanupTags: function (t, e) {
              e.forEach(function (e) {
                t.nodeName.toLowerCase() === e && t.parentNode.removeChild(t);
              });
            },
            getClosestTag: function (t, e) {
              return r.traverseUp(t, function (t) {
                return t.nodeName.toLowerCase() === e.toLowerCase();
              });
            },
            unwrap: function (t, e) {
              for (
                var i = e.createDocumentFragment(),
                  n = Array.prototype.slice.call(t.childNodes),
                  a = 0;
                a < n.length;
                a++
              )
                i.appendChild(n[a]);
              i.childNodes.length
                ? t.parentNode.replaceChild(i, t)
                : t.parentNode.removeChild(t);
            },
            guid: function () {
              function t() {
                return Math.floor(65536 * (1 + Math.random()))
                  .toString(16)
                  .substring(1);
              }
              return (
                t() +
                t() +
                "-" +
                t() +
                "-" +
                t() +
                "-" +
                t() +
                "-" +
                t() +
                t() +
                t()
              );
            },
          };
          t.util = r;
        })(window),
        (function () {
          var e = function (e) {
            t.util.extend(this, e);
          };
          (e.extend = function (e) {
            var i,
              n = this;
            (i =
              e && e.hasOwnProperty("constructor")
                ? e.constructor
                : function () {
                    return n.apply(this, arguments);
                  }),
              t.util.extend(i, n);
            var a = function () {
              this.constructor = i;
            };
            return (
              (a.prototype = n.prototype),
              (i.prototype = new a()),
              e && t.util.extend(i.prototype, e),
              i
            );
          }),
            (e.prototype = {
              init: function () {},
              base: void 0,
              name: void 0,
              checkState: void 0,
              destroy: void 0,
              queryCommandState: void 0,
              isActive: void 0,
              isAlreadyApplied: void 0,
              setActive: void 0,
              setInactive: void 0,
              getInteractionElements: void 0,
              window: void 0,
              document: void 0,
              getEditorElements: function () {
                return this.base.elements;
              },
              getEditorId: function () {
                return this.base.id;
              },
              getEditorOption: function (t) {
                return this.base.options[t];
              },
            }),
            ["execAction", "on", "off", "subscribe", "trigger"].forEach(
              function (t) {
                e.prototype[t] = function () {
                  return this.base[t].apply(this.base, arguments);
                };
              }
            ),
            (t.Extension = e);
        })(),
        (function () {
          function e(e) {
            return t.util.isBlockContainer(e)
              ? NodeFilter.FILTER_ACCEPT
              : NodeFilter.FILTER_SKIP;
          }
          var i = {
            findMatchingSelectionParent: function (e, i) {
              var n,
                a,
                o = i.getSelection();
              return (
                0 !== o.rangeCount &&
                ((n = o.getRangeAt(0)),
                (a = n.commonAncestorContainer),
                t.util.traverseUp(a, e))
              );
            },
            getSelectionElement: function (e) {
              return this.findMatchingSelectionParent(function (e) {
                return t.util.isMediumEditorElement(e);
              }, e);
            },
            exportSelection: function (t, e) {
              if (!t) return null;
              var i = null,
                n = e.getSelection();
              if (n.rangeCount > 0) {
                var a,
                  o = n.getRangeAt(0),
                  r = o.cloneRange();
                r.selectNodeContents(t),
                  r.setEnd(o.startContainer, o.startOffset),
                  (a = r.toString().length),
                  (i = { start: a, end: a + o.toString().length }),
                  this.doesRangeStartWithImages(o, e) &&
                    (i.startsWithImage = !0);
                var s = this.getTrailingImageCount(
                  t,
                  i,
                  o.endContainer,
                  o.endOffset
                );
                if ((s && (i.trailingImageCount = s), 0 !== a)) {
                  var l = this.getIndexRelativeToAdjacentEmptyBlocks(
                    e,
                    t,
                    o.startContainer,
                    o.startOffset
                  );
                  -1 !== l && (i.emptyBlocksIndex = l);
                }
              }
              return i;
            },
            importSelection: function (t, e, i, n) {
              if (t && e) {
                var a = i.createRange();
                a.setStart(e, 0), a.collapse(!0);
                var o,
                  r = e,
                  s = [],
                  l = 0,
                  d = !1,
                  p = !1,
                  c = 0,
                  u = !1,
                  h = !1,
                  f = null;
                for (
                  (n || t.startsWithImage || void 0 !== t.emptyBlocksIndex) &&
                  (h = !0);
                  !u && r;

                )
                  if (r.nodeType > 3) r = s.pop();
                  else {
                    if (3 !== r.nodeType || p) {
                      if (
                        t.trailingImageCount &&
                        p &&
                        ("img" === r.nodeName.toLowerCase() && c++,
                        c === t.trailingImageCount)
                      ) {
                        for (var m = 0; r.parentNode.childNodes[m] !== r; ) m++;
                        a.setEnd(r.parentNode, m + 1), (u = !0);
                      }
                      if (!u && 1 === r.nodeType)
                        for (var g = r.childNodes.length - 1; g >= 0; )
                          s.push(r.childNodes[g]), (g -= 1);
                    } else
                      (o = l + r.length),
                        !d &&
                          t.start >= l &&
                          t.start <= o &&
                          (h || t.start < o
                            ? (a.setStart(r, t.start - l), (d = !0))
                            : (f = r)),
                        d &&
                          t.end >= l &&
                          t.end <= o &&
                          (t.trailingImageCount
                            ? (p = !0)
                            : (a.setEnd(r, t.end - l), (u = !0))),
                        (l = o);
                    u || (r = s.pop());
                  }
                !d && f && (a.setStart(f, f.length), a.setEnd(f, f.length)),
                  void 0 !== t.emptyBlocksIndex &&
                    (a = this.importSelectionMoveCursorPastBlocks(
                      i,
                      e,
                      t.emptyBlocksIndex,
                      a
                    )),
                  n && (a = this.importSelectionMoveCursorPastAnchor(t, a)),
                  this.selectRange(i, a);
              }
            },
            importSelectionMoveCursorPastAnchor: function (e, i) {
              var n = function (t) {
                return "a" === t.nodeName.toLowerCase();
              };
              if (
                e.start === e.end &&
                3 === i.startContainer.nodeType &&
                i.startOffset === i.startContainer.nodeValue.length &&
                t.util.traverseUp(i.startContainer, n)
              ) {
                for (
                  var a = i.startContainer, o = i.startContainer.parentNode;
                  null !== o && "a" !== o.nodeName.toLowerCase();

                )
                  o.childNodes[o.childNodes.length - 1] !== a
                    ? (o = null)
                    : ((a = o), (o = o.parentNode));
                if (null !== o && "a" === o.nodeName.toLowerCase()) {
                  for (
                    var r = null, s = 0;
                    null === r && s < o.parentNode.childNodes.length;
                    s++
                  )
                    o.parentNode.childNodes[s] === o && (r = s);
                  i.setStart(o.parentNode, r + 1), i.collapse(!0);
                }
              }
              return i;
            },
            importSelectionMoveCursorPastBlocks: function (i, n, a, o) {
              var r,
                s,
                l = i.createTreeWalker(n, NodeFilter.SHOW_ELEMENT, e, !1),
                d = o.startContainer,
                p = 0;
              for (
                a = a || 1,
                  r =
                    3 === d.nodeType &&
                    t.util.isBlockContainer(d.previousSibling)
                      ? d.previousSibling
                      : t.util.getClosestBlockContainer(d);
                l.nextNode();

              )
                if (s) {
                  if (((s = l.currentNode), ++p === a)) break;
                  if (s.textContent.length > 0) break;
                } else r === l.currentNode && (s = l.currentNode);
              return (
                s || (s = r),
                o.setStart(t.util.getFirstSelectableLeafNode(s), 0),
                o
              );
            },
            getIndexRelativeToAdjacentEmptyBlocks: function (i, n, a, o) {
              if (a.textContent.length > 0 && o > 0) return -1;
              var r = a;
              if ((3 !== r.nodeType && (r = a.childNodes[o]), r)) {
                if (!t.util.isElementAtBeginningOfBlock(r)) return -1;
                var s = t.util.findPreviousSibling(r);
                if (!s) return -1;
                if (s.nodeValue) return -1;
              }
              for (
                var l = t.util.getClosestBlockContainer(a),
                  d = i.createTreeWalker(n, NodeFilter.SHOW_ELEMENT, e, !1),
                  p = 0;
                d.nextNode();

              ) {
                var c = "" === d.currentNode.textContent;
                if (((c || p > 0) && (p += 1), d.currentNode === l)) return p;
                c || (p = 0);
              }
              return p;
            },
            doesRangeStartWithImages: function (t, e) {
              if (0 !== t.startOffset || 1 !== t.startContainer.nodeType)
                return !1;
              if ("img" === t.startContainer.nodeName.toLowerCase()) return !0;
              var i = t.startContainer.querySelector("img");
              if (!i) return !1;
              for (
                var n = e.createTreeWalker(
                  t.startContainer,
                  NodeFilter.SHOW_ALL,
                  null,
                  !1
                );
                n.nextNode();

              ) {
                var a = n.currentNode;
                if (a === i) break;
                if (a.nodeValue) return !1;
              }
              return !0;
            },
            getTrailingImageCount: function (t, e, i, n) {
              if (0 === n || 1 !== i.nodeType) return 0;
              if ("img" !== i.nodeName.toLowerCase() && !i.querySelector("img"))
                return 0;
              for (var a = i.childNodes[n - 1]; a.hasChildNodes(); )
                a = a.lastChild;
              for (
                var o, r = t, s = [], l = 0, d = !1, p = !1, c = !1, u = 0;
                !c && r;

              )
                if (r.nodeType > 3) r = s.pop();
                else {
                  if (3 !== r.nodeType || p) {
                    if (("img" === r.nodeName.toLowerCase() && u++, r === a))
                      c = !0;
                    else if (1 === r.nodeType)
                      for (var h = r.childNodes.length - 1; h >= 0; )
                        s.push(r.childNodes[h]), (h -= 1);
                  } else
                    (u = 0),
                      (o = l + r.length),
                      !d && e.start >= l && e.start <= o && (d = !0),
                      d && e.end >= l && e.end <= o && (p = !0),
                      (l = o);
                  c || (r = s.pop());
                }
              return u;
            },
            selectionContainsContent: function (t) {
              var e = t.getSelection();
              if (!e || e.isCollapsed || !e.rangeCount) return !1;
              if ("" !== e.toString().trim()) return !0;
              var i = this.getSelectedParentElement(e.getRangeAt(0));
              return !(
                !i ||
                !(
                  "img" === i.nodeName.toLowerCase() ||
                  (1 === i.nodeType && i.querySelector("img"))
                )
              );
            },
            selectionInContentEditableFalse: function (t) {
              var e,
                i = this.findMatchingSelectionParent(function (t) {
                  var i = t && t.getAttribute("contenteditable");
                  return (
                    "true" === i && (e = !0),
                    "#text" !== t.nodeName && "false" === i
                  );
                }, t);
              return !e && i;
            },
            getSelectionHtml: function (t) {
              var e,
                i,
                n,
                a = "",
                o = t.getSelection();
              if (o.rangeCount) {
                for (
                  n = t.createElement("div"), e = 0, i = o.rangeCount;
                  e < i;
                  e += 1
                )
                  n.appendChild(o.getRangeAt(e).cloneContents());
                a = n.innerHTML;
              }
              return a;
            },
            getCaretOffsets: function (t, e) {
              var i, n;
              return (
                e || (e = window.getSelection().getRangeAt(0)),
                (i = e.cloneRange()),
                (n = e.cloneRange()),
                i.selectNodeContents(t),
                i.setEnd(e.endContainer, e.endOffset),
                n.selectNodeContents(t),
                n.setStart(e.endContainer, e.endOffset),
                { left: i.toString().length, right: n.toString().length }
              );
            },
            rangeSelectsSingleNode: function (t) {
              var e = t.startContainer;
              return (
                e === t.endContainer &&
                e.hasChildNodes() &&
                t.endOffset === t.startOffset + 1
              );
            },
            getSelectedParentElement: function (t) {
              return t
                ? this.rangeSelectsSingleNode(t) &&
                  3 !== t.startContainer.childNodes[t.startOffset].nodeType
                  ? t.startContainer.childNodes[t.startOffset]
                  : 3 === t.startContainer.nodeType
                  ? t.startContainer.parentNode
                  : t.startContainer
                : null;
            },
            getSelectedElements: function (t) {
              var e,
                i,
                n,
                a = t.getSelection();
              if (
                !a.rangeCount ||
                a.isCollapsed ||
                !a.getRangeAt(0).commonAncestorContainer
              )
                return [];
              if (
                ((e = a.getRangeAt(0)),
                3 === e.commonAncestorContainer.nodeType)
              ) {
                for (
                  i = [], n = e.commonAncestorContainer;
                  n.parentNode && 1 === n.parentNode.childNodes.length;

                )
                  i.push(n.parentNode), (n = n.parentNode);
                return i;
              }
              return [].filter.call(
                e.commonAncestorContainer.getElementsByTagName("*"),
                function (t) {
                  return (
                    "function" != typeof a.containsNode || a.containsNode(t, !0)
                  );
                }
              );
            },
            selectNode: function (t, e) {
              var i = e.createRange();
              i.selectNodeContents(t), this.selectRange(e, i);
            },
            select: function (t, e, i, n, a) {
              var o = t.createRange();
              return (
                o.setStart(e, i),
                n ? o.setEnd(n, a) : o.collapse(!0),
                this.selectRange(t, o),
                o
              );
            },
            clearSelection: function (t, e) {
              e
                ? t.getSelection().collapseToStart()
                : t.getSelection().collapseToEnd();
            },
            moveCursor: function (t, e, i) {
              this.select(t, e, i);
            },
            getSelectionRange: function (t) {
              var e = t.getSelection();
              return 0 === e.rangeCount ? null : e.getRangeAt(0);
            },
            selectRange: function (t, e) {
              var i = t.getSelection();
              i.removeAllRanges(), i.addRange(e);
            },
            getSelectionStart: function (t) {
              var e = t.getSelection().anchorNode;
              return e && 3 === e.nodeType ? e.parentNode : e;
            },
          };
          t.selection = i;
        })(),
        (function () {
          function e(e, i) {
            return e.some(function (e) {
              if ("function" != typeof e.getInteractionElements) return !1;
              var n = e.getInteractionElements();
              return (
                !!n &&
                (Array.isArray(n) || (n = [n]),
                n.some(function (e) {
                  return t.util.isDescendant(e, i, !0);
                }))
              );
            });
          }
          var i = function (t) {
            (this.base = t),
              (this.options = this.base.options),
              (this.events = []),
              (this.disabledEvents = {}),
              (this.customEvents = {}),
              (this.listeners = {});
          };
          (i.prototype = {
            InputEventOnContenteditableSupported:
              !t.util.isIE && !t.util.isEdge,
            attachDOMEvent: function (e, i, n, a) {
              (e =
                t.util.isElement(e) || [window, document].indexOf(e) > -1
                  ? [e]
                  : e),
                Array.prototype.forEach.call(
                  e,
                  function (t) {
                    t.addEventListener(i, n, a), this.events.push([t, i, n, a]);
                  }.bind(this)
                );
            },
            detachDOMEvent: function (e, i, n, a) {
              var o, r;
              (e =
                t.util.isElement(e) || [window, document].indexOf(e) > -1
                  ? [e]
                  : e),
                Array.prototype.forEach.call(
                  e,
                  function (t) {
                    -1 !== (o = this.indexOfListener(t, i, n, a)) &&
                      ((r = this.events.splice(o, 1)[0]),
                      r[0].removeEventListener(r[1], r[2], r[3]));
                  }.bind(this)
                );
            },
            indexOfListener: function (t, e, i, n) {
              var a, o, r;
              for (a = 0, o = this.events.length; a < o; a += 1)
                if (
                  ((r = this.events[a]),
                  r[0] === t && r[1] === e && r[2] === i && r[3] === n)
                )
                  return a;
              return -1;
            },
            detachAllDOMEvents: function () {
              for (var t = this.events.pop(); t; )
                t[0].removeEventListener(t[1], t[2], t[3]),
                  (t = this.events.pop());
            },
            detachAllEventsFromElement: function (t) {
              for (
                var e = this.events.filter(function (e) {
                    return (
                      e &&
                      e[0].getAttribute &&
                      e[0].getAttribute("medium-editor-index") ===
                        t.getAttribute("medium-editor-index")
                    );
                  }),
                  i = 0,
                  n = e.length;
                i < n;
                i++
              ) {
                var a = e[i];
                this.detachDOMEvent(a[0], a[1], a[2], a[3]);
              }
            },
            attachAllEventsToElement: function (t) {
              this.listeners.editableInput &&
                (this.contentCache[t.getAttribute("medium-editor-index")] =
                  t.innerHTML),
                this.eventsCache &&
                  this.eventsCache.forEach(function (e) {
                    this.attachDOMEvent(t, e.name, e.handler.bind(this));
                  }, this);
            },
            enableCustomEvent: function (t) {
              void 0 !== this.disabledEvents[t] &&
                delete this.disabledEvents[t];
            },
            disableCustomEvent: function (t) {
              this.disabledEvents[t] = !0;
            },
            attachCustomEvent: function (t, e) {
              this.setupListener(t),
                this.customEvents[t] || (this.customEvents[t] = []),
                this.customEvents[t].push(e);
            },
            detachCustomEvent: function (t, e) {
              var i = this.indexOfCustomListener(t, e);
              -1 !== i && this.customEvents[t].splice(i, 1);
            },
            indexOfCustomListener: function (t, e) {
              return this.customEvents[t] && this.customEvents[t].length
                ? this.customEvents[t].indexOf(e)
                : -1;
            },
            detachAllCustomEvents: function () {
              this.customEvents = {};
            },
            triggerCustomEvent: function (t, e, i) {
              this.customEvents[t] &&
                !this.disabledEvents[t] &&
                this.customEvents[t].forEach(function (t) {
                  t(e, i);
                });
            },
            destroy: function () {
              this.detachAllDOMEvents(),
                this.detachAllCustomEvents(),
                this.detachExecCommand(),
                this.base.elements &&
                  this.base.elements.forEach(function (t) {
                    t.removeAttribute("data-medium-focused");
                  });
            },
            attachToExecCommand: function () {
              this.execCommandListener ||
                ((this.execCommandListener = function (t) {
                  this.handleDocumentExecCommand(t);
                }.bind(this)),
                this.wrapExecCommand(),
                this.options.ownerDocument.execCommand.listeners.push(
                  this.execCommandListener
                ));
            },
            detachExecCommand: function () {
              var t = this.options.ownerDocument;
              if (this.execCommandListener && t.execCommand.listeners) {
                var e = t.execCommand.listeners.indexOf(
                  this.execCommandListener
                );
                -1 !== e && t.execCommand.listeners.splice(e, 1),
                  t.execCommand.listeners.length || this.unwrapExecCommand();
              }
            },
            wrapExecCommand: function () {
              var t = this.options.ownerDocument;
              if (!t.execCommand.listeners) {
                var e = function (e, i) {
                    t.execCommand.listeners &&
                      t.execCommand.listeners.forEach(function (t) {
                        t({ command: e[0], value: e[2], args: e, result: i });
                      });
                  },
                  i = function () {
                    var i = t.execCommand.orig.apply(this, arguments);
                    if (!t.execCommand.listeners) return i;
                    var n = Array.prototype.slice.call(arguments);
                    return e(n, i), i;
                  };
                (i.orig = t.execCommand),
                  (i.listeners = []),
                  (i.callListeners = e),
                  (t.execCommand = i);
              }
            },
            unwrapExecCommand: function () {
              var t = this.options.ownerDocument;
              t.execCommand.orig && (t.execCommand = t.execCommand.orig);
            },
            setupListener: function (t) {
              if (!this.listeners[t]) {
                switch (t) {
                  case "externalInteraction":
                    this.attachDOMEvent(
                      this.options.ownerDocument.body,
                      "mousedown",
                      this.handleBodyMousedown.bind(this),
                      !0
                    ),
                      this.attachDOMEvent(
                        this.options.ownerDocument.body,
                        "click",
                        this.handleBodyClick.bind(this),
                        !0
                      ),
                      this.attachDOMEvent(
                        this.options.ownerDocument.body,
                        "focus",
                        this.handleBodyFocus.bind(this),
                        !0
                      );
                    break;
                  case "blur":
                  case "focus":
                    this.setupListener("externalInteraction");
                    break;
                  case "editableInput":
                    (this.contentCache = {}),
                      this.base.elements.forEach(function (t) {
                        this.contentCache[
                          t.getAttribute("medium-editor-index")
                        ] = t.innerHTML;
                      }, this),
                      this.InputEventOnContenteditableSupported &&
                        this.attachToEachElement("input", this.handleInput),
                      this.InputEventOnContenteditableSupported ||
                        (this.setupListener("editableKeypress"),
                        (this.keypressUpdateInput = !0),
                        this.attachDOMEvent(
                          document,
                          "selectionchange",
                          this.handleDocumentSelectionChange.bind(this)
                        ),
                        this.attachToExecCommand());
                    break;
                  case "editableClick":
                    this.attachToEachElement("click", this.handleClick);
                    break;
                  case "editableBlur":
                    this.attachToEachElement("blur", this.handleBlur);
                    break;
                  case "editableKeypress":
                    this.attachToEachElement("keypress", this.handleKeypress);
                    break;
                  case "editableKeyup":
                    this.attachToEachElement("keyup", this.handleKeyup);
                    break;
                  case "editableKeydown":
                    this.attachToEachElement("keydown", this.handleKeydown);
                    break;
                  case "editableKeydownSpace":
                  case "editableKeydownEnter":
                  case "editableKeydownTab":
                  case "editableKeydownDelete":
                    this.setupListener("editableKeydown");
                    break;
                  case "editableMouseover":
                    this.attachToEachElement("mouseover", this.handleMouseover);
                    break;
                  case "editableDrag":
                    this.attachToEachElement("dragover", this.handleDragging),
                      this.attachToEachElement(
                        "dragleave",
                        this.handleDragging
                      );
                    break;
                  case "editableDrop":
                    this.attachToEachElement("drop", this.handleDrop);
                    break;
                  case "editablePaste":
                    this.attachToEachElement("paste", this.handlePaste);
                }
                this.listeners[t] = !0;
              }
            },
            attachToEachElement: function (t, e) {
              this.eventsCache || (this.eventsCache = []),
                this.base.elements.forEach(function (i) {
                  this.attachDOMEvent(i, t, e.bind(this));
                }, this),
                this.eventsCache.push({ name: t, handler: e });
            },
            cleanupElement: function (t) {
              var e = t.getAttribute("medium-editor-index");
              e &&
                (this.detachAllEventsFromElement(t),
                this.contentCache && delete this.contentCache[e]);
            },
            focusElement: function (t) {
              t.focus(), this.updateFocus(t, { target: t, type: "focus" });
            },
            updateFocus: function (i, n) {
              var a,
                o = this.base.getFocusedElement();
              o &&
                "click" === n.type &&
                this.lastMousedownTarget &&
                (t.util.isDescendant(o, this.lastMousedownTarget, !0) ||
                  e(this.base.extensions, this.lastMousedownTarget)) &&
                (a = o),
                a ||
                  this.base.elements.some(function (e) {
                    return !a && t.util.isDescendant(e, i, !0) && (a = e), !!a;
                  }, this);
              var r =
                !t.util.isDescendant(o, i, !0) && !e(this.base.extensions, i);
              a !== o &&
                (o &&
                  r &&
                  (o.removeAttribute("data-medium-focused"),
                  this.triggerCustomEvent("blur", n, o)),
                a &&
                  (a.setAttribute("data-medium-focused", !0),
                  this.triggerCustomEvent("focus", n, a))),
                r && this.triggerCustomEvent("externalInteraction", n);
            },
            updateInput: function (t, e) {
              if (this.contentCache) {
                var i = t.getAttribute("medium-editor-index"),
                  n = t.innerHTML;
                n !== this.contentCache[i] &&
                  this.triggerCustomEvent("editableInput", e, t),
                  (this.contentCache[i] = n);
              }
            },
            handleDocumentSelectionChange: function (e) {
              if (e.currentTarget && e.currentTarget.activeElement) {
                var i,
                  n = e.currentTarget.activeElement;
                this.base.elements.some(function (e) {
                  return !!t.util.isDescendant(e, n, !0) && ((i = e), !0);
                }, this),
                  i && this.updateInput(i, { target: n, currentTarget: i });
              }
            },
            handleDocumentExecCommand: function () {
              var t = this.base.getFocusedElement();
              t && this.updateInput(t, { target: t, currentTarget: t });
            },
            handleBodyClick: function (t) {
              this.updateFocus(t.target, t);
            },
            handleBodyFocus: function (t) {
              this.updateFocus(t.target, t);
            },
            handleBodyMousedown: function (t) {
              this.lastMousedownTarget = t.target;
            },
            handleInput: function (t) {
              this.updateInput(t.currentTarget, t);
            },
            handleClick: function (t) {
              this.triggerCustomEvent("editableClick", t, t.currentTarget);
            },
            handleBlur: function (t) {
              this.triggerCustomEvent("editableBlur", t, t.currentTarget);
            },
            handleKeypress: function (t) {
              if (
                (this.triggerCustomEvent(
                  "editableKeypress",
                  t,
                  t.currentTarget
                ),
                this.keypressUpdateInput)
              ) {
                var e = { target: t.target, currentTarget: t.currentTarget };
                setTimeout(
                  function () {
                    this.updateInput(e.currentTarget, e);
                  }.bind(this),
                  0
                );
              }
            },
            handleKeyup: function (t) {
              this.triggerCustomEvent("editableKeyup", t, t.currentTarget);
            },
            handleMouseover: function (t) {
              this.triggerCustomEvent("editableMouseover", t, t.currentTarget);
            },
            handleDragging: function (t) {
              this.triggerCustomEvent("editableDrag", t, t.currentTarget);
            },
            handleDrop: function (t) {
              this.triggerCustomEvent("editableDrop", t, t.currentTarget);
            },
            handlePaste: function (t) {
              this.triggerCustomEvent("editablePaste", t, t.currentTarget);
            },
            handleKeydown: function (e) {
              return (
                this.triggerCustomEvent("editableKeydown", e, e.currentTarget),
                t.util.isKey(e, t.util.keyCode.SPACE)
                  ? this.triggerCustomEvent(
                      "editableKeydownSpace",
                      e,
                      e.currentTarget
                    )
                  : t.util.isKey(e, t.util.keyCode.ENTER) ||
                    (e.ctrlKey && t.util.isKey(e, t.util.keyCode.M))
                  ? this.triggerCustomEvent(
                      "editableKeydownEnter",
                      e,
                      e.currentTarget
                    )
                  : t.util.isKey(e, t.util.keyCode.TAB)
                  ? this.triggerCustomEvent(
                      "editableKeydownTab",
                      e,
                      e.currentTarget
                    )
                  : t.util.isKey(e, [
                      t.util.keyCode.DELETE,
                      t.util.keyCode.BACKSPACE,
                    ])
                  ? this.triggerCustomEvent(
                      "editableKeydownDelete",
                      e,
                      e.currentTarget
                    )
                  : void 0
              );
            },
          }),
            (t.Events = i);
        })(),
        (function () {
          var e = t.Extension.extend({
            action: void 0,
            aria: void 0,
            tagNames: void 0,
            style: void 0,
            useQueryState: void 0,
            contentDefault: void 0,
            contentFA: void 0,
            classList: void 0,
            attrs: void 0,
            constructor: function (i) {
              e.isBuiltInButton(i)
                ? t.Extension.call(this, this.defaults[i])
                : t.Extension.call(this, i);
            },
            init: function () {
              t.Extension.prototype.init.apply(this, arguments),
                (this.button = this.createButton()),
                this.on(this.button, "click", this.handleClick.bind(this));
            },
            getButton: function () {
              return this.button;
            },
            getAction: function () {
              return "function" == typeof this.action
                ? this.action(this.base.options)
                : this.action;
            },
            getAria: function () {
              return "function" == typeof this.aria
                ? this.aria(this.base.options)
                : this.aria;
            },
            getTagNames: function () {
              return "function" == typeof this.tagNames
                ? this.tagNames(this.base.options)
                : this.tagNames;
            },
            createButton: function () {
              var t = this.document.createElement("button"),
                e = this.contentDefault,
                i = this.getAria(),
                n = this.getEditorOption("buttonLabels");
              return (
                t.classList.add("medium-editor-action"),
                t.classList.add("medium-editor-action-" + this.name),
                this.classList &&
                  this.classList.forEach(function (e) {
                    t.classList.add(e);
                  }),
                t.setAttribute("data-action", this.getAction()),
                i &&
                  (t.setAttribute("title", i), t.setAttribute("aria-label", i)),
                this.attrs &&
                  Object.keys(this.attrs).forEach(function (e) {
                    t.setAttribute(e, this.attrs[e]);
                  }, this),
                "fontawesome" === n && this.contentFA && (e = this.contentFA),
                (t.innerHTML = e),
                t
              );
            },
            handleClick: function (t) {
              t.preventDefault(), t.stopPropagation();
              var e = this.getAction();
              e && this.execAction(e);
            },
            isActive: function () {
              return this.button.classList.contains(
                this.getEditorOption("activeButtonClass")
              );
            },
            setInactive: function () {
              this.button.classList.remove(
                this.getEditorOption("activeButtonClass")
              ),
                delete this.knownState;
            },
            setActive: function () {
              this.button.classList.add(
                this.getEditorOption("activeButtonClass")
              ),
                delete this.knownState;
            },
            queryCommandState: function () {
              var t = null;
              return (
                this.useQueryState &&
                  (t = this.base.queryCommandState(this.getAction())),
                t
              );
            },
            isAlreadyApplied: function (t) {
              var e,
                i,
                n = !1,
                a = this.getTagNames();
              return !1 === this.knownState || !0 === this.knownState
                ? this.knownState
                : (a &&
                    a.length > 0 &&
                    (n = -1 !== a.indexOf(t.nodeName.toLowerCase())),
                  !n &&
                    this.style &&
                    ((e = this.style.value.split("|")),
                    (i = this.window
                      .getComputedStyle(t, null)
                      .getPropertyValue(this.style.prop)),
                    e.forEach(function (t) {
                      this.knownState ||
                        (((n = -1 !== i.indexOf(t)) ||
                          "text-decoration" !== this.style.prop) &&
                          (this.knownState = n));
                    }, this)),
                  n);
            },
          });
          (e.isBuiltInButton = function (e) {
            return (
              "string" == typeof e &&
              t.extensions.button.prototype.defaults.hasOwnProperty(e)
            );
          }),
            (t.extensions.button = e);
        })(),
        (function () {
          t.extensions.button.prototype.defaults = {
            bold: {
              name: "bold",
              action: "bold",
              aria: "bold",
              tagNames: ["b", "strong"],
              style: { prop: "font-weight", value: "700|bold" },
              useQueryState: !0,
              contentDefault: "<b>B</b>",
              contentFA: '<i class="fa fa-bold"></i>',
            },
            italic: {
              name: "italic",
              action: "italic",
              aria: "italic",
              tagNames: ["i", "em"],
              style: { prop: "font-style", value: "italic" },
              useQueryState: !0,
              contentDefault: "<b><i>I</i></b>",
              contentFA: '<i class="fa fa-italic"></i>',
            },
            underline: {
              name: "underline",
              action: "underline",
              aria: "underline",
              tagNames: ["u"],
              style: { prop: "text-decoration", value: "underline" },
              useQueryState: !0,
              contentDefault: "<b><u>U</u></b>",
              contentFA: '<i class="fa fa-underline"></i>',
            },
            strikethrough: {
              name: "strikethrough",
              action: "strikethrough",
              aria: "strike through",
              tagNames: ["strike"],
              style: { prop: "text-decoration", value: "line-through" },
              useQueryState: !0,
              contentDefault: "<s>A</s>",
              contentFA: '<i class="fa fa-strikethrough"></i>',
            },
            superscript: {
              name: "superscript",
              action: "superscript",
              aria: "superscript",
              tagNames: ["sup"],
              contentDefault: "<b>x<sup>1</sup></b>",
              contentFA: '<i class="fa fa-superscript"></i>',
            },
            subscript: {
              name: "subscript",
              action: "subscript",
              aria: "subscript",
              tagNames: ["sub"],
              contentDefault: "<b>x<sub>1</sub></b>",
              contentFA: '<i class="fa fa-subscript"></i>',
            },
            image: {
              name: "image",
              action: "image",
              aria: "image",
              tagNames: ["img"],
              contentDefault: "<b>image</b>",
              contentFA: '<i class="fa fa-picture-o"></i>',
            },
            orderedlist: {
              name: "orderedlist",
              action: "insertorderedlist",
              aria: "ordered list",
              tagNames: ["ol"],
              useQueryState: !0,
              contentDefault: "<b>1.</b>",
              contentFA: '<i class="fa fa-list-ol"></i>',
            },
            unorderedlist: {
              name: "unorderedlist",
              action: "insertunorderedlist",
              aria: "unordered list",
              tagNames: ["ul"],
              useQueryState: !0,
              contentDefault: "<b>&bull;</b>",
              contentFA: '<i class="fa fa-list-ul"></i>',
            },
            indent: {
              name: "indent",
              action: "indent",
              aria: "indent",
              tagNames: [],
              contentDefault: "<b>&rarr;</b>",
              contentFA: '<i class="fa fa-indent"></i>',
            },
            outdent: {
              name: "outdent",
              action: "outdent",
              aria: "outdent",
              tagNames: [],
              contentDefault: "<b>&larr;</b>",
              contentFA: '<i class="fa fa-outdent"></i>',
            },
            justifyCenter: {
              name: "justifyCenter",
              action: "justifyCenter",
              aria: "center justify",
              tagNames: [],
              style: { prop: "text-align", value: "center" },
              contentDefault: "<b>C</b>",
              contentFA: '<i class="fa fa-align-center"></i>',
            },
            justifyFull: {
              name: "justifyFull",
              action: "justifyFull",
              aria: "full justify",
              tagNames: [],
              style: { prop: "text-align", value: "justify" },
              contentDefault: "<b>J</b>",
              contentFA: '<i class="fa fa-align-justify"></i>',
            },
            justifyLeft: {
              name: "justifyLeft",
              action: "justifyLeft",
              aria: "left justify",
              tagNames: [],
              style: { prop: "text-align", value: "left" },
              contentDefault: "<b>L</b>",
              contentFA: '<i class="fa fa-align-left"></i>',
            },
            justifyRight: {
              name: "justifyRight",
              action: "justifyRight",
              aria: "right justify",
              tagNames: [],
              style: { prop: "text-align", value: "right" },
              contentDefault: "<b>R</b>",
              contentFA: '<i class="fa fa-align-right"></i>',
            },
            removeFormat: {
              name: "removeFormat",
              aria: "remove formatting",
              action: "removeFormat",
              contentDefault: "<b>X</b>",
              contentFA: '<i class="fa fa-eraser"></i>',
            },
            quote: {
              name: "quote",
              action: "append-blockquote",
              aria: "blockquote",
              tagNames: ["blockquote"],
              contentDefault: "<b>&ldquo;</b>",
              contentFA: '<i class="fa fa-quote-right"></i>',
            },
            pre: {
              name: "pre",
              action: "append-pre",
              aria: "preformatted text",
              tagNames: ["pre"],
              contentDefault: "<b>0101</b>",
              contentFA: '<i class="fa fa-code fa-lg"></i>',
            },
            h1: {
              name: "h1",
              action: "append-h1",
              aria: "header type one",
              tagNames: ["h1"],
              contentDefault: "<b>H1</b>",
              contentFA: '<i class="fa fa-header"><sup>1</sup>',
            },
            h2: {
              name: "h2",
              action: "append-h2",
              aria: "header type two",
              tagNames: ["h2"],
              contentDefault: "<b>H2</b>",
              contentFA: '<i class="fa fa-header"><sup>2</sup>',
            },
            h3: {
              name: "h3",
              action: "append-h3",
              aria: "header type three",
              tagNames: ["h3"],
              contentDefault: "<b>H3</b>",
              contentFA: '<i class="fa fa-header"><sup>3</sup>',
            },
            h4: {
              name: "h4",
              action: "append-h4",
              aria: "header type four",
              tagNames: ["h4"],
              contentDefault: "<b>H4</b>",
              contentFA: '<i class="fa fa-header"><sup>4</sup>',
            },
            h5: {
              name: "h5",
              action: "append-h5",
              aria: "header type five",
              tagNames: ["h5"],
              contentDefault: "<b>H5</b>",
              contentFA: '<i class="fa fa-header"><sup>5</sup>',
            },
            h6: {
              name: "h6",
              action: "append-h6",
              aria: "header type six",
              tagNames: ["h6"],
              contentDefault: "<b>H6</b>",
              contentFA: '<i class="fa fa-header"><sup>6</sup>',
            },
          };
        })(),
        (function () {
          var e = t.extensions.button.extend({
            init: function () {
              t.extensions.button.prototype.init.apply(this, arguments);
            },
            formSaveLabel: "&#10003;",
            formCloseLabel: "&times;",
            activeClass: "medium-editor-toolbar-form-active",
            hasForm: !0,
            getForm: function () {},
            isDisplayed: function () {
              return (
                !!this.hasForm &&
                this.getForm().classList.contains(this.activeClass)
              );
            },
            showForm: function () {
              this.hasForm && this.getForm().classList.add(this.activeClass);
            },
            hideForm: function () {
              this.hasForm && this.getForm().classList.remove(this.activeClass);
            },
            showToolbarDefaultActions: function () {
              var t = this.base.getExtensionByName("toolbar");
              t && t.showToolbarDefaultActions();
            },
            hideToolbarDefaultActions: function () {
              var t = this.base.getExtensionByName("toolbar");
              t && t.hideToolbarDefaultActions();
            },
            setToolbarPosition: function () {
              var t = this.base.getExtensionByName("toolbar");
              t && t.setToolbarPosition();
            },
          });
          t.extensions.form = e;
        })(),
        (function () {
          var e = t.extensions.form.extend({
            customClassOption: null,
            customClassOptionText: "Button",
            linkValidation: !1,
            placeholderText: "Paste or type a link",
            targetCheckbox: !1,
            targetCheckboxText: "Open in new window",
            name: "anchor",
            action: "createLink",
            aria: "link",
            tagNames: ["a"],
            contentDefault: "<b>#</b>",
            contentFA: '<i class="fa fa-link"></i>',
            init: function () {
              t.extensions.form.prototype.init.apply(this, arguments),
                this.subscribe(
                  "editableKeydown",
                  this.handleKeydown.bind(this)
                );
            },
            handleClick: function (e) {
              e.preventDefault(), e.stopPropagation();
              var i = t.selection.getSelectionRange(this.document);
              return "a" === i.startContainer.nodeName.toLowerCase() ||
                "a" === i.endContainer.nodeName.toLowerCase() ||
                t.util.getClosestTag(
                  t.selection.getSelectedParentElement(i),
                  "a"
                )
                ? this.execAction("unlink")
                : (this.isDisplayed() || this.showForm(), !1);
            },
            handleKeydown: function (e) {
              t.util.isKey(e, t.util.keyCode.K) &&
                t.util.isMetaCtrlKey(e) &&
                !e.shiftKey &&
                this.handleClick(e);
            },
            getForm: function () {
              return this.form || (this.form = this.createForm()), this.form;
            },
            getTemplate: function () {
              var t = [
                '<input type="text" class="medium-editor-toolbar-input" placeholder="',
                this.placeholderText,
                '">',
              ];
              return (
                t.push(
                  '<a href="#" class="medium-editor-toolbar-save">',
                  "fontawesome" === this.getEditorOption("buttonLabels")
                    ? '<i class="fa fa-check"></i>'
                    : this.formSaveLabel,
                  "</a>"
                ),
                t.push(
                  '<a href="#" class="medium-editor-toolbar-close">',
                  "fontawesome" === this.getEditorOption("buttonLabels")
                    ? '<i class="fa fa-times"></i>'
                    : this.formCloseLabel,
                  "</a>"
                ),
                this.targetCheckbox &&
                  t.push(
                    '<div class="medium-editor-toolbar-form-row">',
                    '<input type="checkbox" class="medium-editor-toolbar-anchor-target">',
                    "<label>",
                    this.targetCheckboxText,
                    "</label>",
                    "</div>"
                  ),
                this.customClassOption &&
                  t.push(
                    '<div class="medium-editor-toolbar-form-row">',
                    '<input type="checkbox" class="medium-editor-toolbar-anchor-button">',
                    "<label>",
                    this.customClassOptionText,
                    "</label>",
                    "</div>"
                  ),
                t.join("")
              );
            },
            isDisplayed: function () {
              return t.extensions.form.prototype.isDisplayed.apply(this);
            },
            hideForm: function () {
              t.extensions.form.prototype.hideForm.apply(this),
                (this.getInput().value = "");
            },
            showForm: function (e) {
              var i = this.getInput(),
                n = this.getAnchorTargetCheckbox(),
                a = this.getAnchorButtonCheckbox();
              if (
                ((e = e || { value: "" }),
                "string" == typeof e && (e = { value: e }),
                this.base.saveSelection(),
                this.hideToolbarDefaultActions(),
                t.extensions.form.prototype.showForm.apply(this),
                this.setToolbarPosition(),
                (i.value = e.value),
                i.focus(),
                n && (n.checked = "_blank" === e.target),
                a)
              ) {
                var o = e.buttonClass ? e.buttonClass.split(" ") : [];
                a.checked = -1 !== o.indexOf(this.customClassOption);
              }
            },
            destroy: function () {
              if (!this.form) return !1;
              this.form.parentNode &&
                this.form.parentNode.removeChild(this.form),
                delete this.form;
            },
            getFormOpts: function () {
              var t = this.getAnchorTargetCheckbox(),
                e = this.getAnchorButtonCheckbox(),
                i = { value: this.getInput().value.trim() };
              return (
                this.linkValidation &&
                  (i.value = this.checkLinkFormat(i.value)),
                (i.target = "_self"),
                t && t.checked && (i.target = "_blank"),
                e && e.checked && (i.buttonClass = this.customClassOption),
                i
              );
            },
            doFormSave: function () {
              var t = this.getFormOpts();
              this.completeFormSave(t);
            },
            completeFormSave: function (t) {
              this.base.restoreSelection(),
                this.execAction(this.action, t),
                this.base.checkSelection();
            },
            checkLinkFormat: function (t) {
              var e = /^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i;
              return /^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/.test(t)
                ? "tel:" + t
                : (e.test(t) ? "" : "http://") + encodeURI(t);
            },
            doFormCancel: function () {
              this.base.restoreSelection(), this.base.checkSelection();
            },
            attachFormEvents: function (t) {
              var e = t.querySelector(".medium-editor-toolbar-close"),
                i = t.querySelector(".medium-editor-toolbar-save"),
                n = t.querySelector(".medium-editor-toolbar-input");
              this.on(t, "click", this.handleFormClick.bind(this)),
                this.on(n, "keyup", this.handleTextboxKeyup.bind(this)),
                this.on(e, "click", this.handleCloseClick.bind(this)),
                this.on(i, "click", this.handleSaveClick.bind(this), !0);
            },
            createForm: function () {
              var t = this.document,
                e = t.createElement("div");
              return (
                (e.className = "medium-editor-toolbar-form"),
                (e.id =
                  "medium-editor-toolbar-form-anchor-" + this.getEditorId()),
                (e.innerHTML = this.getTemplate()),
                this.attachFormEvents(e),
                e
              );
            },
            getInput: function () {
              return this.getForm().querySelector(
                "input.medium-editor-toolbar-input"
              );
            },
            getAnchorTargetCheckbox: function () {
              return this.getForm().querySelector(
                ".medium-editor-toolbar-anchor-target"
              );
            },
            getAnchorButtonCheckbox: function () {
              return this.getForm().querySelector(
                ".medium-editor-toolbar-anchor-button"
              );
            },
            handleTextboxKeyup: function (e) {
              if (e.keyCode === t.util.keyCode.ENTER)
                return e.preventDefault(), void this.doFormSave();
              e.keyCode === t.util.keyCode.ESCAPE &&
                (e.preventDefault(), this.doFormCancel());
            },
            handleFormClick: function (t) {
              t.stopPropagation();
            },
            handleSaveClick: function (t) {
              t.preventDefault(), this.doFormSave();
            },
            handleCloseClick: function (t) {
              t.preventDefault(), this.doFormCancel();
            },
          });
          t.extensions.anchor = e;
        })(),
        (function () {
          var e = t.Extension.extend({
            name: "anchor-preview",
            hideDelay: 500,
            previewValueSelector: "a",
            showWhenToolbarIsVisible: !1,
            showOnEmptyLinks: !0,
            init: function () {
              (this.anchorPreview = this.createPreview()),
                this.getEditorOption("elementsContainer").appendChild(
                  this.anchorPreview
                ),
                this.attachToEditables();
            },
            getInteractionElements: function () {
              return this.getPreviewElement();
            },
            getPreviewElement: function () {
              return this.anchorPreview;
            },
            createPreview: function () {
              var t = this.document.createElement("div");
              return (
                (t.id = "medium-editor-anchor-preview-" + this.getEditorId()),
                (t.className = "medium-editor-anchor-preview"),
                (t.innerHTML = this.getTemplate()),
                this.on(t, "click", this.handleClick.bind(this)),
                t
              );
            },
            getTemplate: function () {
              return '<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>';
            },
            destroy: function () {
              this.anchorPreview &&
                (this.anchorPreview.parentNode &&
                  this.anchorPreview.parentNode.removeChild(this.anchorPreview),
                delete this.anchorPreview);
            },
            hidePreview: function () {
              this.anchorPreview.classList.remove(
                "medium-editor-anchor-preview-active"
              ),
                (this.activeAnchor = null);
            },
            showPreview: function (t) {
              return (
                !(
                  !this.anchorPreview.classList.contains(
                    "medium-editor-anchor-preview-active"
                  ) && !t.getAttribute("data-disable-preview")
                ) ||
                (this.previewValueSelector &&
                  ((this.anchorPreview.querySelector(
                    this.previewValueSelector
                  ).textContent = t.attributes.href.value),
                  (this.anchorPreview.querySelector(
                    this.previewValueSelector
                  ).href = t.attributes.href.value)),
                this.anchorPreview.classList.add("medium-toolbar-arrow-over"),
                this.anchorPreview.classList.remove(
                  "medium-toolbar-arrow-under"
                ),
                this.anchorPreview.classList.contains(
                  "medium-editor-anchor-preview-active"
                ) ||
                  this.anchorPreview.classList.add(
                    "medium-editor-anchor-preview-active"
                  ),
                (this.activeAnchor = t),
                this.positionPreview(),
                this.attachPreviewHandlers(),
                this)
              );
            },
            positionPreview: function (t) {
              t = t || this.activeAnchor;
              var e,
                i,
                n,
                a,
                o,
                r = this.window.innerWidth,
                s = this.anchorPreview.offsetHeight,
                l = t.getBoundingClientRect(),
                d = this.diffLeft,
                p = this.diffTop,
                c = this.getEditorOption("elementsContainer"),
                u =
                  ["absolute", "fixed"].indexOf(
                    window.getComputedStyle(c).getPropertyValue("position")
                  ) > -1,
                h = {};
              e = this.anchorPreview.offsetWidth / 2;
              var f = this.base.getExtensionByName("toolbar");
              f && ((d = f.diffLeft), (p = f.diffTop)),
                (i = d - e),
                u
                  ? ((a = c.getBoundingClientRect()),
                    ["top", "left"].forEach(function (t) {
                      h[t] = l[t] - a[t];
                    }),
                    (h.width = l.width),
                    (h.height = l.height),
                    (l = h),
                    (r = a.width),
                    (o = c.scrollTop))
                  : (o = this.window.pageYOffset),
                (n = l.left + l.width / 2),
                (o +=
                  s + l.top + l.height - p - this.anchorPreview.offsetHeight),
                (this.anchorPreview.style.top = Math.round(o) + "px"),
                (this.anchorPreview.style.right = "initial"),
                n < e
                  ? ((this.anchorPreview.style.left = i + e + "px"),
                    (this.anchorPreview.style.right = "initial"))
                  : r - n < e
                  ? ((this.anchorPreview.style.left = "auto"),
                    (this.anchorPreview.style.right = 0))
                  : ((this.anchorPreview.style.left = i + n + "px"),
                    (this.anchorPreview.style.right = "initial"));
            },
            attachToEditables: function () {
              this.subscribe(
                "editableMouseover",
                this.handleEditableMouseover.bind(this)
              ),
                this.subscribe(
                  "positionedToolbar",
                  this.handlePositionedToolbar.bind(this)
                );
            },
            handlePositionedToolbar: function () {
              this.showWhenToolbarIsVisible || this.hidePreview();
            },
            handleClick: function (t) {
              var e = this.base.getExtensionByName("anchor"),
                i = this.activeAnchor;
              e &&
                i &&
                (t.preventDefault(),
                this.base.selectElement(this.activeAnchor),
                this.base.delay(
                  function () {
                    if (i) {
                      var t = {
                        value: i.attributes.href.value,
                        target: i.getAttribute("target"),
                        buttonClass: i.getAttribute("class"),
                      };
                      e.showForm(t), (i = null);
                    }
                  }.bind(this)
                )),
                this.hidePreview();
            },
            handleAnchorMouseout: function () {
              (this.anchorToPreview = null),
                this.off(
                  this.activeAnchor,
                  "mouseout",
                  this.instanceHandleAnchorMouseout
                ),
                (this.instanceHandleAnchorMouseout = null);
            },
            handleEditableMouseover: function (e) {
              var i = t.util.getClosestTag(e.target, "a");
              if (!1 !== i) {
                if (
                  !this.showOnEmptyLinks &&
                  (!/href=["']\S+["']/.test(i.outerHTML) ||
                    /href=["']#\S+["']/.test(i.outerHTML))
                )
                  return !0;
                var n = this.base.getExtensionByName("toolbar");
                if (
                  !this.showWhenToolbarIsVisible &&
                  n &&
                  n.isDisplayed &&
                  n.isDisplayed()
                )
                  return !0;
                this.activeAnchor &&
                  this.activeAnchor !== i &&
                  this.detachPreviewHandlers(),
                  (this.anchorToPreview = i),
                  (this.instanceHandleAnchorMouseout =
                    this.handleAnchorMouseout.bind(this)),
                  this.on(
                    this.anchorToPreview,
                    "mouseout",
                    this.instanceHandleAnchorMouseout
                  ),
                  this.base.delay(
                    function () {
                      this.anchorToPreview &&
                        this.showPreview(this.anchorToPreview);
                    }.bind(this)
                  );
              }
            },
            handlePreviewMouseover: function () {
              (this.lastOver = new Date().getTime()), (this.hovering = !0);
            },
            handlePreviewMouseout: function (t) {
              (t.relatedTarget &&
                /anchor-preview/.test(t.relatedTarget.className)) ||
                (this.hovering = !1);
            },
            updatePreview: function () {
              if (this.hovering) return !0;
              new Date().getTime() - this.lastOver > this.hideDelay &&
                this.detachPreviewHandlers();
            },
            detachPreviewHandlers: function () {
              clearInterval(this.intervalTimer),
                this.instanceHandlePreviewMouseover &&
                  (this.off(
                    this.anchorPreview,
                    "mouseover",
                    this.instanceHandlePreviewMouseover
                  ),
                  this.off(
                    this.anchorPreview,
                    "mouseout",
                    this.instanceHandlePreviewMouseout
                  ),
                  this.activeAnchor &&
                    (this.off(
                      this.activeAnchor,
                      "mouseover",
                      this.instanceHandlePreviewMouseover
                    ),
                    this.off(
                      this.activeAnchor,
                      "mouseout",
                      this.instanceHandlePreviewMouseout
                    ))),
                this.hidePreview(),
                (this.hovering =
                  this.instanceHandlePreviewMouseover =
                  this.instanceHandlePreviewMouseout =
                    null);
            },
            attachPreviewHandlers: function () {
              (this.lastOver = new Date().getTime()),
                (this.hovering = !0),
                (this.instanceHandlePreviewMouseover =
                  this.handlePreviewMouseover.bind(this)),
                (this.instanceHandlePreviewMouseout =
                  this.handlePreviewMouseout.bind(this)),
                (this.intervalTimer = setInterval(
                  this.updatePreview.bind(this),
                  200
                )),
                this.on(
                  this.anchorPreview,
                  "mouseover",
                  this.instanceHandlePreviewMouseover
                ),
                this.on(
                  this.anchorPreview,
                  "mouseout",
                  this.instanceHandlePreviewMouseout
                ),
                this.on(
                  this.activeAnchor,
                  "mouseover",
                  this.instanceHandlePreviewMouseover
                ),
                this.on(
                  this.activeAnchor,
                  "mouseout",
                  this.instanceHandlePreviewMouseout
                );
            },
          });
          t.extensions.anchorPreview = e;
        })(),
        (function () {
          function e(e) {
            return !t.util.getClosestTag(e, "a");
          }
          var i, n, a, o;
          (i = [
            " ",
            "\t",
            "\n",
            "\r",
            " ",
            " ",
            " ",
            " ",
            " ",
            "\u2028",
            "\u2029",
          ]),
            (n =
              "com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw"),
            (a =
              "(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.](" +
              n +
              ")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.(" +
              n +
              "))"),
            (o = new RegExp("^(" + n + ")$", "i"));
          var r = t.Extension.extend({
            init: function () {
              t.Extension.prototype.init.apply(this, arguments),
                (this.disableEventHandling = !1),
                this.subscribe("editableKeypress", this.onKeypress.bind(this)),
                this.subscribe("editableBlur", this.onBlur.bind(this)),
                this.document.execCommand("AutoUrlDetect", !1, !1);
            },
            isLastInstance: function () {
              for (
                var t = 0, e = 0;
                e < this.window._mediumEditors.length;
                e++
              ) {
                var i = this.window._mediumEditors[e];
                null !== i &&
                  void 0 !== i.getExtensionByName("autoLink") &&
                  t++;
              }
              return 1 === t;
            },
            destroy: function () {
              this.document.queryCommandSupported("AutoUrlDetect") &&
                this.isLastInstance() &&
                this.document.execCommand("AutoUrlDetect", !1, !0);
            },
            onBlur: function (t, e) {
              this.performLinking(e);
            },
            onKeypress: function (e) {
              this.disableEventHandling ||
                (t.util.isKey(e, [
                  t.util.keyCode.SPACE,
                  t.util.keyCode.ENTER,
                ]) &&
                  (clearTimeout(this.performLinkingTimeout),
                  (this.performLinkingTimeout = setTimeout(
                    function () {
                      try {
                        var t = this.base.exportSelection();
                        this.performLinking(e.target) &&
                          this.base.importSelection(t, !0);
                      } catch (t) {
                        window.console &&
                          window.console.error("Failed to perform linking", t),
                          (this.disableEventHandling = !0);
                      }
                    }.bind(this),
                    0
                  ))));
            },
            performLinking: function (e) {
              var i = t.util.splitByBlockElements(e),
                n = !1;
              0 === i.length && (i = [e]);
              for (var a = 0; a < i.length; a++)
                (n = this.removeObsoleteAutoLinkSpans(i[a]) || n),
                  (n = this.performLinkingWithinElement(i[a]) || n);
              return (
                this.base.events.updateInput(e, {
                  target: e,
                  currentTarget: e,
                }),
                n
              );
            },
            removeObsoleteAutoLinkSpans: function (i) {
              if (!i || 3 === i.nodeType) return !1;
              for (
                var n = i.querySelectorAll('span[data-auto-link="true"]'),
                  a = !1,
                  o = 0;
                o < n.length;
                o++
              ) {
                var r = n[o].textContent;
                if (
                  (-1 === r.indexOf("://") &&
                    (r = t.util.ensureUrlHasProtocol(r)),
                  n[o].getAttribute("data-href") !== r && e(n[o]))
                ) {
                  a = !0;
                  var s = r.replace(/\s+$/, "");
                  if (n[o].getAttribute("data-href") === s) {
                    var l = r.length - s.length,
                      d = t.util.splitOffDOMTree(
                        n[o],
                        this.splitTextBeforeEnd(n[o], l)
                      );
                    n[o].parentNode.insertBefore(d, n[o].nextSibling);
                  } else t.util.unwrap(n[o], this.document);
                }
              }
              return a;
            },
            splitTextBeforeEnd: function (t, e) {
              for (
                var i = this.document.createTreeWalker(
                    t,
                    NodeFilter.SHOW_TEXT,
                    null,
                    !1
                  ),
                  n = !0;
                n;

              )
                n = null !== i.lastChild();
              for (var a, o, r; e > 0 && null !== r; )
                (a = i.currentNode),
                  (o = a.nodeValue),
                  o.length > e
                    ? ((r = a.splitText(o.length - e)), (e = 0))
                    : ((r = i.previousNode()), (e -= o.length));
              return r;
            },
            performLinkingWithinElement: function (e) {
              for (var i = this.findLinkableText(e), n = 0; n < i.length; n++) {
                var a = t.util.findOrCreateMatchingTextNodes(
                  this.document,
                  e,
                  i[n]
                );
                this.shouldNotLink(a) || this.createAutoLink(a, i[n].href);
              }
              return !1;
            },
            shouldNotLink: function (e) {
              for (var i = !1, n = 0; n < e.length && !1 === i; n++)
                i = !!t.util.traverseUp(e[n], function (t) {
                  return (
                    "a" === t.nodeName.toLowerCase() ||
                    (t.getAttribute &&
                      "true" === t.getAttribute("data-auto-link"))
                  );
                });
              return i;
            },
            findLinkableText: function (t) {
              for (
                var e = new RegExp(a, "gi"),
                  n = t.textContent,
                  r = null,
                  s = [];
                null !== (r = e.exec(n));

              ) {
                var l = !0,
                  d = r.index + r[0].length;
                (l = !(
                  (0 !== r.index && -1 === i.indexOf(n[r.index - 1])) ||
                  (d !== n.length && -1 === i.indexOf(n[d]))
                )),
                  (l =
                    l &&
                    (-1 !== r[0].indexOf("/") ||
                      o.test(r[0].split(".").pop().split("?").shift()))),
                  l && s.push({ href: r[0], start: r.index, end: d });
              }
              return s;
            },
            createAutoLink: function (e, i) {
              i = t.util.ensureUrlHasProtocol(i);
              var n = t.util.createLink(
                  this.document,
                  e,
                  i,
                  this.getEditorOption("targetBlank") ? "_blank" : null
                ),
                a = this.document.createElement("span");
              for (
                a.setAttribute("data-auto-link", "true"),
                  a.setAttribute("data-href", i),
                  n.insertBefore(a, n.firstChild);
                n.childNodes.length > 1;

              )
                a.appendChild(n.childNodes[1]);
            },
          });
          t.extensions.autoLink = r;
        })(),
        (function () {
          function e(e) {
            var n = t.util.getContainerEditorElement(e);
            Array.prototype.slice
              .call(n.parentElement.querySelectorAll("." + i))
              .forEach(function (t) {
                t.classList.remove(i);
              });
          }
          var i = "medium-editor-dragover",
            n = t.Extension.extend({
              name: "fileDragging",
              allowedTypes: ["image"],
              init: function () {
                t.Extension.prototype.init.apply(this, arguments),
                  this.subscribe("editableDrag", this.handleDrag.bind(this)),
                  this.subscribe("editableDrop", this.handleDrop.bind(this));
              },
              handleDrag: function (t) {
                t.preventDefault(), (t.dataTransfer.dropEffect = "copy");
                var n = t.target.classList ? t.target : t.target.parentElement;
                e(n), "dragover" === t.type && n.classList.add(i);
              },
              handleDrop: function (t) {
                t.preventDefault(),
                  t.stopPropagation(),
                  this.base.selectElement(t.target);
                var i = this.base.exportSelection();
                (i.start = i.end),
                  this.base.importSelection(i),
                  t.dataTransfer.files &&
                    Array.prototype.slice
                      .call(t.dataTransfer.files)
                      .forEach(function (t) {
                        this.isAllowedFile(t) &&
                          t.type.match("image") &&
                          this.insertImageFile(t);
                      }, this),
                  e(t.target);
              },
              isAllowedFile: function (t) {
                return this.allowedTypes.some(function (e) {
                  return !!t.type.match(e);
                });
              },
              insertImageFile: function (e) {
                if ("function" == typeof FileReader) {
                  var i = new FileReader();
                  i.readAsDataURL(e),
                    i.addEventListener(
                      "load",
                      function (e) {
                        var i = this.document.createElement("img");
                        (i.src = e.target.result),
                          t.util.insertHTMLCommand(this.document, i.outerHTML);
                      }.bind(this)
                    );
                }
              },
            });
          t.extensions.fileDragging = n;
        })(),
        (function () {
          var e = t.Extension.extend({
            name: "keyboard-commands",
            commands: [
              { command: "bold", key: "B", meta: !0, shift: !1, alt: !1 },
              { command: "italic", key: "I", meta: !0, shift: !1, alt: !1 },
              { command: "underline", key: "U", meta: !0, shift: !1, alt: !1 },
            ],
            init: function () {
              t.Extension.prototype.init.apply(this, arguments),
                this.subscribe(
                  "editableKeydown",
                  this.handleKeydown.bind(this)
                ),
                (this.keys = {}),
                this.commands.forEach(function (t) {
                  var e = t.key.charCodeAt(0);
                  this.keys[e] || (this.keys[e] = []), this.keys[e].push(t);
                }, this);
            },
            handleKeydown: function (e) {
              var i = t.util.getKeyCode(e);
              if (this.keys[i]) {
                var n = t.util.isMetaCtrlKey(e),
                  a = !!e.shiftKey,
                  o = !!e.altKey;
                this.keys[i].forEach(function (t) {
                  t.meta !== n ||
                    t.shift !== a ||
                    (t.alt !== o && void 0 !== t.alt) ||
                    (e.preventDefault(),
                    e.stopPropagation(),
                    "function" == typeof t.command
                      ? t.command.apply(this)
                      : !1 !== t.command && this.execAction(t.command));
                }, this);
              }
            },
          });
          t.extensions.keyboardCommands = e;
        })(),
        (function () {
          var e = t.extensions.form.extend({
            name: "fontname",
            action: "fontName",
            aria: "change font name",
            contentDefault: "&#xB1;",
            contentFA: '<i class="fa fa-font"></i>',
            fonts: ["", "Arial", "Verdana", "Times New Roman"],
            init: function () {
              t.extensions.form.prototype.init.apply(this, arguments);
            },
            handleClick: function (t) {
              if (
                (t.preventDefault(), t.stopPropagation(), !this.isDisplayed())
              ) {
                var e = this.document.queryCommandValue("fontName") + "";
                this.showForm(e);
              }
              return !1;
            },
            getForm: function () {
              return this.form || (this.form = this.createForm()), this.form;
            },
            isDisplayed: function () {
              return "block" === this.getForm().style.display;
            },
            hideForm: function () {
              (this.getForm().style.display = "none"),
                (this.getSelect().value = "");
            },
            showForm: function (t) {
              var e = this.getSelect();
              this.base.saveSelection(),
                this.hideToolbarDefaultActions(),
                (this.getForm().style.display = "block"),
                this.setToolbarPosition(),
                (e.value = t || ""),
                e.focus();
            },
            destroy: function () {
              if (!this.form) return !1;
              this.form.parentNode &&
                this.form.parentNode.removeChild(this.form),
                delete this.form;
            },
            doFormSave: function () {
              this.base.restoreSelection(), this.base.checkSelection();
            },
            doFormCancel: function () {
              this.base.restoreSelection(),
                this.clearFontName(),
                this.base.checkSelection();
            },
            createForm: function () {
              var t,
                e = this.document,
                i = e.createElement("div"),
                n = e.createElement("select"),
                a = e.createElement("a"),
                o = e.createElement("a");
              (i.className = "medium-editor-toolbar-form"),
                (i.id =
                  "medium-editor-toolbar-form-fontname-" + this.getEditorId()),
                this.on(i, "click", this.handleFormClick.bind(this));
              for (var r = 0; r < this.fonts.length; r++)
                (t = e.createElement("option")),
                  (t.innerHTML = this.fonts[r]),
                  (t.value = this.fonts[r]),
                  n.appendChild(t);
              return (
                (n.className = "medium-editor-toolbar-select"),
                i.appendChild(n),
                this.on(n, "change", this.handleFontChange.bind(this)),
                o.setAttribute("href", "#"),
                (o.className = "medium-editor-toobar-save"),
                (o.innerHTML =
                  "fontawesome" === this.getEditorOption("buttonLabels")
                    ? '<i class="fa fa-check"></i>'
                    : "&#10003;"),
                i.appendChild(o),
                this.on(o, "click", this.handleSaveClick.bind(this), !0),
                a.setAttribute("href", "#"),
                (a.className = "medium-editor-toobar-close"),
                (a.innerHTML =
                  "fontawesome" === this.getEditorOption("buttonLabels")
                    ? '<i class="fa fa-times"></i>'
                    : "&times;"),
                i.appendChild(a),
                this.on(a, "click", this.handleCloseClick.bind(this)),
                i
              );
            },
            getSelect: function () {
              return this.getForm().querySelector(
                "select.medium-editor-toolbar-select"
              );
            },
            clearFontName: function () {
              t.selection
                .getSelectedElements(this.document)
                .forEach(function (t) {
                  "font" === t.nodeName.toLowerCase() &&
                    t.hasAttribute("face") &&
                    t.removeAttribute("face");
                });
            },
            handleFontChange: function () {
              var t = this.getSelect().value;
              "" === t
                ? this.clearFontName()
                : this.execAction("fontName", { value: t });
            },
            handleFormClick: function (t) {
              t.stopPropagation();
            },
            handleSaveClick: function (t) {
              t.preventDefault(), this.doFormSave();
            },
            handleCloseClick: function (t) {
              t.preventDefault(), this.doFormCancel();
            },
          });
          t.extensions.fontName = e;
        })(),
        (function () {
          var e = t.extensions.form.extend({
            name: "fontsize",
            action: "fontSize",
            aria: "increase/decrease font size",
            contentDefault: "&#xB1;",
            contentFA: '<i class="fa fa-text-height"></i>',
            init: function () {
              t.extensions.form.prototype.init.apply(this, arguments);
            },
            handleClick: function (t) {
              if (
                (t.preventDefault(), t.stopPropagation(), !this.isDisplayed())
              ) {
                var e = this.document.queryCommandValue("fontSize") + "";
                this.showForm(e);
              }
              return !1;
            },
            getForm: function () {
              return this.form || (this.form = this.createForm()), this.form;
            },
            isDisplayed: function () {
              return "block" === this.getForm().style.display;
            },
            hideForm: function () {
              (this.getForm().style.display = "none"),
                (this.getInput().value = "");
            },
            showForm: function (t) {
              var e = this.getInput();
              this.base.saveSelection(),
                this.hideToolbarDefaultActions(),
                (this.getForm().style.display = "block"),
                this.setToolbarPosition(),
                (e.value = t || ""),
                e.focus();
            },
            destroy: function () {
              if (!this.form) return !1;
              this.form.parentNode &&
                this.form.parentNode.removeChild(this.form),
                delete this.form;
            },
            doFormSave: function () {
              this.base.restoreSelection(), this.base.checkSelection();
            },
            doFormCancel: function () {
              this.base.restoreSelection(),
                this.clearFontSize(),
                this.base.checkSelection();
            },
            createForm: function () {
              var t = this.document,
                e = t.createElement("div"),
                i = t.createElement("input"),
                n = t.createElement("a"),
                a = t.createElement("a");
              return (
                (e.className = "medium-editor-toolbar-form"),
                (e.id =
                  "medium-editor-toolbar-form-fontsize-" + this.getEditorId()),
                this.on(e, "click", this.handleFormClick.bind(this)),
                i.setAttribute("type", "range"),
                i.setAttribute("min", "1"),
                i.setAttribute("max", "7"),
                (i.className = "medium-editor-toolbar-input"),
                e.appendChild(i),
                this.on(i, "change", this.handleSliderChange.bind(this)),
                a.setAttribute("href", "#"),
                (a.className = "medium-editor-toobar-save"),
                (a.innerHTML =
                  "fontawesome" === this.getEditorOption("buttonLabels")
                    ? '<i class="fa fa-check"></i>'
                    : "&#10003;"),
                e.appendChild(a),
                this.on(a, "click", this.handleSaveClick.bind(this), !0),
                n.setAttribute("href", "#"),
                (n.className = "medium-editor-toobar-close"),
                (n.innerHTML =
                  "fontawesome" === this.getEditorOption("buttonLabels")
                    ? '<i class="fa fa-times"></i>'
                    : "&times;"),
                e.appendChild(n),
                this.on(n, "click", this.handleCloseClick.bind(this)),
                e
              );
            },
            getInput: function () {
              return this.getForm().querySelector(
                "input.medium-editor-toolbar-input"
              );
            },
            clearFontSize: function () {
              t.selection
                .getSelectedElements(this.document)
                .forEach(function (t) {
                  "font" === t.nodeName.toLowerCase() &&
                    t.hasAttribute("size") &&
                    t.removeAttribute("size");
                });
            },
            handleSliderChange: function () {
              var t = this.getInput().value;
              "4" === t
                ? this.clearFontSize()
                : this.execAction("fontSize", { value: t });
            },
            handleFormClick: function (t) {
              t.stopPropagation();
            },
            handleSaveClick: function (t) {
              t.preventDefault(), this.doFormSave();
            },
            handleCloseClick: function (t) {
              t.preventDefault(), this.doFormCancel();
            },
          });
          t.extensions.fontSize = e;
        })(),
        (function () {
          function e() {
            return [
              [
                new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),
                "",
              ],
              [new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g), ""],
              [new RegExp(/<br>$/i), ""],
              [new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi), ""],
              [new RegExp(/<\/b>(<br[^>]*>)?$/gi), ""],
              [
                new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g),
                " ",
              ],
              [new RegExp(/<br class="Apple-interchange-newline">/g), "<br>"],
              [
                new RegExp(
                  /<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi
                ),
                '<span class="replace-with italic bold">',
              ],
              [
                new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),
                '<span class="replace-with italic">',
              ],
              [
                new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),
                '<span class="replace-with bold">',
              ],
              [new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi), "<$1$2>"],
              [
                new RegExp(
                  /&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi
                ),
                '<a href="$1">',
              ],
              [new RegExp(/<\/p>\n+/gi), "</p>"],
              [new RegExp(/\n+<p/gi), "<p"],
              [new RegExp(/<\/?o:[a-z]*>/gi), ""],
              [
                new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),
                "$1",
              ],
            ];
          }
          function i(t, e, i) {
            var n = t.clipboardData || e.clipboardData || i.dataTransfer,
              a = {};
            if (!n) return a;
            if (n.getData) {
              var o = n.getData("Text");
              o && o.length > 0 && (a["text/plain"] = o);
            }
            if (n.types)
              for (var r = 0; r < n.types.length; r++) {
                var s = n.types[r];
                a[s] = n.getData(s);
              }
            return a;
          }
          var n = null,
            a = null,
            o = function (t) {
              t.stopPropagation();
            },
            r = t.Extension.extend({
              forcePlainText: !0,
              cleanPastedHTML: !1,
              preCleanReplacements: [],
              cleanReplacements: [],
              cleanAttrs: ["class", "style", "dir"],
              cleanTags: ["meta"],
              init: function () {
                t.Extension.prototype.init.apply(this, arguments),
                  (this.forcePlainText || this.cleanPastedHTML) &&
                    (this.subscribe(
                      "editableKeydown",
                      this.handleKeydown.bind(this)
                    ),
                    this.getEditorElements().forEach(function (t) {
                      this.on(t, "paste", this.handlePaste.bind(this));
                    }, this),
                    this.subscribe(
                      "addElement",
                      this.handleAddElement.bind(this)
                    ));
              },
              handleAddElement: function (t, e) {
                this.on(e, "paste", this.handlePaste.bind(this));
              },
              destroy: function () {
                (this.forcePlainText || this.cleanPastedHTML) &&
                  this.removePasteBin();
              },
              handlePaste: function (t, e) {
                if (!t.defaultPrevented) {
                  var n = i(t, this.window, this.document),
                    a = n["text/html"],
                    o = n["text/plain"];
                  this.window.clipboardData &&
                    void 0 === t.clipboardData &&
                    !a &&
                    (a = o),
                    (a || o) && (t.preventDefault(), this.doPaste(a, o, e));
                }
              },
              doPaste: function (e, i, n) {
                var a,
                  o,
                  r = "";
                if (this.cleanPastedHTML && e) return this.cleanPaste(e);
                if (
                  this.getEditorOption("disableReturn") ||
                  (n && n.getAttribute("data-disable-return"))
                )
                  r = t.util.htmlEntities(i);
                else if (((a = i.split(/[\r\n]+/g)), a.length > 1))
                  for (o = 0; o < a.length; o += 1)
                    "" !== a[o] &&
                      (r += "<p>" + t.util.htmlEntities(a[o]) + "</p>");
                else r = t.util.htmlEntities(a[0]);
                t.util.insertHTMLCommand(this.document, r);
              },
              handlePasteBinPaste: function (t) {
                if (t.defaultPrevented) return void this.removePasteBin();
                var e = i(t, this.window, this.document),
                  n = e["text/html"],
                  o = e["text/plain"],
                  r = a;
                if (!this.cleanPastedHTML || n)
                  return (
                    t.preventDefault(),
                    this.removePasteBin(),
                    this.doPaste(n, o, r),
                    void this.trigger(
                      "editablePaste",
                      { currentTarget: r, target: r },
                      r
                    )
                  );
                setTimeout(
                  function () {
                    this.cleanPastedHTML && (n = this.getPasteBinHtml()),
                      this.removePasteBin(),
                      this.doPaste(n, o, r),
                      this.trigger(
                        "editablePaste",
                        { currentTarget: r, target: r },
                        r
                      );
                  }.bind(this),
                  0
                );
              },
              handleKeydown: function (e, i) {
                t.util.isKey(e, t.util.keyCode.V) &&
                  t.util.isMetaCtrlKey(e) &&
                  (e.stopImmediatePropagation(),
                  this.removePasteBin(),
                  this.createPasteBin(i));
              },
              createPasteBin: function (e) {
                var i,
                  r = t.selection.getSelectionRange(this.document),
                  s = this.window.pageYOffset;
                (a = e),
                  r &&
                    ((i = r.getClientRects()),
                    i.length
                      ? (s += i[0].top)
                      : (s += r.startContainer.getBoundingClientRect().top)),
                  (n = r);
                var l = this.document.createElement("div");
                (l.id = this.pasteBinId =
                  "medium-editor-pastebin-" + +Date.now()),
                  l.setAttribute(
                    "style",
                    "border: 1px red solid; position: absolute; top: " +
                      s +
                      "px; width: 10px; height: 10px; overflow: hidden; opacity: 0"
                  ),
                  l.setAttribute("contentEditable", !0),
                  (l.innerHTML = "%ME_PASTEBIN%"),
                  this.document.body.appendChild(l),
                  this.on(l, "focus", o),
                  this.on(l, "focusin", o),
                  this.on(l, "focusout", o),
                  l.focus(),
                  t.selection.selectNode(l, this.document),
                  this.boundHandlePaste ||
                    (this.boundHandlePaste =
                      this.handlePasteBinPaste.bind(this)),
                  this.on(l, "paste", this.boundHandlePaste);
              },
              removePasteBin: function () {
                null !== n &&
                  (t.selection.selectRange(this.document, n), (n = null)),
                  null !== a && (a = null);
                var e = this.getPasteBin();
                e &&
                  e &&
                  (this.off(e, "focus", o),
                  this.off(e, "focusin", o),
                  this.off(e, "focusout", o),
                  this.off(e, "paste", this.boundHandlePaste),
                  e.parentElement.removeChild(e));
              },
              getPasteBin: function () {
                return this.document.getElementById(this.pasteBinId);
              },
              getPasteBinHtml: function () {
                var t = this.getPasteBin();
                if (!t) return !1;
                if (t.firstChild && "mcepastebin" === t.firstChild.id)
                  return !1;
                var e = t.innerHTML;
                return !(!e || "%ME_PASTEBIN%" === e) && e;
              },
              cleanPaste: function (t) {
                var i,
                  n,
                  a,
                  o,
                  r = /<p|<br|<div/.test(t),
                  s = [].concat(
                    this.preCleanReplacements || [],
                    e(),
                    this.cleanReplacements || []
                  );
                for (i = 0; i < s.length; i += 1)
                  t = t.replace(s[i][0], s[i][1]);
                if (!r) return this.pasteHTML(t);
                for (
                  a = this.document.createElement("div"),
                    a.innerHTML =
                      "<p>" + t.split("<br><br>").join("</p><p>") + "</p>",
                    n = a.querySelectorAll("a,p,div,br"),
                    i = 0;
                  i < n.length;
                  i += 1
                )
                  switch (
                    ((o = n[i]),
                    (o.innerHTML = o.innerHTML.replace(/\n/gi, " ")),
                    o.nodeName.toLowerCase())
                  ) {
                    case "p":
                    case "div":
                      this.filterCommonBlocks(o);
                      break;
                    case "br":
                      this.filterLineBreak(o);
                  }
                this.pasteHTML(a.innerHTML);
              },
              pasteHTML: function (e, i) {
                i = t.util.defaults({}, i, {
                  cleanAttrs: this.cleanAttrs,
                  cleanTags: this.cleanTags,
                });
                var n,
                  a,
                  o,
                  r,
                  s = this.document.createDocumentFragment();
                for (
                  s.appendChild(this.document.createElement("body")),
                    r = s.querySelector("body"),
                    r.innerHTML = e,
                    this.cleanupSpans(r),
                    n = r.querySelectorAll("*"),
                    o = 0;
                  o < n.length;
                  o += 1
                )
                  (a = n[o]),
                    "a" === a.nodeName.toLowerCase() &&
                      this.getEditorOption("targetBlank") &&
                      t.util.setTargetBlank(a),
                    t.util.cleanupAttrs(a, i.cleanAttrs),
                    t.util.cleanupTags(a, i.cleanTags);
                t.util.insertHTMLCommand(
                  this.document,
                  r.innerHTML.replace(/&nbsp;/g, " ")
                );
              },
              isCommonBlock: function (t) {
                return (
                  t &&
                  ("p" === t.nodeName.toLowerCase() ||
                    "div" === t.nodeName.toLowerCase())
                );
              },
              filterCommonBlocks: function (t) {
                /^\s*$/.test(t.textContent) &&
                  t.parentNode &&
                  t.parentNode.removeChild(t);
              },
              filterLineBreak: function (t) {
                this.isCommonBlock(t.previousElementSibling)
                  ? this.removeWithParent(t)
                  : !this.isCommonBlock(t.parentNode) ||
                    (t.parentNode.firstChild !== t &&
                      t.parentNode.lastChild !== t)
                  ? t.parentNode &&
                    1 === t.parentNode.childElementCount &&
                    "" === t.parentNode.textContent &&
                    this.removeWithParent(t)
                  : this.removeWithParent(t);
              },
              removeWithParent: function (t) {
                t &&
                  t.parentNode &&
                  (t.parentNode.parentNode &&
                  1 === t.parentNode.childElementCount
                    ? t.parentNode.parentNode.removeChild(t.parentNode)
                    : t.parentNode.removeChild(t));
              },
              cleanupSpans: function (e) {
                var i,
                  n,
                  a,
                  o = e.querySelectorAll(".replace-with"),
                  r = function (t) {
                    return (
                      t &&
                      "#text" !== t.nodeName &&
                      "false" === t.getAttribute("contenteditable")
                    );
                  };
                for (i = 0; i < o.length; i += 1)
                  (n = o[i]),
                    (a = this.document.createElement(
                      n.classList.contains("bold") ? "b" : "i"
                    )),
                    n.classList.contains("bold") &&
                    n.classList.contains("italic")
                      ? (a.innerHTML = "<i>" + n.innerHTML + "</i>")
                      : (a.innerHTML = n.innerHTML),
                    n.parentNode.replaceChild(a, n);
                for (
                  o = e.querySelectorAll("span"), i = 0;
                  i < o.length;
                  i += 1
                ) {
                  if (((n = o[i]), t.util.traverseUp(n, r))) return !1;
                  t.util.unwrap(n, this.document);
                }
              },
            });
          t.extensions.paste = r;
        })(),
        (function () {
          var e = t.Extension.extend({
            name: "placeholder",
            text: "Type your text",
            hideOnClick: !0,
            init: function () {
              t.Extension.prototype.init.apply(this, arguments),
                this.initPlaceholders(),
                this.attachEventHandlers();
            },
            initPlaceholders: function () {
              this.getEditorElements().forEach(this.initElement, this);
            },
            handleAddElement: function (t, e) {
              this.initElement(e);
            },
            initElement: function (t) {
              t.getAttribute("data-placeholder") ||
                t.setAttribute("data-placeholder", this.text),
                this.updatePlaceholder(t);
            },
            destroy: function () {
              this.getEditorElements().forEach(this.cleanupElement, this);
            },
            handleRemoveElement: function (t, e) {
              this.cleanupElement(e);
            },
            cleanupElement: function (t) {
              t.getAttribute("data-placeholder") === this.text &&
                t.removeAttribute("data-placeholder");
            },
            showPlaceholder: function (e) {
              e &&
                (t.util.isFF && 0 === e.childNodes.length
                  ? (e.classList.add("medium-editor-placeholder-relative"),
                    e.classList.remove("medium-editor-placeholder"))
                  : (e.classList.add("medium-editor-placeholder"),
                    e.classList.remove("medium-editor-placeholder-relative")));
            },
            hidePlaceholder: function (t) {
              t &&
                (t.classList.remove("medium-editor-placeholder"),
                t.classList.remove("medium-editor-placeholder-relative"));
            },
            updatePlaceholder: function (t, e) {
              if (
                t.querySelector("img, blockquote, ul, ol, table") ||
                "" !== t.textContent.replace(/^\s+|\s+$/g, "")
              )
                return this.hidePlaceholder(t);
              e || this.showPlaceholder(t);
            },
            attachEventHandlers: function () {
              this.hideOnClick &&
                this.subscribe("focus", this.handleFocus.bind(this)),
                this.subscribe("editableInput", this.handleInput.bind(this)),
                this.subscribe("blur", this.handleBlur.bind(this)),
                this.subscribe("addElement", this.handleAddElement.bind(this)),
                this.subscribe(
                  "removeElement",
                  this.handleRemoveElement.bind(this)
                );
            },
            handleInput: function (t, e) {
              var i = this.hideOnClick && e === this.base.getFocusedElement();
              this.updatePlaceholder(e, i);
            },
            handleFocus: function (t, e) {
              this.hidePlaceholder(e);
            },
            handleBlur: function (t, e) {
              this.updatePlaceholder(e);
            },
          });
          t.extensions.placeholder = e;
        })(),
        (function () {
          var e = t.Extension.extend({
            name: "toolbar",
            align: "center",
            allowMultiParagraphSelection: !0,
            buttons: [
              "bold",
              "italic",
              "underline",
              "anchor",
              "h2",
              "h3",
              "quote",
            ],
            diffLeft: 0,
            diffTop: -10,
            firstButtonClass: "medium-editor-button-first",
            lastButtonClass: "medium-editor-button-last",
            standardizeSelectionStart: !1,
            static: !1,
            sticky: !1,
            stickyTopOffset: 0,
            updateOnEmptySelection: !1,
            relativeContainer: null,
            init: function () {
              t.Extension.prototype.init.apply(this, arguments),
                this.initThrottledMethods(),
                this.relativeContainer
                  ? this.relativeContainer.appendChild(this.getToolbarElement())
                  : this.getEditorOption("elementsContainer").appendChild(
                      this.getToolbarElement()
                    );
            },
            forEachExtension: function (t, e) {
              return this.base.extensions.forEach(function (i) {
                if (i !== this) return t.apply(e || this, arguments);
              }, this);
            },
            createToolbar: function () {
              var t = this.document.createElement("div");
              return (
                (t.id = "medium-editor-toolbar-" + this.getEditorId()),
                (t.className = "medium-editor-toolbar"),
                this.static
                  ? (t.className += " static-toolbar")
                  : this.relativeContainer
                  ? (t.className += " medium-editor-relative-toolbar")
                  : (t.className += " medium-editor-stalker-toolbar"),
                t.appendChild(this.createToolbarButtons()),
                this.forEachExtension(function (e) {
                  e.hasForm && t.appendChild(e.getForm());
                }),
                this.attachEventHandlers(),
                t
              );
            },
            createToolbarButtons: function () {
              var e,
                i,
                n,
                a,
                o,
                r,
                s = this.document.createElement("ul");
              return (
                (s.id = "medium-editor-toolbar-actions" + this.getEditorId()),
                (s.className = "medium-editor-toolbar-actions"),
                (s.style.display = "block"),
                this.buttons.forEach(function (n) {
                  "string" == typeof n
                    ? ((o = n), (r = null))
                    : ((o = n.name), (r = n)),
                    (a = this.base.addBuiltInExtension(o, r)) &&
                      "function" == typeof a.getButton &&
                      ((i = a.getButton(this.base)),
                      (e = this.document.createElement("li")),
                      t.util.isElement(i)
                        ? e.appendChild(i)
                        : (e.innerHTML = i),
                      s.appendChild(e));
                }, this),
                (n = s.querySelectorAll("button")),
                n.length > 0 &&
                  (n[0].classList.add(this.firstButtonClass),
                  n[n.length - 1].classList.add(this.lastButtonClass)),
                s
              );
            },
            destroy: function () {
              this.toolbar &&
                (this.toolbar.parentNode &&
                  this.toolbar.parentNode.removeChild(this.toolbar),
                delete this.toolbar);
            },
            getInteractionElements: function () {
              return this.getToolbarElement();
            },
            getToolbarElement: function () {
              return (
                this.toolbar || (this.toolbar = this.createToolbar()),
                this.toolbar
              );
            },
            getToolbarActionsElement: function () {
              return this.getToolbarElement().querySelector(
                ".medium-editor-toolbar-actions"
              );
            },
            initThrottledMethods: function () {
              this.throttledPositionToolbar = t.util.throttle(
                function () {
                  this.base.isActive && this.positionToolbarIfShown();
                }.bind(this)
              );
            },
            attachEventHandlers: function () {
              this.subscribe("blur", this.handleBlur.bind(this)),
                this.subscribe("focus", this.handleFocus.bind(this)),
                this.subscribe(
                  "editableClick",
                  this.handleEditableClick.bind(this)
                ),
                this.subscribe(
                  "editableKeyup",
                  this.handleEditableKeyup.bind(this)
                ),
                this.on(
                  this.document.documentElement,
                  "mouseup",
                  this.handleDocumentMouseup.bind(this)
                ),
                this.static &&
                  this.sticky &&
                  this.on(
                    this.window,
                    "scroll",
                    this.handleWindowScroll.bind(this),
                    !0
                  ),
                this.on(
                  this.window,
                  "resize",
                  this.handleWindowResize.bind(this)
                );
            },
            handleWindowScroll: function () {
              this.positionToolbarIfShown();
            },
            handleWindowResize: function () {
              this.throttledPositionToolbar();
            },
            handleDocumentMouseup: function (e) {
              if (
                e &&
                e.target &&
                t.util.isDescendant(this.getToolbarElement(), e.target)
              )
                return !1;
              this.checkState();
            },
            handleEditableClick: function () {
              setTimeout(
                function () {
                  this.checkState();
                }.bind(this),
                0
              );
            },
            handleEditableKeyup: function () {
              this.checkState();
            },
            handleBlur: function () {
              clearTimeout(this.hideTimeout),
                clearTimeout(this.delayShowTimeout),
                (this.hideTimeout = setTimeout(
                  function () {
                    this.hideToolbar();
                  }.bind(this),
                  1
                ));
            },
            handleFocus: function () {
              this.checkState();
            },
            isDisplayed: function () {
              return this.getToolbarElement().classList.contains(
                "medium-editor-toolbar-active"
              );
            },
            showToolbar: function () {
              clearTimeout(this.hideTimeout),
                this.isDisplayed() ||
                  (this.getToolbarElement().classList.add(
                    "medium-editor-toolbar-active"
                  ),
                  this.trigger(
                    "showToolbar",
                    {},
                    this.base.getFocusedElement()
                  ));
            },
            hideToolbar: function () {
              this.isDisplayed() &&
                (this.getToolbarElement().classList.remove(
                  "medium-editor-toolbar-active"
                ),
                this.trigger("hideToolbar", {}, this.base.getFocusedElement()));
            },
            isToolbarDefaultActionsDisplayed: function () {
              return "block" === this.getToolbarActionsElement().style.display;
            },
            hideToolbarDefaultActions: function () {
              this.isToolbarDefaultActionsDisplayed() &&
                (this.getToolbarActionsElement().style.display = "none");
            },
            showToolbarDefaultActions: function () {
              this.hideExtensionForms(),
                this.isToolbarDefaultActionsDisplayed() ||
                  (this.getToolbarActionsElement().style.display = "block"),
                (this.delayShowTimeout = this.base.delay(
                  function () {
                    this.showToolbar();
                  }.bind(this)
                ));
            },
            hideExtensionForms: function () {
              this.forEachExtension(function (t) {
                t.hasForm && t.isDisplayed() && t.hideForm();
              });
            },
            multipleBlockElementsSelected: function () {
              var e = /<[^\/>][^>]*><\/[^>]+>/gim,
                i = new RegExp(
                  "<(" +
                    t.util.blockContainerElementNames.join("|") +
                    ")[^>]*>",
                  "g"
                ),
                n = t.selection.getSelectionHtml(this.document).replace(e, ""),
                a = n.match(i);
              return !!a && a.length > 1;
            },
            modifySelection: function () {
              var e = this.window.getSelection(),
                i = e.getRangeAt(0);
              if (
                this.standardizeSelectionStart &&
                i.startContainer.nodeValue &&
                i.startOffset === i.startContainer.nodeValue.length
              ) {
                var n = t.util.findAdjacentTextNodeWithContent(
                  t.selection.getSelectionElement(this.window),
                  i.startContainer,
                  this.document
                );
                if (n) {
                  for (
                    var a = 0;
                    0 === n.nodeValue.substr(a, 1).trim().length;

                  )
                    a += 1;
                  i = t.selection.select(
                    this.document,
                    n,
                    a,
                    i.endContainer,
                    i.endOffset
                  );
                }
              }
            },
            checkState: function () {
              if (!this.base.preventSelectionUpdates) {
                if (
                  !this.base.getFocusedElement() ||
                  t.selection.selectionInContentEditableFalse(this.window)
                )
                  return this.hideToolbar();
                var e = t.selection.getSelectionElement(this.window);
                return !e ||
                  -1 === this.getEditorElements().indexOf(e) ||
                  e.getAttribute("data-disable-toolbar")
                  ? this.hideToolbar()
                  : this.updateOnEmptySelection && this.static
                  ? this.showAndUpdateToolbar()
                  : !t.selection.selectionContainsContent(this.document) ||
                    (!1 === this.allowMultiParagraphSelection &&
                      this.multipleBlockElementsSelected())
                  ? this.hideToolbar()
                  : void this.showAndUpdateToolbar();
              }
            },
            showAndUpdateToolbar: function () {
              this.modifySelection(),
                this.setToolbarButtonStates(),
                this.trigger(
                  "positionToolbar",
                  {},
                  this.base.getFocusedElement()
                ),
                this.showToolbarDefaultActions(),
                this.setToolbarPosition();
            },
            setToolbarButtonStates: function () {
              this.forEachExtension(function (t) {
                "function" == typeof t.isActive &&
                  "function" == typeof t.setInactive &&
                  t.setInactive();
              }),
                this.checkActiveButtons();
            },
            checkActiveButtons: function () {
              var e,
                i = [],
                n = null,
                a = t.selection.getSelectionRange(this.document),
                o = function (t) {
                  "function" == typeof t.checkState
                    ? t.checkState(e)
                    : "function" == typeof t.isActive &&
                      "function" == typeof t.isAlreadyApplied &&
                      "function" == typeof t.setActive &&
                      !t.isActive() &&
                      t.isAlreadyApplied(e) &&
                      t.setActive();
                };
              if (
                a &&
                (this.forEachExtension(function (t) {
                  if (
                    "function" == typeof t.queryCommandState &&
                    null !== (n = t.queryCommandState())
                  )
                    return void (
                      n &&
                      "function" == typeof t.setActive &&
                      t.setActive()
                    );
                  i.push(t);
                }),
                (e = t.selection.getSelectedParentElement(a)),
                this.getEditorElements().some(function (i) {
                  return t.util.isDescendant(i, e, !0);
                }))
              )
                for (; e && (i.forEach(o), !t.util.isMediumEditorElement(e)); )
                  e = e.parentNode;
            },
            positionToolbarIfShown: function () {
              this.isDisplayed() && this.setToolbarPosition();
            },
            setToolbarPosition: function () {
              var t = this.base.getFocusedElement(),
                e = this.window.getSelection();
              if (!t) return this;
              (!this.static && e.isCollapsed) ||
                (this.showToolbar(),
                this.relativeContainer ||
                  (this.static
                    ? this.positionStaticToolbar(t)
                    : this.positionToolbar(e)),
                this.trigger(
                  "positionedToolbar",
                  {},
                  this.base.getFocusedElement()
                ));
            },
            positionStaticToolbar: function (t) {
              this.getToolbarElement().style.left = "0";
              var e,
                i =
                  (this.document.documentElement &&
                    this.document.documentElement.scrollTop) ||
                  this.document.body.scrollTop,
                n = this.window.innerWidth,
                a = this.getToolbarElement(),
                o = t.getBoundingClientRect(),
                r = o.top + i,
                s = o.left + o.width / 2,
                l = a.offsetHeight,
                d = a.offsetWidth,
                p = d / 2;
              switch (
                (this.sticky
                  ? i > r + t.offsetHeight - l - this.stickyTopOffset
                    ? ((a.style.top = r + t.offsetHeight - l + "px"),
                      a.classList.remove("medium-editor-sticky-toolbar"))
                    : i > r - l - this.stickyTopOffset
                    ? (a.classList.add("medium-editor-sticky-toolbar"),
                      (a.style.top = this.stickyTopOffset + "px"))
                    : (a.classList.remove("medium-editor-sticky-toolbar"),
                      (a.style.top = r - l + "px"))
                  : (a.style.top = r - l + "px"),
                this.align)
              ) {
                case "left":
                  e = o.left;
                  break;
                case "right":
                  e = o.right - d;
                  break;
                case "center":
                  e = s - p;
              }
              e < 0 ? (e = 0) : e + d > n && (e = n - Math.ceil(d) - 1),
                (a.style.left = e + "px");
            },
            positionToolbar: function (t) {
              (this.getToolbarElement().style.left = "0"),
                (this.getToolbarElement().style.right = "initial");
              var e = t.getRangeAt(0),
                i = e.getBoundingClientRect();
              (!i ||
                (0 === i.height &&
                  0 === i.width &&
                  e.startContainer === e.endContainer)) &&
                (i =
                  1 === e.startContainer.nodeType &&
                  e.startContainer.querySelector("img")
                    ? e.startContainer
                        .querySelector("img")
                        .getBoundingClientRect()
                    : e.startContainer.getBoundingClientRect());
              var n,
                a,
                o = this.window.innerWidth,
                r = this.getToolbarElement(),
                s = r.offsetHeight,
                l = r.offsetWidth,
                d = l / 2,
                p = this.diffLeft - d,
                c = this.getEditorOption("elementsContainer"),
                u =
                  ["absolute", "fixed"].indexOf(
                    window.getComputedStyle(c).getPropertyValue("position")
                  ) > -1,
                h = {},
                f = {};
              u
                ? ((a = c.getBoundingClientRect()),
                  ["top", "left"].forEach(function (t) {
                    f[t] = i[t] - a[t];
                  }),
                  (f.width = i.width),
                  (f.height = i.height),
                  (i = f),
                  (o = a.width),
                  (h.top = c.scrollTop))
                : (h.top = this.window.pageYOffset),
                (n = i.left + i.width / 2),
                (h.top += i.top - s),
                i.top < 50
                  ? (r.classList.add("medium-toolbar-arrow-over"),
                    r.classList.remove("medium-toolbar-arrow-under"),
                    (h.top += 50 + i.height - this.diffTop))
                  : (r.classList.add("medium-toolbar-arrow-under"),
                    r.classList.remove("medium-toolbar-arrow-over"),
                    (h.top += this.diffTop)),
                n < d
                  ? ((h.left = p + d), (h.right = "initial"))
                  : o - n < d
                  ? ((h.left = "auto"), (h.right = 0))
                  : ((h.left = p + n), (h.right = "initial")),
                ["top", "left", "right"].forEach(function (t) {
                  r.style[t] = h[t] + (isNaN(h[t]) ? "" : "px");
                });
            },
          });
          t.extensions.toolbar = e;
        })(),
        (function () {
          var e = t.Extension.extend({
            init: function () {
              t.Extension.prototype.init.apply(this, arguments),
                this.subscribe("editableDrag", this.handleDrag.bind(this)),
                this.subscribe("editableDrop", this.handleDrop.bind(this));
            },
            handleDrag: function (t) {
              t.preventDefault(),
                (t.dataTransfer.dropEffect = "copy"),
                "dragover" === t.type
                  ? t.target.classList.add("medium-editor-dragover")
                  : "dragleave" === t.type &&
                    t.target.classList.remove("medium-editor-dragover");
            },
            handleDrop: function (e) {
              var i;
              e.preventDefault(),
                e.stopPropagation(),
                e.dataTransfer.files &&
                  ((i = Array.prototype.slice.call(e.dataTransfer.files, 0)),
                  i.some(
                    function (e) {
                      if (e.type.match("image")) {
                        var i, n;
                        (i = new FileReader()),
                          i.readAsDataURL(e),
                          (n = "medium-img-" + +new Date()),
                          t.util.insertHTMLCommand(
                            this.document,
                            '<img class="medium-editor-image-loading" id="' +
                              n +
                              '" />'
                          ),
                          (i.onload = function () {
                            var t = this.document.getElementById(n);
                            t &&
                              (t.removeAttribute("id"),
                              t.removeAttribute("class"),
                              (t.src = i.result));
                          }.bind(this));
                      }
                    }.bind(this)
                  )),
                e.target.classList.remove("medium-editor-dragover");
            },
          });
          t.extensions.imageDragging = e;
        })(),
        (function () {
          function e(e) {
            var i = t.selection.getSelectionStart(this.options.ownerDocument),
              n = i.textContent,
              a = t.selection.getCaretOffsets(i);
            (void 0 === n[a.left - 1] ||
              "" === n[a.left - 1].trim() ||
              (void 0 !== n[a.left] && "" === n[a.left].trim())) &&
              e.preventDefault();
          }
          function i(e, i) {
            if (
              this.options.disableReturn ||
              i.getAttribute("data-disable-return")
            )
              e.preventDefault();
            else if (
              this.options.disableDoubleReturn ||
              i.getAttribute("data-disable-double-return")
            ) {
              var n = t.selection.getSelectionStart(this.options.ownerDocument);
              ((n &&
                "" === n.textContent.trim() &&
                "li" !== n.nodeName.toLowerCase()) ||
                (n.previousElementSibling &&
                  "br" !== n.previousElementSibling.nodeName.toLowerCase() &&
                  "" === n.previousElementSibling.textContent.trim())) &&
                e.preventDefault();
            }
          }
          function n(e) {
            var i = t.selection.getSelectionStart(this.options.ownerDocument);
            "pre" === (i && i.nodeName.toLowerCase()) &&
              (e.preventDefault(),
              t.util.insertHTMLCommand(this.options.ownerDocument, "    ")),
              t.util.isListItem(i) &&
                (e.preventDefault(),
                e.shiftKey
                  ? this.options.ownerDocument.execCommand("outdent", !1, null)
                  : this.options.ownerDocument.execCommand("indent", !1, null));
          }
          function a(e) {
            var i,
              n = t.selection.getSelectionStart(this.options.ownerDocument),
              a = n.nodeName.toLowerCase(),
              o = /^(\s+|<br\/?>)?$/i,
              r = /h\d/i;
            t.util.isKey(e, [t.util.keyCode.BACKSPACE, t.util.keyCode.ENTER]) &&
            n.previousElementSibling &&
            r.test(a) &&
            0 === t.selection.getCaretOffsets(n).left
              ? t.util.isKey(e, t.util.keyCode.BACKSPACE) &&
                o.test(n.previousElementSibling.innerHTML)
                ? (n.previousElementSibling.parentNode.removeChild(
                    n.previousElementSibling
                  ),
                  e.preventDefault())
                : !this.options.disableDoubleReturn &&
                  t.util.isKey(e, t.util.keyCode.ENTER) &&
                  ((i = this.options.ownerDocument.createElement("p")),
                  (i.innerHTML = "<br>"),
                  n.previousElementSibling.parentNode.insertBefore(i, n),
                  e.preventDefault())
              : t.util.isKey(e, t.util.keyCode.DELETE) &&
                n.nextElementSibling &&
                n.previousElementSibling &&
                !r.test(a) &&
                o.test(n.innerHTML) &&
                r.test(n.nextElementSibling.nodeName.toLowerCase())
              ? (t.selection.moveCursor(
                  this.options.ownerDocument,
                  n.nextElementSibling
                ),
                n.previousElementSibling.parentNode.removeChild(n),
                e.preventDefault())
              : t.util.isKey(e, t.util.keyCode.BACKSPACE) &&
                "li" === a &&
                o.test(n.innerHTML) &&
                !n.previousElementSibling &&
                !n.parentElement.previousElementSibling &&
                n.nextElementSibling &&
                "li" === n.nextElementSibling.nodeName.toLowerCase()
              ? ((i = this.options.ownerDocument.createElement("p")),
                (i.innerHTML = "<br>"),
                n.parentElement.parentElement.insertBefore(i, n.parentElement),
                t.selection.moveCursor(this.options.ownerDocument, i),
                n.parentElement.removeChild(n),
                e.preventDefault())
              : t.util.isKey(e, t.util.keyCode.BACKSPACE) &&
                !1 !== t.util.getClosestTag(n, "blockquote") &&
                0 === t.selection.getCaretOffsets(n).left
              ? (e.preventDefault(),
                t.util.execFormatBlock(this.options.ownerDocument, "p"))
              : t.util.isKey(e, t.util.keyCode.ENTER) &&
                !1 !== t.util.getClosestTag(n, "blockquote") &&
                0 === t.selection.getCaretOffsets(n).right &&
                ((i = this.options.ownerDocument.createElement("p")),
                (i.innerHTML = "<br>"),
                n.parentElement.insertBefore(i, n.nextSibling),
                t.selection.moveCursor(this.options.ownerDocument, i),
                e.preventDefault());
          }
          function o(e) {
            var i,
              n = t.selection.getSelectionStart(this.options.ownerDocument);
            n &&
              (t.util.isMediumEditorElement(n) &&
                0 === n.children.length &&
                !t.util.isBlockContainer(n) &&
                this.options.ownerDocument.execCommand("formatBlock", !1, "p"),
              !t.util.isKey(e, t.util.keyCode.ENTER) ||
                t.util.isListItem(n) ||
                t.util.isBlockContainer(n) ||
                ((i = n.nodeName.toLowerCase()),
                "a" === i
                  ? this.options.ownerDocument.execCommand("unlink", !1, null)
                  : e.shiftKey ||
                    e.ctrlKey ||
                    this.options.ownerDocument.execCommand(
                      "formatBlock",
                      !1,
                      "p"
                    )));
          }
          function r(t, e) {
            var i = e.parentNode.querySelector(
              'textarea[medium-editor-textarea-id="' +
                e.getAttribute("medium-editor-textarea-id") +
                '"]'
            );
            i && (i.value = e.innerHTML.trim());
          }
          function s(t) {
            t._mediumEditors || (t._mediumEditors = [null]),
              this.id || (this.id = t._mediumEditors.length),
              (t._mediumEditors[this.id] = this);
          }
          function l(t) {
            t._mediumEditors &&
              t._mediumEditors[this.id] &&
              (t._mediumEditors[this.id] = null);
          }
          function d(e, i, n) {
            var a = [];
            if (
              (e || (e = []),
              "string" == typeof e && (e = i.querySelectorAll(e)),
              t.util.isElement(e) && (e = [e]),
              n)
            )
              for (var o = 0; o < e.length; o++) {
                var r = e[o];
                !t.util.isElement(r) ||
                  r.getAttribute("data-medium-editor-element") ||
                  r.getAttribute("medium-editor-textarea-id") ||
                  a.push(r);
              }
            else a = Array.prototype.slice.apply(e);
            return a;
          }
          function p(t) {
            var e = t.parentNode.querySelector(
              'textarea[medium-editor-textarea-id="' +
                t.getAttribute("medium-editor-textarea-id") +
                '"]'
            );
            e &&
              (e.classList.remove("medium-editor-hidden"),
              e.removeAttribute("medium-editor-textarea-id")),
              t.parentNode && t.parentNode.removeChild(t);
          }
          function c(t, e) {
            return (
              Object.keys(e).forEach(function (i) {
                void 0 === t[i] && (t[i] = e[i]);
              }),
              t
            );
          }
          function u(t, e, i) {
            return (
              (t = c(t, {
                window: i.options.contentWindow,
                document: i.options.ownerDocument,
                base: i,
              })),
              "function" == typeof t.init && t.init(),
              t.name || (t.name = e),
              t
            );
          }
          function h() {
            return (
              !this.elements.every(function (t) {
                return !!t.getAttribute("data-disable-toolbar");
              }) && !1 !== this.options.toolbar
            );
          }
          function f() {
            return !!h.call(this) && !1 !== this.options.anchorPreview;
          }
          function m() {
            return !1 !== this.options.placeholder;
          }
          function g() {
            return !1 !== this.options.autoLink;
          }
          function b() {
            return !1 !== this.options.imageDragging;
          }
          function v() {
            return !1 !== this.options.keyboardCommands;
          }
          function y() {
            return !this.options.extensions.imageDragging;
          }
          function w(t) {
            for (
              var e = this.options.ownerDocument.createElement("div"),
                i = Date.now(),
                n = "medium-editor-" + i,
                a = t.attributes;
              this.options.ownerDocument.getElementById(n);

            )
              i++, (n = "medium-editor-" + i);
            (e.className = t.className),
              (e.id = n),
              (e.innerHTML = t.value),
              t.setAttribute("medium-editor-textarea-id", n);
            for (var o = 0, r = a.length; o < r; o++)
              e.hasAttribute(a[o].nodeName) ||
                e.setAttribute(a[o].nodeName, a[o].nodeValue);
            return (
              t.form &&
                this.on(
                  t.form,
                  "reset",
                  function (t) {
                    t.defaultPrevented ||
                      this.resetContent(
                        this.options.ownerDocument.getElementById(n)
                      );
                  }.bind(this)
                ),
              t.classList.add("medium-editor-hidden"),
              t.parentNode.insertBefore(e, t),
              e
            );
          }
          function C(e, n) {
            if (!e.getAttribute("data-medium-editor-element")) {
              "textarea" === e.nodeName.toLowerCase() &&
                ((e = w.call(this, e)),
                this.instanceHandleEditableInput ||
                  ((this.instanceHandleEditableInput = r.bind(this)),
                  this.subscribe(
                    "editableInput",
                    this.instanceHandleEditableInput
                  ))),
                this.options.disableEditing ||
                  e.getAttribute("data-disable-editing") ||
                  (e.setAttribute("contentEditable", !0),
                  e.setAttribute("spellcheck", this.options.spellcheck)),
                this.instanceHandleEditableKeydownEnter ||
                  ((e.getAttribute("data-disable-return") ||
                    e.getAttribute("data-disable-double-return")) &&
                    ((this.instanceHandleEditableKeydownEnter = i.bind(this)),
                    this.subscribe(
                      "editableKeydownEnter",
                      this.instanceHandleEditableKeydownEnter
                    ))),
                this.options.disableReturn ||
                  e.getAttribute("data-disable-return") ||
                  this.on(e, "keyup", o.bind(this));
              var a = t.util.guid();
              e.setAttribute("data-medium-editor-element", !0),
                e.classList.add("medium-editor-element"),
                e.setAttribute("role", "textbox"),
                e.setAttribute("aria-multiline", !0),
                e.setAttribute("data-medium-editor-editor-index", n),
                e.setAttribute("medium-editor-index", a),
                (E[a] = e.innerHTML),
                this.events.attachAllEventsToElement(e);
            }
            return e;
          }
          function _() {
            this.subscribe("editableKeydownTab", n.bind(this)),
              this.subscribe("editableKeydownDelete", a.bind(this)),
              this.subscribe("editableKeydownEnter", a.bind(this)),
              this.options.disableExtraSpaces &&
                this.subscribe("editableKeydownSpace", e.bind(this)),
              this.instanceHandleEditableKeydownEnter ||
                ((this.options.disableReturn ||
                  this.options.disableDoubleReturn) &&
                  ((this.instanceHandleEditableKeydownEnter = i.bind(this)),
                  this.subscribe(
                    "editableKeydownEnter",
                    this.instanceHandleEditableKeydownEnter
                  )));
          }
          function x() {
            if (
              ((this.extensions = []),
              Object.keys(this.options.extensions).forEach(function (t) {
                "toolbar" !== t &&
                  this.options.extensions[t] &&
                  this.extensions.push(u(this.options.extensions[t], t, this));
              }, this),
              y.call(this))
            ) {
              var e = this.options.fileDragging;
              e || ((e = {}), b.call(this) || (e.allowedTypes = [])),
                this.addBuiltInExtension("fileDragging", e);
            }
            var i = {
              paste: !0,
              "anchor-preview": f.call(this),
              autoLink: g.call(this),
              keyboardCommands: v.call(this),
              placeholder: m.call(this),
            };
            Object.keys(i).forEach(function (t) {
              i[t] && this.addBuiltInExtension(t);
            }, this);
            var n = this.options.extensions.toolbar;
            if (!n && h.call(this)) {
              var a = t.util.extend({}, this.options.toolbar, {
                allowMultiParagraphSelection:
                  this.options.allowMultiParagraphSelection,
              });
              n = new t.extensions.toolbar(a);
            }
            n && this.extensions.push(u(n, "toolbar", this));
          }
          function S(e, i) {
            var n = [
              [
                "allowMultiParagraphSelection",
                "toolbar.allowMultiParagraphSelection",
              ],
            ];
            return (
              i &&
                n.forEach(function (e) {
                  i.hasOwnProperty(e[0]) &&
                    void 0 !== i[e[0]] &&
                    t.util.deprecated(e[0], e[1], "v6.0.0");
                }),
              t.util.defaults({}, i, e)
            );
          }
          function T(e, i) {
            var n,
              a,
              o = /^append-(.+)$/gi,
              r = /justify([A-Za-z]*)$/g;
            if ((n = o.exec(e)))
              return t.util.execFormatBlock(this.options.ownerDocument, n[1]);
            if ("fontSize" === e)
              return (
                i.size &&
                  t.util.deprecated(
                    ".size option for fontSize command",
                    ".value",
                    "6.0.0"
                  ),
                (a = i.value || i.size),
                this.options.ownerDocument.execCommand("fontSize", !1, a)
              );
            if ("fontName" === e)
              return (
                i.name &&
                  t.util.deprecated(
                    ".name option for fontName command",
                    ".value",
                    "6.0.0"
                  ),
                (a = i.value || i.name),
                this.options.ownerDocument.execCommand("fontName", !1, a)
              );
            if ("createLink" === e) return this.createLink(i);
            if ("image" === e) {
              var s = this.options.contentWindow
                .getSelection()
                .toString()
                .trim();
              return this.options.ownerDocument.execCommand(
                "insertImage",
                !1,
                s
              );
            }
            if (r.exec(e)) {
              var l = this.options.ownerDocument.execCommand(e, !1, null),
                d = t.selection.getSelectedParentElement(
                  t.selection.getSelectionRange(this.options.ownerDocument)
                );
              return d && k.call(this, t.util.getTopBlockContainer(d)), l;
            }
            return (
              (a = i && i.value),
              this.options.ownerDocument.execCommand(e, !1, a)
            );
          }
          function k(e) {
            if (e) {
              var i,
                n = Array.prototype.slice
                  .call(e.childNodes)
                  .filter(function (t) {
                    var e = "div" === t.nodeName.toLowerCase();
                    return e && !i && (i = t.style.textAlign), e;
                  });
              n.length &&
                (this.saveSelection(),
                n.forEach(function (e) {
                  if (e.style.textAlign === i) {
                    var n = e.lastChild;
                    if (n) {
                      t.util.unwrap(e, this.options.ownerDocument);
                      var a = this.options.ownerDocument.createElement("BR");
                      n.parentNode.insertBefore(a, n.nextSibling);
                    }
                  }
                }, this),
                (e.style.textAlign = i),
                this.restoreSelection());
            }
          }
          var E = {};
          (t.prototype = {
            init: function (t, e) {
              return (
                (this.options = S.call(this, this.defaults, e)),
                (this.origElements = t),
                this.options.elementsContainer ||
                  (this.options.elementsContainer =
                    this.options.ownerDocument.body),
                this.setup()
              );
            },
            setup: function () {
              this.isActive ||
                (s.call(this, this.options.contentWindow),
                (this.events = new t.Events(this)),
                (this.elements = []),
                this.addElements(this.origElements),
                0 !== this.elements.length &&
                  ((this.isActive = !0), x.call(this), _.call(this)));
            },
            destroy: function () {
              this.isActive &&
                ((this.isActive = !1),
                this.extensions.forEach(function (t) {
                  "function" == typeof t.destroy && t.destroy();
                }, this),
                this.events.destroy(),
                this.elements.forEach(function (t) {
                  this.options.spellcheck && (t.innerHTML = t.innerHTML),
                    t.removeAttribute("contentEditable"),
                    t.removeAttribute("spellcheck"),
                    t.removeAttribute("data-medium-editor-element"),
                    t.classList.remove("medium-editor-element"),
                    t.removeAttribute("role"),
                    t.removeAttribute("aria-multiline"),
                    t.removeAttribute("medium-editor-index"),
                    t.removeAttribute("data-medium-editor-editor-index"),
                    t.getAttribute("medium-editor-textarea-id") && p(t);
                }, this),
                (this.elements = []),
                (this.instanceHandleEditableKeydownEnter = null),
                (this.instanceHandleEditableInput = null),
                l.call(this, this.options.contentWindow));
            },
            on: function (t, e, i, n) {
              return this.events.attachDOMEvent(t, e, i, n), this;
            },
            off: function (t, e, i, n) {
              return this.events.detachDOMEvent(t, e, i, n), this;
            },
            subscribe: function (t, e) {
              return this.events.attachCustomEvent(t, e), this;
            },
            unsubscribe: function (t, e) {
              return this.events.detachCustomEvent(t, e), this;
            },
            trigger: function (t, e, i) {
              return this.events.triggerCustomEvent(t, e, i), this;
            },
            delay: function (t) {
              var e = this;
              return setTimeout(function () {
                e.isActive && t();
              }, this.options.delay);
            },
            serialize: function () {
              var t,
                e,
                i = {},
                n = this.elements.length;
              for (t = 0; t < n; t += 1)
                (e =
                  "" !== this.elements[t].id
                    ? this.elements[t].id
                    : "element-" + t),
                  (i[e] = { value: this.elements[t].innerHTML.trim() });
              return i;
            },
            getExtensionByName: function (t) {
              var e;
              return (
                this.extensions &&
                  this.extensions.length &&
                  this.extensions.some(function (i) {
                    return i.name === t && ((e = i), !0);
                  }),
                e
              );
            },
            addBuiltInExtension: function (e, i) {
              var n,
                a = this.getExtensionByName(e);
              if (a) return a;
              switch (e) {
                case "anchor":
                  (n = t.util.extend({}, this.options.anchor, i)),
                    (a = new t.extensions.anchor(n));
                  break;
                case "anchor-preview":
                  a = new t.extensions.anchorPreview(
                    this.options.anchorPreview
                  );
                  break;
                case "autoLink":
                  a = new t.extensions.autoLink();
                  break;
                case "fileDragging":
                  a = new t.extensions.fileDragging(i);
                  break;
                case "fontname":
                  a = new t.extensions.fontName(this.options.fontName);
                  break;
                case "fontsize":
                  a = new t.extensions.fontSize(i);
                  break;
                case "keyboardCommands":
                  a = new t.extensions.keyboardCommands(
                    this.options.keyboardCommands
                  );
                  break;
                case "paste":
                  a = new t.extensions.paste(this.options.paste);
                  break;
                case "placeholder":
                  a = new t.extensions.placeholder(this.options.placeholder);
                  break;
                default:
                  t.extensions.button.isBuiltInButton(e) &&
                    (i
                      ? ((n = t.util.defaults(
                          {},
                          i,
                          t.extensions.button.prototype.defaults[e]
                        )),
                        (a = new t.extensions.button(n)))
                      : (a = new t.extensions.button(e)));
              }
              return a && this.extensions.push(u(a, e, this)), a;
            },
            stopSelectionUpdates: function () {
              this.preventSelectionUpdates = !0;
            },
            startSelectionUpdates: function () {
              this.preventSelectionUpdates = !1;
            },
            checkSelection: function () {
              var t = this.getExtensionByName("toolbar");
              return t && t.checkState(), this;
            },
            queryCommandState: function (t) {
              var e,
                i = /^full-(.+)$/gi,
                n = null;
              (e = i.exec(t)) && (t = e[1]);
              try {
                n = this.options.ownerDocument.queryCommandState(t);
              } catch (t) {
                n = null;
              }
              return n;
            },
            execAction: function (e, i) {
              var n,
                a,
                o = /^full-(.+)$/gi;
              return (
                (n = o.exec(e)),
                n
                  ? (this.saveSelection(),
                    this.selectAllContents(),
                    (a = T.call(this, n[1], i)),
                    this.restoreSelection())
                  : (a = T.call(this, e, i)),
                ("insertunorderedlist" !== e && "insertorderedlist" !== e) ||
                  t.util.cleanListDOM(
                    this.options.ownerDocument,
                    this.getSelectedParentElement()
                  ),
                this.checkSelection(),
                a
              );
            },
            getSelectedParentElement: function (e) {
              return (
                void 0 === e &&
                  (e = this.options.contentWindow.getSelection().getRangeAt(0)),
                t.selection.getSelectedParentElement(e)
              );
            },
            selectAllContents: function () {
              var e = t.selection.getSelectionElement(
                this.options.contentWindow
              );
              if (e) {
                for (; 1 === e.children.length; ) e = e.children[0];
                this.selectElement(e);
              }
            },
            selectElement: function (e) {
              t.selection.selectNode(e, this.options.ownerDocument);
              var i = t.selection.getSelectionElement(
                this.options.contentWindow
              );
              i && this.events.focusElement(i);
            },
            getFocusedElement: function () {
              var t;
              return (
                this.elements.some(function (e) {
                  return (
                    !t && e.getAttribute("data-medium-focused") && (t = e), !!t
                  );
                }, this),
                t
              );
            },
            exportSelection: function () {
              var e = t.selection.getSelectionElement(
                  this.options.contentWindow
                ),
                i = this.elements.indexOf(e),
                n = null;
              return (
                i >= 0 &&
                  (n = t.selection.exportSelection(
                    e,
                    this.options.ownerDocument
                  )),
                null !== n && 0 !== i && (n.editableElementIndex = i),
                n
              );
            },
            saveSelection: function () {
              this.selectionState = this.exportSelection();
            },
            importSelection: function (e, i) {
              if (e) {
                var n = this.elements[e.editableElementIndex || 0];
                t.selection.importSelection(
                  e,
                  n,
                  this.options.ownerDocument,
                  i
                );
              }
            },
            restoreSelection: function () {
              this.importSelection(this.selectionState);
            },
            createLink: function (e) {
              var i,
                n = t.selection.getSelectionElement(this.options.contentWindow),
                a = {};
              if (-1 !== this.elements.indexOf(n)) {
                try {
                  if (
                    (this.events.disableCustomEvent("editableInput"),
                    e.url &&
                      t.util.deprecated(
                        ".url option for createLink",
                        ".value",
                        "6.0.0"
                      ),
                    (i = e.url || e.value) && i.trim().length > 0)
                  ) {
                    var o = this.options.contentWindow.getSelection();
                    if (o) {
                      var r,
                        s,
                        l,
                        d,
                        p = o.getRangeAt(0),
                        c = p.commonAncestorContainer;
                      if (
                        (3 === p.endContainer.nodeType &&
                          3 !== p.startContainer.nodeType &&
                          0 === p.startOffset &&
                          p.startContainer.firstChild === p.endContainer &&
                          (c = p.endContainer),
                        (s = t.util.getClosestBlockContainer(p.startContainer)),
                        (l = t.util.getClosestBlockContainer(p.endContainer)),
                        3 !== c.nodeType &&
                          0 !== c.textContent.length &&
                          s === l)
                      ) {
                        var u = s || n,
                          h =
                            this.options.ownerDocument.createDocumentFragment();
                        this.execAction("unlink"),
                          (r = this.exportSelection()),
                          h.appendChild(u.cloneNode(!0)),
                          n === u
                            ? t.selection.select(
                                this.options.ownerDocument,
                                u.firstChild,
                                0,
                                u.lastChild,
                                3 === u.lastChild.nodeType
                                  ? u.lastChild.nodeValue.length
                                  : u.lastChild.childNodes.length
                              )
                            : t.selection.select(
                                this.options.ownerDocument,
                                u,
                                0,
                                u,
                                u.childNodes.length
                              );
                        var f = this.exportSelection();
                        (d = t.util.findOrCreateMatchingTextNodes(
                          this.options.ownerDocument,
                          h,
                          {
                            start: r.start - f.start,
                            end: r.end - f.start,
                            editableElementIndex: r.editableElementIndex,
                          }
                        )),
                          0 === d.length &&
                            ((h =
                              this.options.ownerDocument.createDocumentFragment()),
                            h.appendChild(c.cloneNode(!0)),
                            (d = [
                              h.firstChild.firstChild,
                              h.firstChild.lastChild,
                            ])),
                          t.util.createLink(
                            this.options.ownerDocument,
                            d,
                            i.trim()
                          );
                        var m = (h.firstChild.innerHTML.match(/^\s+/) || [
                          "",
                        ])[0].length;
                        t.util.insertHTMLCommand(
                          this.options.ownerDocument,
                          h.firstChild.innerHTML.replace(/^\s+/, "")
                        ),
                          (r.start -= m),
                          (r.end -= m),
                          this.importSelection(r);
                      } else
                        this.options.ownerDocument.execCommand(
                          "createLink",
                          !1,
                          i
                        );
                      this.options.targetBlank || "_blank" === e.target
                        ? t.util.setTargetBlank(
                            t.selection.getSelectionStart(
                              this.options.ownerDocument
                            ),
                            i
                          )
                        : t.util.removeTargetBlank(
                            t.selection.getSelectionStart(
                              this.options.ownerDocument
                            ),
                            i
                          ),
                        e.buttonClass &&
                          t.util.addClassToAnchors(
                            t.selection.getSelectionStart(
                              this.options.ownerDocument
                            ),
                            e.buttonClass
                          );
                    }
                  }
                  if (
                    this.options.targetBlank ||
                    "_blank" === e.target ||
                    e.buttonClass
                  ) {
                    (a = this.options.ownerDocument.createEvent("HTMLEvents")),
                      a.initEvent("input", !0, !0, this.options.contentWindow);
                    for (var g = 0, b = this.elements.length; g < b; g += 1)
                      this.elements[g].dispatchEvent(a);
                  }
                } finally {
                  this.events.enableCustomEvent("editableInput");
                }
                this.events.triggerCustomEvent("editableInput", a, n);
              }
            },
            cleanPaste: function (t) {
              this.getExtensionByName("paste").cleanPaste(t);
            },
            pasteHTML: function (t, e) {
              this.getExtensionByName("paste").pasteHTML(t, e);
            },
            setContent: function (t, e) {
              if (((e = e || 0), this.elements[e])) {
                var i = this.elements[e];
                (i.innerHTML = t), this.checkContentChanged(i);
              }
            },
            getContent: function (t) {
              return (
                (t = t || 0),
                this.elements[t] ? this.elements[t].innerHTML.trim() : null
              );
            },
            checkContentChanged: function (e) {
              (e =
                e ||
                t.selection.getSelectionElement(this.options.contentWindow)),
                this.events.updateInput(e, { target: e, currentTarget: e });
            },
            resetContent: function (t) {
              if (t) {
                var e = this.elements.indexOf(t);
                return void (
                  -1 !== e &&
                  this.setContent(E[t.getAttribute("medium-editor-index")], e)
                );
              }
              this.elements.forEach(function (t, e) {
                this.setContent(E[t.getAttribute("medium-editor-index")], e);
              }, this);
            },
            addElements: function (t) {
              var e = d(t, this.options.ownerDocument, !0);
              if (0 === e.length) return !1;
              e.forEach(function (t) {
                (t = C.call(this, t, this.id)),
                  this.elements.push(t),
                  this.trigger(
                    "addElement",
                    { target: t, currentTarget: t },
                    t
                  );
              }, this);
            },
            removeElements: function (t) {
              var e = d(t, this.options.ownerDocument),
                i = e.map(function (t) {
                  return t.getAttribute("medium-editor-textarea-id") &&
                    t.parentNode
                    ? t.parentNode.querySelector(
                        'div[medium-editor-textarea-id="' +
                          t.getAttribute("medium-editor-textarea-id") +
                          '"]'
                      )
                    : t;
                });
              this.elements = this.elements.filter(function (t) {
                return (
                  -1 === i.indexOf(t) ||
                  (this.events.cleanupElement(t),
                  t.getAttribute("medium-editor-textarea-id") && p(t),
                  this.trigger(
                    "removeElement",
                    { target: t, currentTarget: t },
                    t
                  ),
                  !1)
                );
              }, this);
            },
          }),
            (t.getEditorFromElement = function (t) {
              var e = t.getAttribute("data-medium-editor-editor-index"),
                i =
                  t &&
                  t.ownerDocument &&
                  (t.ownerDocument.defaultView || t.ownerDocument.parentWindow);
              return i && i._mediumEditors && i._mediumEditors[e]
                ? i._mediumEditors[e]
                : null;
            });
        })(),
        (function () {
          t.prototype.defaults = {
            activeButtonClass: "medium-editor-button-active",
            buttonLabels: !1,
            delay: 0,
            disableReturn: !1,
            disableDoubleReturn: !1,
            disableExtraSpaces: !1,
            disableEditing: !1,
            autoLink: !1,
            elementsContainer: !1,
            contentWindow: window,
            ownerDocument: document,
            targetBlank: !1,
            extensions: {},
            spellcheck: !0,
          };
        })(),
        (t.parseVersionString = function (t) {
          var e = t.split("-"),
            i = e[0].split("."),
            n = e.length > 1 ? e[1] : "";
          return {
            major: parseInt(i[0], 10),
            minor: parseInt(i[1], 10),
            revision: parseInt(i[2], 10),
            preRelease: n,
            toString: function () {
              return [i[0], i[1], i[2]].join(".") + (n ? "-" + n : "");
            },
          };
        }),
        (t.version = t.parseVersionString.call(
          this,
          { version: "5.21.1" }.version
        )),
        t
      );
    })()
  ),
  define(
    "lib-build/css!lib-app/medium-editor/dist/css/medium-editor",
    [],
    function () {}
  ),
  define(
    "lib-build/css!lib-app/medium-editor/dist/css/themes/flat",
    [],
    function () {}
  ),
  define(
    "lib-build/css!lib-app/font-awesome/css/font-awesome",
    [],
    function () {}
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/textEditor/MediumEditorWrapper",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/textEditor/MediumEditorWrapper",
    [
      "lib-app/medium-editor/dist/js/medium-editor",
      "lib-build/css!lib-app/medium-editor/dist/css/medium-editor",
      "lib-build/css!lib-app/medium-editor/dist/css/themes/flat",
      "lib-build/css!lib-app/font-awesome/css/font-awesome",
      "lib-build/css!./MediumEditorWrapper",
      "dojo/_base/lang",
    ],
    function (t, e, i, n, a, o) {
      var r = {
          buttonLabels: "fontawesome",
          targetBlank: !0,
          autoLink: !0,
          imageDragging: !1,
          fileDragging: !1,
          disableDoubleReturn: !0,
          anchor: { linkValidation: !0, placeholderText: "Enter a link..." },
          paste: { forcePlainText: !0, cleanPastedHTML: !1 },
          extensions: { imageDragging: new (function () {})() },
        },
        s = { toolbar: !1, disableReturn: !0, keyboardCommands: !1 },
        l = {
          toolbar: { allowMultiParagraphSelection: !1, buttons: ["anchor"] },
          disableReturn: !0,
          keyboardCommands: !1,
        },
        d = {
          toolbar: {
            allowMultiParagraphSelection: !1,
            buttons: ["bold", "italic", "underline", "anchor"],
          },
        },
        p = t.selection;
      return function (e) {
        if (((e = e || {}), !e.container))
          return void console.error(
            "Could not initialize MediumEditorWrapper, userOptions:",
            e
          );
        var i = e.mode || "standard",
          n = o.mixin({}, r);
        "single-line" == i
          ? (n = o.mixin(n, s))
          : "link" == i
          ? ((n = o.mixin(n, l)),
            (n.placeholder = {
              text: "Enter the link label and highlight it...",
              hideOnClick: !1,
            }))
          : (n = o.mixin(n, d)),
          e.placeholder &&
            (n.placeholder = { text: e.placeholder, hideOnClick: !1 }),
          (n = o.mixin(n, e.editorConfig)),
          (n.elementsContainer = e.container.parent()[0]);
        var a = new t(e.container, n);
        e.onBlur &&
          "function" == typeof e.onBlur &&
          a.subscribe("blur", e.onBlur),
          a.subscribe("editableInput", function (t, e) {
            $(e)
              .find("p")
              .contents()
              .each(function () {
                (this.nodeType !== Node.COMMENT_NODE && 8 != this.nodeType) ||
                  $(this).remove();
              });
          }),
          a.subscribe(
            "editableKeydownEnter",
            function (t) {
              var e = $(a.getSelectedParentElement()),
                i = p.getSelectionRange(document),
                n = e.children();
              "" == e.html() && 0 == n.length && t.preventDefault(),
                ("" != e.prev().html() && "<br>" != e.prev().html()) ||
                  0 !== i.startOffset ||
                  t.preventDefault(),
                1 == n.length &&
                  ("br" != n[0].tagName.toLowerCase() ||
                    e.text() ||
                    t.preventDefault());
            }.bind(this)
          );
        var c = $(a.elements[0]);
        c.on("input", function () {
          c.children("p")
            .children("span[style]")
            .each(function () {
              (this.style.color &&
                "inherit" != this.style.color &&
                "rgb(0, 0, 0)" != this.style.color) ||
                $(this).contents().unwrap();
            });
        }),
          (this.setContent = function (t) {
            t = t || {};
            var e = t.text;
            void 0 !== e &&
              ((e = "<p>" + e + "</p>"),
              t.convertLine && (e = e.replace(/\n{2}/g, "</p><p>")),
              a.setContent(e));
          });
      };
    }
  ),
  (function (t, e) {
    function i(e, i) {
      var a,
        o,
        r,
        s = e.nodeName.toLowerCase();
      return "area" === s
        ? ((a = e.parentNode),
          (o = a.name),
          !(!e.href || !o || "map" !== a.nodeName.toLowerCase()) &&
            !!(r = t("img[usemap=#" + o + "]")[0]) &&
            n(r))
        : (/input|select|textarea|button|object/.test(s)
            ? !e.disabled
            : "a" === s
            ? e.href || i
            : i) && n(e);
    }
    function n(e) {
      return (
        t.expr.filters.visible(e) &&
        !t(e)
          .parents()
          .addBack()
          .filter(function () {
            return "hidden" === t.css(this, "visibility");
          }).length
      );
    }
    var a = 0,
      o = /^ui-id-\d+$/;
    (t.ui = t.ui || {}),
      t.extend(t.ui, {
        version: "1.10.4",
        keyCode: {
          BACKSPACE: 8,
          COMMA: 188,
          DELETE: 46,
          DOWN: 40,
          END: 35,
          ENTER: 13,
          ESCAPE: 27,
          HOME: 36,
          LEFT: 37,
          NUMPAD_ADD: 107,
          NUMPAD_DECIMAL: 110,
          NUMPAD_DIVIDE: 111,
          NUMPAD_ENTER: 108,
          NUMPAD_MULTIPLY: 106,
          NUMPAD_SUBTRACT: 109,
          PAGE_DOWN: 34,
          PAGE_UP: 33,
          PERIOD: 190,
          RIGHT: 39,
          SPACE: 32,
          TAB: 9,
          UP: 38,
        },
      }),
      t.fn.extend({
        focus: (function (e) {
          return function (i, n) {
            return "number" == typeof i
              ? this.each(function () {
                  var e = this;
                  setTimeout(function () {
                    t(e).focus(), n && n.call(e);
                  }, i);
                })
              : e.apply(this, arguments);
          };
        })(t.fn.focus),
        scrollParent: function () {
          var e;
          return (
            (e =
              (t.ui.ie && /(static|relative)/.test(this.css("position"))) ||
              /absolute/.test(this.css("position"))
                ? this.parents()
                    .filter(function () {
                      return (
                        /(relative|absolute|fixed)/.test(
                          t.css(this, "position")
                        ) &&
                        /(auto|scroll)/.test(
                          t.css(this, "overflow") +
                            t.css(this, "overflow-y") +
                            t.css(this, "overflow-x")
                        )
                      );
                    })
                    .eq(0)
                : this.parents()
                    .filter(function () {
                      return /(auto|scroll)/.test(
                        t.css(this, "overflow") +
                          t.css(this, "overflow-y") +
                          t.css(this, "overflow-x")
                      );
                    })
                    .eq(0)),
            /fixed/.test(this.css("position")) || !e.length ? t(document) : e
          );
        },
        zIndex: function (i) {
          if (i !== e) return this.css("zIndex", i);
          if (this.length)
            for (var n, a, o = t(this[0]); o.length && o[0] !== document; ) {
              if (
                ("absolute" === (n = o.css("position")) ||
                  "relative" === n ||
                  "fixed" === n) &&
                ((a = parseInt(o.css("zIndex"), 10)), !isNaN(a) && 0 !== a)
              )
                return a;
              o = o.parent();
            }
          return 0;
        },
        uniqueId: function () {
          return this.each(function () {
            this.id || (this.id = "ui-id-" + ++a);
          });
        },
        removeUniqueId: function () {
          return this.each(function () {
            o.test(this.id) && t(this).removeAttr("id");
          });
        },
      }),
      t.extend(t.expr[":"], {
        data: t.expr.createPseudo
          ? t.expr.createPseudo(function (e) {
              return function (i) {
                return !!t.data(i, e);
              };
            })
          : function (e, i, n) {
              return !!t.data(e, n[3]);
            },
        focusable: function (e) {
          return i(e, !isNaN(t.attr(e, "tabindex")));
        },
        tabbable: function (e) {
          var n = t.attr(e, "tabindex"),
            a = isNaN(n);
          return (a || n >= 0) && i(e, !a);
        },
      }),
      t("<a>").outerWidth(1).jquery ||
        t.each(["Width", "Height"], function (i, n) {
          function a(e, i, n, a) {
            return (
              t.each(o, function () {
                (i -= parseFloat(t.css(e, "padding" + this)) || 0),
                  n &&
                    (i -= parseFloat(t.css(e, "border" + this + "Width")) || 0),
                  a && (i -= parseFloat(t.css(e, "margin" + this)) || 0);
              }),
              i
            );
          }
          var o = "Width" === n ? ["Left", "Right"] : ["Top", "Bottom"],
            r = n.toLowerCase(),
            s = {
              innerWidth: t.fn.innerWidth,
              innerHeight: t.fn.innerHeight,
              outerWidth: t.fn.outerWidth,
              outerHeight: t.fn.outerHeight,
            };
          (t.fn["inner" + n] = function (i) {
            return i === e
              ? s["inner" + n].call(this)
              : this.each(function () {
                  t(this).css(r, a(this, i) + "px");
                });
          }),
            (t.fn["outer" + n] = function (e, i) {
              return "number" != typeof e
                ? s["outer" + n].call(this, e)
                : this.each(function () {
                    t(this).css(r, a(this, e, !0, i) + "px");
                  });
            });
        }),
      t.fn.addBack ||
        (t.fn.addBack = function (t) {
          return this.add(
            null == t ? this.prevObject : this.prevObject.filter(t)
          );
        }),
      t("<a>").data("a-b", "a").removeData("a-b").data("a-b") &&
        (t.fn.removeData = (function (e) {
          return function (i) {
            return arguments.length
              ? e.call(this, t.camelCase(i))
              : e.call(this);
          };
        })(t.fn.removeData)),
      (t.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())),
      (t.support.selectstart =
        "onselectstart" in document.createElement("div")),
      t.fn.extend({
        disableSelection: function () {
          return this.bind(
            (t.support.selectstart ? "selectstart" : "mousedown") +
              ".ui-disableSelection",
            function (t) {
              t.preventDefault();
            }
          );
        },
        enableSelection: function () {
          return this.unbind(".ui-disableSelection");
        },
      }),
      t.extend(t.ui, {
        plugin: {
          add: function (e, i, n) {
            var a,
              o = t.ui[e].prototype;
            for (a in n)
              (o.plugins[a] = o.plugins[a] || []), o.plugins[a].push([i, n[a]]);
          },
          call: function (t, e, i) {
            var n,
              a = t.plugins[e];
            if (
              a &&
              t.element[0].parentNode &&
              11 !== t.element[0].parentNode.nodeType
            )
              for (n = 0; a.length > n; n++)
                t.options[a[n][0]] && a[n][1].apply(t.element, i);
          },
        },
        hasScroll: function (e, i) {
          if ("hidden" === t(e).css("overflow")) return !1;
          var n = i && "left" === i ? "scrollLeft" : "scrollTop",
            a = !1;
          return e[n] > 0 || ((e[n] = 1), (a = e[n] > 0), (e[n] = 0), a);
        },
      });
  })(jQuery),
  (function (t, e) {
    var i = 0,
      n = Array.prototype.slice,
      a = t.cleanData;
    (t.cleanData = function (e) {
      for (var i, n = 0; null != (i = e[n]); n++)
        try {
          t(i).triggerHandler("remove");
        } catch (t) {}
      a(e);
    }),
      (t.widget = function (i, n, a) {
        var o,
          r,
          s,
          l,
          d = {},
          p = i.split(".")[0];
        (i = i.split(".")[1]),
          (o = p + "-" + i),
          a || ((a = n), (n = t.Widget)),
          (t.expr[":"][o.toLowerCase()] = function (e) {
            return !!t.data(e, o);
          }),
          (t[p] = t[p] || {}),
          (r = t[p][i]),
          (s = t[p][i] =
            function (t, i) {
              return this._createWidget
                ? (arguments.length && this._createWidget(t, i), e)
                : new s(t, i);
            }),
          t.extend(s, r, {
            version: a.version,
            _proto: t.extend({}, a),
            _childConstructors: [],
          }),
          (l = new n()),
          (l.options = t.widget.extend({}, l.options)),
          t.each(a, function (i, a) {
            return t.isFunction(a)
              ? ((d[i] = (function () {
                  var t = function () {
                      return n.prototype[i].apply(this, arguments);
                    },
                    e = function (t) {
                      return n.prototype[i].apply(this, t);
                    };
                  return function () {
                    var i,
                      n = this._super,
                      o = this._superApply;
                    return (
                      (this._super = t),
                      (this._superApply = e),
                      (i = a.apply(this, arguments)),
                      (this._super = n),
                      (this._superApply = o),
                      i
                    );
                  };
                })()),
                e)
              : ((d[i] = a), e);
          }),
          (s.prototype = t.widget.extend(
            l,
            { widgetEventPrefix: r ? l.widgetEventPrefix || i : i },
            d,
            { constructor: s, namespace: p, widgetName: i, widgetFullName: o }
          )),
          r
            ? (t.each(r._childConstructors, function (e, i) {
                var n = i.prototype;
                t.widget(n.namespace + "." + n.widgetName, s, i._proto);
              }),
              delete r._childConstructors)
            : n._childConstructors.push(s),
          t.widget.bridge(i, s);
      }),
      (t.widget.extend = function (i) {
        for (
          var a, o, r = n.call(arguments, 1), s = 0, l = r.length;
          l > s;
          s++
        )
          for (a in r[s])
            (o = r[s][a]),
              r[s].hasOwnProperty(a) &&
                o !== e &&
                (i[a] = t.isPlainObject(o)
                  ? t.isPlainObject(i[a])
                    ? t.widget.extend({}, i[a], o)
                    : t.widget.extend({}, o)
                  : o);
        return i;
      }),
      (t.widget.bridge = function (i, a) {
        var o = a.prototype.widgetFullName || i;
        t.fn[i] = function (r) {
          var s = "string" == typeof r,
            l = n.call(arguments, 1),
            d = this;
          return (
            (r =
              !s && l.length ? t.widget.extend.apply(null, [r].concat(l)) : r),
            s
              ? this.each(function () {
                  var n,
                    a = t.data(this, o);
                  return a
                    ? t.isFunction(a[r]) && "_" !== r.charAt(0)
                      ? ((n = a[r].apply(a, l)),
                        n !== a && n !== e
                          ? ((d = n && n.jquery ? d.pushStack(n.get()) : n), !1)
                          : e)
                      : t.error(
                          "no such method '" +
                            r +
                            "' for " +
                            i +
                            " widget instance"
                        )
                    : t.error(
                        "cannot call methods on " +
                          i +
                          " prior to initialization; attempted to call method '" +
                          r +
                          "'"
                      );
                })
              : this.each(function () {
                  var e = t.data(this, o);
                  e
                    ? e.option(r || {})._init()
                    : t.data(this, o, new a(r, this));
                }),
            d
          );
        };
      }),
      (t.Widget = function () {}),
      (t.Widget._childConstructors = []),
      (t.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: { disabled: !1, create: null },
        _createWidget: function (e, n) {
          (n = t(n || this.defaultElement || this)[0]),
            (this.element = t(n)),
            (this.uuid = i++),
            (this.eventNamespace = "." + this.widgetName + this.uuid),
            (this.options = t.widget.extend(
              {},
              this.options,
              this._getCreateOptions(),
              e
            )),
            (this.bindings = t()),
            (this.hoverable = t()),
            (this.focusable = t()),
            n !== this &&
              (t.data(n, this.widgetFullName, this),
              this._on(!0, this.element, {
                remove: function (t) {
                  t.target === n && this.destroy();
                },
              }),
              (this.document = t(n.style ? n.ownerDocument : n.document || n)),
              (this.window = t(
                this.document[0].defaultView || this.document[0].parentWindow
              ))),
            this._create(),
            this._trigger("create", null, this._getCreateEventData()),
            this._init();
        },
        _getCreateOptions: t.noop,
        _getCreateEventData: t.noop,
        _create: t.noop,
        _init: t.noop,
        destroy: function () {
          this._destroy(),
            this.element
              .unbind(this.eventNamespace)
              .removeData(this.widgetName)
              .removeData(this.widgetFullName)
              .removeData(t.camelCase(this.widgetFullName)),
            this.widget()
              .unbind(this.eventNamespace)
              .removeAttr("aria-disabled")
              .removeClass(this.widgetFullName + "-disabled ui-state-disabled"),
            this.bindings.unbind(this.eventNamespace),
            this.hoverable.removeClass("ui-state-hover"),
            this.focusable.removeClass("ui-state-focus");
        },
        _destroy: t.noop,
        widget: function () {
          return this.element;
        },
        option: function (i, n) {
          var a,
            o,
            r,
            s = i;
          if (0 === arguments.length) return t.widget.extend({}, this.options);
          if ("string" == typeof i)
            if (((s = {}), (a = i.split(".")), (i = a.shift()), a.length)) {
              for (
                o = s[i] = t.widget.extend({}, this.options[i]), r = 0;
                a.length - 1 > r;
                r++
              )
                (o[a[r]] = o[a[r]] || {}), (o = o[a[r]]);
              if (((i = a.pop()), 1 === arguments.length))
                return o[i] === e ? null : o[i];
              o[i] = n;
            } else {
              if (1 === arguments.length)
                return this.options[i] === e ? null : this.options[i];
              s[i] = n;
            }
          return this._setOptions(s), this;
        },
        _setOptions: function (t) {
          var e;
          for (e in t) this._setOption(e, t[e]);
          return this;
        },
        _setOption: function (t, e) {
          return (
            (this.options[t] = e),
            "disabled" === t &&
              (this.widget()
                .toggleClass(
                  this.widgetFullName + "-disabled ui-state-disabled",
                  !!e
                )
                .attr("aria-disabled", e),
              this.hoverable.removeClass("ui-state-hover"),
              this.focusable.removeClass("ui-state-focus")),
            this
          );
        },
        enable: function () {
          return this._setOption("disabled", !1);
        },
        disable: function () {
          return this._setOption("disabled", !0);
        },
        _on: function (i, n, a) {
          var o,
            r = this;
          "boolean" != typeof i && ((a = n), (n = i), (i = !1)),
            a
              ? ((n = o = t(n)), (this.bindings = this.bindings.add(n)))
              : ((a = n), (n = this.element), (o = this.widget())),
            t.each(a, function (a, s) {
              function l() {
                return i ||
                  (!0 !== r.options.disabled &&
                    !t(this).hasClass("ui-state-disabled"))
                  ? ("string" == typeof s ? r[s] : s).apply(r, arguments)
                  : e;
              }
              "string" != typeof s &&
                (l.guid = s.guid = s.guid || l.guid || t.guid++);
              var d = a.match(/^(\w+)\s*(.*)$/),
                p = d[1] + r.eventNamespace,
                c = d[2];
              c ? o.delegate(c, p, l) : n.bind(p, l);
            });
        },
        _off: function (t, e) {
          (e =
            (e || "").split(" ").join(this.eventNamespace + " ") +
            this.eventNamespace),
            t.unbind(e).undelegate(e);
        },
        _delay: function (t, e) {
          function i() {
            return ("string" == typeof t ? n[t] : t).apply(n, arguments);
          }
          var n = this;
          return setTimeout(i, e || 0);
        },
        _hoverable: function (e) {
          (this.hoverable = this.hoverable.add(e)),
            this._on(e, {
              mouseenter: function (e) {
                t(e.currentTarget).addClass("ui-state-hover");
              },
              mouseleave: function (e) {
                t(e.currentTarget).removeClass("ui-state-hover");
              },
            });
        },
        _focusable: function (e) {
          (this.focusable = this.focusable.add(e)),
            this._on(e, {
              focusin: function (e) {
                t(e.currentTarget).addClass("ui-state-focus");
              },
              focusout: function (e) {
                t(e.currentTarget).removeClass("ui-state-focus");
              },
            });
        },
        _trigger: function (e, i, n) {
          var a,
            o,
            r = this.options[e];
          if (
            ((n = n || {}),
            (i = t.Event(i)),
            (i.type = (
              e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e
            ).toLowerCase()),
            (i.target = this.element[0]),
            (o = i.originalEvent))
          )
            for (a in o) a in i || (i[a] = o[a]);
          return (
            this.element.trigger(i, n),
            !(
              (t.isFunction(r) &&
                !1 === r.apply(this.element[0], [i].concat(n))) ||
              i.isDefaultPrevented()
            )
          );
        },
      }),
      t.each({ show: "fadeIn", hide: "fadeOut" }, function (e, i) {
        t.Widget.prototype["_" + e] = function (n, a, o) {
          "string" == typeof a && (a = { effect: a });
          var r,
            s = a ? (!0 === a || "number" == typeof a ? i : a.effect || i) : e;
          (a = a || {}),
            "number" == typeof a && (a = { duration: a }),
            (r = !t.isEmptyObject(a)),
            (a.complete = o),
            a.delay && n.delay(a.delay),
            r && t.effects && t.effects.effect[s]
              ? n[e](a)
              : s !== e && n[s]
              ? n[s](a.duration, a.easing, o)
              : n.queue(function (i) {
                  t(this)[e](), o && o.call(n[0]), i();
                });
        };
      });
  })(jQuery),
  (function (t) {
    var e = !1;
    t(document).mouseup(function () {
      e = !1;
    }),
      t.widget("ui.mouse", {
        version: "1.10.4",
        options: {
          cancel: "input,textarea,button,select,option",
          distance: 1,
          delay: 0,
        },
        _mouseInit: function () {
          var e = this;
          this.element
            .bind("mousedown." + this.widgetName, function (t) {
              return e._mouseDown(t);
            })
            .bind("click." + this.widgetName, function (i) {
              return !0 ===
                t.data(i.target, e.widgetName + ".preventClickEvent")
                ? (t.removeData(i.target, e.widgetName + ".preventClickEvent"),
                  i.stopImmediatePropagation(),
                  !1)
                : void 0;
            }),
            (this.started = !1);
        },
        _mouseDestroy: function () {
          this.element.unbind("." + this.widgetName),
            this._mouseMoveDelegate &&
              t(document)
                .unbind("mousemove." + this.widgetName, this._mouseMoveDelegate)
                .unbind("mouseup." + this.widgetName, this._mouseUpDelegate);
        },
        _mouseDown: function (i) {
          if (!e) {
            this._mouseStarted && this._mouseUp(i), (this._mouseDownEvent = i);
            var n = this,
              a = 1 === i.which,
              o =
                !(
                  "string" != typeof this.options.cancel || !i.target.nodeName
                ) && t(i.target).closest(this.options.cancel).length;
            return (
              !(a && !o && this._mouseCapture(i)) ||
              ((this.mouseDelayMet = !this.options.delay),
              this.mouseDelayMet ||
                (this._mouseDelayTimer = setTimeout(function () {
                  n.mouseDelayMet = !0;
                }, this.options.delay)),
              this._mouseDistanceMet(i) &&
              this._mouseDelayMet(i) &&
              ((this._mouseStarted = !1 !== this._mouseStart(i)),
              !this._mouseStarted)
                ? (i.preventDefault(), !0)
                : (!0 ===
                    t.data(i.target, this.widgetName + ".preventClickEvent") &&
                    t.removeData(
                      i.target,
                      this.widgetName + ".preventClickEvent"
                    ),
                  (this._mouseMoveDelegate = function (t) {
                    return n._mouseMove(t);
                  }),
                  (this._mouseUpDelegate = function (t) {
                    return n._mouseUp(t);
                  }),
                  t(document)
                    .bind(
                      "mousemove." + this.widgetName,
                      this._mouseMoveDelegate
                    )
                    .bind("mouseup." + this.widgetName, this._mouseUpDelegate),
                  i.preventDefault(),
                  (e = !0),
                  !0))
            );
          }
        },
        _mouseMove: function (e) {
          return t.ui.ie &&
            (!document.documentMode || 9 > document.documentMode) &&
            !e.button
            ? this._mouseUp(e)
            : this._mouseStarted
            ? (this._mouseDrag(e), e.preventDefault())
            : (this._mouseDistanceMet(e) &&
                this._mouseDelayMet(e) &&
                ((this._mouseStarted =
                  !1 !== this._mouseStart(this._mouseDownEvent, e)),
                this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)),
              !this._mouseStarted);
        },
        _mouseUp: function (e) {
          return (
            t(document)
              .unbind("mousemove." + this.widgetName, this._mouseMoveDelegate)
              .unbind("mouseup." + this.widgetName, this._mouseUpDelegate),
            this._mouseStarted &&
              ((this._mouseStarted = !1),
              e.target === this._mouseDownEvent.target &&
                t.data(e.target, this.widgetName + ".preventClickEvent", !0),
              this._mouseStop(e)),
            !1
          );
        },
        _mouseDistanceMet: function (t) {
          return (
            Math.max(
              Math.abs(this._mouseDownEvent.pageX - t.pageX),
              Math.abs(this._mouseDownEvent.pageY - t.pageY)
            ) >= this.options.distance
          );
        },
        _mouseDelayMet: function () {
          return this.mouseDelayMet;
        },
        _mouseStart: function () {},
        _mouseDrag: function () {},
        _mouseStop: function () {},
        _mouseCapture: function () {
          return !0;
        },
      });
  })(jQuery),
  (function (t, e) {
    function i(t, e, i) {
      return [
        parseFloat(t[0]) * (h.test(t[0]) ? e / 100 : 1),
        parseFloat(t[1]) * (h.test(t[1]) ? i / 100 : 1),
      ];
    }
    function n(e, i) {
      return parseInt(t.css(e, i), 10) || 0;
    }
    function a(e) {
      var i = e[0];
      return 9 === i.nodeType
        ? { width: e.width(), height: e.height(), offset: { top: 0, left: 0 } }
        : t.isWindow(i)
        ? {
            width: e.width(),
            height: e.height(),
            offset: { top: e.scrollTop(), left: e.scrollLeft() },
          }
        : i.preventDefault
        ? { width: 0, height: 0, offset: { top: i.pageY, left: i.pageX } }
        : {
            width: e.outerWidth(),
            height: e.outerHeight(),
            offset: e.offset(),
          };
    }
    t.ui = t.ui || {};
    var o,
      r = Math.max,
      s = Math.abs,
      l = Math.round,
      d = /left|center|right/,
      p = /top|center|bottom/,
      c = /[\+\-]\d+(\.[\d]+)?%?/,
      u = /^\w+/,
      h = /%$/,
      f = t.fn.position;
    (t.position = {
      scrollbarWidth: function () {
        if (void 0 !== o) return o;
        var e,
          i,
          n = t(
            "<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"
          ),
          a = n.children()[0];
        return (
          t("body").append(n),
          (e = a.offsetWidth),
          n.css("overflow", "scroll"),
          (i = a.offsetWidth),
          e === i && (i = n[0].clientWidth),
          n.remove(),
          (o = e - i)
        );
      },
      getScrollInfo: function (e) {
        var i = e.isWindow || e.isDocument ? "" : e.element.css("overflow-x"),
          n = e.isWindow || e.isDocument ? "" : e.element.css("overflow-y"),
          a =
            "scroll" === i ||
            ("auto" === i && e.width < e.element[0].scrollWidth);
        return {
          width:
            "scroll" === n ||
            ("auto" === n && e.height < e.element[0].scrollHeight)
              ? t.position.scrollbarWidth()
              : 0,
          height: a ? t.position.scrollbarWidth() : 0,
        };
      },
      getWithinInfo: function (e) {
        var i = t(e || window),
          n = t.isWindow(i[0]);
        return {
          element: i,
          isWindow: n,
          isDocument: !!i[0] && 9 === i[0].nodeType,
          offset: i.offset() || { left: 0, top: 0 },
          scrollLeft: i.scrollLeft(),
          scrollTop: i.scrollTop(),
          width: n ? i.width() : i.outerWidth(),
          height: n ? i.height() : i.outerHeight(),
        };
      },
    }),
      (t.fn.position = function (e) {
        if (!e || !e.of) return f.apply(this, arguments);
        e = t.extend({}, e);
        var o,
          h,
          m,
          g,
          b,
          v,
          y = t(e.of),
          w = t.position.getWithinInfo(e.within),
          C = t.position.getScrollInfo(w),
          _ = (e.collision || "flip").split(" "),
          x = {};
        return (
          (v = a(y)),
          y[0].preventDefault && (e.at = "left top"),
          (h = v.width),
          (m = v.height),
          (g = v.offset),
          (b = t.extend({}, g)),
          t.each(["my", "at"], function () {
            var t,
              i,
              n = (e[this] || "").split(" ");
            1 === n.length &&
              (n = d.test(n[0])
                ? n.concat(["center"])
                : p.test(n[0])
                ? ["center"].concat(n)
                : ["center", "center"]),
              (n[0] = d.test(n[0]) ? n[0] : "center"),
              (n[1] = p.test(n[1]) ? n[1] : "center"),
              (t = c.exec(n[0])),
              (i = c.exec(n[1])),
              (x[this] = [t ? t[0] : 0, i ? i[0] : 0]),
              (e[this] = [u.exec(n[0])[0], u.exec(n[1])[0]]);
          }),
          1 === _.length && (_[1] = _[0]),
          "right" === e.at[0]
            ? (b.left += h)
            : "center" === e.at[0] && (b.left += h / 2),
          "bottom" === e.at[1]
            ? (b.top += m)
            : "center" === e.at[1] && (b.top += m / 2),
          (o = i(x.at, h, m)),
          (b.left += o[0]),
          (b.top += o[1]),
          this.each(function () {
            var a,
              d,
              p = t(this),
              c = p.outerWidth(),
              u = p.outerHeight(),
              f = n(this, "marginLeft"),
              v = n(this, "marginTop"),
              S = c + f + n(this, "marginRight") + C.width,
              T = u + v + n(this, "marginBottom") + C.height,
              k = t.extend({}, b),
              E = i(x.my, p.outerWidth(), p.outerHeight());
            "right" === e.my[0]
              ? (k.left -= c)
              : "center" === e.my[0] && (k.left -= c / 2),
              "bottom" === e.my[1]
                ? (k.top -= u)
                : "center" === e.my[1] && (k.top -= u / 2),
              (k.left += E[0]),
              (k.top += E[1]),
              t.support.offsetFractions ||
                ((k.left = l(k.left)), (k.top = l(k.top))),
              (a = { marginLeft: f, marginTop: v }),
              t.each(["left", "top"], function (i, n) {
                t.ui.position[_[i]] &&
                  t.ui.position[_[i]][n](k, {
                    targetWidth: h,
                    targetHeight: m,
                    elemWidth: c,
                    elemHeight: u,
                    collisionPosition: a,
                    collisionWidth: S,
                    collisionHeight: T,
                    offset: [o[0] + E[0], o[1] + E[1]],
                    my: e.my,
                    at: e.at,
                    within: w,
                    elem: p,
                  });
              }),
              e.using &&
                (d = function (t) {
                  var i = g.left - k.left,
                    n = i + h - c,
                    a = g.top - k.top,
                    o = a + m - u,
                    l = {
                      target: {
                        element: y,
                        left: g.left,
                        top: g.top,
                        width: h,
                        height: m,
                      },
                      element: {
                        element: p,
                        left: k.left,
                        top: k.top,
                        width: c,
                        height: u,
                      },
                      horizontal: 0 > n ? "left" : i > 0 ? "right" : "center",
                      vertical: 0 > o ? "top" : a > 0 ? "bottom" : "middle",
                    };
                  c > h && h > s(i + n) && (l.horizontal = "center"),
                    u > m && m > s(a + o) && (l.vertical = "middle"),
                    (l.important =
                      r(s(i), s(n)) > r(s(a), s(o))
                        ? "horizontal"
                        : "vertical"),
                    e.using.call(this, t, l);
                }),
              p.offset(t.extend(k, { using: d }));
          })
        );
      }),
      (t.ui.position = {
        fit: {
          left: function (t, e) {
            var i,
              n = e.within,
              a = n.isWindow ? n.scrollLeft : n.offset.left,
              o = n.width,
              s = t.left - e.collisionPosition.marginLeft,
              l = a - s,
              d = s + e.collisionWidth - o - a;
            e.collisionWidth > o
              ? l > 0 && 0 >= d
                ? ((i = t.left + l + e.collisionWidth - o - a),
                  (t.left += l - i))
                : (t.left =
                    d > 0 && 0 >= l ? a : l > d ? a + o - e.collisionWidth : a)
              : l > 0
              ? (t.left += l)
              : d > 0
              ? (t.left -= d)
              : (t.left = r(t.left - s, t.left));
          },
          top: function (t, e) {
            var i,
              n = e.within,
              a = n.isWindow ? n.scrollTop : n.offset.top,
              o = e.within.height,
              s = t.top - e.collisionPosition.marginTop,
              l = a - s,
              d = s + e.collisionHeight - o - a;
            e.collisionHeight > o
              ? l > 0 && 0 >= d
                ? ((i = t.top + l + e.collisionHeight - o - a),
                  (t.top += l - i))
                : (t.top =
                    d > 0 && 0 >= l ? a : l > d ? a + o - e.collisionHeight : a)
              : l > 0
              ? (t.top += l)
              : d > 0
              ? (t.top -= d)
              : (t.top = r(t.top - s, t.top));
          },
        },
        flip: {
          left: function (t, e) {
            var i,
              n,
              a = e.within,
              o = a.offset.left + a.scrollLeft,
              r = a.width,
              l = a.isWindow ? a.scrollLeft : a.offset.left,
              d = t.left - e.collisionPosition.marginLeft,
              p = d - l,
              c = d + e.collisionWidth - r - l,
              u =
                "left" === e.my[0]
                  ? -e.elemWidth
                  : "right" === e.my[0]
                  ? e.elemWidth
                  : 0,
              h =
                "left" === e.at[0]
                  ? e.targetWidth
                  : "right" === e.at[0]
                  ? -e.targetWidth
                  : 0,
              f = -2 * e.offset[0];
            0 > p
              ? (0 > (i = t.left + u + h + f + e.collisionWidth - r - o) ||
                  s(p) > i) &&
                (t.left += u + h + f)
              : c > 0 &&
                ((n = t.left - e.collisionPosition.marginLeft + u + h + f - l) >
                  0 ||
                  c > s(n)) &&
                (t.left += u + h + f);
          },
          top: function (t, e) {
            var i,
              n,
              a = e.within,
              o = a.offset.top + a.scrollTop,
              r = a.height,
              l = a.isWindow ? a.scrollTop : a.offset.top,
              d = t.top - e.collisionPosition.marginTop,
              p = d - l,
              c = d + e.collisionHeight - r - l,
              u = "top" === e.my[1],
              h = u ? -e.elemHeight : "bottom" === e.my[1] ? e.elemHeight : 0,
              f =
                "top" === e.at[1]
                  ? e.targetHeight
                  : "bottom" === e.at[1]
                  ? -e.targetHeight
                  : 0,
              m = -2 * e.offset[1];
            0 > p
              ? ((n = t.top + h + f + m + e.collisionHeight - r - o),
                t.top + h + f + m > p &&
                  (0 > n || s(p) > n) &&
                  (t.top += h + f + m))
              : c > 0 &&
                ((i = t.top - e.collisionPosition.marginTop + h + f + m - l),
                t.top + h + f + m > c &&
                  (i > 0 || c > s(i)) &&
                  (t.top += h + f + m));
          },
        },
        flipfit: {
          left: function () {
            t.ui.position.flip.left.apply(this, arguments),
              t.ui.position.fit.left.apply(this, arguments);
          },
          top: function () {
            t.ui.position.flip.top.apply(this, arguments),
              t.ui.position.fit.top.apply(this, arguments);
          },
        },
      }),
      (function () {
        var e,
          i,
          n,
          a,
          o,
          r = document.getElementsByTagName("body")[0],
          s = document.createElement("div");
        (e = document.createElement(r ? "div" : "body")),
          (n = {
            visibility: "hidden",
            width: 0,
            height: 0,
            border: 0,
            margin: 0,
            background: "none",
          }),
          r &&
            t.extend(n, {
              position: "absolute",
              left: "-1000px",
              top: "-1000px",
            });
        for (o in n) e.style[o] = n[o];
        e.appendChild(s),
          (i = r || document.documentElement),
          i.insertBefore(e, i.firstChild),
          (s.style.cssText = "position: absolute; left: 10.7432222px;"),
          (a = t(s).offset().left),
          (t.support.offsetFractions = a > 10 && 11 > a),
          (e.innerHTML = ""),
          i.removeChild(e);
      })();
  })(jQuery),
  (function (t) {
    t.widget("ui.draggable", t.ui.mouse, {
      version: "1.10.4",
      widgetEventPrefix: "drag",
      options: {
        addClasses: !0,
        appendTo: "parent",
        axis: !1,
        connectToSortable: !1,
        containment: !1,
        cursor: "auto",
        cursorAt: !1,
        grid: !1,
        handle: !1,
        helper: "original",
        iframeFix: !1,
        opacity: !1,
        refreshPositions: !1,
        revert: !1,
        revertDuration: 500,
        scope: "default",
        scroll: !0,
        scrollSensitivity: 20,
        scrollSpeed: 20,
        snap: !1,
        snapMode: "both",
        snapTolerance: 20,
        stack: !1,
        zIndex: !1,
        drag: null,
        start: null,
        stop: null,
      },
      _create: function () {
        "original" !== this.options.helper ||
          /^(?:r|a|f)/.test(this.element.css("position")) ||
          (this.element[0].style.position = "relative"),
          this.options.addClasses && this.element.addClass("ui-draggable"),
          this.options.disabled &&
            this.element.addClass("ui-draggable-disabled"),
          this._mouseInit();
      },
      _destroy: function () {
        this.element.removeClass(
          "ui-draggable ui-draggable-dragging ui-draggable-disabled"
        ),
          this._mouseDestroy();
      },
      _mouseCapture: function (e) {
        var i = this.options;
        return (
          !(
            this.helper ||
            i.disabled ||
            t(e.target).closest(".ui-resizable-handle").length > 0
          ) &&
          ((this.handle = this._getHandle(e)),
          !!this.handle &&
            (t(!0 === i.iframeFix ? "iframe" : i.iframeFix).each(function () {
              t(
                "<div class='ui-draggable-iframeFix' style='background: #fff;'></div>"
              )
                .css({
                  width: this.offsetWidth + "px",
                  height: this.offsetHeight + "px",
                  position: "absolute",
                  opacity: "0.001",
                  zIndex: 1e3,
                })
                .css(t(this).offset())
                .appendTo("body");
            }),
            !0))
        );
      },
      _mouseStart: function (e) {
        var i = this.options;
        return (
          (this.helper = this._createHelper(e)),
          this.helper.addClass("ui-draggable-dragging"),
          this._cacheHelperProportions(),
          t.ui.ddmanager && (t.ui.ddmanager.current = this),
          this._cacheMargins(),
          (this.cssPosition = this.helper.css("position")),
          (this.scrollParent = this.helper.scrollParent()),
          (this.offsetParent = this.helper.offsetParent()),
          (this.offsetParentCssPosition = this.offsetParent.css("position")),
          (this.offset = this.positionAbs = this.element.offset()),
          (this.offset = {
            top: this.offset.top - this.margins.top,
            left: this.offset.left - this.margins.left,
          }),
          (this.offset.scroll = !1),
          t.extend(this.offset, {
            click: {
              left: e.pageX - this.offset.left,
              top: e.pageY - this.offset.top,
            },
            parent: this._getParentOffset(),
            relative: this._getRelativeOffset(),
          }),
          (this.originalPosition = this.position = this._generatePosition(e)),
          (this.originalPageX = e.pageX),
          (this.originalPageY = e.pageY),
          i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt),
          this._setContainment(),
          !1 === this._trigger("start", e)
            ? (this._clear(), !1)
            : (this._cacheHelperProportions(),
              t.ui.ddmanager &&
                !i.dropBehaviour &&
                t.ui.ddmanager.prepareOffsets(this, e),
              this._mouseDrag(e, !0),
              t.ui.ddmanager && t.ui.ddmanager.dragStart(this, e),
              !0)
        );
      },
      _mouseDrag: function (e, i) {
        if (
          ("fixed" === this.offsetParentCssPosition &&
            (this.offset.parent = this._getParentOffset()),
          (this.position = this._generatePosition(e)),
          (this.positionAbs = this._convertPositionTo("absolute")),
          !i)
        ) {
          var n = this._uiHash();
          if (!1 === this._trigger("drag", e, n)) return this._mouseUp({}), !1;
          this.position = n.position;
        }
        return (
          (this.options.axis && "y" === this.options.axis) ||
            (this.helper[0].style.left = this.position.left + "px"),
          (this.options.axis && "x" === this.options.axis) ||
            (this.helper[0].style.top = this.position.top + "px"),
          t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
          !1
        );
      },
      _mouseStop: function (e) {
        var i = this,
          n = !1;
        return (
          t.ui.ddmanager &&
            !this.options.dropBehaviour &&
            (n = t.ui.ddmanager.drop(this, e)),
          this.dropped && ((n = this.dropped), (this.dropped = !1)),
          !(
            "original" === this.options.helper &&
            !t.contains(this.element[0].ownerDocument, this.element[0])
          ) &&
            (("invalid" === this.options.revert && !n) ||
            ("valid" === this.options.revert && n) ||
            !0 === this.options.revert ||
            (t.isFunction(this.options.revert) &&
              this.options.revert.call(this.element, n))
              ? t(this.helper).animate(
                  this.originalPosition,
                  parseInt(this.options.revertDuration, 10),
                  function () {
                    !1 !== i._trigger("stop", e) && i._clear();
                  }
                )
              : !1 !== this._trigger("stop", e) && this._clear(),
            !1)
        );
      },
      _mouseUp: function (e) {
        return (
          t("div.ui-draggable-iframeFix").each(function () {
            this.parentNode.removeChild(this);
          }),
          t.ui.ddmanager && t.ui.ddmanager.dragStop(this, e),
          t.ui.mouse.prototype._mouseUp.call(this, e)
        );
      },
      cancel: function () {
        return (
          this.helper.is(".ui-draggable-dragging")
            ? this._mouseUp({})
            : this._clear(),
          this
        );
      },
      _getHandle: function (e) {
        return (
          !this.options.handle ||
          !!t(e.target).closest(this.element.find(this.options.handle)).length
        );
      },
      _createHelper: function (e) {
        var i = this.options,
          n = t.isFunction(i.helper)
            ? t(i.helper.apply(this.element[0], [e]))
            : "clone" === i.helper
            ? this.element.clone().removeAttr("id")
            : this.element;
        return (
          n.parents("body").length ||
            n.appendTo(
              "parent" === i.appendTo ? this.element[0].parentNode : i.appendTo
            ),
          n[0] === this.element[0] ||
            /(fixed|absolute)/.test(n.css("position")) ||
            n.css("position", "absolute"),
          n
        );
      },
      _adjustOffsetFromHelper: function (e) {
        "string" == typeof e && (e = e.split(" ")),
          t.isArray(e) && (e = { left: +e[0], top: +e[1] || 0 }),
          "left" in e && (this.offset.click.left = e.left + this.margins.left),
          "right" in e &&
            (this.offset.click.left =
              this.helperProportions.width - e.right + this.margins.left),
          "top" in e && (this.offset.click.top = e.top + this.margins.top),
          "bottom" in e &&
            (this.offset.click.top =
              this.helperProportions.height - e.bottom + this.margins.top);
      },
      _getParentOffset: function () {
        var e = this.offsetParent.offset();
        return (
          "absolute" === this.cssPosition &&
            this.scrollParent[0] !== document &&
            t.contains(this.scrollParent[0], this.offsetParent[0]) &&
            ((e.left += this.scrollParent.scrollLeft()),
            (e.top += this.scrollParent.scrollTop())),
          (this.offsetParent[0] === document.body ||
            (this.offsetParent[0].tagName &&
              "html" === this.offsetParent[0].tagName.toLowerCase() &&
              t.ui.ie)) &&
            (e = { top: 0, left: 0 }),
          {
            top:
              e.top +
              (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
            left:
              e.left +
              (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0),
          }
        );
      },
      _getRelativeOffset: function () {
        if ("relative" === this.cssPosition) {
          var t = this.element.position();
          return {
            top:
              t.top -
              (parseInt(this.helper.css("top"), 10) || 0) +
              this.scrollParent.scrollTop(),
            left:
              t.left -
              (parseInt(this.helper.css("left"), 10) || 0) +
              this.scrollParent.scrollLeft(),
          };
        }
        return { top: 0, left: 0 };
      },
      _cacheMargins: function () {
        this.margins = {
          left: parseInt(this.element.css("marginLeft"), 10) || 0,
          top: parseInt(this.element.css("marginTop"), 10) || 0,
          right: parseInt(this.element.css("marginRight"), 10) || 0,
          bottom: parseInt(this.element.css("marginBottom"), 10) || 0,
        };
      },
      _cacheHelperProportions: function () {
        this.helperProportions = {
          width: this.helper.outerWidth(),
          height: this.helper.outerHeight(),
        };
      },
      _setContainment: function () {
        var e,
          i,
          n,
          a = this.options;
        return a.containment
          ? "window" === a.containment
            ? void (this.containment = [
                t(window).scrollLeft() -
                  this.offset.relative.left -
                  this.offset.parent.left,
                t(window).scrollTop() -
                  this.offset.relative.top -
                  this.offset.parent.top,
                t(window).scrollLeft() +
                  t(window).width() -
                  this.helperProportions.width -
                  this.margins.left,
                t(window).scrollTop() +
                  (t(window).height() ||
                    document.body.parentNode.scrollHeight) -
                  this.helperProportions.height -
                  this.margins.top,
              ])
            : "document" === a.containment
            ? void (this.containment = [
                0,
                0,
                t(document).width() -
                  this.helperProportions.width -
                  this.margins.left,
                (t(document).height() ||
                  document.body.parentNode.scrollHeight) -
                  this.helperProportions.height -
                  this.margins.top,
              ])
            : a.containment.constructor === Array
            ? void (this.containment = a.containment)
            : ("parent" === a.containment &&
                (a.containment = this.helper[0].parentNode),
              (i = t(a.containment)),
              void (
                (n = i[0]) &&
                ((e = "hidden" !== i.css("overflow")),
                (this.containment = [
                  (parseInt(i.css("borderLeftWidth"), 10) || 0) +
                    (parseInt(i.css("paddingLeft"), 10) || 0),
                  (parseInt(i.css("borderTopWidth"), 10) || 0) +
                    (parseInt(i.css("paddingTop"), 10) || 0),
                  (e ? Math.max(n.scrollWidth, n.offsetWidth) : n.offsetWidth) -
                    (parseInt(i.css("borderRightWidth"), 10) || 0) -
                    (parseInt(i.css("paddingRight"), 10) || 0) -
                    this.helperProportions.width -
                    this.margins.left -
                    this.margins.right,
                  (e
                    ? Math.max(n.scrollHeight, n.offsetHeight)
                    : n.offsetHeight) -
                    (parseInt(i.css("borderBottomWidth"), 10) || 0) -
                    (parseInt(i.css("paddingBottom"), 10) || 0) -
                    this.helperProportions.height -
                    this.margins.top -
                    this.margins.bottom,
                ]),
                (this.relative_container = i))
              ))
          : void (this.containment = null);
      },
      _convertPositionTo: function (e, i) {
        i || (i = this.position);
        var n = "absolute" === e ? 1 : -1,
          a =
            "absolute" !== this.cssPosition ||
            (this.scrollParent[0] !== document &&
              t.contains(this.scrollParent[0], this.offsetParent[0]))
              ? this.scrollParent
              : this.offsetParent;
        return (
          this.offset.scroll ||
            (this.offset.scroll = { top: a.scrollTop(), left: a.scrollLeft() }),
          {
            top:
              i.top +
              this.offset.relative.top * n +
              this.offset.parent.top * n -
              ("fixed" === this.cssPosition
                ? -this.scrollParent.scrollTop()
                : this.offset.scroll.top) *
                n,
            left:
              i.left +
              this.offset.relative.left * n +
              this.offset.parent.left * n -
              ("fixed" === this.cssPosition
                ? -this.scrollParent.scrollLeft()
                : this.offset.scroll.left) *
                n,
          }
        );
      },
      _generatePosition: function (e) {
        var i,
          n,
          a,
          o,
          r = this.options,
          s =
            "absolute" !== this.cssPosition ||
            (this.scrollParent[0] !== document &&
              t.contains(this.scrollParent[0], this.offsetParent[0]))
              ? this.scrollParent
              : this.offsetParent,
          l = e.pageX,
          d = e.pageY;
        return (
          this.offset.scroll ||
            (this.offset.scroll = { top: s.scrollTop(), left: s.scrollLeft() }),
          this.originalPosition &&
            (this.containment &&
              (this.relative_container
                ? ((n = this.relative_container.offset()),
                  (i = [
                    this.containment[0] + n.left,
                    this.containment[1] + n.top,
                    this.containment[2] + n.left,
                    this.containment[3] + n.top,
                  ]))
                : (i = this.containment),
              e.pageX - this.offset.click.left < i[0] &&
                (l = i[0] + this.offset.click.left),
              e.pageY - this.offset.click.top < i[1] &&
                (d = i[1] + this.offset.click.top),
              e.pageX - this.offset.click.left > i[2] &&
                (l = i[2] + this.offset.click.left),
              e.pageY - this.offset.click.top > i[3] &&
                (d = i[3] + this.offset.click.top)),
            r.grid &&
              ((a = r.grid[1]
                ? this.originalPageY +
                  Math.round((d - this.originalPageY) / r.grid[1]) * r.grid[1]
                : this.originalPageY),
              (d = i
                ? a - this.offset.click.top >= i[1] ||
                  a - this.offset.click.top > i[3]
                  ? a
                  : a - this.offset.click.top >= i[1]
                  ? a - r.grid[1]
                  : a + r.grid[1]
                : a),
              (o = r.grid[0]
                ? this.originalPageX +
                  Math.round((l - this.originalPageX) / r.grid[0]) * r.grid[0]
                : this.originalPageX),
              (l = i
                ? o - this.offset.click.left >= i[0] ||
                  o - this.offset.click.left > i[2]
                  ? o
                  : o - this.offset.click.left >= i[0]
                  ? o - r.grid[0]
                  : o + r.grid[0]
                : o))),
          {
            top:
              d -
              this.offset.click.top -
              this.offset.relative.top -
              this.offset.parent.top +
              ("fixed" === this.cssPosition
                ? -this.scrollParent.scrollTop()
                : this.offset.scroll.top),
            left:
              l -
              this.offset.click.left -
              this.offset.relative.left -
              this.offset.parent.left +
              ("fixed" === this.cssPosition
                ? -this.scrollParent.scrollLeft()
                : this.offset.scroll.left),
          }
        );
      },
      _clear: function () {
        this.helper.removeClass("ui-draggable-dragging"),
          this.helper[0] === this.element[0] ||
            this.cancelHelperRemoval ||
            this.helper.remove(),
          (this.helper = null),
          (this.cancelHelperRemoval = !1);
      },
      _trigger: function (e, i, n) {
        return (
          (n = n || this._uiHash()),
          t.ui.plugin.call(this, e, [i, n]),
          "drag" === e &&
            (this.positionAbs = this._convertPositionTo("absolute")),
          t.Widget.prototype._trigger.call(this, e, i, n)
        );
      },
      plugins: {},
      _uiHash: function () {
        return {
          helper: this.helper,
          position: this.position,
          originalPosition: this.originalPosition,
          offset: this.positionAbs,
        };
      },
    }),
      t.ui.plugin.add("draggable", "connectToSortable", {
        start: function (e, i) {
          var n = t(this).data("ui-draggable"),
            a = n.options,
            o = t.extend({}, i, { item: n.element });
          (n.sortables = []),
            t(a.connectToSortable).each(function () {
              var i = t.data(this, "ui-sortable");
              i &&
                !i.options.disabled &&
                (n.sortables.push({
                  instance: i,
                  shouldRevert: i.options.revert,
                }),
                i.refreshPositions(),
                i._trigger("activate", e, o));
            });
        },
        stop: function (e, i) {
          var n = t(this).data("ui-draggable"),
            a = t.extend({}, i, { item: n.element });
          t.each(n.sortables, function () {
            this.instance.isOver
              ? ((this.instance.isOver = 0),
                (n.cancelHelperRemoval = !0),
                (this.instance.cancelHelperRemoval = !1),
                this.shouldRevert &&
                  (this.instance.options.revert = this.shouldRevert),
                this.instance._mouseStop(e),
                (this.instance.options.helper = this.instance.options._helper),
                "original" === n.options.helper &&
                  this.instance.currentItem.css({ top: "auto", left: "auto" }))
              : ((this.instance.cancelHelperRemoval = !1),
                this.instance._trigger("deactivate", e, a));
          });
        },
        drag: function (e, i) {
          var n = t(this).data("ui-draggable"),
            a = this;
          t.each(n.sortables, function () {
            var o = !1,
              r = this;
            (this.instance.positionAbs = n.positionAbs),
              (this.instance.helperProportions = n.helperProportions),
              (this.instance.offset.click = n.offset.click),
              this.instance._intersectsWith(this.instance.containerCache) &&
                ((o = !0),
                t.each(n.sortables, function () {
                  return (
                    (this.instance.positionAbs = n.positionAbs),
                    (this.instance.helperProportions = n.helperProportions),
                    (this.instance.offset.click = n.offset.click),
                    this !== r &&
                      this.instance._intersectsWith(
                        this.instance.containerCache
                      ) &&
                      t.contains(
                        r.instance.element[0],
                        this.instance.element[0]
                      ) &&
                      (o = !1),
                    o
                  );
                })),
              o
                ? (this.instance.isOver ||
                    ((this.instance.isOver = 1),
                    (this.instance.currentItem = t(a)
                      .clone()
                      .removeAttr("id")
                      .appendTo(this.instance.element)
                      .data("ui-sortable-item", !0)),
                    (this.instance.options._helper =
                      this.instance.options.helper),
                    (this.instance.options.helper = function () {
                      return i.helper[0];
                    }),
                    (e.target = this.instance.currentItem[0]),
                    this.instance._mouseCapture(e, !0),
                    this.instance._mouseStart(e, !0, !0),
                    (this.instance.offset.click.top = n.offset.click.top),
                    (this.instance.offset.click.left = n.offset.click.left),
                    (this.instance.offset.parent.left -=
                      n.offset.parent.left - this.instance.offset.parent.left),
                    (this.instance.offset.parent.top -=
                      n.offset.parent.top - this.instance.offset.parent.top),
                    n._trigger("toSortable", e),
                    (n.dropped = this.instance.element),
                    (n.currentItem = n.element),
                    (this.instance.fromOutside = n)),
                  this.instance.currentItem && this.instance._mouseDrag(e))
                : this.instance.isOver &&
                  ((this.instance.isOver = 0),
                  (this.instance.cancelHelperRemoval = !0),
                  (this.instance.options.revert = !1),
                  this.instance._trigger(
                    "out",
                    e,
                    this.instance._uiHash(this.instance)
                  ),
                  this.instance._mouseStop(e, !0),
                  (this.instance.options.helper =
                    this.instance.options._helper),
                  this.instance.currentItem.remove(),
                  this.instance.placeholder &&
                    this.instance.placeholder.remove(),
                  n._trigger("fromSortable", e),
                  (n.dropped = !1));
          });
        },
      }),
      t.ui.plugin.add("draggable", "cursor", {
        start: function () {
          var e = t("body"),
            i = t(this).data("ui-draggable").options;
          e.css("cursor") && (i._cursor = e.css("cursor")),
            e.css("cursor", i.cursor);
        },
        stop: function () {
          var e = t(this).data("ui-draggable").options;
          e._cursor && t("body").css("cursor", e._cursor);
        },
      }),
      t.ui.plugin.add("draggable", "opacity", {
        start: function (e, i) {
          var n = t(i.helper),
            a = t(this).data("ui-draggable").options;
          n.css("opacity") && (a._opacity = n.css("opacity")),
            n.css("opacity", a.opacity);
        },
        stop: function (e, i) {
          var n = t(this).data("ui-draggable").options;
          n._opacity && t(i.helper).css("opacity", n._opacity);
        },
      }),
      t.ui.plugin.add("draggable", "scroll", {
        start: function () {
          var e = t(this).data("ui-draggable");
          e.scrollParent[0] !== document &&
            "HTML" !== e.scrollParent[0].tagName &&
            (e.overflowOffset = e.scrollParent.offset());
        },
        drag: function (e) {
          var i = t(this).data("ui-draggable"),
            n = i.options,
            a = !1;
          i.scrollParent[0] !== document && "HTML" !== i.scrollParent[0].tagName
            ? ((n.axis && "x" === n.axis) ||
                (i.overflowOffset.top +
                  i.scrollParent[0].offsetHeight -
                  e.pageY <
                n.scrollSensitivity
                  ? (i.scrollParent[0].scrollTop = a =
                      i.scrollParent[0].scrollTop + n.scrollSpeed)
                  : e.pageY - i.overflowOffset.top < n.scrollSensitivity &&
                    (i.scrollParent[0].scrollTop = a =
                      i.scrollParent[0].scrollTop - n.scrollSpeed)),
              (n.axis && "y" === n.axis) ||
                (i.overflowOffset.left +
                  i.scrollParent[0].offsetWidth -
                  e.pageX <
                n.scrollSensitivity
                  ? (i.scrollParent[0].scrollLeft = a =
                      i.scrollParent[0].scrollLeft + n.scrollSpeed)
                  : e.pageX - i.overflowOffset.left < n.scrollSensitivity &&
                    (i.scrollParent[0].scrollLeft = a =
                      i.scrollParent[0].scrollLeft - n.scrollSpeed)))
            : ((n.axis && "x" === n.axis) ||
                (e.pageY - t(document).scrollTop() < n.scrollSensitivity
                  ? (a = t(document).scrollTop(
                      t(document).scrollTop() - n.scrollSpeed
                    ))
                  : t(window).height() - (e.pageY - t(document).scrollTop()) <
                      n.scrollSensitivity &&
                    (a = t(document).scrollTop(
                      t(document).scrollTop() + n.scrollSpeed
                    ))),
              (n.axis && "y" === n.axis) ||
                (e.pageX - t(document).scrollLeft() < n.scrollSensitivity
                  ? (a = t(document).scrollLeft(
                      t(document).scrollLeft() - n.scrollSpeed
                    ))
                  : t(window).width() - (e.pageX - t(document).scrollLeft()) <
                      n.scrollSensitivity &&
                    (a = t(document).scrollLeft(
                      t(document).scrollLeft() + n.scrollSpeed
                    )))),
            !1 !== a &&
              t.ui.ddmanager &&
              !n.dropBehaviour &&
              t.ui.ddmanager.prepareOffsets(i, e);
        },
      }),
      t.ui.plugin.add("draggable", "snap", {
        start: function () {
          var e = t(this).data("ui-draggable"),
            i = e.options;
          (e.snapElements = []),
            t(
              i.snap.constructor !== String
                ? i.snap.items || ":data(ui-draggable)"
                : i.snap
            ).each(function () {
              var i = t(this),
                n = i.offset();
              this !== e.element[0] &&
                e.snapElements.push({
                  item: this,
                  width: i.outerWidth(),
                  height: i.outerHeight(),
                  top: n.top,
                  left: n.left,
                });
            });
        },
        drag: function (e, i) {
          var n,
            a,
            o,
            r,
            s,
            l,
            d,
            p,
            c,
            u,
            h = t(this).data("ui-draggable"),
            f = h.options,
            m = f.snapTolerance,
            g = i.offset.left,
            b = g + h.helperProportions.width,
            v = i.offset.top,
            y = v + h.helperProportions.height;
          for (c = h.snapElements.length - 1; c >= 0; c--)
            (s = h.snapElements[c].left),
              (l = s + h.snapElements[c].width),
              (d = h.snapElements[c].top),
              (p = d + h.snapElements[c].height),
              s - m > b ||
              g > l + m ||
              d - m > y ||
              v > p + m ||
              !t.contains(
                h.snapElements[c].item.ownerDocument,
                h.snapElements[c].item
              )
                ? (h.snapElements[c].snapping &&
                    h.options.snap.release &&
                    h.options.snap.release.call(
                      h.element,
                      e,
                      t.extend(h._uiHash(), {
                        snapItem: h.snapElements[c].item,
                      })
                    ),
                  (h.snapElements[c].snapping = !1))
                : ("inner" !== f.snapMode &&
                    ((n = m >= Math.abs(d - y)),
                    (a = m >= Math.abs(p - v)),
                    (o = m >= Math.abs(s - b)),
                    (r = m >= Math.abs(l - g)),
                    n &&
                      (i.position.top =
                        h._convertPositionTo("relative", {
                          top: d - h.helperProportions.height,
                          left: 0,
                        }).top - h.margins.top),
                    a &&
                      (i.position.top =
                        h._convertPositionTo("relative", { top: p, left: 0 })
                          .top - h.margins.top),
                    o &&
                      (i.position.left =
                        h._convertPositionTo("relative", {
                          top: 0,
                          left: s - h.helperProportions.width,
                        }).left - h.margins.left),
                    r &&
                      (i.position.left =
                        h._convertPositionTo("relative", { top: 0, left: l })
                          .left - h.margins.left)),
                  (u = n || a || o || r),
                  "outer" !== f.snapMode &&
                    ((n = m >= Math.abs(d - v)),
                    (a = m >= Math.abs(p - y)),
                    (o = m >= Math.abs(s - g)),
                    (r = m >= Math.abs(l - b)),
                    n &&
                      (i.position.top =
                        h._convertPositionTo("relative", { top: d, left: 0 })
                          .top - h.margins.top),
                    a &&
                      (i.position.top =
                        h._convertPositionTo("relative", {
                          top: p - h.helperProportions.height,
                          left: 0,
                        }).top - h.margins.top),
                    o &&
                      (i.position.left =
                        h._convertPositionTo("relative", { top: 0, left: s })
                          .left - h.margins.left),
                    r &&
                      (i.position.left =
                        h._convertPositionTo("relative", {
                          top: 0,
                          left: l - h.helperProportions.width,
                        }).left - h.margins.left)),
                  !h.snapElements[c].snapping &&
                    (n || a || o || r || u) &&
                    h.options.snap.snap &&
                    h.options.snap.snap.call(
                      h.element,
                      e,
                      t.extend(h._uiHash(), {
                        snapItem: h.snapElements[c].item,
                      })
                    ),
                  (h.snapElements[c].snapping = n || a || o || r || u));
        },
      }),
      t.ui.plugin.add("draggable", "stack", {
        start: function () {
          var e,
            i = this.data("ui-draggable").options,
            n = t.makeArray(t(i.stack)).sort(function (e, i) {
              return (
                (parseInt(t(e).css("zIndex"), 10) || 0) -
                (parseInt(t(i).css("zIndex"), 10) || 0)
              );
            });
          n.length &&
            ((e = parseInt(t(n[0]).css("zIndex"), 10) || 0),
            t(n).each(function (i) {
              t(this).css("zIndex", e + i);
            }),
            this.css("zIndex", e + n.length));
        },
      }),
      t.ui.plugin.add("draggable", "zIndex", {
        start: function (e, i) {
          var n = t(i.helper),
            a = t(this).data("ui-draggable").options;
          n.css("zIndex") && (a._zIndex = n.css("zIndex")),
            n.css("zIndex", a.zIndex);
        },
        stop: function (e, i) {
          var n = t(this).data("ui-draggable").options;
          n._zIndex && t(i.helper).css("zIndex", n._zIndex);
        },
      });
  })(jQuery),
  (function (t) {
    function e(t, e, i) {
      return t > e && e + i > t;
    }
    t.widget("ui.droppable", {
      version: "1.10.4",
      widgetEventPrefix: "drop",
      options: {
        accept: "*",
        activeClass: !1,
        addClasses: !0,
        greedy: !1,
        hoverClass: !1,
        scope: "default",
        tolerance: "intersect",
        activate: null,
        deactivate: null,
        drop: null,
        out: null,
        over: null,
      },
      _create: function () {
        var e,
          i = this.options,
          n = i.accept;
        (this.isover = !1),
          (this.isout = !0),
          (this.accept = t.isFunction(n)
            ? n
            : function (t) {
                return t.is(n);
              }),
          (this.proportions = function () {
            return arguments.length
              ? void (e = arguments[0])
              : e ||
                  (e = {
                    width: this.element[0].offsetWidth,
                    height: this.element[0].offsetHeight,
                  });
          }),
          (t.ui.ddmanager.droppables[i.scope] =
            t.ui.ddmanager.droppables[i.scope] || []),
          t.ui.ddmanager.droppables[i.scope].push(this),
          i.addClasses && this.element.addClass("ui-droppable");
      },
      _destroy: function () {
        for (
          var e = 0, i = t.ui.ddmanager.droppables[this.options.scope];
          i.length > e;
          e++
        )
          i[e] === this && i.splice(e, 1);
        this.element.removeClass("ui-droppable ui-droppable-disabled");
      },
      _setOption: function (e, i) {
        "accept" === e &&
          (this.accept = t.isFunction(i)
            ? i
            : function (t) {
                return t.is(i);
              }),
          t.Widget.prototype._setOption.apply(this, arguments);
      },
      _activate: function (e) {
        var i = t.ui.ddmanager.current;
        this.options.activeClass &&
          this.element.addClass(this.options.activeClass),
          i && this._trigger("activate", e, this.ui(i));
      },
      _deactivate: function (e) {
        var i = t.ui.ddmanager.current;
        this.options.activeClass &&
          this.element.removeClass(this.options.activeClass),
          i && this._trigger("deactivate", e, this.ui(i));
      },
      _over: function (e) {
        var i = t.ui.ddmanager.current;
        i &&
          (i.currentItem || i.element)[0] !== this.element[0] &&
          this.accept.call(this.element[0], i.currentItem || i.element) &&
          (this.options.hoverClass &&
            this.element.addClass(this.options.hoverClass),
          this._trigger("over", e, this.ui(i)));
      },
      _out: function (e) {
        var i = t.ui.ddmanager.current;
        i &&
          (i.currentItem || i.element)[0] !== this.element[0] &&
          this.accept.call(this.element[0], i.currentItem || i.element) &&
          (this.options.hoverClass &&
            this.element.removeClass(this.options.hoverClass),
          this._trigger("out", e, this.ui(i)));
      },
      _drop: function (e, i) {
        var n = i || t.ui.ddmanager.current,
          a = !1;
        return (
          !(!n || (n.currentItem || n.element)[0] === this.element[0]) &&
          (this.element
            .find(":data(ui-droppable)")
            .not(".ui-draggable-dragging")
            .each(function () {
              var e = t.data(this, "ui-droppable");
              return e.options.greedy &&
                !e.options.disabled &&
                e.options.scope === n.options.scope &&
                e.accept.call(e.element[0], n.currentItem || n.element) &&
                t.ui.intersect(
                  n,
                  t.extend(e, { offset: e.element.offset() }),
                  e.options.tolerance
                )
                ? ((a = !0), !1)
                : void 0;
            }),
          !a &&
            !!this.accept.call(this.element[0], n.currentItem || n.element) &&
            (this.options.activeClass &&
              this.element.removeClass(this.options.activeClass),
            this.options.hoverClass &&
              this.element.removeClass(this.options.hoverClass),
            this._trigger("drop", e, this.ui(n)),
            this.element))
        );
      },
      ui: function (t) {
        return {
          draggable: t.currentItem || t.element,
          helper: t.helper,
          position: t.position,
          offset: t.positionAbs,
        };
      },
    }),
      (t.ui.intersect = function (t, i, n) {
        if (!i.offset) return !1;
        var a,
          o,
          r = (t.positionAbs || t.position.absolute).left,
          s = (t.positionAbs || t.position.absolute).top,
          l = r + t.helperProportions.width,
          d = s + t.helperProportions.height,
          p = i.offset.left,
          c = i.offset.top,
          u = p + i.proportions().width,
          h = c + i.proportions().height;
        switch (n) {
          case "fit":
            return r >= p && u >= l && s >= c && h >= d;
          case "intersect":
            return (
              r + t.helperProportions.width / 2 > p &&
              u > l - t.helperProportions.width / 2 &&
              s + t.helperProportions.height / 2 > c &&
              h > d - t.helperProportions.height / 2
            );
          case "pointer":
            return (
              (a =
                (t.positionAbs || t.position.absolute).left +
                (t.clickOffset || t.offset.click).left),
              (o =
                (t.positionAbs || t.position.absolute).top +
                (t.clickOffset || t.offset.click).top),
              e(o, c, i.proportions().height) && e(a, p, i.proportions().width)
            );
          case "touch":
            return (
              ((s >= c && h >= s) || (d >= c && h >= d) || (c > s && d > h)) &&
              ((r >= p && u >= r) || (l >= p && u >= l) || (p > r && l > u))
            );
          default:
            return !1;
        }
      }),
      (t.ui.ddmanager = {
        current: null,
        droppables: { default: [] },
        prepareOffsets: function (e, i) {
          var n,
            a,
            o = t.ui.ddmanager.droppables[e.options.scope] || [],
            r = i ? i.type : null,
            s = (e.currentItem || e.element)
              .find(":data(ui-droppable)")
              .addBack();
          t: for (n = 0; o.length > n; n++)
            if (
              !(
                o[n].options.disabled ||
                (e &&
                  !o[n].accept.call(
                    o[n].element[0],
                    e.currentItem || e.element
                  ))
              )
            ) {
              for (a = 0; s.length > a; a++)
                if (s[a] === o[n].element[0]) {
                  o[n].proportions().height = 0;
                  continue t;
                }
              (o[n].visible = "none" !== o[n].element.css("display")),
                o[n].visible &&
                  ("mousedown" === r && o[n]._activate.call(o[n], i),
                  (o[n].offset = o[n].element.offset()),
                  o[n].proportions({
                    width: o[n].element[0].offsetWidth,
                    height: o[n].element[0].offsetHeight,
                  }));
            }
        },
        drop: function (e, i) {
          var n = !1;
          return (
            t.each(
              (t.ui.ddmanager.droppables[e.options.scope] || []).slice(),
              function () {
                this.options &&
                  (!this.options.disabled &&
                    this.visible &&
                    t.ui.intersect(e, this, this.options.tolerance) &&
                    (n = this._drop.call(this, i) || n),
                  !this.options.disabled &&
                    this.visible &&
                    this.accept.call(
                      this.element[0],
                      e.currentItem || e.element
                    ) &&
                    ((this.isout = !0),
                    (this.isover = !1),
                    this._deactivate.call(this, i)));
              }
            ),
            n
          );
        },
        dragStart: function (e, i) {
          e.element.parentsUntil("body").bind("scroll.droppable", function () {
            e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i);
          });
        },
        drag: function (e, i) {
          e.options.refreshPositions && t.ui.ddmanager.prepareOffsets(e, i),
            t.each(
              t.ui.ddmanager.droppables[e.options.scope] || [],
              function () {
                if (
                  !this.options.disabled &&
                  !this.greedyChild &&
                  this.visible
                ) {
                  var n,
                    a,
                    o,
                    r = t.ui.intersect(e, this, this.options.tolerance),
                    s =
                      !r && this.isover
                        ? "isout"
                        : r && !this.isover
                        ? "isover"
                        : null;
                  s &&
                    (this.options.greedy &&
                      ((a = this.options.scope),
                      (o = this.element
                        .parents(":data(ui-droppable)")
                        .filter(function () {
                          return (
                            t.data(this, "ui-droppable").options.scope === a
                          );
                        })),
                      o.length &&
                        ((n = t.data(o[0], "ui-droppable")),
                        (n.greedyChild = "isover" === s))),
                    n &&
                      "isover" === s &&
                      ((n.isover = !1), (n.isout = !0), n._out.call(n, i)),
                    (this[s] = !0),
                    (this["isout" === s ? "isover" : "isout"] = !1),
                    this["isover" === s ? "_over" : "_out"].call(this, i),
                    n &&
                      "isout" === s &&
                      ((n.isout = !1), (n.isover = !0), n._over.call(n, i)));
                }
              }
            );
        },
        dragStop: function (e, i) {
          e.element.parentsUntil("body").unbind("scroll.droppable"),
            e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i);
        },
      });
  })(jQuery),
  (function (t) {
    function e(t) {
      return parseInt(t, 10) || 0;
    }
    function i(t) {
      return !isNaN(parseInt(t, 10));
    }
    t.widget("ui.resizable", t.ui.mouse, {
      version: "1.10.4",
      widgetEventPrefix: "resize",
      options: {
        alsoResize: !1,
        animate: !1,
        animateDuration: "slow",
        animateEasing: "swing",
        aspectRatio: !1,
        autoHide: !1,
        containment: !1,
        ghost: !1,
        grid: !1,
        handles: "e,s,se",
        helper: !1,
        maxHeight: null,
        maxWidth: null,
        minHeight: 10,
        minWidth: 10,
        zIndex: 90,
        resize: null,
        start: null,
        stop: null,
      },
      _create: function () {
        var e,
          i,
          n,
          a,
          o,
          r = this,
          s = this.options;
        if (
          (this.element.addClass("ui-resizable"),
          t.extend(this, {
            _aspectRatio: !!s.aspectRatio,
            aspectRatio: s.aspectRatio,
            originalElement: this.element,
            _proportionallyResizeElements: [],
            _helper:
              s.helper || s.ghost || s.animate
                ? s.helper || "ui-resizable-helper"
                : null,
          }),
          this.element[0].nodeName.match(
            /canvas|textarea|input|select|button|img/i
          ) &&
            (this.element.wrap(
              t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css(
                {
                  position: this.element.css("position"),
                  width: this.element.outerWidth(),
                  height: this.element.outerHeight(),
                  top: this.element.css("top"),
                  left: this.element.css("left"),
                }
              )
            ),
            (this.element = this.element
              .parent()
              .data("ui-resizable", this.element.data("ui-resizable"))),
            (this.elementIsWrapper = !0),
            this.element.css({
              marginLeft: this.originalElement.css("marginLeft"),
              marginTop: this.originalElement.css("marginTop"),
              marginRight: this.originalElement.css("marginRight"),
              marginBottom: this.originalElement.css("marginBottom"),
            }),
            this.originalElement.css({
              marginLeft: 0,
              marginTop: 0,
              marginRight: 0,
              marginBottom: 0,
            }),
            (this.originalResizeStyle = this.originalElement.css("resize")),
            this.originalElement.css("resize", "none"),
            this._proportionallyResizeElements.push(
              this.originalElement.css({
                position: "static",
                zoom: 1,
                display: "block",
              })
            ),
            this.originalElement.css({
              margin: this.originalElement.css("margin"),
            }),
            this._proportionallyResize()),
          (this.handles =
            s.handles ||
            (t(".ui-resizable-handle", this.element).length
              ? {
                  n: ".ui-resizable-n",
                  e: ".ui-resizable-e",
                  s: ".ui-resizable-s",
                  w: ".ui-resizable-w",
                  se: ".ui-resizable-se",
                  sw: ".ui-resizable-sw",
                  ne: ".ui-resizable-ne",
                  nw: ".ui-resizable-nw",
                }
              : "e,s,se")),
          this.handles.constructor === String)
        )
          for (
            "all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"),
              e = this.handles.split(","),
              this.handles = {},
              i = 0;
            e.length > i;
            i++
          )
            (n = t.trim(e[i])),
              (o = "ui-resizable-" + n),
              (a = t("<div class='ui-resizable-handle " + o + "'></div>")),
              a.css({ zIndex: s.zIndex }),
              "se" === n && a.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),
              (this.handles[n] = ".ui-resizable-" + n),
              this.element.append(a);
        (this._renderAxis = function (e) {
          var i, n, a, o;
          e = e || this.element;
          for (i in this.handles)
            this.handles[i].constructor === String &&
              (this.handles[i] = t(this.handles[i], this.element).show()),
              this.elementIsWrapper &&
                this.originalElement[0].nodeName.match(
                  /textarea|input|select|button/i
                ) &&
                ((n = t(this.handles[i], this.element)),
                (o = /sw|ne|nw|se|n|s/.test(i)
                  ? n.outerHeight()
                  : n.outerWidth()),
                (a = [
                  "padding",
                  /ne|nw|n/.test(i)
                    ? "Top"
                    : /se|sw|s/.test(i)
                    ? "Bottom"
                    : /^e$/.test(i)
                    ? "Right"
                    : "Left",
                ].join("")),
                e.css(a, o),
                this._proportionallyResize()),
              t(this.handles[i]).length;
        }),
          this._renderAxis(this.element),
          (this._handles = t(
            ".ui-resizable-handle",
            this.element
          ).disableSelection()),
          this._handles.mouseover(function () {
            r.resizing ||
              (this.className &&
                (a = this.className.match(
                  /ui-resizable-(se|sw|ne|nw|n|e|s|w)/i
                )),
              (r.axis = a && a[1] ? a[1] : "se"));
          }),
          s.autoHide &&
            (this._handles.hide(),
            t(this.element)
              .addClass("ui-resizable-autohide")
              .mouseenter(function () {
                s.disabled ||
                  (t(this).removeClass("ui-resizable-autohide"),
                  r._handles.show());
              })
              .mouseleave(function () {
                s.disabled ||
                  r.resizing ||
                  (t(this).addClass("ui-resizable-autohide"),
                  r._handles.hide());
              })),
          this._mouseInit();
      },
      _destroy: function () {
        this._mouseDestroy();
        var e,
          i = function (e) {
            t(e)
              .removeClass(
                "ui-resizable ui-resizable-disabled ui-resizable-resizing"
              )
              .removeData("resizable")
              .removeData("ui-resizable")
              .unbind(".resizable")
              .find(".ui-resizable-handle")
              .remove();
          };
        return (
          this.elementIsWrapper &&
            (i(this.element),
            (e = this.element),
            this.originalElement
              .css({
                position: e.css("position"),
                width: e.outerWidth(),
                height: e.outerHeight(),
                top: e.css("top"),
                left: e.css("left"),
              })
              .insertAfter(e),
            e.remove()),
          this.originalElement.css("resize", this.originalResizeStyle),
          i(this.originalElement),
          this
        );
      },
      _mouseCapture: function (e) {
        var i,
          n,
          a = !1;
        for (i in this.handles)
          ((n = t(this.handles[i])[0]) === e.target ||
            t.contains(n, e.target)) &&
            (a = !0);
        return !this.options.disabled && a;
      },
      _mouseStart: function (i) {
        var n,
          a,
          o,
          r = this.options,
          s = this.element.position(),
          l = this.element;
        return (
          (this.resizing = !0),
          /absolute/.test(l.css("position"))
            ? l.css({
                position: "absolute",
                top: l.css("top"),
                left: l.css("left"),
              })
            : l.is(".ui-draggable") &&
              l.css({ position: "absolute", top: s.top, left: s.left }),
          this._renderProxy(),
          (n = e(this.helper.css("left"))),
          (a = e(this.helper.css("top"))),
          r.containment &&
            ((n += t(r.containment).scrollLeft() || 0),
            (a += t(r.containment).scrollTop() || 0)),
          (this.offset = this.helper.offset()),
          (this.position = { left: n, top: a }),
          (this.size = this._helper
            ? { width: this.helper.width(), height: this.helper.height() }
            : { width: l.width(), height: l.height() }),
          (this.originalSize = this._helper
            ? { width: l.outerWidth(), height: l.outerHeight() }
            : { width: l.width(), height: l.height() }),
          (this.originalPosition = { left: n, top: a }),
          (this.sizeDiff = {
            width: l.outerWidth() - l.width(),
            height: l.outerHeight() - l.height(),
          }),
          (this.originalMousePosition = { left: i.pageX, top: i.pageY }),
          (this.aspectRatio =
            "number" == typeof r.aspectRatio
              ? r.aspectRatio
              : this.originalSize.width / this.originalSize.height || 1),
          (o = t(".ui-resizable-" + this.axis).css("cursor")),
          t("body").css("cursor", "auto" === o ? this.axis + "-resize" : o),
          l.addClass("ui-resizable-resizing"),
          this._propagate("start", i),
          !0
        );
      },
      _mouseDrag: function (e) {
        var i,
          n = this.helper,
          a = {},
          o = this.originalMousePosition,
          r = this.axis,
          s = this.position.top,
          l = this.position.left,
          d = this.size.width,
          p = this.size.height,
          c = e.pageX - o.left || 0,
          u = e.pageY - o.top || 0,
          h = this._change[r];
        return (
          !!h &&
          ((i = h.apply(this, [e, c, u])),
          this._updateVirtualBoundaries(e.shiftKey),
          (this._aspectRatio || e.shiftKey) && (i = this._updateRatio(i, e)),
          (i = this._respectSize(i, e)),
          this._updateCache(i),
          this._propagate("resize", e),
          this.position.top !== s && (a.top = this.position.top + "px"),
          this.position.left !== l && (a.left = this.position.left + "px"),
          this.size.width !== d && (a.width = this.size.width + "px"),
          this.size.height !== p && (a.height = this.size.height + "px"),
          n.css(a),
          !this._helper &&
            this._proportionallyResizeElements.length &&
            this._proportionallyResize(),
          t.isEmptyObject(a) || this._trigger("resize", e, this.ui()),
          !1)
        );
      },
      _mouseStop: function (e) {
        this.resizing = !1;
        var i,
          n,
          a,
          o,
          r,
          s,
          l,
          d = this.options,
          p = this;
        return (
          this._helper &&
            ((i = this._proportionallyResizeElements),
            (n = i.length && /textarea/i.test(i[0].nodeName)),
            (a = n && t.ui.hasScroll(i[0], "left") ? 0 : p.sizeDiff.height),
            (o = n ? 0 : p.sizeDiff.width),
            (r = {
              width: p.helper.width() - o,
              height: p.helper.height() - a,
            }),
            (s =
              parseInt(p.element.css("left"), 10) +
                (p.position.left - p.originalPosition.left) || null),
            (l =
              parseInt(p.element.css("top"), 10) +
                (p.position.top - p.originalPosition.top) || null),
            d.animate || this.element.css(t.extend(r, { top: l, left: s })),
            p.helper.height(p.size.height),
            p.helper.width(p.size.width),
            this._helper && !d.animate && this._proportionallyResize()),
          t("body").css("cursor", "auto"),
          this.element.removeClass("ui-resizable-resizing"),
          this._propagate("stop", e),
          this._helper && this.helper.remove(),
          !1
        );
      },
      _updateVirtualBoundaries: function (t) {
        var e,
          n,
          a,
          o,
          r,
          s = this.options;
        (r = {
          minWidth: i(s.minWidth) ? s.minWidth : 0,
          maxWidth: i(s.maxWidth) ? s.maxWidth : 1 / 0,
          minHeight: i(s.minHeight) ? s.minHeight : 0,
          maxHeight: i(s.maxHeight) ? s.maxHeight : 1 / 0,
        }),
          (this._aspectRatio || t) &&
            ((e = r.minHeight * this.aspectRatio),
            (a = r.minWidth / this.aspectRatio),
            (n = r.maxHeight * this.aspectRatio),
            (o = r.maxWidth / this.aspectRatio),
            e > r.minWidth && (r.minWidth = e),
            a > r.minHeight && (r.minHeight = a),
            r.maxWidth > n && (r.maxWidth = n),
            r.maxHeight > o && (r.maxHeight = o)),
          (this._vBoundaries = r);
      },
      _updateCache: function (t) {
        (this.offset = this.helper.offset()),
          i(t.left) && (this.position.left = t.left),
          i(t.top) && (this.position.top = t.top),
          i(t.height) && (this.size.height = t.height),
          i(t.width) && (this.size.width = t.width);
      },
      _updateRatio: function (t) {
        var e = this.position,
          n = this.size,
          a = this.axis;
        return (
          i(t.height)
            ? (t.width = t.height * this.aspectRatio)
            : i(t.width) && (t.height = t.width / this.aspectRatio),
          "sw" === a &&
            ((t.left = e.left + (n.width - t.width)), (t.top = null)),
          "nw" === a &&
            ((t.top = e.top + (n.height - t.height)),
            (t.left = e.left + (n.width - t.width))),
          t
        );
      },
      _respectSize: function (t) {
        var e = this._vBoundaries,
          n = this.axis,
          a = i(t.width) && e.maxWidth && e.maxWidth < t.width,
          o = i(t.height) && e.maxHeight && e.maxHeight < t.height,
          r = i(t.width) && e.minWidth && e.minWidth > t.width,
          s = i(t.height) && e.minHeight && e.minHeight > t.height,
          l = this.originalPosition.left + this.originalSize.width,
          d = this.position.top + this.size.height,
          p = /sw|nw|w/.test(n),
          c = /nw|ne|n/.test(n);
        return (
          r && (t.width = e.minWidth),
          s && (t.height = e.minHeight),
          a && (t.width = e.maxWidth),
          o && (t.height = e.maxHeight),
          r && p && (t.left = l - e.minWidth),
          a && p && (t.left = l - e.maxWidth),
          s && c && (t.top = d - e.minHeight),
          o && c && (t.top = d - e.maxHeight),
          t.width || t.height || t.left || !t.top
            ? t.width || t.height || t.top || !t.left || (t.left = null)
            : (t.top = null),
          t
        );
      },
      _proportionallyResize: function () {
        if (this._proportionallyResizeElements.length) {
          var t,
            e,
            i,
            n,
            a,
            o = this.helper || this.element;
          for (t = 0; this._proportionallyResizeElements.length > t; t++) {
            if (((a = this._proportionallyResizeElements[t]), !this.borderDif))
              for (
                this.borderDif = [],
                  i = [
                    a.css("borderTopWidth"),
                    a.css("borderRightWidth"),
                    a.css("borderBottomWidth"),
                    a.css("borderLeftWidth"),
                  ],
                  n = [
                    a.css("paddingTop"),
                    a.css("paddingRight"),
                    a.css("paddingBottom"),
                    a.css("paddingLeft"),
                  ],
                  e = 0;
                i.length > e;
                e++
              )
                this.borderDif[e] =
                  (parseInt(i[e], 10) || 0) + (parseInt(n[e], 10) || 0);
            a.css({
              height: o.height() - this.borderDif[0] - this.borderDif[2] || 0,
              width: o.width() - this.borderDif[1] - this.borderDif[3] || 0,
            });
          }
        }
      },
      _renderProxy: function () {
        var e = this.element,
          i = this.options;
        (this.elementOffset = e.offset()),
          this._helper
            ? ((this.helper =
                this.helper || t("<div style='overflow:hidden;'></div>")),
              this.helper
                .addClass(this._helper)
                .css({
                  width: this.element.outerWidth() - 1,
                  height: this.element.outerHeight() - 1,
                  position: "absolute",
                  left: this.elementOffset.left + "px",
                  top: this.elementOffset.top + "px",
                  zIndex: ++i.zIndex,
                }),
              this.helper.appendTo("body").disableSelection())
            : (this.helper = this.element);
      },
      _change: {
        e: function (t, e) {
          return { width: this.originalSize.width + e };
        },
        w: function (t, e) {
          var i = this.originalSize;
          return { left: this.originalPosition.left + e, width: i.width - e };
        },
        n: function (t, e, i) {
          var n = this.originalSize;
          return { top: this.originalPosition.top + i, height: n.height - i };
        },
        s: function (t, e, i) {
          return { height: this.originalSize.height + i };
        },
        se: function (e, i, n) {
          return t.extend(
            this._change.s.apply(this, arguments),
            this._change.e.apply(this, [e, i, n])
          );
        },
        sw: function (e, i, n) {
          return t.extend(
            this._change.s.apply(this, arguments),
            this._change.w.apply(this, [e, i, n])
          );
        },
        ne: function (e, i, n) {
          return t.extend(
            this._change.n.apply(this, arguments),
            this._change.e.apply(this, [e, i, n])
          );
        },
        nw: function (e, i, n) {
          return t.extend(
            this._change.n.apply(this, arguments),
            this._change.w.apply(this, [e, i, n])
          );
        },
      },
      _propagate: function (e, i) {
        t.ui.plugin.call(this, e, [i, this.ui()]),
          "resize" !== e && this._trigger(e, i, this.ui());
      },
      plugins: {},
      ui: function () {
        return {
          originalElement: this.originalElement,
          element: this.element,
          helper: this.helper,
          position: this.position,
          size: this.size,
          originalSize: this.originalSize,
          originalPosition: this.originalPosition,
        };
      },
    }),
      t.ui.plugin.add("resizable", "animate", {
        stop: function (e) {
          var i = t(this).data("ui-resizable"),
            n = i.options,
            a = i._proportionallyResizeElements,
            o = a.length && /textarea/i.test(a[0].nodeName),
            r = o && t.ui.hasScroll(a[0], "left") ? 0 : i.sizeDiff.height,
            s = o ? 0 : i.sizeDiff.width,
            l = { width: i.size.width - s, height: i.size.height - r },
            d =
              parseInt(i.element.css("left"), 10) +
                (i.position.left - i.originalPosition.left) || null,
            p =
              parseInt(i.element.css("top"), 10) +
                (i.position.top - i.originalPosition.top) || null;
          i.element.animate(t.extend(l, p && d ? { top: p, left: d } : {}), {
            duration: n.animateDuration,
            easing: n.animateEasing,
            step: function () {
              var n = {
                width: parseInt(i.element.css("width"), 10),
                height: parseInt(i.element.css("height"), 10),
                top: parseInt(i.element.css("top"), 10),
                left: parseInt(i.element.css("left"), 10),
              };
              a &&
                a.length &&
                t(a[0]).css({ width: n.width, height: n.height }),
                i._updateCache(n),
                i._propagate("resize", e);
            },
          });
        },
      }),
      t.ui.plugin.add("resizable", "containment", {
        start: function () {
          var i,
            n,
            a,
            o,
            r,
            s,
            l,
            d = t(this).data("ui-resizable"),
            p = d.options,
            c = d.element,
            u = p.containment,
            h =
              u instanceof t
                ? u.get(0)
                : /parent/.test(u)
                ? c.parent().get(0)
                : u;
          h &&
            ((d.containerElement = t(h)),
            /document/.test(u) || u === document
              ? ((d.containerOffset = { left: 0, top: 0 }),
                (d.containerPosition = { left: 0, top: 0 }),
                (d.parentData = {
                  element: t(document),
                  left: 0,
                  top: 0,
                  width: t(document).width(),
                  height:
                    t(document).height() ||
                    document.body.parentNode.scrollHeight,
                }))
              : ((i = t(h)),
                (n = []),
                t(["Top", "Right", "Left", "Bottom"]).each(function (t, a) {
                  n[t] = e(i.css("padding" + a));
                }),
                (d.containerOffset = i.offset()),
                (d.containerPosition = i.position()),
                (d.containerSize = {
                  height: i.innerHeight() - n[3],
                  width: i.innerWidth() - n[1],
                }),
                (a = d.containerOffset),
                (o = d.containerSize.height),
                (r = d.containerSize.width),
                (s = t.ui.hasScroll(h, "left") ? h.scrollWidth : r),
                (l = t.ui.hasScroll(h) ? h.scrollHeight : o),
                (d.parentData = {
                  element: h,
                  left: a.left,
                  top: a.top,
                  width: s,
                  height: l,
                })));
        },
        resize: function (e) {
          var i,
            n,
            a,
            o,
            r = t(this).data("ui-resizable"),
            s = r.options,
            l = r.containerOffset,
            d = r.position,
            p = r._aspectRatio || e.shiftKey,
            c = { top: 0, left: 0 },
            u = r.containerElement;
          u[0] !== document && /static/.test(u.css("position")) && (c = l),
            d.left < (r._helper ? l.left : 0) &&
              ((r.size.width =
                r.size.width +
                (r._helper
                  ? r.position.left - l.left
                  : r.position.left - c.left)),
              p && (r.size.height = r.size.width / r.aspectRatio),
              (r.position.left = s.helper ? l.left : 0)),
            d.top < (r._helper ? l.top : 0) &&
              ((r.size.height =
                r.size.height +
                (r._helper ? r.position.top - l.top : r.position.top)),
              p && (r.size.width = r.size.height * r.aspectRatio),
              (r.position.top = r._helper ? l.top : 0)),
            (r.offset.left = r.parentData.left + r.position.left),
            (r.offset.top = r.parentData.top + r.position.top),
            (i = Math.abs(
              (r._helper, r.offset.left - c.left + r.sizeDiff.width)
            )),
            (n = Math.abs(
              (r._helper ? r.offset.top - c.top : r.offset.top - l.top) +
                r.sizeDiff.height
            )),
            (a = r.containerElement.get(0) === r.element.parent().get(0)),
            (o = /relative|absolute/.test(r.containerElement.css("position"))),
            a && o && (i -= Math.abs(r.parentData.left)),
            i + r.size.width >= r.parentData.width &&
              ((r.size.width = r.parentData.width - i),
              p && (r.size.height = r.size.width / r.aspectRatio)),
            n + r.size.height >= r.parentData.height &&
              ((r.size.height = r.parentData.height - n),
              p && (r.size.width = r.size.height * r.aspectRatio));
        },
        stop: function () {
          var e = t(this).data("ui-resizable"),
            i = e.options,
            n = e.containerOffset,
            a = e.containerPosition,
            o = e.containerElement,
            r = t(e.helper),
            s = r.offset(),
            l = r.outerWidth() - e.sizeDiff.width,
            d = r.outerHeight() - e.sizeDiff.height;
          e._helper &&
            !i.animate &&
            /relative/.test(o.css("position")) &&
            t(this).css({
              left: s.left - a.left - n.left,
              width: l,
              height: d,
            }),
            e._helper &&
              !i.animate &&
              /static/.test(o.css("position")) &&
              t(this).css({
                left: s.left - a.left - n.left,
                width: l,
                height: d,
              });
        },
      }),
      t.ui.plugin.add("resizable", "alsoResize", {
        start: function () {
          var e = t(this).data("ui-resizable"),
            i = e.options,
            n = function (e) {
              t(e).each(function () {
                var e = t(this);
                e.data("ui-resizable-alsoresize", {
                  width: parseInt(e.width(), 10),
                  height: parseInt(e.height(), 10),
                  left: parseInt(e.css("left"), 10),
                  top: parseInt(e.css("top"), 10),
                });
              });
            };
          "object" != typeof i.alsoResize || i.alsoResize.parentNode
            ? n(i.alsoResize)
            : i.alsoResize.length
            ? ((i.alsoResize = i.alsoResize[0]), n(i.alsoResize))
            : t.each(i.alsoResize, function (t) {
                n(t);
              });
        },
        resize: function (e, i) {
          var n = t(this).data("ui-resizable"),
            a = n.options,
            o = n.originalSize,
            r = n.originalPosition,
            s = {
              height: n.size.height - o.height || 0,
              width: n.size.width - o.width || 0,
              top: n.position.top - r.top || 0,
              left: n.position.left - r.left || 0,
            },
            l = function (e, n) {
              t(e).each(function () {
                var e = t(this),
                  a = t(this).data("ui-resizable-alsoresize"),
                  o = {},
                  r =
                    n && n.length
                      ? n
                      : e.parents(i.originalElement[0]).length
                      ? ["width", "height"]
                      : ["width", "height", "top", "left"];
                t.each(r, function (t, e) {
                  var i = (a[e] || 0) + (s[e] || 0);
                  i && i >= 0 && (o[e] = i || null);
                }),
                  e.css(o);
              });
            };
          "object" != typeof a.alsoResize || a.alsoResize.nodeType
            ? l(a.alsoResize)
            : t.each(a.alsoResize, function (t, e) {
                l(t, e);
              });
        },
        stop: function () {
          t(this).removeData("resizable-alsoresize");
        },
      }),
      t.ui.plugin.add("resizable", "ghost", {
        start: function () {
          var e = t(this).data("ui-resizable"),
            i = e.options,
            n = e.size;
          (e.ghost = e.originalElement.clone()),
            e.ghost
              .css({
                opacity: 0.25,
                display: "block",
                position: "relative",
                height: n.height,
                width: n.width,
                margin: 0,
                left: 0,
                top: 0,
              })
              .addClass("ui-resizable-ghost")
              .addClass("string" == typeof i.ghost ? i.ghost : ""),
            e.ghost.appendTo(e.helper);
        },
        resize: function () {
          var e = t(this).data("ui-resizable");
          e.ghost &&
            e.ghost.css({
              position: "relative",
              height: e.size.height,
              width: e.size.width,
            });
        },
        stop: function () {
          var e = t(this).data("ui-resizable");
          e.ghost && e.helper && e.helper.get(0).removeChild(e.ghost.get(0));
        },
      }),
      t.ui.plugin.add("resizable", "grid", {
        resize: function () {
          var e = t(this).data("ui-resizable"),
            i = e.options,
            n = e.size,
            a = e.originalSize,
            o = e.originalPosition,
            r = e.axis,
            s = "number" == typeof i.grid ? [i.grid, i.grid] : i.grid,
            l = s[0] || 1,
            d = s[1] || 1,
            p = Math.round((n.width - a.width) / l) * l,
            c = Math.round((n.height - a.height) / d) * d,
            u = a.width + p,
            h = a.height + c,
            f = i.maxWidth && u > i.maxWidth,
            m = i.maxHeight && h > i.maxHeight,
            g = i.minWidth && i.minWidth > u,
            b = i.minHeight && i.minHeight > h;
          (i.grid = s),
            g && (u += l),
            b && (h += d),
            f && (u -= l),
            m && (h -= d),
            /^(se|s|e)$/.test(r)
              ? ((e.size.width = u), (e.size.height = h))
              : /^(ne)$/.test(r)
              ? ((e.size.width = u),
                (e.size.height = h),
                (e.position.top = o.top - c))
              : /^(sw)$/.test(r)
              ? ((e.size.width = u),
                (e.size.height = h),
                (e.position.left = o.left - p))
              : (h - d > 0
                  ? ((e.size.height = h), (e.position.top = o.top - c))
                  : ((e.size.height = d),
                    (e.position.top = o.top + a.height - d)),
                u - l > 0
                  ? ((e.size.width = u), (e.position.left = o.left - p))
                  : ((e.size.width = l),
                    (e.position.left = o.left + a.width - l)));
        },
      });
  })(jQuery),
  (function (t) {
    t.widget("ui.selectable", t.ui.mouse, {
      version: "1.10.4",
      options: {
        appendTo: "body",
        autoRefresh: !0,
        distance: 0,
        filter: "*",
        tolerance: "touch",
        selected: null,
        selecting: null,
        start: null,
        stop: null,
        unselected: null,
        unselecting: null,
      },
      _create: function () {
        var e,
          i = this;
        this.element.addClass("ui-selectable"),
          (this.dragged = !1),
          (this.refresh = function () {
            (e = t(i.options.filter, i.element[0])),
              e.addClass("ui-selectee"),
              e.each(function () {
                var e = t(this),
                  i = e.offset();
                t.data(this, "selectable-item", {
                  element: this,
                  $element: e,
                  left: i.left,
                  top: i.top,
                  right: i.left + e.outerWidth(),
                  bottom: i.top + e.outerHeight(),
                  startselected: !1,
                  selected: e.hasClass("ui-selected"),
                  selecting: e.hasClass("ui-selecting"),
                  unselecting: e.hasClass("ui-unselecting"),
                });
              });
          }),
          this.refresh(),
          (this.selectees = e.addClass("ui-selectee")),
          this._mouseInit(),
          (this.helper = t("<div class='ui-selectable-helper'></div>"));
      },
      _destroy: function () {
        this.selectees.removeClass("ui-selectee").removeData("selectable-item"),
          this.element.removeClass("ui-selectable ui-selectable-disabled"),
          this._mouseDestroy();
      },
      _mouseStart: function (e) {
        var i = this,
          n = this.options;
        (this.opos = [e.pageX, e.pageY]),
          this.options.disabled ||
            ((this.selectees = t(n.filter, this.element[0])),
            this._trigger("start", e),
            t(n.appendTo).append(this.helper),
            this.helper.css({
              left: e.pageX,
              top: e.pageY,
              width: 0,
              height: 0,
            }),
            n.autoRefresh && this.refresh(),
            this.selectees.filter(".ui-selected").each(function () {
              var n = t.data(this, "selectable-item");
              (n.startselected = !0),
                e.metaKey ||
                  e.ctrlKey ||
                  (n.$element.removeClass("ui-selected"),
                  (n.selected = !1),
                  n.$element.addClass("ui-unselecting"),
                  (n.unselecting = !0),
                  i._trigger("unselecting", e, { unselecting: n.element }));
            }),
            t(e.target)
              .parents()
              .addBack()
              .each(function () {
                var n,
                  a = t.data(this, "selectable-item");
                return a
                  ? ((n =
                      (!e.metaKey && !e.ctrlKey) ||
                      !a.$element.hasClass("ui-selected")),
                    a.$element
                      .removeClass(n ? "ui-unselecting" : "ui-selected")
                      .addClass(n ? "ui-selecting" : "ui-unselecting"),
                    (a.unselecting = !n),
                    (a.selecting = n),
                    (a.selected = n),
                    n
                      ? i._trigger("selecting", e, { selecting: a.element })
                      : i._trigger("unselecting", e, {
                          unselecting: a.element,
                        }),
                    !1)
                  : void 0;
              }));
      },
      _mouseDrag: function (e) {
        if (((this.dragged = !0), !this.options.disabled)) {
          var i,
            n = this,
            a = this.options,
            o = this.opos[0],
            r = this.opos[1],
            s = e.pageX,
            l = e.pageY;
          return (
            o > s && ((i = s), (s = o), (o = i)),
            r > l && ((i = l), (l = r), (r = i)),
            this.helper.css({ left: o, top: r, width: s - o, height: l - r }),
            this.selectees.each(function () {
              var i = t.data(this, "selectable-item"),
                d = !1;
              i &&
                i.element !== n.element[0] &&
                ("touch" === a.tolerance
                  ? (d = !(
                      i.left > s ||
                      o > i.right ||
                      i.top > l ||
                      r > i.bottom
                    ))
                  : "fit" === a.tolerance &&
                    (d =
                      i.left > o && s > i.right && i.top > r && l > i.bottom),
                d
                  ? (i.selected &&
                      (i.$element.removeClass("ui-selected"),
                      (i.selected = !1)),
                    i.unselecting &&
                      (i.$element.removeClass("ui-unselecting"),
                      (i.unselecting = !1)),
                    i.selecting ||
                      (i.$element.addClass("ui-selecting"),
                      (i.selecting = !0),
                      n._trigger("selecting", e, { selecting: i.element })))
                  : (i.selecting &&
                      ((e.metaKey || e.ctrlKey) && i.startselected
                        ? (i.$element.removeClass("ui-selecting"),
                          (i.selecting = !1),
                          i.$element.addClass("ui-selected"),
                          (i.selected = !0))
                        : (i.$element.removeClass("ui-selecting"),
                          (i.selecting = !1),
                          i.startselected &&
                            (i.$element.addClass("ui-unselecting"),
                            (i.unselecting = !0)),
                          n._trigger("unselecting", e, {
                            unselecting: i.element,
                          }))),
                    i.selected &&
                      (e.metaKey ||
                        e.ctrlKey ||
                        i.startselected ||
                        (i.$element.removeClass("ui-selected"),
                        (i.selected = !1),
                        i.$element.addClass("ui-unselecting"),
                        (i.unselecting = !0),
                        n._trigger("unselecting", e, {
                          unselecting: i.element,
                        })))));
            }),
            !1
          );
        }
      },
      _mouseStop: function (e) {
        var i = this;
        return (
          (this.dragged = !1),
          t(".ui-unselecting", this.element[0]).each(function () {
            var n = t.data(this, "selectable-item");
            n.$element.removeClass("ui-unselecting"),
              (n.unselecting = !1),
              (n.startselected = !1),
              i._trigger("unselected", e, { unselected: n.element });
          }),
          t(".ui-selecting", this.element[0]).each(function () {
            var n = t.data(this, "selectable-item");
            n.$element.removeClass("ui-selecting").addClass("ui-selected"),
              (n.selecting = !1),
              (n.selected = !0),
              (n.startselected = !0),
              i._trigger("selected", e, { selected: n.element });
          }),
          this._trigger("stop", e),
          this.helper.remove(),
          !1
        );
      },
    });
  })(jQuery),
  (function (t) {
    function e(t, e, i) {
      return t > e && e + i > t;
    }
    function i(t) {
      return (
        /left|right/.test(t.css("float")) ||
        /inline|table-cell/.test(t.css("display"))
      );
    }
    t.widget("ui.sortable", t.ui.mouse, {
      version: "1.10.4",
      widgetEventPrefix: "sort",
      ready: !1,
      options: {
        appendTo: "parent",
        axis: !1,
        connectWith: !1,
        containment: !1,
        cursor: "auto",
        cursorAt: !1,
        dropOnEmpty: !0,
        forcePlaceholderSize: !1,
        forceHelperSize: !1,
        grid: !1,
        handle: !1,
        helper: "original",
        items: "> *",
        opacity: !1,
        placeholder: !1,
        revert: !1,
        scroll: !0,
        scrollSensitivity: 20,
        scrollSpeed: 20,
        scope: "default",
        tolerance: "intersect",
        zIndex: 1e3,
        activate: null,
        beforeStop: null,
        change: null,
        deactivate: null,
        out: null,
        over: null,
        receive: null,
        remove: null,
        sort: null,
        start: null,
        stop: null,
        update: null,
      },
      _create: function () {
        var t = this.options;
        (this.containerCache = {}),
          this.element.addClass("ui-sortable"),
          this.refresh(),
          (this.floating =
            !!this.items.length && ("x" === t.axis || i(this.items[0].item))),
          (this.offset = this.element.offset()),
          this._mouseInit(),
          (this.ready = !0);
      },
      _destroy: function () {
        this.element.removeClass("ui-sortable ui-sortable-disabled"),
          this._mouseDestroy();
        for (var t = this.items.length - 1; t >= 0; t--)
          this.items[t].item.removeData(this.widgetName + "-item");
        return this;
      },
      _setOption: function (e, i) {
        "disabled" === e
          ? ((this.options[e] = i),
            this.widget().toggleClass("ui-sortable-disabled", !!i))
          : t.Widget.prototype._setOption.apply(this, arguments);
      },
      _mouseCapture: function (e, i) {
        var n = null,
          a = !1,
          o = this;
        return (
          !this.reverting &&
          !this.options.disabled &&
          "static" !== this.options.type &&
          (this._refreshItems(e),
          t(e.target)
            .parents()
            .each(function () {
              return t.data(this, o.widgetName + "-item") === o
                ? ((n = t(this)), !1)
                : void 0;
            }),
          t.data(e.target, o.widgetName + "-item") === o && (n = t(e.target)),
          !!n &&
            !(
              this.options.handle &&
              !i &&
              (t(this.options.handle, n)
                .find("*")
                .addBack()
                .each(function () {
                  this === e.target && (a = !0);
                }),
              !a)
            ) &&
            ((this.currentItem = n), this._removeCurrentsFromItems(), !0))
        );
      },
      _mouseStart: function (e, i, n) {
        var a,
          o,
          r = this.options;
        if (
          ((this.currentContainer = this),
          this.refreshPositions(),
          (this.helper = this._createHelper(e)),
          this._cacheHelperProportions(),
          this._cacheMargins(),
          (this.scrollParent = this.helper.scrollParent()),
          (this.offset = this.currentItem.offset()),
          (this.offset = {
            top: this.offset.top - this.margins.top,
            left: this.offset.left - this.margins.left,
          }),
          t.extend(this.offset, {
            click: {
              left: e.pageX - this.offset.left,
              top: e.pageY - this.offset.top,
            },
            parent: this._getParentOffset(),
            relative: this._getRelativeOffset(),
          }),
          this.helper.css("position", "absolute"),
          (this.cssPosition = this.helper.css("position")),
          (this.originalPosition = this._generatePosition(e)),
          (this.originalPageX = e.pageX),
          (this.originalPageY = e.pageY),
          r.cursorAt && this._adjustOffsetFromHelper(r.cursorAt),
          (this.domPosition = {
            prev: this.currentItem.prev()[0],
            parent: this.currentItem.parent()[0],
          }),
          this.helper[0] !== this.currentItem[0] && this.currentItem.hide(),
          this._createPlaceholder(),
          r.containment && this._setContainment(),
          r.cursor &&
            "auto" !== r.cursor &&
            ((o = this.document.find("body")),
            (this.storedCursor = o.css("cursor")),
            o.css("cursor", r.cursor),
            (this.storedStylesheet = t(
              "<style>*{ cursor: " + r.cursor + " !important; }</style>"
            ).appendTo(o))),
          r.opacity &&
            (this.helper.css("opacity") &&
              (this._storedOpacity = this.helper.css("opacity")),
            this.helper.css("opacity", r.opacity)),
          r.zIndex &&
            (this.helper.css("zIndex") &&
              (this._storedZIndex = this.helper.css("zIndex")),
            this.helper.css("zIndex", r.zIndex)),
          this.scrollParent[0] !== document &&
            "HTML" !== this.scrollParent[0].tagName &&
            (this.overflowOffset = this.scrollParent.offset()),
          this._trigger("start", e, this._uiHash()),
          this._preserveHelperProportions || this._cacheHelperProportions(),
          !n)
        )
          for (a = this.containers.length - 1; a >= 0; a--)
            this.containers[a]._trigger("activate", e, this._uiHash(this));
        return (
          t.ui.ddmanager && (t.ui.ddmanager.current = this),
          t.ui.ddmanager &&
            !r.dropBehaviour &&
            t.ui.ddmanager.prepareOffsets(this, e),
          (this.dragging = !0),
          this.helper.addClass("ui-sortable-helper"),
          this._mouseDrag(e),
          !0
        );
      },
      _mouseDrag: function (e) {
        var i,
          n,
          a,
          o,
          r = this.options,
          s = !1;
        for (
          this.position = this._generatePosition(e),
            this.positionAbs = this._convertPositionTo("absolute"),
            this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs),
            this.options.scroll &&
              (this.scrollParent[0] !== document &&
              "HTML" !== this.scrollParent[0].tagName
                ? (this.overflowOffset.top +
                    this.scrollParent[0].offsetHeight -
                    e.pageY <
                  r.scrollSensitivity
                    ? (this.scrollParent[0].scrollTop = s =
                        this.scrollParent[0].scrollTop + r.scrollSpeed)
                    : e.pageY - this.overflowOffset.top < r.scrollSensitivity &&
                      (this.scrollParent[0].scrollTop = s =
                        this.scrollParent[0].scrollTop - r.scrollSpeed),
                  this.overflowOffset.left +
                    this.scrollParent[0].offsetWidth -
                    e.pageX <
                  r.scrollSensitivity
                    ? (this.scrollParent[0].scrollLeft = s =
                        this.scrollParent[0].scrollLeft + r.scrollSpeed)
                    : e.pageX - this.overflowOffset.left <
                        r.scrollSensitivity &&
                      (this.scrollParent[0].scrollLeft = s =
                        this.scrollParent[0].scrollLeft - r.scrollSpeed))
                : (e.pageY - t(document).scrollTop() < r.scrollSensitivity
                    ? (s = t(document).scrollTop(
                        t(document).scrollTop() - r.scrollSpeed
                      ))
                    : t(window).height() - (e.pageY - t(document).scrollTop()) <
                        r.scrollSensitivity &&
                      (s = t(document).scrollTop(
                        t(document).scrollTop() + r.scrollSpeed
                      )),
                  e.pageX - t(document).scrollLeft() < r.scrollSensitivity
                    ? (s = t(document).scrollLeft(
                        t(document).scrollLeft() - r.scrollSpeed
                      ))
                    : t(window).width() - (e.pageX - t(document).scrollLeft()) <
                        r.scrollSensitivity &&
                      (s = t(document).scrollLeft(
                        t(document).scrollLeft() + r.scrollSpeed
                      ))),
              !1 !== s &&
                t.ui.ddmanager &&
                !r.dropBehaviour &&
                t.ui.ddmanager.prepareOffsets(this, e)),
            this.positionAbs = this._convertPositionTo("absolute"),
            (this.options.axis && "y" === this.options.axis) ||
              (this.helper[0].style.left = this.position.left + "px"),
            (this.options.axis && "x" === this.options.axis) ||
              (this.helper[0].style.top = this.position.top + "px"),
            i = this.items.length - 1;
          i >= 0;
          i--
        )
          if (
            ((n = this.items[i]),
            (a = n.item[0]),
            (o = this._intersectsWithPointer(n)) &&
              n.instance === this.currentContainer &&
              a !== this.currentItem[0] &&
              this.placeholder[1 === o ? "next" : "prev"]()[0] !== a &&
              !t.contains(this.placeholder[0], a) &&
              ("semi-dynamic" !== this.options.type ||
                !t.contains(this.element[0], a)))
          ) {
            if (
              ((this.direction = 1 === o ? "down" : "up"),
              "pointer" !== this.options.tolerance &&
                !this._intersectsWithSides(n))
            )
              break;
            this._rearrange(e, n), this._trigger("change", e, this._uiHash());
            break;
          }
        return (
          this._contactContainers(e),
          t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
          this._trigger("sort", e, this._uiHash()),
          (this.lastPositionAbs = this.positionAbs),
          !1
        );
      },
      _mouseStop: function (e, i) {
        if (e) {
          if (
            (t.ui.ddmanager &&
              !this.options.dropBehaviour &&
              t.ui.ddmanager.drop(this, e),
            this.options.revert)
          ) {
            var n = this,
              a = this.placeholder.offset(),
              o = this.options.axis,
              r = {};
            (o && "x" !== o) ||
              (r.left =
                a.left -
                this.offset.parent.left -
                this.margins.left +
                (this.offsetParent[0] === document.body
                  ? 0
                  : this.offsetParent[0].scrollLeft)),
              (o && "y" !== o) ||
                (r.top =
                  a.top -
                  this.offset.parent.top -
                  this.margins.top +
                  (this.offsetParent[0] === document.body
                    ? 0
                    : this.offsetParent[0].scrollTop)),
              (this.reverting = !0),
              t(this.helper).animate(
                r,
                parseInt(this.options.revert, 10) || 500,
                function () {
                  n._clear(e);
                }
              );
          } else this._clear(e, i);
          return !1;
        }
      },
      cancel: function () {
        if (this.dragging) {
          this._mouseUp({ target: null }),
            "original" === this.options.helper
              ? this.currentItem
                  .css(this._storedCSS)
                  .removeClass("ui-sortable-helper")
              : this.currentItem.show();
          for (var e = this.containers.length - 1; e >= 0; e--)
            this.containers[e]._trigger("deactivate", null, this._uiHash(this)),
              this.containers[e].containerCache.over &&
                (this.containers[e]._trigger("out", null, this._uiHash(this)),
                (this.containers[e].containerCache.over = 0));
        }
        return (
          this.placeholder &&
            (this.placeholder[0].parentNode &&
              this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
            "original" !== this.options.helper &&
              this.helper &&
              this.helper[0].parentNode &&
              this.helper.remove(),
            t.extend(this, {
              helper: null,
              dragging: !1,
              reverting: !1,
              _noFinalSort: null,
            }),
            this.domPosition.prev
              ? t(this.domPosition.prev).after(this.currentItem)
              : t(this.domPosition.parent).prepend(this.currentItem)),
          this
        );
      },
      serialize: function (e) {
        var i = this._getItemsAsjQuery(e && e.connected),
          n = [];
        return (
          (e = e || {}),
          t(i).each(function () {
            var i = (t(e.item || this).attr(e.attribute || "id") || "").match(
              e.expression || /(.+)[\-=_](.+)/
            );
            i &&
              n.push(
                (e.key || i[1] + "[]") +
                  "=" +
                  (e.key && e.expression ? i[1] : i[2])
              );
          }),
          !n.length && e.key && n.push(e.key + "="),
          n.join("&")
        );
      },
      toArray: function (e) {
        var i = this._getItemsAsjQuery(e && e.connected),
          n = [];
        return (
          (e = e || {}),
          i.each(function () {
            n.push(t(e.item || this).attr(e.attribute || "id") || "");
          }),
          n
        );
      },
      _intersectsWith: function (t) {
        var e = this.positionAbs.left,
          i = e + this.helperProportions.width,
          n = this.positionAbs.top,
          a = n + this.helperProportions.height,
          o = t.left,
          r = o + t.width,
          s = t.top,
          l = s + t.height,
          d = this.offset.click.top,
          p = this.offset.click.left,
          c = "x" === this.options.axis || (n + d > s && l > n + d),
          u = "y" === this.options.axis || (e + p > o && r > e + p),
          h = c && u;
        return "pointer" === this.options.tolerance ||
          this.options.forcePointerForContainers ||
          ("pointer" !== this.options.tolerance &&
            this.helperProportions[this.floating ? "width" : "height"] >
              t[this.floating ? "width" : "height"])
          ? h
          : e + this.helperProportions.width / 2 > o &&
              r > i - this.helperProportions.width / 2 &&
              n + this.helperProportions.height / 2 > s &&
              l > a - this.helperProportions.height / 2;
      },
      _intersectsWithPointer: function (t) {
        var i =
            "x" === this.options.axis ||
            e(this.positionAbs.top + this.offset.click.top, t.top, t.height),
          n =
            "y" === this.options.axis ||
            e(this.positionAbs.left + this.offset.click.left, t.left, t.width),
          a = i && n,
          o = this._getDragVerticalDirection(),
          r = this._getDragHorizontalDirection();
        return (
          !!a &&
          (this.floating
            ? (r && "right" === r) || "down" === o
              ? 2
              : 1
            : o && ("down" === o ? 2 : 1))
        );
      },
      _intersectsWithSides: function (t) {
        var i = e(
            this.positionAbs.top + this.offset.click.top,
            t.top + t.height / 2,
            t.height
          ),
          n = e(
            this.positionAbs.left + this.offset.click.left,
            t.left + t.width / 2,
            t.width
          ),
          a = this._getDragVerticalDirection(),
          o = this._getDragHorizontalDirection();
        return this.floating && o
          ? ("right" === o && n) || ("left" === o && !n)
          : a && (("down" === a && i) || ("up" === a && !i));
      },
      _getDragVerticalDirection: function () {
        var t = this.positionAbs.top - this.lastPositionAbs.top;
        return 0 !== t && (t > 0 ? "down" : "up");
      },
      _getDragHorizontalDirection: function () {
        var t = this.positionAbs.left - this.lastPositionAbs.left;
        return 0 !== t && (t > 0 ? "right" : "left");
      },
      refresh: function (t) {
        return this._refreshItems(t), this.refreshPositions(), this;
      },
      _connectWith: function () {
        var t = this.options;
        return t.connectWith.constructor === String
          ? [t.connectWith]
          : t.connectWith;
      },
      _getItemsAsjQuery: function (e) {
        function i() {
          s.push(this);
        }
        var n,
          a,
          o,
          r,
          s = [],
          l = [],
          d = this._connectWith();
        if (d && e)
          for (n = d.length - 1; n >= 0; n--)
            for (o = t(d[n]), a = o.length - 1; a >= 0; a--)
              (r = t.data(o[a], this.widgetFullName)) &&
                r !== this &&
                !r.options.disabled &&
                l.push([
                  t.isFunction(r.options.items)
                    ? r.options.items.call(r.element)
                    : t(r.options.items, r.element)
                        .not(".ui-sortable-helper")
                        .not(".ui-sortable-placeholder"),
                  r,
                ]);
        for (
          l.push([
            t.isFunction(this.options.items)
              ? this.options.items.call(this.element, null, {
                  options: this.options,
                  item: this.currentItem,
                })
              : t(this.options.items, this.element)
                  .not(".ui-sortable-helper")
                  .not(".ui-sortable-placeholder"),
            this,
          ]),
            n = l.length - 1;
          n >= 0;
          n--
        )
          l[n][0].each(i);
        return t(s);
      },
      _removeCurrentsFromItems: function () {
        var e = this.currentItem.find(":data(" + this.widgetName + "-item)");
        this.items = t.grep(this.items, function (t) {
          for (var i = 0; e.length > i; i++) if (e[i] === t.item[0]) return !1;
          return !0;
        });
      },
      _refreshItems: function (e) {
        (this.items = []), (this.containers = [this]);
        var i,
          n,
          a,
          o,
          r,
          s,
          l,
          d,
          p = this.items,
          c = [
            [
              t.isFunction(this.options.items)
                ? this.options.items.call(this.element[0], e, {
                    item: this.currentItem,
                  })
                : t(this.options.items, this.element),
              this,
            ],
          ],
          u = this._connectWith();
        if (u && this.ready)
          for (i = u.length - 1; i >= 0; i--)
            for (a = t(u[i]), n = a.length - 1; n >= 0; n--)
              (o = t.data(a[n], this.widgetFullName)) &&
                o !== this &&
                !o.options.disabled &&
                (c.push([
                  t.isFunction(o.options.items)
                    ? o.options.items.call(o.element[0], e, {
                        item: this.currentItem,
                      })
                    : t(o.options.items, o.element),
                  o,
                ]),
                this.containers.push(o));
        for (i = c.length - 1; i >= 0; i--)
          for (r = c[i][1], s = c[i][0], n = 0, d = s.length; d > n; n++)
            (l = t(s[n])),
              l.data(this.widgetName + "-item", r),
              p.push({
                item: l,
                instance: r,
                width: 0,
                height: 0,
                left: 0,
                top: 0,
              });
      },
      refreshPositions: function (e) {
        this.offsetParent &&
          this.helper &&
          (this.offset.parent = this._getParentOffset());
        var i, n, a, o;
        for (i = this.items.length - 1; i >= 0; i--)
          (n = this.items[i]),
            (n.instance !== this.currentContainer &&
              this.currentContainer &&
              n.item[0] !== this.currentItem[0]) ||
              ((a = this.options.toleranceElement
                ? t(this.options.toleranceElement, n.item)
                : n.item),
              e || ((n.width = a.outerWidth()), (n.height = a.outerHeight())),
              (o = a.offset()),
              (n.left = o.left),
              (n.top = o.top));
        if (this.options.custom && this.options.custom.refreshContainers)
          this.options.custom.refreshContainers.call(this);
        else
          for (i = this.containers.length - 1; i >= 0; i--)
            (o = this.containers[i].element.offset()),
              (this.containers[i].containerCache.left = o.left),
              (this.containers[i].containerCache.top = o.top),
              (this.containers[i].containerCache.width =
                this.containers[i].element.outerWidth()),
              (this.containers[i].containerCache.height =
                this.containers[i].element.outerHeight());
        return this;
      },
      _createPlaceholder: function (e) {
        e = e || this;
        var i,
          n = e.options;
        (n.placeholder && n.placeholder.constructor !== String) ||
          ((i = n.placeholder),
          (n.placeholder = {
            element: function () {
              var n = e.currentItem[0].nodeName.toLowerCase(),
                a = t("<" + n + ">", e.document[0])
                  .addClass(
                    i || e.currentItem[0].className + " ui-sortable-placeholder"
                  )
                  .removeClass("ui-sortable-helper");
              return (
                "tr" === n
                  ? e.currentItem.children().each(function () {
                      t("<td>&#160;</td>", e.document[0])
                        .attr("colspan", t(this).attr("colspan") || 1)
                        .appendTo(a);
                    })
                  : "img" === n && a.attr("src", e.currentItem.attr("src")),
                i || a.css("visibility", "hidden"),
                a
              );
            },
            update: function (t, a) {
              (!i || n.forcePlaceholderSize) &&
                (a.height() ||
                  a.height(
                    e.currentItem.innerHeight() -
                      parseInt(e.currentItem.css("paddingTop") || 0, 10) -
                      parseInt(e.currentItem.css("paddingBottom") || 0, 10)
                  ),
                a.width() ||
                  a.width(
                    e.currentItem.innerWidth() -
                      parseInt(e.currentItem.css("paddingLeft") || 0, 10) -
                      parseInt(e.currentItem.css("paddingRight") || 0, 10)
                  ));
            },
          })),
          (e.placeholder = t(
            n.placeholder.element.call(e.element, e.currentItem)
          )),
          e.currentItem.after(e.placeholder),
          n.placeholder.update(e, e.placeholder);
      },
      _contactContainers: function (n) {
        var a,
          o,
          r,
          s,
          l,
          d,
          p,
          c,
          u,
          h,
          f = null,
          m = null;
        for (a = this.containers.length - 1; a >= 0; a--)
          if (!t.contains(this.currentItem[0], this.containers[a].element[0]))
            if (this._intersectsWith(this.containers[a].containerCache)) {
              if (f && t.contains(this.containers[a].element[0], f.element[0]))
                continue;
              (f = this.containers[a]), (m = a);
            } else
              this.containers[a].containerCache.over &&
                (this.containers[a]._trigger("out", n, this._uiHash(this)),
                (this.containers[a].containerCache.over = 0));
        if (f)
          if (1 === this.containers.length)
            this.containers[m].containerCache.over ||
              (this.containers[m]._trigger("over", n, this._uiHash(this)),
              (this.containers[m].containerCache.over = 1));
          else {
            for (
              r = 1e4,
                s = null,
                h = f.floating || i(this.currentItem),
                l = h ? "left" : "top",
                d = h ? "width" : "height",
                p = this.positionAbs[l] + this.offset.click[l],
                o = this.items.length - 1;
              o >= 0;
              o--
            )
              t.contains(
                this.containers[m].element[0],
                this.items[o].item[0]
              ) &&
                this.items[o].item[0] !== this.currentItem[0] &&
                (!h ||
                  e(
                    this.positionAbs.top + this.offset.click.top,
                    this.items[o].top,
                    this.items[o].height
                  )) &&
                ((c = this.items[o].item.offset()[l]),
                (u = !1),
                Math.abs(c - p) > Math.abs(c + this.items[o][d] - p) &&
                  ((u = !0), (c += this.items[o][d])),
                r > Math.abs(c - p) &&
                  ((r = Math.abs(c - p)),
                  (s = this.items[o]),
                  (this.direction = u ? "up" : "down")));
            if (!s && !this.options.dropOnEmpty) return;
            if (this.currentContainer === this.containers[m]) return;
            s
              ? this._rearrange(n, s, null, !0)
              : this._rearrange(n, null, this.containers[m].element, !0),
              this._trigger("change", n, this._uiHash()),
              this.containers[m]._trigger("change", n, this._uiHash(this)),
              (this.currentContainer = this.containers[m]),
              this.options.placeholder.update(
                this.currentContainer,
                this.placeholder
              ),
              this.containers[m]._trigger("over", n, this._uiHash(this)),
              (this.containers[m].containerCache.over = 1);
          }
      },
      _createHelper: function (e) {
        var i = this.options,
          n = t.isFunction(i.helper)
            ? t(i.helper.apply(this.element[0], [e, this.currentItem]))
            : "clone" === i.helper
            ? this.currentItem.clone()
            : this.currentItem;
        return (
          n.parents("body").length ||
            t(
              "parent" !== i.appendTo
                ? i.appendTo
                : this.currentItem[0].parentNode
            )[0].appendChild(n[0]),
          n[0] === this.currentItem[0] &&
            (this._storedCSS = {
              width: this.currentItem[0].style.width,
              height: this.currentItem[0].style.height,
              position: this.currentItem.css("position"),
              top: this.currentItem.css("top"),
              left: this.currentItem.css("left"),
            }),
          (!n[0].style.width || i.forceHelperSize) &&
            n.width(this.currentItem.width()),
          (!n[0].style.height || i.forceHelperSize) &&
            n.height(this.currentItem.height()),
          n
        );
      },
      _adjustOffsetFromHelper: function (e) {
        "string" == typeof e && (e = e.split(" ")),
          t.isArray(e) && (e = { left: +e[0], top: +e[1] || 0 }),
          "left" in e && (this.offset.click.left = e.left + this.margins.left),
          "right" in e &&
            (this.offset.click.left =
              this.helperProportions.width - e.right + this.margins.left),
          "top" in e && (this.offset.click.top = e.top + this.margins.top),
          "bottom" in e &&
            (this.offset.click.top =
              this.helperProportions.height - e.bottom + this.margins.top);
      },
      _getParentOffset: function () {
        this.offsetParent = this.helper.offsetParent();
        var e = this.offsetParent.offset();
        return (
          "absolute" === this.cssPosition &&
            this.scrollParent[0] !== document &&
            t.contains(this.scrollParent[0], this.offsetParent[0]) &&
            ((e.left += this.scrollParent.scrollLeft()),
            (e.top += this.scrollParent.scrollTop())),
          (this.offsetParent[0] === document.body ||
            (this.offsetParent[0].tagName &&
              "html" === this.offsetParent[0].tagName.toLowerCase() &&
              t.ui.ie)) &&
            (e = { top: 0, left: 0 }),
          {
            top:
              e.top +
              (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
            left:
              e.left +
              (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0),
          }
        );
      },
      _getRelativeOffset: function () {
        if ("relative" === this.cssPosition) {
          var t = this.currentItem.position();
          return {
            top:
              t.top -
              (parseInt(this.helper.css("top"), 10) || 0) +
              this.scrollParent.scrollTop(),
            left:
              t.left -
              (parseInt(this.helper.css("left"), 10) || 0) +
              this.scrollParent.scrollLeft(),
          };
        }
        return { top: 0, left: 0 };
      },
      _cacheMargins: function () {
        this.margins = {
          left: parseInt(this.currentItem.css("marginLeft"), 10) || 0,
          top: parseInt(this.currentItem.css("marginTop"), 10) || 0,
        };
      },
      _cacheHelperProportions: function () {
        this.helperProportions = {
          width: this.helper.outerWidth(),
          height: this.helper.outerHeight(),
        };
      },
      _setContainment: function () {
        var e,
          i,
          n,
          a = this.options;
        "parent" === a.containment &&
          (a.containment = this.helper[0].parentNode),
          ("document" === a.containment || "window" === a.containment) &&
            (this.containment = [
              0 - this.offset.relative.left - this.offset.parent.left,
              0 - this.offset.relative.top - this.offset.parent.top,
              t("document" === a.containment ? document : window).width() -
                this.helperProportions.width -
                this.margins.left,
              (t("document" === a.containment ? document : window).height() ||
                document.body.parentNode.scrollHeight) -
                this.helperProportions.height -
                this.margins.top,
            ]),
          /^(document|window|parent)$/.test(a.containment) ||
            ((e = t(a.containment)[0]),
            (i = t(a.containment).offset()),
            (n = "hidden" !== t(e).css("overflow")),
            (this.containment = [
              i.left +
                (parseInt(t(e).css("borderLeftWidth"), 10) || 0) +
                (parseInt(t(e).css("paddingLeft"), 10) || 0) -
                this.margins.left,
              i.top +
                (parseInt(t(e).css("borderTopWidth"), 10) || 0) +
                (parseInt(t(e).css("paddingTop"), 10) || 0) -
                this.margins.top,
              i.left +
                (n ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) -
                (parseInt(t(e).css("borderLeftWidth"), 10) || 0) -
                (parseInt(t(e).css("paddingRight"), 10) || 0) -
                this.helperProportions.width -
                this.margins.left,
              i.top +
                (n
                  ? Math.max(e.scrollHeight, e.offsetHeight)
                  : e.offsetHeight) -
                (parseInt(t(e).css("borderTopWidth"), 10) || 0) -
                (parseInt(t(e).css("paddingBottom"), 10) || 0) -
                this.helperProportions.height -
                this.margins.top,
            ]));
      },
      _convertPositionTo: function (e, i) {
        i || (i = this.position);
        var n = "absolute" === e ? 1 : -1,
          a =
            "absolute" !== this.cssPosition ||
            (this.scrollParent[0] !== document &&
              t.contains(this.scrollParent[0], this.offsetParent[0]))
              ? this.scrollParent
              : this.offsetParent,
          o = /(html|body)/i.test(a[0].tagName);
        return {
          top:
            i.top +
            this.offset.relative.top * n +
            this.offset.parent.top * n -
            ("fixed" === this.cssPosition
              ? -this.scrollParent.scrollTop()
              : o
              ? 0
              : a.scrollTop()) *
              n,
          left:
            i.left +
            this.offset.relative.left * n +
            this.offset.parent.left * n -
            ("fixed" === this.cssPosition
              ? -this.scrollParent.scrollLeft()
              : o
              ? 0
              : a.scrollLeft()) *
              n,
        };
      },
      _generatePosition: function (e) {
        var i,
          n,
          a = this.options,
          o = e.pageX,
          r = e.pageY,
          s =
            "absolute" !== this.cssPosition ||
            (this.scrollParent[0] !== document &&
              t.contains(this.scrollParent[0], this.offsetParent[0]))
              ? this.scrollParent
              : this.offsetParent,
          l = /(html|body)/i.test(s[0].tagName);
        return (
          "relative" !== this.cssPosition ||
            (this.scrollParent[0] !== document &&
              this.scrollParent[0] !== this.offsetParent[0]) ||
            (this.offset.relative = this._getRelativeOffset()),
          this.originalPosition &&
            (this.containment &&
              (e.pageX - this.offset.click.left < this.containment[0] &&
                (o = this.containment[0] + this.offset.click.left),
              e.pageY - this.offset.click.top < this.containment[1] &&
                (r = this.containment[1] + this.offset.click.top),
              e.pageX - this.offset.click.left > this.containment[2] &&
                (o = this.containment[2] + this.offset.click.left),
              e.pageY - this.offset.click.top > this.containment[3] &&
                (r = this.containment[3] + this.offset.click.top)),
            a.grid &&
              ((i =
                this.originalPageY +
                Math.round((r - this.originalPageY) / a.grid[1]) * a.grid[1]),
              (r = this.containment
                ? i - this.offset.click.top >= this.containment[1] &&
                  i - this.offset.click.top <= this.containment[3]
                  ? i
                  : i - this.offset.click.top >= this.containment[1]
                  ? i - a.grid[1]
                  : i + a.grid[1]
                : i),
              (n =
                this.originalPageX +
                Math.round((o - this.originalPageX) / a.grid[0]) * a.grid[0]),
              (o = this.containment
                ? n - this.offset.click.left >= this.containment[0] &&
                  n - this.offset.click.left <= this.containment[2]
                  ? n
                  : n - this.offset.click.left >= this.containment[0]
                  ? n - a.grid[0]
                  : n + a.grid[0]
                : n))),
          {
            top:
              r -
              this.offset.click.top -
              this.offset.relative.top -
              this.offset.parent.top +
              ("fixed" === this.cssPosition
                ? -this.scrollParent.scrollTop()
                : l
                ? 0
                : s.scrollTop()),
            left:
              o -
              this.offset.click.left -
              this.offset.relative.left -
              this.offset.parent.left +
              ("fixed" === this.cssPosition
                ? -this.scrollParent.scrollLeft()
                : l
                ? 0
                : s.scrollLeft()),
          }
        );
      },
      _rearrange: function (t, e, i, n) {
        i
          ? i[0].appendChild(this.placeholder[0])
          : e.item[0].parentNode.insertBefore(
              this.placeholder[0],
              "down" === this.direction ? e.item[0] : e.item[0].nextSibling
            ),
          (this.counter = this.counter ? ++this.counter : 1);
        var a = this.counter;
        this._delay(function () {
          a === this.counter && this.refreshPositions(!n);
        });
      },
      _clear: function (t, e) {
        function i(t, e, i) {
          return function (n) {
            i._trigger(t, n, e._uiHash(e));
          };
        }
        this.reverting = !1;
        var n,
          a = [];
        if (
          (!this._noFinalSort &&
            this.currentItem.parent().length &&
            this.placeholder.before(this.currentItem),
          (this._noFinalSort = null),
          this.helper[0] === this.currentItem[0])
        ) {
          for (n in this._storedCSS)
            ("auto" === this._storedCSS[n] ||
              "static" === this._storedCSS[n]) &&
              (this._storedCSS[n] = "");
          this.currentItem
            .css(this._storedCSS)
            .removeClass("ui-sortable-helper");
        } else this.currentItem.show();
        for (
          this.fromOutside &&
            !e &&
            a.push(function (t) {
              this._trigger("receive", t, this._uiHash(this.fromOutside));
            }),
            (!this.fromOutside &&
              this.domPosition.prev ===
                this.currentItem.prev().not(".ui-sortable-helper")[0] &&
              this.domPosition.parent === this.currentItem.parent()[0]) ||
              e ||
              a.push(function (t) {
                this._trigger("update", t, this._uiHash());
              }),
            this !== this.currentContainer &&
              (e ||
                (a.push(function (t) {
                  this._trigger("remove", t, this._uiHash());
                }),
                a.push(
                  function (t) {
                    return function (e) {
                      t._trigger("receive", e, this._uiHash(this));
                    };
                  }.call(this, this.currentContainer)
                ),
                a.push(
                  function (t) {
                    return function (e) {
                      t._trigger("update", e, this._uiHash(this));
                    };
                  }.call(this, this.currentContainer)
                ))),
            n = this.containers.length - 1;
          n >= 0;
          n--
        )
          e || a.push(i("deactivate", this, this.containers[n])),
            this.containers[n].containerCache.over &&
              (a.push(i("out", this, this.containers[n])),
              (this.containers[n].containerCache.over = 0));
        if (
          (this.storedCursor &&
            (this.document.find("body").css("cursor", this.storedCursor),
            this.storedStylesheet.remove()),
          this._storedOpacity &&
            this.helper.css("opacity", this._storedOpacity),
          this._storedZIndex &&
            this.helper.css(
              "zIndex",
              "auto" === this._storedZIndex ? "" : this._storedZIndex
            ),
          (this.dragging = !1),
          this.cancelHelperRemoval)
        ) {
          if (!e) {
            for (
              this._trigger("beforeStop", t, this._uiHash()), n = 0;
              a.length > n;
              n++
            )
              a[n].call(this, t);
            this._trigger("stop", t, this._uiHash());
          }
          return (this.fromOutside = !1), !1;
        }
        if (
          (e || this._trigger("beforeStop", t, this._uiHash()),
          this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
          this.helper[0] !== this.currentItem[0] && this.helper.remove(),
          (this.helper = null),
          !e)
        ) {
          for (n = 0; a.length > n; n++) a[n].call(this, t);
          this._trigger("stop", t, this._uiHash());
        }
        return (this.fromOutside = !1), !0;
      },
      _trigger: function () {
        !1 === t.Widget.prototype._trigger.apply(this, arguments) &&
          this.cancel();
      },
      _uiHash: function (e) {
        var i = e || this;
        return {
          helper: i.helper,
          placeholder: i.placeholder || t([]),
          position: i.position,
          originalPosition: i.originalPosition,
          offset: i.positionAbs,
          item: i.currentItem,
          sender: e ? e.element : null,
        };
      },
    });
  })(jQuery),
  (function (t, e) {
    var i = "ui-effects-";
    (t.effects = { effect: {} }),
      (function (t, e) {
        function i(t, e, i) {
          var n = p[e.type] || {};
          return null == t
            ? i || !e.def
              ? null
              : e.def
            : ((t = n.floor ? ~~t : parseFloat(t)),
              isNaN(t)
                ? e.def
                : n.mod
                ? (t + n.mod) % n.mod
                : 0 > t
                ? 0
                : t > n.max
                ? n.max
                : t);
        }
        function n(i) {
          var n = l(),
            a = (n._rgba = []);
          return (
            (i = i.toLowerCase()),
            h(s, function (t, o) {
              var r,
                s = o.re.exec(i),
                l = s && o.parse(s),
                p = o.space || "rgba";
              return l
                ? ((r = n[p](l)),
                  (n[d[p].cache] = r[d[p].cache]),
                  (a = n._rgba = r._rgba),
                  !1)
                : e;
            }),
            a.length
              ? ("0,0,0,0" === a.join() && t.extend(a, o.transparent), n)
              : o[i]
          );
        }
        function a(t, e, i) {
          return (
            (i = (i + 1) % 1),
            1 > 6 * i
              ? t + 6 * (e - t) * i
              : 1 > 2 * i
              ? e
              : 2 > 3 * i
              ? t + 6 * (e - t) * (2 / 3 - i)
              : t
          );
        }
        var o,
          r = /^([\-+])=\s*(\d+\.?\d*)/,
          s = [
            {
              re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
              parse: function (t) {
                return [t[1], t[2], t[3], t[4]];
              },
            },
            {
              re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
              parse: function (t) {
                return [2.55 * t[1], 2.55 * t[2], 2.55 * t[3], t[4]];
              },
            },
            {
              re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
              parse: function (t) {
                return [
                  parseInt(t[1], 16),
                  parseInt(t[2], 16),
                  parseInt(t[3], 16),
                ];
              },
            },
            {
              re: /#([a-f0-9])([a-f0-9])([a-f0-9])/,
              parse: function (t) {
                return [
                  parseInt(t[1] + t[1], 16),
                  parseInt(t[2] + t[2], 16),
                  parseInt(t[3] + t[3], 16),
                ];
              },
            },
            {
              re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
              space: "hsla",
              parse: function (t) {
                return [t[1], t[2] / 100, t[3] / 100, t[4]];
              },
            },
          ],
          l = (t.Color = function (e, i, n, a) {
            return new t.Color.fn.parse(e, i, n, a);
          }),
          d = {
            rgba: {
              props: {
                red: { idx: 0, type: "byte" },
                green: { idx: 1, type: "byte" },
                blue: { idx: 2, type: "byte" },
              },
            },
            hsla: {
              props: {
                hue: { idx: 0, type: "degrees" },
                saturation: { idx: 1, type: "percent" },
                lightness: { idx: 2, type: "percent" },
              },
            },
          },
          p = {
            byte: { floor: !0, max: 255 },
            percent: { max: 1 },
            degrees: { mod: 360, floor: !0 },
          },
          c = (l.support = {}),
          u = t("<p>")[0],
          h = t.each;
        (u.style.cssText = "background-color:rgba(1,1,1,.5)"),
          (c.rgba = u.style.backgroundColor.indexOf("rgba") > -1),
          h(d, function (t, e) {
            (e.cache = "_" + t),
              (e.props.alpha = { idx: 3, type: "percent", def: 1 });
          }),
          (l.fn = t.extend(l.prototype, {
            parse: function (a, r, s, p) {
              if (a === e) return (this._rgba = [null, null, null, null]), this;
              (a.jquery || a.nodeType) && ((a = t(a).css(r)), (r = e));
              var c = this,
                u = t.type(a),
                f = (this._rgba = []);
              return (
                r !== e && ((a = [a, r, s, p]), (u = "array")),
                "string" === u
                  ? this.parse(n(a) || o._default)
                  : "array" === u
                  ? (h(d.rgba.props, function (t, e) {
                      f[e.idx] = i(a[e.idx], e);
                    }),
                    this)
                  : "object" === u
                  ? (a instanceof l
                      ? h(d, function (t, e) {
                          a[e.cache] && (c[e.cache] = a[e.cache].slice());
                        })
                      : h(d, function (e, n) {
                          var o = n.cache;
                          h(n.props, function (t, e) {
                            if (!c[o] && n.to) {
                              if ("alpha" === t || null == a[t]) return;
                              c[o] = n.to(c._rgba);
                            }
                            c[o][e.idx] = i(a[t], e, !0);
                          }),
                            c[o] &&
                              0 > t.inArray(null, c[o].slice(0, 3)) &&
                              ((c[o][3] = 1),
                              n.from && (c._rgba = n.from(c[o])));
                        }),
                    this)
                  : e
              );
            },
            is: function (t) {
              var i = l(t),
                n = !0,
                a = this;
              return (
                h(d, function (t, o) {
                  var r,
                    s = i[o.cache];
                  return (
                    s &&
                      ((r = a[o.cache] || (o.to && o.to(a._rgba)) || []),
                      h(o.props, function (t, i) {
                        return null != s[i.idx]
                          ? (n = s[i.idx] === r[i.idx])
                          : e;
                      })),
                    n
                  );
                }),
                n
              );
            },
            _space: function () {
              var t = [],
                e = this;
              return (
                h(d, function (i, n) {
                  e[n.cache] && t.push(i);
                }),
                t.pop()
              );
            },
            transition: function (t, e) {
              var n = l(t),
                a = n._space(),
                o = d[a],
                r = 0 === this.alpha() ? l("transparent") : this,
                s = r[o.cache] || o.to(r._rgba),
                c = s.slice();
              return (
                (n = n[o.cache]),
                h(o.props, function (t, a) {
                  var o = a.idx,
                    r = s[o],
                    l = n[o],
                    d = p[a.type] || {};
                  null !== l &&
                    (null === r
                      ? (c[o] = l)
                      : (d.mod &&
                          (l - r > d.mod / 2
                            ? (r += d.mod)
                            : r - l > d.mod / 2 && (r -= d.mod)),
                        (c[o] = i((l - r) * e + r, a))));
                }),
                this[a](c)
              );
            },
            blend: function (e) {
              if (1 === this._rgba[3]) return this;
              var i = this._rgba.slice(),
                n = i.pop(),
                a = l(e)._rgba;
              return l(
                t.map(i, function (t, e) {
                  return (1 - n) * a[e] + n * t;
                })
              );
            },
            toRgbaString: function () {
              var e = "rgba(",
                i = t.map(this._rgba, function (t, e) {
                  return null == t ? (e > 2 ? 1 : 0) : t;
                });
              return 1 === i[3] && (i.pop(), (e = "rgb(")), e + i.join() + ")";
            },
            toHslaString: function () {
              var e = "hsla(",
                i = t.map(this.hsla(), function (t, e) {
                  return (
                    null == t && (t = e > 2 ? 1 : 0),
                    e && 3 > e && (t = Math.round(100 * t) + "%"),
                    t
                  );
                });
              return 1 === i[3] && (i.pop(), (e = "hsl(")), e + i.join() + ")";
            },
            toHexString: function (e) {
              var i = this._rgba.slice(),
                n = i.pop();
              return (
                e && i.push(~~(255 * n)),
                "#" +
                  t
                    .map(i, function (t) {
                      return (
                        (t = (t || 0).toString(16)),
                        1 === t.length ? "0" + t : t
                      );
                    })
                    .join("")
              );
            },
            toString: function () {
              return 0 === this._rgba[3] ? "transparent" : this.toRgbaString();
            },
          })),
          (l.fn.parse.prototype = l.fn),
          (d.hsla.to = function (t) {
            if (null == t[0] || null == t[1] || null == t[2])
              return [null, null, null, t[3]];
            var e,
              i,
              n = t[0] / 255,
              a = t[1] / 255,
              o = t[2] / 255,
              r = t[3],
              s = Math.max(n, a, o),
              l = Math.min(n, a, o),
              d = s - l,
              p = s + l,
              c = 0.5 * p;
            return (
              (e =
                l === s
                  ? 0
                  : n === s
                  ? (60 * (a - o)) / d + 360
                  : a === s
                  ? (60 * (o - n)) / d + 120
                  : (60 * (n - a)) / d + 240),
              (i = 0 === d ? 0 : 0.5 >= c ? d / p : d / (2 - p)),
              [Math.round(e) % 360, i, c, null == r ? 1 : r]
            );
          }),
          (d.hsla.from = function (t) {
            if (null == t[0] || null == t[1] || null == t[2])
              return [null, null, null, t[3]];
            var e = t[0] / 360,
              i = t[1],
              n = t[2],
              o = t[3],
              r = 0.5 >= n ? n * (1 + i) : n + i - n * i,
              s = 2 * n - r;
            return [
              Math.round(255 * a(s, r, e + 1 / 3)),
              Math.round(255 * a(s, r, e)),
              Math.round(255 * a(s, r, e - 1 / 3)),
              o,
            ];
          }),
          h(d, function (n, a) {
            var o = a.props,
              s = a.cache,
              d = a.to,
              p = a.from;
            (l.fn[n] = function (n) {
              if ((d && !this[s] && (this[s] = d(this._rgba)), n === e))
                return this[s].slice();
              var a,
                r = t.type(n),
                c = "array" === r || "object" === r ? n : arguments,
                u = this[s].slice();
              return (
                h(o, function (t, e) {
                  var n = c["object" === r ? t : e.idx];
                  null == n && (n = u[e.idx]), (u[e.idx] = i(n, e));
                }),
                p ? ((a = l(p(u))), (a[s] = u), a) : l(u)
              );
            }),
              h(o, function (e, i) {
                l.fn[e] ||
                  (l.fn[e] = function (a) {
                    var o,
                      s = t.type(a),
                      l = "alpha" === e ? (this._hsla ? "hsla" : "rgba") : n,
                      d = this[l](),
                      p = d[i.idx];
                    return "undefined" === s
                      ? p
                      : ("function" === s &&
                          ((a = a.call(this, p)), (s = t.type(a))),
                        null == a && i.empty
                          ? this
                          : ("string" === s &&
                              (o = r.exec(a)) &&
                              (a =
                                p + parseFloat(o[2]) * ("+" === o[1] ? 1 : -1)),
                            (d[i.idx] = a),
                            this[l](d)));
                  });
              });
          }),
          (l.hook = function (e) {
            var i = e.split(" ");
            h(i, function (e, i) {
              (t.cssHooks[i] = {
                set: function (e, a) {
                  var o,
                    r,
                    s = "";
                  if (
                    "transparent" !== a &&
                    ("string" !== t.type(a) || (o = n(a)))
                  ) {
                    if (((a = l(o || a)), !c.rgba && 1 !== a._rgba[3])) {
                      for (
                        r = "backgroundColor" === i ? e.parentNode : e;
                        ("" === s || "transparent" === s) && r && r.style;

                      )
                        try {
                          (s = t.css(r, "backgroundColor")), (r = r.parentNode);
                        } catch (t) {}
                      a = a.blend(s && "transparent" !== s ? s : "_default");
                    }
                    a = a.toRgbaString();
                  }
                  try {
                    e.style[i] = a;
                  } catch (t) {}
                },
              }),
                (t.fx.step[i] = function (e) {
                  e.colorInit ||
                    ((e.start = l(e.elem, i)),
                    (e.end = l(e.end)),
                    (e.colorInit = !0)),
                    t.cssHooks[i].set(e.elem, e.start.transition(e.end, e.pos));
                });
            });
          }),
          l.hook(
            "backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"
          ),
          (t.cssHooks.borderColor = {
            expand: function (t) {
              var e = {};
              return (
                h(["Top", "Right", "Bottom", "Left"], function (i, n) {
                  e["border" + n + "Color"] = t;
                }),
                e
              );
            },
          }),
          (o = t.Color.names =
            {
              aqua: "#00ffff",
              black: "#000000",
              blue: "#0000ff",
              fuchsia: "#ff00ff",
              gray: "#808080",
              green: "#008000",
              lime: "#00ff00",
              maroon: "#800000",
              navy: "#000080",
              olive: "#808000",
              purple: "#800080",
              red: "#ff0000",
              silver: "#c0c0c0",
              teal: "#008080",
              white: "#ffffff",
              yellow: "#ffff00",
              transparent: [null, null, null, 0],
              _default: "#ffffff",
            });
      })(jQuery),
      (function () {
        function i(e) {
          var i,
            n,
            a = e.ownerDocument.defaultView
              ? e.ownerDocument.defaultView.getComputedStyle(e, null)
              : e.currentStyle,
            o = {};
          if (a && a.length && a[0] && a[a[0]])
            for (n = a.length; n--; )
              (i = a[n]), "string" == typeof a[i] && (o[t.camelCase(i)] = a[i]);
          else for (i in a) "string" == typeof a[i] && (o[i] = a[i]);
          return o;
        }
        function n(e, i) {
          var n,
            a,
            r = {};
          for (n in i)
            (a = i[n]),
              e[n] !== a &&
                (o[n] ||
                  ((t.fx.step[n] || !isNaN(parseFloat(a))) && (r[n] = a)));
          return r;
        }
        var a = ["add", "remove", "toggle"],
          o = {
            border: 1,
            borderBottom: 1,
            borderColor: 1,
            borderLeft: 1,
            borderRight: 1,
            borderTop: 1,
            borderWidth: 1,
            margin: 1,
            padding: 1,
          };
        t.each(
          [
            "borderLeftStyle",
            "borderRightStyle",
            "borderBottomStyle",
            "borderTopStyle",
          ],
          function (e, i) {
            t.fx.step[i] = function (t) {
              (("none" !== t.end && !t.setAttr) ||
                (1 === t.pos && !t.setAttr)) &&
                (jQuery.style(t.elem, i, t.end), (t.setAttr = !0));
            };
          }
        ),
          t.fn.addBack ||
            (t.fn.addBack = function (t) {
              return this.add(
                null == t ? this.prevObject : this.prevObject.filter(t)
              );
            }),
          (t.effects.animateClass = function (e, o, r, s) {
            var l = t.speed(o, r, s);
            return this.queue(function () {
              var o,
                r = t(this),
                s = r.attr("class") || "",
                d = l.children ? r.find("*").addBack() : r;
              (d = d.map(function () {
                return { el: t(this), start: i(this) };
              })),
                (o = function () {
                  t.each(a, function (t, i) {
                    e[i] && r[i + "Class"](e[i]);
                  });
                }),
                o(),
                (d = d.map(function () {
                  return (
                    (this.end = i(this.el[0])),
                    (this.diff = n(this.start, this.end)),
                    this
                  );
                })),
                r.attr("class", s),
                (d = d.map(function () {
                  var e = this,
                    i = t.Deferred(),
                    n = t.extend({}, l, {
                      queue: !1,
                      complete: function () {
                        i.resolve(e);
                      },
                    });
                  return this.el.animate(this.diff, n), i.promise();
                })),
                t.when.apply(t, d.get()).done(function () {
                  o(),
                    t.each(arguments, function () {
                      var e = this.el;
                      t.each(this.diff, function (t) {
                        e.css(t, "");
                      });
                    }),
                    l.complete.call(r[0]);
                });
            });
          }),
          t.fn.extend({
            addClass: (function (e) {
              return function (i, n, a, o) {
                return n
                  ? t.effects.animateClass.call(this, { add: i }, n, a, o)
                  : e.apply(this, arguments);
              };
            })(t.fn.addClass),
            removeClass: (function (e) {
              return function (i, n, a, o) {
                return arguments.length > 1
                  ? t.effects.animateClass.call(this, { remove: i }, n, a, o)
                  : e.apply(this, arguments);
              };
            })(t.fn.removeClass),
            toggleClass: (function (i) {
              return function (n, a, o, r, s) {
                return "boolean" == typeof a || a === e
                  ? o
                    ? t.effects.animateClass.call(
                        this,
                        a ? { add: n } : { remove: n },
                        o,
                        r,
                        s
                      )
                    : i.apply(this, arguments)
                  : t.effects.animateClass.call(this, { toggle: n }, a, o, r);
              };
            })(t.fn.toggleClass),
            switchClass: function (e, i, n, a, o) {
              return t.effects.animateClass.call(
                this,
                { add: i, remove: e },
                n,
                a,
                o
              );
            },
          });
      })(),
      (function () {
        function n(e, i, n, a) {
          return (
            t.isPlainObject(e) && ((i = e), (e = e.effect)),
            (e = { effect: e }),
            null == i && (i = {}),
            t.isFunction(i) && ((a = i), (n = null), (i = {})),
            ("number" == typeof i || t.fx.speeds[i]) &&
              ((a = n), (n = i), (i = {})),
            t.isFunction(n) && ((a = n), (n = null)),
            i && t.extend(e, i),
            (n = n || i.duration),
            (e.duration = t.fx.off
              ? 0
              : "number" == typeof n
              ? n
              : n in t.fx.speeds
              ? t.fx.speeds[n]
              : t.fx.speeds._default),
            (e.complete = a || i.complete),
            e
          );
        }
        function a(e) {
          return (
            !(e && "number" != typeof e && !t.fx.speeds[e]) ||
            ("string" == typeof e && !t.effects.effect[e]) ||
            !!t.isFunction(e) ||
            ("object" == typeof e && !e.effect)
          );
        }
        t.extend(t.effects, {
          version: "1.10.4",
          save: function (t, e) {
            for (var n = 0; e.length > n; n++)
              null !== e[n] && t.data(i + e[n], t[0].style[e[n]]);
          },
          restore: function (t, n) {
            var a, o;
            for (o = 0; n.length > o; o++)
              null !== n[o] &&
                ((a = t.data(i + n[o])), a === e && (a = ""), t.css(n[o], a));
          },
          setMode: function (t, e) {
            return "toggle" === e && (e = t.is(":hidden") ? "show" : "hide"), e;
          },
          getBaseline: function (t, e) {
            var i, n;
            switch (t[0]) {
              case "top":
                i = 0;
                break;
              case "middle":
                i = 0.5;
                break;
              case "bottom":
                i = 1;
                break;
              default:
                i = t[0] / e.height;
            }
            switch (t[1]) {
              case "left":
                n = 0;
                break;
              case "center":
                n = 0.5;
                break;
              case "right":
                n = 1;
                break;
              default:
                n = t[1] / e.width;
            }
            return { x: n, y: i };
          },
          createWrapper: function (e) {
            if (e.parent().is(".ui-effects-wrapper")) return e.parent();
            var i = {
                width: e.outerWidth(!0),
                height: e.outerHeight(!0),
                float: e.css("float"),
              },
              n = t("<div></div>")
                .addClass("ui-effects-wrapper")
                .css({
                  fontSize: "100%",
                  background: "transparent",
                  border: "none",
                  margin: 0,
                  padding: 0,
                }),
              a = { width: e.width(), height: e.height() },
              o = document.activeElement;
            try {
              o.id;
            } catch (t) {
              o = document.body;
            }
            return (
              e.wrap(n),
              (e[0] === o || t.contains(e[0], o)) && t(o).focus(),
              (n = e.parent()),
              "static" === e.css("position")
                ? (n.css({ position: "relative" }),
                  e.css({ position: "relative" }))
                : (t.extend(i, {
                    position: e.css("position"),
                    zIndex: e.css("z-index"),
                  }),
                  t.each(["top", "left", "bottom", "right"], function (t, n) {
                    (i[n] = e.css(n)),
                      isNaN(parseInt(i[n], 10)) && (i[n] = "auto");
                  }),
                  e.css({
                    position: "relative",
                    top: 0,
                    left: 0,
                    right: "auto",
                    bottom: "auto",
                  })),
              e.css(a),
              n.css(i).show()
            );
          },
          removeWrapper: function (e) {
            var i = document.activeElement;
            return (
              e.parent().is(".ui-effects-wrapper") &&
                (e.parent().replaceWith(e),
                (e[0] === i || t.contains(e[0], i)) && t(i).focus()),
              e
            );
          },
          setTransition: function (e, i, n, a) {
            return (
              (a = a || {}),
              t.each(i, function (t, i) {
                var o = e.cssUnit(i);
                o[0] > 0 && (a[i] = o[0] * n + o[1]);
              }),
              a
            );
          },
        }),
          t.fn.extend({
            effect: function () {
              function e(e) {
                function n() {
                  t.isFunction(o) && o.call(a[0]), t.isFunction(e) && e();
                }
                var a = t(this),
                  o = i.complete,
                  s = i.mode;
                (a.is(":hidden") ? "hide" === s : "show" === s)
                  ? (a[s](), n())
                  : r.call(a[0], i, n);
              }
              var i = n.apply(this, arguments),
                a = i.mode,
                o = i.queue,
                r = t.effects.effect[i.effect];
              return t.fx.off || !r
                ? a
                  ? this[a](i.duration, i.complete)
                  : this.each(function () {
                      i.complete && i.complete.call(this);
                    })
                : !1 === o
                ? this.each(e)
                : this.queue(o || "fx", e);
            },
            show: (function (t) {
              return function (e) {
                if (a(e)) return t.apply(this, arguments);
                var i = n.apply(this, arguments);
                return (i.mode = "show"), this.effect.call(this, i);
              };
            })(t.fn.show),
            hide: (function (t) {
              return function (e) {
                if (a(e)) return t.apply(this, arguments);
                var i = n.apply(this, arguments);
                return (i.mode = "hide"), this.effect.call(this, i);
              };
            })(t.fn.hide),
            toggle: (function (t) {
              return function (e) {
                if (a(e) || "boolean" == typeof e)
                  return t.apply(this, arguments);
                var i = n.apply(this, arguments);
                return (i.mode = "toggle"), this.effect.call(this, i);
              };
            })(t.fn.toggle),
            cssUnit: function (e) {
              var i = this.css(e),
                n = [];
              return (
                t.each(["em", "px", "%", "pt"], function (t, e) {
                  i.indexOf(e) > 0 && (n = [parseFloat(i), e]);
                }),
                n
              );
            },
          });
      })(),
      (function () {
        var e = {};
        t.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function (t, i) {
          e[i] = function (e) {
            return Math.pow(e, t + 2);
          };
        }),
          t.extend(e, {
            Sine: function (t) {
              return 1 - Math.cos((t * Math.PI) / 2);
            },
            Circ: function (t) {
              return 1 - Math.sqrt(1 - t * t);
            },
            Elastic: function (t) {
              return 0 === t || 1 === t
                ? t
                : -Math.pow(2, 8 * (t - 1)) *
                    Math.sin(((80 * (t - 1) - 7.5) * Math.PI) / 15);
            },
            Back: function (t) {
              return t * t * (3 * t - 2);
            },
            Bounce: function (t) {
              for (var e, i = 4; ((e = Math.pow(2, --i)) - 1) / 11 > t; );
              return (
                1 / Math.pow(4, 3 - i) -
                7.5625 * Math.pow((3 * e - 2) / 22 - t, 2)
              );
            },
          }),
          t.each(e, function (e, i) {
            (t.easing["easeIn" + e] = i),
              (t.easing["easeOut" + e] = function (t) {
                return 1 - i(1 - t);
              }),
              (t.easing["easeInOut" + e] = function (t) {
                return 0.5 > t ? i(2 * t) / 2 : 1 - i(-2 * t + 2) / 2;
              });
          });
      })();
  })(jQuery),
  (function (t) {
    t.effects.effect.drop = function (e, i) {
      var n,
        a = t(this),
        o = [
          "position",
          "top",
          "bottom",
          "left",
          "right",
          "opacity",
          "height",
          "width",
        ],
        r = t.effects.setMode(a, e.mode || "hide"),
        s = "show" === r,
        l = e.direction || "left",
        d = "up" === l || "down" === l ? "top" : "left",
        p = "up" === l || "left" === l ? "pos" : "neg",
        c = { opacity: s ? 1 : 0 };
      t.effects.save(a, o),
        a.show(),
        t.effects.createWrapper(a),
        (n =
          e.distance || a["top" === d ? "outerHeight" : "outerWidth"](!0) / 2),
        s && a.css("opacity", 0).css(d, "pos" === p ? -n : n),
        (c[d] =
          (s ? ("pos" === p ? "+=" : "-=") : "pos" === p ? "-=" : "+=") + n),
        a.animate(c, {
          queue: !1,
          duration: e.duration,
          easing: e.easing,
          complete: function () {
            "hide" === r && a.hide(),
              t.effects.restore(a, o),
              t.effects.removeWrapper(a),
              i();
          },
        });
    };
  })(jQuery),
  (function (t) {
    t.effects.effect.fade = function (e, i) {
      var n = t(this),
        a = t.effects.setMode(n, e.mode || "toggle");
      n.animate(
        { opacity: a },
        { queue: !1, duration: e.duration, easing: e.easing, complete: i }
      );
    };
  })(jQuery),
  (function (t) {
    t.effects.effect.highlight = function (e, i) {
      var n = t(this),
        a = ["backgroundImage", "backgroundColor", "opacity"],
        o = t.effects.setMode(n, e.mode || "show"),
        r = { backgroundColor: n.css("backgroundColor") };
      "hide" === o && (r.opacity = 0),
        t.effects.save(n, a),
        n
          .show()
          .css({
            backgroundImage: "none",
            backgroundColor: e.color || "#ffff99",
          })
          .animate(r, {
            queue: !1,
            duration: e.duration,
            easing: e.easing,
            complete: function () {
              "hide" === o && n.hide(), t.effects.restore(n, a), i();
            },
          });
    };
  })(jQuery),
  define("lib-app/jquery-ui.min", function () {}),
  define(
    "storymaps/tpl/builder/MovableGraphic",
    [
      "dojo/has",
      "dojo/touch",
      "dojo/on",
      "dojo/_base/array",
      "dojo/_base/connect",
    ],
    function (t, e, i, n, a) {
      return function (o, r, s, l, d) {
        function p(t) {
          c &&
            t.mapPoint &&
            (s.setGeometry(t.mapPoint),
            d && !s.hasBeenMoved && d(s),
            (s.hasBeenMoved = !0));
        }
        var c = !1,
          u = [];
        !(function () {
          var n = a.connect(r, "onMouseOver", function (t) {
              t.graphic == s && o.setMapCursor("move");
            }),
            d = a.connect(r, "onMouseOut", function (t) {
              t.graphic == s && o.setMapCursor("default");
            }),
            h = i(r._div.rawNode, e.press, function (e) {
              (e.graphic == s ||
                e.target.e_graphic ||
                t("touch") ||
                10 == t("ie") ||
                7 == t("trident")) &&
                (o.disablePan(), (c = !0), (s.hasBeenMoved = !1));
            }),
            f = e.release(r._div.rawNode, function () {
              o.enablePan(), (c = !1), l && s.hasBeenMoved && l(s, !0);
            }),
            m =
              t("touch") || t("ie") >= 10 || 7 == t("trident")
                ? e.move(o.__container, p)
                : a.connect(o, "onMouseDrag", p);
          u = [n, d, h, f, m];
        })(),
          (this.clean = function () {
            n.forEach(u, function (t) {
              a.disconnect(t);
            });
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewUpload",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="imageSelectorUpload drag-area drag-default uploader">\n  <div class="header">\n    <div>\n      <span class="drop-label">' +
            (null == (__t = lblDrop) ? "" : __t) +
            '</span>\n      \x3c!-- this used to be a button, but firefox wouldn\'t open\n        a file-input nested inside a button --\x3e\n      <div class="btn btn-sm btn-default btn-file">\n        <span class="">' +
            (null == (__t = lblUploadButton) ? "" : __t) +
            '</span>\n        <input class="file-input" type="file" accept=".png,.jpeg,.jpg,.gif,.bmp"></input>\n      </div>\n      <span class="uploadHelp fa fa-info-circle" data-toggle="tooltip" data-title="' +
            (null == (__t = infoUpload) ? "" : __t) +
            '"></span>\n      <span class="uploadWait smallLoader hidden"></span>\n    </div>\n    <div class="info-text warning-text"></div>\n  </div>\n  <div class="resources"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewResourceItem",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p +=
            '<div class="resource-item ' +
            (null == (__t = usedClass) ? "" : __t) +
            '">\n  <div class="img-wrapper">\n    <img src="' +
            (null == (__t = tokenizedThumbUrl || picUrl) ? "" : __t) +
            '" />\n  </div>\n  <div class="title">' +
            (null == (__t = displayName) ? "" : __t) +
            "</div>\n  "),
            usedClass &&
              (__p +=
                '\n    <span class="remove floating-btn">\n      <span class="fa fa-trash"></span>\n    </span>\n  '),
            (__p += "\n</div>\n");
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/image/ViewUpload",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/image/ViewUpload",
    [
      "dojo/_base/declare",
      "dojo/_base/lang",
      "dojo/topic",
      "./FileUploadHelper",
      "storymaps/common/utils/CommonHelper",
      "lib-build/tpl!./ViewUpload",
      "lib-build/tpl!./ViewResourceItem",
      "lib-build/css!./ViewUpload",
    ],
    function (t, e, i, n, a, o, r) {
      return t([], {
        uploadEnabled: !1,
        dragging: !1,
        fileError: !1,
        canCheckFileOnDrag: !1,
        hasDnD: !1,
        constructor: function (t, e, i, n) {
          (this.showView = e),
            (i = i || null),
            (n = n || null),
            this.setupUI(t, i, n);
        },
        present: function () {
          this.uploadEnabled
            ? this.showAppResources()
            : this.setupUI(this.container),
            this.container.show(),
            this.toggleLoadingIndicator(!1);
        },
        setupUI: function (t, e, i) {
          (this.container = t),
            (this.uploadEnabled || a.getItemId()) &&
              (e ||
                this.container.html(o(i18n.commonMedia.imageSelectorUpload)),
              (this.uploader = this.container.find(".uploader")),
              (this.fileInput = this.container.find(".file-input")),
              (this.resourcesContainer = this.container.find(".resources")),
              (this.warningText = this.container.find(".warning-text")),
              this.container.find(".uploadHelp").tooltip({ trigger: "hover" }),
              i || this.showAppResources(),
              (this.uploadEnabled = !0),
              this.setupDnD());
        },
        setupDnD: function () {
          (this.hasDnD = n.checkDnD()),
            this.hasDnD &&
              (n.disableWindowDnD(),
              this.uploader.on("dragover", e.hitch(this, this.onDragOver)),
              this.uploader.on("dragleave", e.hitch(this, this.onDragLeave)),
              this.uploader.on("drop", e.hitch(this, this.onDrop))),
            this.fileInput.on("change", e.hitch(this, this.onFileChange));
        },
        showAppResources: function () {
          var t = this;
          n.getStoryResources().then(function (i) {
            var a = app.data.getAllImageUrls(),
              o = _.map(a, function (t) {
                return n.getFileIdFromUrl(t).toLowerCase();
              });
            t.resourcesContainer.empty(),
              _.each(i, function (i) {
                var n = _.contains(o, i.fileId.toLowerCase());
                (i.usedClass = n ? "" : "unused"),
                  (i.tokenizedThumbUrl = t.getTokenizedThumbUrl(i));
                var a = $(r(i));
                a.on("click", e.hitch(t, t.selectImage, i)),
                  a
                    .find(".remove")
                    .on("click", e.hitch(t, t.removeResource, i)),
                  a.on("dragstart", function () {
                    return !1;
                  }),
                  t.resourcesContainer.append(a);
              }),
              t.container.find(".tooltip").tooltip("hide"),
              t.resourcesContainer
                .find(".remove")
                .tooltip({
                  html: !0,
                  trigger: "hover",
                  container: t.container,
                  placement: "left",
                  title: i18n.commonMedia.imageSelectorUpload.tooltipRemove,
                  delay: { show: 500, hide: 200 },
                });
          });
        },
        getTokenizedThumbUrl: function (t) {
          var e;
          return (
            t.thumbFile
              ? (e = t.thumbFile)
              : t.file
              ? (e = t.file)
              : t.sizes && (e = _.min(t.sizes, "width").name),
            e || console.warn("no thumbFile?", t),
            a.possiblyAddToken(t.resourcesUrl + "/" + encodeURIComponent(e))
          );
        },
        onDragOver: function (t) {
          if ((n.preventAndStopEvent(t), !this.dragging)) {
            (this.dragging = !0), (t = t.originalEvent || t);
            var e,
              i = t.dataTransfer;
            i &&
              (i.files && i.files.length
                ? (e = this.getDragClassAndMsg(i.files))
                : i.items &&
                  i.items.length &&
                  (e = this.getDragClassAndMsg(i.items))),
              this.setUploaderTimerOrClass(e);
          }
        },
        getDragClassAndMsg: function (t) {
          var e = n.validateTypeOnDrag(t);
          return e
            ? e && t.length > 1
              ? {
                  dragClass: "drag-warning",
                  msg: i18n.commonMedia.imageSelectorUpload.warningOneFile,
                }
              : { dragClass: "drag-success" }
            : {
                dragClass: "drag-error",
                msg: i18n.commonMedia.imageSelectorUpload.warningFileTypes,
              };
        },
        onDragLeave: function (t) {
          n.preventAndStopEvent(t),
            (this.dragging = !1),
            this.setUploaderClass();
        },
        onDrop: function (t) {
          (this.dragging = !1), this.setUploaderClass();
          var e = n.findFilesFromDrop(t);
          e && (n.preventAndStopEvent(t), this.onFileChange(e));
        },
        getEXIF: function (t, e) {
          var i = new FileReader();
          (i.onload = function (t) {
            return e(t.target.result);
          }),
            i.readAsArrayBuffer(t);
        },
        onFileChange: function (t) {
          var e = t.target ? t.target.files : t;
          if (e && e.length) {
            var i = e[0];
            this.processFile(i);
          }
        },
        processFile: function (t) {
          if (!n.validateFile(t))
            return void this.setUploaderTimerOrClass({
              dragClass: "drag-error",
              msg: i18n.commonMedia.imageSelectorUpload.warningFileTypes,
            });
          this.toggleLoadingIndicator(!0), this.setUploaderClass();
          var i = n.getUploadBaseName(t, 0);
          app.appCfg.useImageEXIF &&
            window.EXIF &&
            this.getEXIF(t, function (e) {
              var i,
                n,
                o = window.EXIF.readFromBinaryFile(e);
              o.GPSLatitude &&
                o.GPSLatitude[0] &&
                ((i = a.convertToDegrees(o.GPSLatitude)),
                "S" == o.GPSLatitudeRef && (i = -Math.abs(i)),
                (t.lat = i)),
                o.GPSLatitude &&
                  o.GPSLongitude[0] &&
                  ((n = a.convertToDegrees(o.GPSLongitude)),
                  "W" == o.GPSLongitudeRef && (n = -Math.abs(n)),
                  (t.lng = n));
            }),
            n.processFile(t, !0).then(
              e.hitch(this, function (e) {
                _.extend(e, { baseName: i }),
                  app.appCfg.useImageEXIF &&
                    (t.lat && _.extend(e, { lat: t.lat }),
                    t.lng && _.extend(e, { lng: t.lng })),
                  this.uploadFile(e);
              }),
              e.hitch(this, function (t) {
                this.toggleLoadingIndicator(!1), console.warn("errback", t);
                var e;
                "filesize" === t.reason &&
                  (e = i18n.commonMedia.imageSelectorUpload.warningFileSize),
                  this.setUploaderTimerOrClass({
                    dragClass: "drag-error",
                    msg: e,
                  });
              })
            );
        },
        toggleLoadingIndicator: function (t) {
          this.container.find(".uploadWait").toggleClass("hidden", !t);
        },
        uploadFile: function (t) {
          n.uploadSingleResource(t).then(
            e.hitch(this, function (e) {
              if (
                ((e.name = e.displayName || t.baseName),
                t.lat && (e.lat = t.lat),
                t.lng && (e.lng = t.lng),
                (new Image().src = a.possiblyAddToken(
                  e.picUrl || e.sizes[0].url
                )),
                this.toggleLoadingIndicator(!1),
                app.appCfg.mediaPickerSkipConfigure)
              )
                return void i.publish("IMAGEUPLOADED", e);
              this.showView("configure", { media: e, fromService: !0 });
            })
          );
        },
        setUploaderTimerOrClass: function (t) {
          (t.dragClass && t.dragClass.indexOf("error") >= 0) ||
          t.dragClass.indexOf("warning") >= 0
            ? (this.setUploaderClass(t.dragClass),
              this.setWarningText(t.msg),
              setTimeout(
                e.hitch(this, function () {
                  this.dragging ||
                    (this.setUploaderClass(), this.setWarningText());
                }),
                3e3
              ))
            : this.setUploaderClass(t.dragClass);
        },
        setWarningText: function (t) {
          (t = t || ""), this.warningText.text(t);
        },
        setUploaderClass: function (t) {
          (!t &&
            (this.setWarningText(), this.uploader.hasClass("drag-default"))) ||
            this.uploader
              .removeClass("drag-default drag-error drag-warning drag-success")
              .addClass(t || "drag-default");
        },
        removeResource: function (t, i) {
          n.preventAndStopEvent(i),
            n.removeResources(t).then(e.hitch(this, this.showAppResources));
        },
        selectImage: function (t) {
          _.extend(t, { name: t.displayName }),
            this.showView("configure", { media: t, fromService: !0 });
        },
      });
    }
  ),
  define(
    "storymaps/tpl/builder/DetailPanelBuilder",
    [
      "lib-build/tpl!./DetailPanelBuilder",
      "lib-build/tpl!./DetailPanelBuilderSlide",
      "lib-build/css!../ui/desktop/DetailPanel",
      "lib-build/css!./DetailPanelBuilder",
      "./textEditor/MediumEditorWrapper",
      "lib-app/jquery-ui.min",
      "../core/WebApplicationData",
      "./MovableGraphic",
      "storymaps/common/utils/CommonHelper",
      "storymaps/common/builder/media/image/FileUploadHelper",
      "storymaps/common/builder/media/image/ViewUpload",
      "esri/geometry/webMercatorUtils",
      "esri/SpatialReference",
      "esri/graphic",
      "esri/geometry/Point",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/dijit/Search",
      "dojo/Deferred",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h, f, m, g, b, v) {
      return function (i, n) {
        function o() {
          if (!E) {
            if (!app.data.getWebAppData().getAppGeocoders) return;
            var t = new b();
            l.createGeocoder({ map: app.map, domNode: $("#search")[0] }).then(
              function (e) {
                (E = e),
                  (E.autoNavigate = !1),
                  E.hide(),
                  E.on("search-results", function (t) {
                    var e;
                    $.each(t.results, function (t, i) {
                      i.length &&
                        $.each(i, function (t, i) {
                          if (i.feature.geometry) return (e = i), !1;
                        });
                    }),
                      e &&
                        !app.map.extent.contains(e.feature.geometry) &&
                        (app.mapTips && app.mapTips.clean(!0),
                        setTimeout(function () {
                          app.map.centerAt(e.feature.geometry),
                            app.ui.mainView.buildMapTips();
                        }, 0));
                  }),
                  E.on("select-result", function (t) {
                    E.hide(), I && I.clean();
                    var e = $(
                      '<div class="addLocationText"><a href="#">' +
                        i18n.builder.detailPanelBuilder.useLocation +
                        "</a> </div>"
                    );
                    $(".esriPopup .contentPane").append(e);
                    var i = $(".esriPopup")[0];
                    $(i).removeClass("app-hidden"), $(".esriPopup").show();
                    var n = $(".entry.active").index(),
                      a = $(".detailContainer")[n],
                      o = $(a).find(".swiper-slide-active");
                    $("body").removeClass("pickLocation"),
                      app.map
                        .getLayer("tempIconLayer")
                        .remove(app.map.getLayer("tempIconLayer").graphics[0]),
                      M && M.remove();
                    var r = $.grep(app.layerCurrent.graphics, function (t) {
                      return (
                        t.attributes.shortlist_id == $(o).data("shortlist-id")
                      );
                    });
                    r[0] &&
                      !r[0].attributes.locationSet &&
                      app.map.setMapCursor("crosshair"),
                      $(e).on("click", function () {
                        r[0].setGeometry(t.result.feature.geometry),
                          (r[0].attributes.locationSet = 1),
                          r[0].show(),
                          E.highlightGraphic.hide(),
                          $(".esriPopup").hide(),
                          app.map
                            .getLayer(app.data.getShortlistLayerId())
                            .redraw(),
                          app.mapTips && app.mapTips.clean(!0),
                          app.ui.mainView.buildMapTips(),
                          app.map
                            .getLayer("tempIconLayer")
                            .remove(
                              app.map.getLayer("tempIconLayer").graphics[0]
                            ),
                          app.addFeatureBar.updateLocatedFeatures(),
                          y(r[0]),
                          P.updateShortlistExtent(),
                          $(o).find(".setLocation").hide(),
                          $(o).find(".editLocation").show(),
                          $(o).find(".cancelLocation").hide(),
                          $("body").removeClass("pickLocation"),
                          $("body").addClass("removeSlide"),
                          v.publish("BUILDER_INCREMENT_COUNTER");
                      }),
                      app.map.setMapCursor("auto");
                  }),
                  t.resolve();
              },
              function () {
                t.reject();
              }
            );
          }
        }
        function m() {
          $("body").addClass("loadingPlaces");
          var t = $(".entry.active").index();
          t < 0 && (t = 0),
            $(".detailContainer").css("z-index", 99999999),
            $(".detailContainer").show(),
            B[t].update(),
            B[t].slideNext(),
            B[t].slidePrev(),
            B[t].update(),
            W.resize(),
            $(".detailContainer").hide(),
            $(".detailContainer").css("z-index", 0),
            $("body").removeClass("loadingPlaces");
        }
        function g(t) {
          $("body").addClass("pickLocation");
          var e = $.grep(app.layerCurrent.graphics, function (e) {
              return e.attributes.shortlist_id == t;
            }),
            i = $(".entry.active").index(),
            n = B[i].slides[B[i].activeIndex];
          if (
            (E.show(),
            $(n).find(".setLocation").hide(),
            $(n).find(".editLocation").hide(),
            $(n).find(".cancelLocation").show(),
            $(n).find(".cancelLocation").click(x),
            app.map.reposition(),
            e[0].attributes.locationSet)
          ) {
            e[0].hide();
            var a = new h(e[0].geometry, e[0].symbol, e[0].attributes);
            (A = app.map.getLayer("tempIconLayer")),
              A.add(a),
              A.graphics[0].show(),
              (I = new s(app.map, A, A.graphics[0], w));
          } else
            app.map.setMapCursor("crosshair"),
              (M = app.map.on("click", function (i) {
                e[0].setGeometry(i.mapPoint),
                  e[0].symbol.setWidth(
                    app.ui.mainView.lutIconSpecs.large.getWidth()
                  ),
                  e[0].symbol.setHeight(
                    app.ui.mainView.lutIconSpecs.large.getHeight()
                  ),
                  e[0].symbol.setOffset(
                    app.ui.mainView.lutIconSpecs.large.getOffsetX(),
                    app.ui.mainView.lutIconSpecs.large.getOffsetY()
                  ),
                  (app.ui.mainView.selected = e[0]),
                  (e[0].attributes.locationSet = 1),
                  app.ui.mainView.buildMapTips(),
                  e[0].show(),
                  $(n).find(".editLocation").show(),
                  $(n).find(".updateLocation").hide(),
                  $(n).find(".cancelLocation").hide(),
                  E.hide(),
                  E.highlightGraphic && E.highlightGraphic.hide(),
                  $(".esriPopup").hide(),
                  app.map.setMapCursor("auto"),
                  M.remove();
                var a = $.grep($("#myList li"), function (e) {
                  return $(e).data("shortlist-id") == t;
                });
                $(a).find(".unlocated").removeClass("unlocated"),
                  app.addFeatureBar.updateLocatedFeatures();
                var o = app.map.getLayer(app.data.getShortlistLayerId());
                o.graphics.length > 1 && P.updateShortlistExtent(),
                  o.redraw(),
                  y(e[0]),
                  $("body").removeClass("pickLocation"),
                  $("body").addClass("removeSlide"),
                  T(),
                  v.publish("BUILDER_INCREMENT_COUNTER");
              }));
        }
        function y(t) {
          var e = $.grep($("#myList li"), function (e) {
            return $(e).data("shortlist-id") == t.attributes.shortlist_id;
          });
          $(e).addClass("located"),
            $(e).find(".unlocated").length &&
              $(e).find(".unlocated").removeClass("unlocated"),
            $("body").hasClass("organizeFeatures"),
            $("body").hasClass("locateFeatures") && $(".located").hide();
        }
        function w(t, e) {
          var i = $(".entry.active").index(),
            n = B[i].slides[B[i].activeIndex];
          app.mapTips && app.mapTips.clean(!0),
            (D = t),
            E.highlightGraphic && E.highlightGraphic.hide(),
            $(".esriPopup").hide(),
            $(n).find(".updateLocation").show(),
            $(n).find(".updateLocation").click(_),
            $(n).find(".cancelLocation").click(C),
            v.publish("BUILDER_INCREMENT_COUNTER");
        }
        function C() {
          if (!app.data.getWebAppData().getIsExternalData()) {
            I && I.clean(),
              E && E.hide(),
              $("body").removeClass("pickLocation"),
              app.map
                .getLayer("tempIconLayer")
                .remove(app.map.getLayer("tempIconLayer").graphics[0]),
              app.map.setMapCursor("auto");
            var t = $(".entry.active").index(),
              e = B[t].slides[B[t].activeIndex],
              i = $.grep(app.layerCurrent.graphics, function (t) {
                return t.attributes.shortlist_id == $(e).data("shortlist-id");
              });
            if (
              (E && E.highlightGraphic && E.highlightGraphic.hide(),
              $(".esriPopup").hide(),
              $(e).find(".cancelLocation").hide(),
              $(e).find(".updateLocation").hide(),
              i[0] && i[0].attributes.locationSet
                ? ($(e).find(".editLocation").show(), i[0].show())
                : $(e).find(".setLocation").show(),
              B[t].activeIndex == B[t].slides.length - 1)
            ) {
              var n = $(".detailContainer")[t];
              $(n).find(".detail-btn-add").show();
            }
            app.map.getLayer(app.data.getShortlistLayerId()).redraw();
          }
        }
        function _() {
          I && I.clean(),
            L.buildMapTips(),
            E.hide(),
            E.highlightGraphic && E.highlightGraphic.hide(),
            $(".esriPopup").hide(),
            $("body").removeClass("pickLocation");
          var t = $(".entry.active").index(),
            e = $.grep(app.layerCurrent.graphics, function (t) {
              return t.attributes.shortlist_id == D.attributes.shortlist_id;
            }),
            i = B[t].slides[B[t].activeIndex];
          e[0].setGeometry(D.geometry),
            e[0].show(),
            app.map
              .getLayer("tempIconLayer")
              .remove(app.map.getLayer("tempIconLayer").graphics[0]),
            app.map.getLayer(app.data.getShortlistLayerId()).redraw(),
            app.addFeatureBar.updateLocatedFeatures(),
            app.map.setMapCursor("auto"),
            app.mapTips && app.mapTips.clean(!0),
            app.ui.mainView.buildMapTips(),
            P.updateShortlistExtent(),
            $(i).find(".editLocation").show(),
            $(i).find(".updateLocation").hide(),
            $(i).find(".cancelLocation").hide(),
            T(),
            v.publish("BUILDER_INCREMENT_COUNTER");
        }
        function x() {
          var t = $(".entry.active").index(),
            e = B[t].slides[B[t].activeIndex],
            i = $.grep(app.layerCurrent.graphics, function (t) {
              return t.attributes.shortlist_id == $(e).data("shortlist-id");
            });
          if (
            (W.hideSearch(),
            app.mapTips && app.mapTips.clean(!0),
            app.map.setMapCursor("auto"),
            app.ui.mainView.buildMapTips(),
            app.map
              .getLayer("tempIconLayer")
              .remove(app.map.getLayer("tempIconLayer").graphics[0]),
            i[0].attributes.locationSet && i[0].show(),
            app.map.getLayer(app.data.getShortlistLayerId()).redraw(),
            E.highlightGraphic && E.highlightGraphic.hide(),
            $(".esriPopup").hide(),
            $(e).find(".cancelLocation").hide(),
            i[0].attributes.locationSet
              ? $(e).find(".editLocation").show()
              : $(e).find(".setLocation").show(),
            B[t].activeIndex == B[t].slides.length - 1)
          ) {
            var n = $(".detailContainer")[t];
            $(n).find(".detail-btn-add").show();
          }
        }
        function S() {
          var t = {};
          t.mode = "add";
          var e = $(".entry.active").index(),
            i = B[e].slides[B[e].activeIndex],
            n = $.grep(app.layerCurrent.graphics, function (t) {
              return t.attributes.shortlist_id == $(i).data("shortlist-id");
            });
          n[0].attributes &&
            n[0].attributes.pic_url &&
            ((t = { media: { type: "image", image: {} }, mode: "add" }),
            (t.media.pic_url = n[0].attributes.pic_url)),
            n[0].attributes &&
              n[0].attributes.thumb_url &&
              (t.media ||
                (t = { media: { type: "image", image: {} }, mode: "add" }),
              (t.media.thumb_url = n[0].attributes.thumb_url)),
            F.present(t).then(function (t) {
              W.updateSlide(t);
            });
        }
        function T() {
          var t = $(".entry.active").index();
          if (
            (1 == B[t].slides.length
              ? ($(".detail-btn-left").hide(), $(".detail-btn-right").hide())
              : ($(".detail-btn-left").show(),
                B[t].activeIndex != B[t].slides.length - 1 &&
                  $(".detail-btn-right").show()),
            B[t].activeIndex != B[t].slides.length - 1 ||
              $("body").hasClass("locateFeatures"))
          )
            $(".detail-btn-add").hide(),
              B[t].slides.length > 1 && $(".detail-btn-right").show();
          else {
            $(".detail-btn-right").hide();
            var e = B[t].slides[B[t].activeIndex],
              i = app.map.getLayer(
                app.data.getWebAppData().getShortlistLayerId()
              ).graphics,
              n = $.grep(i, function (t) {
                return t.attributes.shortlist_id == $(e).data("shortlist-id");
              });
            n[0] &&
            n[0].attributes &&
            (n[0].attributes.name ||
              n[0].attributes.description ||
              n[0].attributes.pic_url ||
              n[0].attributes.thumb_url ||
              n[0].attributes.locationSet)
              ? $(".detail-btn-add").show()
              : $(".detail-btn-add").hide();
          }
        }
        function k() {
          N = !0;
        }
        var E,
          A,
          I,
          L,
          P,
          D,
          M,
          O,
          R,
          N = !1,
          B = [],
          F = n,
          W = this;
        (this.init = function (t, e) {
          app.data.getWebAppData().getIsExternalData() ||
            (L && E) ||
            ((P = e),
            L ||
              v.subscribe("IMAGEUPLOADED", function (t) {
                var e = {};
                if (t && t.success) {
                  t.picUrl || t.sizes[0].url;
                  t.lat && (e.lat = t.lat),
                    t.lng && (e.lng = t.lng),
                    (e.uploaded = !0),
                    (e.name = t.name),
                    (e.resource = t),
                    "block" == $("#editorDialogInlineMedia").css("display") &&
                      $("#editorDialogInlineMedia").modal("toggle"),
                    W.updateSlide(e);
                }
              }),
            (L = t),
            setTimeout(function () {
              (A = new esri.layers.GraphicsLayer()),
                (A.id = "tempIconLayer"),
                app.map.addLayer(A),
                app.map.reorderLayer(A, app.map.graphicsLayerIds.length - 1);
            }, 500),
            window.addEventListener(
              "keydown",
              function (t) {
                [33, 34].indexOf(t.keyCode) > -1 && t.preventDefault();
              },
              !1
            ));
        }),
          (this.buildSlides = function (t, e) {
            if (!app.data.getWebAppData().getIsExternalData()) {
              var i = app.map.getLayer(app.data.getShortlistLayerId()),
                n = $(".entry.active").index();
              n < 0 && (n = 0), e > -1 && (n = e), B[n].removeAllSlides();
              var a = $.grep(i.graphics, function (t) {
                return t.attributes.tab_id == n;
              });
              a[0] &&
                a[0].attributes.number &&
                a.sort(function (t, e) {
                  return (
                    parseInt(t.attributes.number) -
                    parseInt(e.attributes.number)
                  );
                }),
                $("body").addClass("loadingPlaces"),
                $.each(a, function (t, e) {
                  var i = e.attributes,
                    a = t + 1,
                    o = {
                      name: i.name,
                      description: i.description,
                      pic_url: i.pic_url,
                      thumb_url: i.thumb_url,
                      locationSet: i.locationSet,
                      number: i.number,
                    };
                  W.addSlide(a, i.shortlist_id, o, n), B[n].update();
                }),
                B[n].update(),
                m(),
                setTimeout(function () {
                  $("body").removeClass("loadingPlaces");
                }, 500);
            }
          }),
          (this.buildAllSlides = function () {
            if (!app.data.getWebAppData().getIsExternalData()) {
              E || o();
              var t = app.map.getLayer(app.data.getShortlistLayerId()),
                e = t.graphics,
                i = [],
                n = $("#nav-bar").find(".nav-tabs > li:not(.dropdown)");
              $.each(n, function () {
                i.push([]);
              }),
                $.each(e, function (t, e) {
                  i[parseInt(e.attributes.tab_id)].push(e);
                }),
                $.each(i, function (t) {
                  W.buildSlides(!1, t);
                }),
                m(),
                W.resize();
            }
          }),
          (this.buildUnlocatedSlides = function () {
            if (!app.data.getWebAppData().getIsExternalData()) {
              var t = app.map.getLayer(app.data.getShortlistLayerId()),
                e = $(".entry.active").index();
              e < 0 && (e = 0), B[e].removeAllSlides();
              var i = $.grep(t.graphics, function (t) {
                return t.attributes.tab_id == e;
              });
              i[0] &&
                i[0].attributes.number &&
                i.sort(function (t, e) {
                  return (
                    parseInt(t.attributes.number) -
                    parseInt(e.attributes.number)
                  );
                }),
                $("body").addClass("loadingPlaces");
              var n = 1;
              $.each(i, function (t, i) {
                var a = i.attributes;
                if (!a.locationSet) {
                  var o = n++,
                    r = {
                      name: a.name,
                      description: a.description,
                      pic_url: a.pic_url,
                      thumb_url: a.thumb_url,
                      locationSet: a.locationSet,
                      number: a.number,
                    };
                  W.addSlide(o, a.shortlist_id, r, e), B[e].update();
                }
              }),
                B[e].update(),
                m(),
                setTimeout(function () {
                  $("body").removeClass("loadingPlaces");
                }, 500);
            }
          }),
          (this.addDetailPanelSwiper = function (e) {
            if (
              !(
                app.data.getWebAppData().getIsExternalData() ||
                ($(".detailContainer") && $(".detailContainer")[e])
              )
            ) {
              var n = e;
              if ((e || (n = 0), 0 == n))
                $(i).find("#paneLeft").append(t({})),
                  $(i)
                    .find(" .detailView")
                    [n].setAttribute("id", "detailView" + n);
              else {
                var a = $(i).find(" .detailContainer")[n - 1];
                $(a).after(t({})),
                  $(i)
                    .find(" .detailView")
                    [n].setAttribute("id", "detailView" + n);
              }
              $(".detailContainer").hide();
              var o = $(".detailContainer")[n];
              $(o).show();
              var r = new Swiper($(o), {
                speed: 0,
                setWrapperSize: !0,
                lazyLoading: !0,
                lazyLoadingInPrevNext: !0,
                simulateTouch: !1,
              });
              (B[n] = r),
                (B[n].updating = !1),
                r.init(),
                $(o).hide(),
                r.update(),
                r.on("onSlideChangeEnd", function (t) {
                  if (
                    !app.data.getWebAppData().getIsExternalData() &&
                    (T(), !$("body").hasClass("loadingPlaces"))
                  ) {
                    L.preSelection();
                    var e = $(".entry.active").index(),
                      i = t.slides[t.activeIndex],
                      n = $(i).data("shortlist-id"),
                      a = $.grep(app.layerCurrent.graphics, function (t) {
                        return t.attributes.shortlist_id == n;
                      })[0];
                    a &&
                      a.attributes &&
                      !a.attributes.locationSet &&
                      $(i).find(".editLocation").hide(),
                      (L.selected = a),
                      B[e].update(),
                      L.selected &&
                        L.selected.attributes.locationSet &&
                        !app.map.extent.contains(L.selected.geometry) &&
                        app.map.centerAt(L.selected.geometry),
                      setTimeout(function () {
                        L.buildMapTips();
                      }, 0),
                      $(".esriPopup").hide(),
                      W.resize(),
                      $(o).show(),
                      $(o).css("z-index", 99);
                  }
                }),
                i.find(".detailClose").click(function () {
                  if (!app.data.getWebAppData().getIsExternalData()) {
                    app.ui.mainView.unselect(),
                      $(".arcgisSearch").css("display"),
                      C();
                    var t,
                      e = $(".entry.active").index(),
                      n = B[e].slides[B[e].activeIndex],
                      a = app.map.getLayer(
                        app.data.getWebAppData().getShortlistLayerId()
                      ),
                      o = $.grep(a.graphics, function (t) {
                        return (
                          t.attributes.shortlist_id == $(n).data("shortlist-id")
                        );
                      });
                    if (o[0]) {
                      if (
                        (t = o[0].attributes) &&
                        (t.name.length ||
                          "Unnamed Place" == t.name ||
                          t.description.length ||
                          t.pic_url.length ||
                          t.locationSet)
                      );
                      else {
                        var r = app.ui.tilePanel.findTile(
                          $(n).data("shortlist-id")
                        );
                        $(r).remove(),
                          a.remove(o[0]),
                          app.layerCurrent.remove(o[0]),
                          B[e].removeSlide(B[e].activeIndex),
                          app.addFeatureBar.updateLocatedFeatures();
                      }
                      i.find(".detailContainer").hide(),
                        "small" == app.ui.mobileIntro.screenSize &&
                          app.ui.mobileFeatureList.showMobileList(),
                        $("body").hasClass("locateFeatures removeSlide") &&
                          1 == B[e].slides.length &&
                          (W.buildSlides(),
                          app.addFeatureBar.exitOrganizeMode()),
                        $("body").hasClass("locateFeatures removeSlide") &&
                          B[e].slides.length > 1 &&
                          W.buildUnlocatedSlides();
                    }
                  }
                });
              var s = navigator.appVersion.indexOf("Edge") > 0,
                l = navigator.userAgent.indexOf("Windows NT 10.0") > 0;
              i.find($(".detail-btn-left")[n]).click(function () {
                if (!app.data.getWebAppData().getIsExternalData()) {
                  var t,
                    e = $(".entry.active").index(),
                    i = B[e],
                    n = B[e].slides[B[e].activeIndex],
                    a = app.map.getLayer(
                      app.data.getWebAppData().getShortlistLayerId()
                    ),
                    o = $.grep(a.graphics, function (t) {
                      return (
                        t.attributes.shortlist_id == $(n).data("shortlist-id")
                      );
                    });
                  if (o[0]) {
                    if (
                      (t = o[0].attributes) &&
                      (t.name.length ||
                        "Unnamed Place" == t.name ||
                        t.description.length ||
                        t.pic_url.length ||
                        t.locationSet)
                    );
                    else {
                      var r = app.ui.tilePanel.findTile(
                        $(n).data("shortlist-id")
                      );
                      $(r).remove(),
                        a.remove(o[0]),
                        app.layerCurrent.remove(o[0]),
                        B[e].removeSlide(B[e].activeIndex),
                        app.addFeatureBar.updateLocatedFeatures(),
                        T();
                    }
                    if ("block" == $(".arcgisSearch").css("display")) {
                      I && I.clean(),
                        E && E.hide(),
                        C(),
                        app.map
                          .getLayer("tempIconLayer")
                          .remove(
                            app.map.getLayer("tempIconLayer").graphics[0]
                          ),
                        app.map.setMapCursor("auto");
                      var n = B[e].slides[B[e].activeIndex],
                        o = $.grep(app.layerCurrent.graphics, function (t) {
                          return (
                            t.attributes.shortlist_id ==
                            $(n).data("shortlist-id") + 1
                          );
                        });
                      E.highlightGraphic && E.highlightGraphic.hide(),
                        $(".esriPopup").hide(),
                        $(n).find(".cancelLocation").hide(),
                        $(n).find(".updateLocation").hide(),
                        o[0] && o[0].attributes.locationSet
                          ? ($(n).find(".editLocation").show(), o[0].show())
                          : $(n).find(".setLocation").show();
                      var a = app.map.getLayer(app.data.getShortlistLayerId());
                      a.redraw();
                    }
                    if (
                      ((s || l) &&
                        $(".swiper-slide-active .detailTextContainer").css({
                          "overflow-y": "visible",
                        }),
                      0 === i.activeIndex
                        ? i.slideTo(i.slides.length - 1, 0)
                        : i.slidePrev(),
                      (s || l) &&
                        $(".swiper-slide-active .detailTextContainer").css({
                          "overflow-y": "auto",
                        }),
                      $("body").hasClass("locateFeatures removeSlide"))
                    ) {
                      var d =
                        B[e].activeIndex == B[e].slides.length - 1
                          ? 0
                          : B[e].activeIndex + 1;
                      B[e].removeSlide(d),
                        B[e].update(),
                        T(),
                        $("body").removeClass("removeSlide");
                      var p = B[e].slides[B[e].activeIndex],
                        c = $(p).data("shortlist-id"),
                        u = $.grep(app.layerCurrent.graphics, function (t) {
                          return t.attributes.shortlist_id == c;
                        })[0];
                      (L.selected = u),
                        setTimeout(function () {
                          L.buildMapTips();
                        }, 0);
                    }
                  }
                }
              }),
                i.find($(".detail-btn-right")[n]).click(function () {
                  if (!app.data.getWebAppData().getIsExternalData()) {
                    var t = $(".entry.active").index(),
                      e = B[t];
                    if ("block" == $(".arcgisSearch").css("display")) {
                      I && I.clean(),
                        E && E.hide(),
                        C(),
                        app.map
                          .getLayer("tempIconLayer")
                          .remove(
                            app.map.getLayer("tempIconLayer").graphics[0]
                          ),
                        app.map.setMapCursor("auto");
                      var i = B[t].slides[B[t].activeIndex],
                        n = $.grep(app.layerCurrent.graphics, function (t) {
                          return (
                            t.attributes.shortlist_id ==
                            $(i).data("shortlist-id") - 1
                          );
                        });
                      E.highlightGraphic && E.highlightGraphic.hide(),
                        $(".esriPopup").hide(),
                        $(i).find(".cancelLocation").hide(),
                        $(i).find(".updateLocation").hide(),
                        n[0] && n[0].attributes.locationSet
                          ? ($(i).find(".editLocation").show(), n[0].show())
                          : $(i).find(".setLocation").show();
                      app.map.getLayer(app.data.getShortlistLayerId()).redraw();
                    }
                    if (
                      ((s || l) &&
                        $(".swiper-slide-active .detailTextContainer").css({
                          "overflow-y": "visible",
                        }),
                      e.activeIndex == e.slides.length - 1
                        ? e.slideTo(0, 0)
                        : e.slideNext(),
                      (s || l) &&
                        $(".swiper-slide-active .detailTextContainer").css({
                          "overflow-y": "auto",
                        }),
                      $("body").hasClass("locateFeatures removeSlide"))
                    ) {
                      var a =
                        0 === B[t].activeIndex
                          ? B[t].slides.length - 1
                          : B[t].activeIndex - 1;
                      B[t].removeSlide(a),
                        B[t].update(),
                        T(),
                        $("body").removeClass("removeSlide");
                      var o = B[t].slides[B[t].activeIndex],
                        r = $(o).data("shortlist-id"),
                        d = $.grep(app.layerCurrent.graphics, function (t) {
                          return t.attributes.shortlist_id == r;
                        })[0];
                      (L.selected = d),
                        setTimeout(function () {
                          L.buildMapTips();
                        }, 0);
                    }
                  }
                }),
                i.find($(".detail-btn-add")[n]).click(function () {
                  if (
                    !app.data.getWebAppData().getIsExternalData() &&
                    (app.addFeatureBar.addFeature(),
                    "block" == $(".arcgisSearch").css("display"))
                  ) {
                    I && I.clean(),
                      E && E.hide(),
                      $("body").removeClass("pickLocation"),
                      app.map
                        .getLayer("tempIconLayer")
                        .remove(app.map.getLayer("tempIconLayer").graphics[0]),
                      app.map.setMapCursor("auto");
                    var t = $(".entry.active").index(),
                      e = B[t].slides[B[t].activeIndex],
                      i = $.grep(app.layerCurrent.graphics, function (t) {
                        return (
                          t.attributes.shortlist_id ==
                          $(e).data("shortlist-id") - 1
                        );
                      });
                    E.highlightGraphic && E.highlightGraphic.hide(),
                      $(".esriPopup").hide(),
                      $(e).find(".cancelLocation").hide(),
                      $(e).find(".updateLocation").hide(),
                      i[0] && i[0].attributes.locationSet
                        ? ($(e).find(".editLocation").show(), i[0].show())
                        : $(e).find(".setLocation").show();
                    app.map.getLayer(app.data.getShortlistLayerId()).redraw();
                  }
                });
            }
          }),
          (this.present = function (t) {
            k();
          }),
          (this.addSlide = function (t, n, s, d) {
            E || o();
            var c = $(".entry.active").index();
            d > -1 && (c = d);
            var u = $(".detailContainer")[c];
            i.find("#detailView" + c).append(
              e({
                addImage: i18n.builder.detailPanelBuilder.addImage,
                setLocation: i18n.builder.detailPanelBuilder.setLocation,
                changeLocation: i18n.builder.detailPanelBuilder.changeLocation,
                update: i18n.builder.detailPanelBuilder.update,
                cancel: i18n.builder.detailPanelBuilder.cancel,
              })
            );
            var h = $(u).find(".swiper-slide")[t - 1];
            $(h).find(".detailFeatureNum").text(t),
              app.data.getWebAppData().getGeneralOptions().numberedIcons
                ? ($(h)
                    .find(".detailFeatureNum")
                    .css("background-color", app.data.getStory()[c].color),
                  $(h).find(".detailFeatureNum").show(),
                  $(h).find(".detailFeatureTitle").removeClass("notNumbered"))
                : ($(h).find(".detailFeatureNum").hide(),
                  $(h).find(".detailFeatureTitle").addClass("notNumbered"));
            if (
              (new p($(h), null, !0, !0),
              $(h).find(".detailPictureDiv img").click(S),
              $(h).find(".detailPictureDiv .imagePicker").click(S),
              $(h).data("shortlist-id", n),
              $(h).find(".detailFeatureTitle").addClass("noTitle"),
              s)
            ) {
              if (
                (s.name &&
                  ($(h).find(".detailFeatureTitle").html(s.name),
                  $(h).find(".detailFeatureTitle").removeClass("noTitle")),
                s.pic_url)
              ) {
                var f = s.pic_url;
                if (f.indexOf("sharing/rest/content/items/") > -1) {
                  f.indexOf("http") > -1 &&
                    5 == f.indexOf("https") &&
                    (f = f.slice(5));
                  (f.match(/https/g) || [].length).length > 1 &&
                    (f = f.slice(6));
                }
                f.indexOf("sharing/rest/content/items/") > -1 &&
                  (f = l.possiblyAddToken(f)),
                  $(h).find("img").attr("src", f),
                  $(h).find(".imagePicker").hide();
              }
              s.description && $(h).find(".description").html(s.description),
                ((s.lng && s.lat) || s.locationSet) &&
                  ($(h).find(".setLocation").hide(),
                  $(h).find(".editLocation").show());
            }
            s && (s.lng || s.lat || s.locationSet)
              ? ($(h).find(".editLocation").show(),
                $(h).find(".setLocation").hide())
              : ($(h).find(".setLocation").show(),
                $(h).find(".editLocation").hide()),
              B[c].update();
            var m = function (t, e) {
              var i = $(".entry.active").index(),
                n = B[i].slides[B[i].activeIndex],
                a = $.grep(app.layerCurrent.graphics, function (t) {
                  return t.attributes.shortlist_id == $(n).data("shortlist-id");
                });
              if (".detailFeatureTitle" == e.selector) {
                a[0].attributes.name = $(e).text();
                var o = $.grep($("#myList li"), function (t) {
                  return $(t).data("shortlist-id") == $(n).data("shortlist-id");
                });
                $(o).find(".blurb").text($(e).text()),
                  $(n).find(".detailFeatureTitle").removeClass("noTitle"),
                  app.mapTips &&
                    (app.mapTips.clean(!0), app.ui.mainView.buildMapTips());
              }
              ".description" == e.selector &&
                (a[0].attributes.description = $(e).html()),
                r.getTitle() && v.publish("BUILDER_INCREMENT_COUNTER"),
                setTimeout(function () {
                  T();
                }, 50);
            };
            (O = new a({
              container: $(h).find(".detailFeatureTitle"),
              mode: "single-line",
              placeholder:
                i18n.builder.detailPanelBuilder.enterPlaceName + "...",
              onBlur: function (t) {
                m(0, $(h).find(".detailFeatureTitle"));
              },
            })),
              (R = new a({
                container: $(h).find(".editable"),
                mode: "standard",
                placeholder:
                  i18n.builder.detailPanelBuilder.enterPlaceDescription + "...",
                onBlur: function (t) {
                  m(0, $(h).find(".description"));
                },
              })),
              (!s || (s && !s.name)) &&
                setTimeout(function () {
                  $(h).find(".detailFeatureTitleText").focus();
                }, 0),
              $(h)
                .find(".setLocation, .editLocation")
                .click(function () {
                  var t = $(".entry.active").index(),
                    e = B[t].slides[B[t].activeIndex];
                  if (
                    (g(
                      $.grep(app.layerCurrent.graphics, function (t) {
                        return (
                          t.attributes.shortlist_id == $(e).data("shortlist-id")
                        );
                      })[0].attributes.shortlist_id
                    ),
                    B[t].activeIndex == B[t].slides.length - 1)
                  ) {
                    var i = $(".detailContainer")[t];
                    $(i).find(".detail-btn-add").hide();
                  }
                }),
              (B[c].updating = !1);
          }),
          (this.showSlide = function (t) {
            if (!app.data.getWebAppData().getIsExternalData()) {
              W.resize(), m();
              var e = $(".entry.active").index(),
                i = $(".detailContainer")[e],
                n = null;
              $.each(
                $("#detailView" + e).find($(".swiper-slide")),
                function (e, i) {
                  if (parseInt($(i).data("shortlist-id")) == t)
                    return void (n = e);
                }
              ),
                W.resize(),
                n > -1 &&
                  setTimeout(function () {
                    B[e].slideTo(n, 0);
                  }, 0),
                n == B[e].activeIndex
                  ? ($(i).show(), $(i).css("z-index", 99), T())
                  : B[e].slides.length < 2
                  ? ($(i).show(), $(i).css("z-index", 99), T())
                  : setTimeout(function () {
                      $(i).show(), $(i).css("z-index", 99), T();
                    }, 0);
            }
          }),
          (this.updateSlide = function (t) {
            var e = $(".entry.active").index();
            B[e].updating = !0;
            var i = B[e].slides[B[e].activeIndex],
              n = $.grep(app.layerCurrent.graphics, function (t) {
                return t.attributes.shortlist_id == $(i).data("shortlist-id");
              });
            if (
              (n[0].attributes.resource &&
                n[0].attributes.resource.thumb_url == t.thumb_url &&
                d.removeResources(n[0].attributes.resource),
              t.uploaded)
            ) {
              n[0].attributes.resource = t.resource;
              var a = t.url ? t.url : t.resource.sizes[0].url;
              n[0].attributes.pic_url = a;
              var o = l.possiblyAddToken(a);
              $(i).find("img").attr("src", o),
                $(i).find(".detailFeatureTitle").text().length <= 0 &&
                t.name.indexOf("jpeg") > -1
                  ? (t.name = t.name.slice(0, -5))
                  : $(i).find(".detailFeatureTitle").text().length <= 0 &&
                    (t.name = t.name.slice(0, -4));
            } else
              $(i).find("img").attr("src", t.url),
                (n[0].attributes.pic_url = t.url);
            $(i).find(".imagePicker").hide(),
              t.thumb_url
                ? (n[0].attributes.thumb_url = t.thumb_url)
                : t.uploaded && t.resource && t.resource.thumbUrl
                ? (n[0].attributes.thumb_url = t.resource.thumbUrl)
                : (n[0].attributes.thumb_url = t.url);
            var s = $.grep($("#myList li"), function (t) {
              return $(t).data("shortlist-id") == $(i).data("shortlist-id");
            });
            if (t.uploaded) {
              var p = l.possiblyAddToken(n[0].attributes.thumb_url);
              $(s)
                .find(".tileImage")
                .css("background-image", "url(" + p + ")");
            } else
              $(s)
                .find(".tileImage")
                .css(
                  "background-image",
                  "url(" + n[0].attributes.thumb_url + ")"
                );
            if (
              ($(s).find("i").hide(),
              $(i).find(".detailFeatureTitle").text().length <= 0 &&
                (t.name || t.url))
            ) {
              var h;
              if (t.url) {
                var m = t.url.split("/");
                (h = m[m.length - 1]), (h = h.split(".")[0]);
              }
              var g = t.name || h;
              (n[0].attributes.name = g),
                O.setContent({ text: g }),
                $(s).find(".blurb").text(g),
                $("#item" + $(i).data("shortlist-id"))
                  .find(".blurb")
                  .text(g),
                $(i).find(".detailFeatureTitle").removeClass("noTitle");
            }
            if (
              ($(i).find(".description").text().length <= 0 &&
                t.description &&
                ((n[0].attributes.description = t.description),
                R.setContent({ text: t.description, convertLine: !0 })),
              t.lat && t.lng && !n[0].attributes.locationSet)
            ) {
              var b = [t.lng, t.lat];
              4326 != app.map.spatialReference.wkid &&
                (b = c.lngLatToXY(t.lng, t.lat));
              var y = new f(
                b[0],
                b[1],
                new u({ wkid: app.map.spatialReference.wkid })
              );
              n[0].setGeometry(y),
                (n[0].attributes.locationSet = 1),
                $(s).addClass("located"),
                $(s).find(".unlocated").removeClass("unlocated"),
                $(i).find(".editLocation").show(),
                $(i).find(".setLocation").hide(),
                setTimeout(function () {
                  P.updateShortlistExtent();
                }, 1e3);
            } else
              n[0].attributes.locationSet || $(i).find(".setLocation").show();
            if (n[0].attributes.locationSet) {
              n[0].show(),
                (app.ui.mainView.selected = n[0]),
                app.ui.mainView.buildMapTips();
              app.map.getLayer(app.data.getShortlistLayerId()).redraw();
            }
            app.addFeatureBar.updateLocatedFeatures(),
              r.getTitle() && v.publish("BUILDER_INCREMENT_COUNTER"),
              setTimeout(function () {
                T();
              }, 50),
              W.resize(),
              (B[e].updating = !1);
          }),
          (this.updateThemeSwipers = function (t) {
            $.each($(".detailContainer"), function (t, e) {
              $(e).remove();
            }),
              $.each(t.entries, function (t) {
                W.addDetailPanelSwiper(t);
              });
          }),
          (this.hideSearch = function () {
            E && E.hide();
          }),
          (this.checkTempLayer = function () {
            I &&
              (I.clean(),
              app.map
                .getLayer("tempIconLayer")
                .remove(app.map.getLayer("tempIconLayer").graphics[0]));
          }),
          (this.resize = function () {
            app.data.getWebAppData().getIsExternalData() ||
              (B.length &&
                setTimeout(function () {
                  var t = 115;
                  "small" == app.ui.mobileIntro.screenSize &&
                    ($("#paneLeft").css(
                      "height",
                      $("#contentPanel").height() - $("#map").height() + 10
                    ),
                    $("#paneLeft").css("width", "100%"),
                    $("#paneLeft").css({ top: $("#map").height() - 10 }),
                    (t = 20));
                  var e = $(".entry.active").index();
                  e < 0 && (e = 0);
                  var i = B[e].slides[B[e].activeIndex];
                  $(i).height($("#paneLeft").outerHeight() - 5);
                  var n = $(i).find(".detailHeader").outerHeight();
                  $(".detailTextContainer").css({ "margin-top": "10px" }),
                    $(".detailTextContainer").height(
                      $("#paneLeft").outerHeight() - n - t + "px"
                    ),
                    $(".detailTextContainer").width("100%"),
                    $(".detailPictureDiv img").css(
                      "max-width",
                      $("#paneLeft").outerWidth()
                    );
                  var a =
                    $("#paneLeft").outerHeight() - n - 60 <
                    0.6 * $("#paneLeft").outerHeight()
                      ? $("#paneLeft").outerHeight() - n - 60
                      : 0.6 * $("#paneLeft").outerHeight();
                  $(".detailPictureDiv img").css(
                    "max-height",
                    parseInt(a) + "px"
                  ),
                    $(".detailContainer").width($("#paneLeft").outerWidth()),
                    $(".detailContainer").height($("#paneLeft").outerHeight()),
                    B[e].update(),
                    B[e].slideTo(B[e].activeIndex);
                }, 0));
          }),
          (this.close = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/media/Popup", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="modal-dialog">\r\n\t<div class="modal-content">\r\n\t\t<div class="modal-header">\r\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n\t\t\t<h4 class="modal-title">' +
          (null == (__t = lblTitle) ? "" : __t) +
          '</h4>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-body">\r\n\t\t\t<div class="viewMediaSelectorContainer"></div>\r\n\t\t\t\t<div class="checkbox opt-select-all-container">\r\n\t\t\t\t\t<label style="outline: none;">\r\n\t\t\t\t\t\t<input type="checkbox" class="opt-checkbox-select-all">\r\n\t\t\t\t\t\t' +
          (null == (__t = selectAll) ? "" : __t) +
          ' \r\n\t\t\t\t\t</label>\r\n\t\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-footer">\r\n\t\t\t<span class="modal-footer-left"><button class="btn btn-back btn-naked">< ' +
          (null == (__t = btnBack) ? "" : __t) +
          '</button></span>\r\n\t\t\t<button class="btnSubmit btn btn-primary"></button>\r\n\t\t\t<button class="btnCancel btn btn-naked btn-close" data-dismiss="modal">' +
          (null == (__t = btnCancel) ? "" : __t) +
          "</button>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n";
      return __p;
    };
  }),
  define("lib-build/css!storymaps/tpl/builder/media/Popup", [], function () {}),
  define(
    "lib-build/tpl!storymaps/common/builder/media/MediaSelector",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p +=
            '<div class="mediaSelector">\n\t<label class="lblSelect">' +
            (null == (__t = lblSelect) ? "" : __t) +
            ':</label>\n\t<span class="media-types">\n\t\t<form>\n\t\t\t<div class="media-type-wrapper '),
            hasMap || (__p += " disabled "),
            (__p +=
              '">\n\t\t\t\t<label class="checkbox-inline media-type">\n\t\t\t\t\t<input type="radio" name="media-type" value="map"> ' +
              (null == (__t = lblMap) ? "" : __t) +
              '\n\t\t\t\t\t<span class="icon fa fa-map-o"></span>\n\t\t\t\t</label>\n\t\t\t\t<div class="mediaContainersArrow"></div>\n\t\t\t</div>\n\n\t\t\t<div class="media-type-wrapper">\n\t\t\t\t<label class="checkbox-inline media-type">\n\t\t\t\t\t<input type="radio" name="media-type" value="image"> ' +
              (null == (__t = lblImage) ? "" : __t) +
              '\n\t\t\t\t\t<span class="icon fa fa-camera"></span>\n\t\t\t\t</label>\n\t\t\t\t<div class="mediaContainersArrow"></div>\n\t\t\t</div>\n\n\t\t\t<div class="media-type-wrapper '),
            hasVideo || (__p += " disabled "),
            (__p +=
              '">\n\t\t\t\t<label class="checkbox-inline media-type">\n\t\t\t\t\t<input type="radio" name="media-type" value="video"> ' +
              (null == (__t = lblVideo) ? "" : __t) +
              '\n\t\t\t\t\t<span class="icon fa fa-video-camera"></span>\n\t\t\t\t</label>\n\t\t\t\t<div class="mediaContainersArrow"></div>\n\t\t\t</div>\n\n\t\t\t<div class="media-type-wrapper '),
            hasWebPage || (__p += " disabled "),
            (__p +=
              '">\n\t\t\t\t<label class="checkbox-inline media-type">\n\t\t\t\t\t<input type="radio" name="media-type" value="webpage"> ' +
              (null == (__t = lblExternal) ? "" : __t) +
              '\n\t\t\t\t\t<span class="icon fa fa-link"></span>\n\t\t\t\t</label>\n\t\t\t\t<div class="mediaContainersArrow"></div>\n\t\t\t</div>\n\t\t</form>\n\t</span>\n\n\t<div class="mediaContainers">\n\t\t<div class="mainMediaTypeContainer mapMediaContainer '),
            hasMap || (__p += " disabled "),
            (__p +=
              '"></div>\n\t\t<div class="mainMediaTypeContainer imageMediaContainer"></div>\n\t\t<div class="mainMediaTypeContainer videoMediaContainer"></div>\n\t\t<div class="mainMediaTypeContainer webpageMediaContainer"></div>\n\t</div>\n</div>\n');
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/MediaSelector",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/map/WebMapSelector",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="webmapSelector">\n\t<table class="map-cfg">\n\t\t<tr class="map-cfg-webmap">\n\t\t\t<td class="map-cfg-title">\n\t\t\t\t' +
            (null == (__t = lblWebMap) ? "" : __t) +
            '\n\t\t\t</td>\n\t\t\t<td class="map-cfg-btns">\n\t\t\t\t<div class="webmaps-list-container">\n\t\t\t\t\t<table style="width: 100%;">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<div class="radio-value btn-group" style="width: 100%;">\n\t\t\t\t\t\t\t\t\t<button class="btn btn-default dropdown-toggle webmaps-list-btn" type="button" data-toggle="dropdown">\n\t\t\t\t\t\t\t\t\t\t<span class="webmaps-list-btn-inner"></span>&nbsp;<span class="caret"></span>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<ul class="dropdown-menu webmaps-list"></ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="selected-map-edit-container">\n\t\t\t\t\t\t\t\t<span class="btn btn-naked selected-map-edit" style="padding-right: 0px">\n\t\t\t\t\t\t\t\t\t<span class="glyphicon glyphicon-edit" style="margin-right: 3px;"></span>\n\t\t\t\t\t\t\t\t\t' +
            (null == (__t = lblEdit) ? "" : __t) +
            '\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="selected-map-sharing-status"></span>\n\t\t\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" data-original-title="" title="Make sure your webmaps are shared publicly">\n\t\t\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t --\x3e\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr class="map-cfg-row map-cfg-location">\n\t\t\t<td class="map-cfg-title">\n\t\t\t\t' +
            (null == (__t = lblLocation) ? "" : __t) +
            '\n\t\t\t</td>\n\t\t\t<td class="map-cfg-btns">\n\t\t\t\t<div class="regular-control">\n\t\t\t\t\t<span class="btn-group">\n\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="default">\n\t\t\t\t\t\t\t' +
            (null == (__t = webmapDefault) ? "" : __t) +
            '\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="custom">\n\t\t\t\t\t\t\t' +
            (null == (__t = customCfg) ? "" : __t) +
            '&nbsp;\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>\n\t\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipLocation) ? "" : __t) +
            '">\n\t\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="inherit-alt">\n\t\t\t\t\t' +
            (null == (__t = lblLocationAlt) ? "" : __t) +
            '\n\t\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipLocationAlt) ? "" : __t) +
            '">\n\t\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr class="map-cfg-row map-cfg-content">\n\t\t\t<td class="map-cfg-title">\n\t\t\t\t' +
            (null == (__t = lblContent) ? "" : __t) +
            '\n\t\t\t</td>\n\t\t\t<td class="map-cfg-btns">\n\t\t\t\t<span class="btn-group">\n\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="default">\n\t\t\t\t\t\t' +
            (null == (__t = webmapDefault) ? "" : __t) +
            '\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="custom">\n\t\t\t\t\t\t' +
            (null == (__t = customCfg) ? "" : __t) +
            '&nbsp;\n\t\t\t\t\t</button>\n\t\t\t\t</span>\n\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipContent) ? "" : __t) +
            '">\n\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t</a>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr class="map-cfg-row map-cfg-popup">\n\t\t\t<td class="map-cfg-title">\n\t\t\t\t' +
            (null == (__t = lblPopup) ? "" : __t) +
            '\n\t\t\t</td>\n\t\t\t<td class="map-cfg-btns">\n\t\t\t\t<span class="btn-group">\n\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="default">\n\t\t\t\t\t\t' +
            (null == (__t = webmapDefault) ? "" : __t) +
            '\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="custom">\n\t\t\t\t\t\t' +
            (null == (__t = customCfg) ? "" : __t) +
            '&nbsp;\n\t\t\t\t\t</button>\n\t\t\t\t</span>\n\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipPopup) ? "" : __t) +
            '">\n\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t</a>\n\t\t\t</td>\n\t\t</tr>\n\n\t\t<tr class="map-cfg-row map-cfg-controls">\n\t\t\t<td class="map-cfg-title">\n\t\t\t\t' +
            (null == (__t = lblControls) ? "" : __t) +
            '\n\t\t\t</td>\n\t\t\t<td class="map-cfg-btns">\n\t\t\t\t<div class="checkbox map-cfg-controls-overview">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="checkbox" class="opt-checkbox-overview" />\n\t\t\t\t\t\t' +
            (null == (__t = lblOverview) ? "" : __t) +
            '\n\t\t\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipOverview) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="checkbox">\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input type="checkbox" class="opt-checkbox-legend" />\n\t\t\t\t\t\t' +
            (null == (__t = lblLegend) ? "" : __t) +
            '\n\t\t\t\t\t\t<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipLegend) ? "" : __t) +
            '">\n\t\t\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr class="map-cfg-row">\n\t\t\t<td class="map-cfg-title">' +
            (null == (__t = lblAltText) ? "" : __t) +
            '</td>\n\t\t\t<td class="map-cfg-btns">\n\t\t\t\t<textarea class="form-control alt-text" spellcheck="true" placeholder="' +
            (null == (__t = placeholderAltText) ? "" : __t) +
            '"></textarea>\n\t\t\t\t<a href="#" class="help" data-html="true" data-toggle="tooltip" data-placement="right" title="' +
            (null == (__t = tooltipAltText) ? "" : __t) +
            '">\n\t\t\t\t\t<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n\t\t\t\t</a>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n\n\t<div class="webmap-loading">\n\n\t</div>\n\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/map/WebMapSelector",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/map/MapConfigOverlay",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="mapConfigOverlay toc">\n\t\x3c!--\n\t<div class="expandButton">\n\t\t<span class="toc-title">\n\t\t\t' +
            (null == (__t = tocTitle) ? "" : __t) +
            '\n\t\t</span>\n\t\t<span class="toc-toggle"></span>\n\t</div>\n\t--\x3e\n\t<div class="header">' +
            (null == (__t = tocTitle) ? "" : __t) +
            '</div>\n\t<div class="explain">' +
            (null == (__t = tocExplain) ? "" : __t) +
            '</div>\n\t<div class="tocContainer">\x3c!-- TOC is injected here --\x3e</div>\n\t<div class="btns">\n\t\t<button type="button" class="btn btn-primary save">' +
            (null == (__t = tocSave) ? "" : __t) +
            '</button>\n\t\t<div style="margin-top:10px">\n\t\t\t<button type="button" class="btn btn-sm btn-naked reset">' +
            (null == (__t = btnReset) ? "" : __t) +
            '</button> |\n\t\t\t<button type="button" class="btn btn-sm btn-naked cancel">' +
            (null == (__t = btnCancel) ? "" : __t) +
            '</button>\n\t\t</div>\n\t</div>\n</div>\n\n<div class="mapConfigOverlay position">\n\t<div class="header">' +
            (null == (__t = extentTitle) ? "" : __t) +
            '</div>\n\t<div class="explain">' +
            (null == (__t = extentExplain) ? "" : __t) +
            '</div>\n\t<div class="btns">\n\t\t<button type="button" class="btn btn-primary save">' +
            (null == (__t = extentSave) ? "" : __t) +
            '</button>\n\t\t<div style="margin-top:10px">\n\t\t\t<button type="button" class="btn btn-sm btn-naked reset">' +
            (null == (__t = btnReset) ? "" : __t) +
            '</button> |\n\t\t\t<button type="button" class="btn btn-sm btn-naked cancel">' +
            (null == (__t = btnCancel) ? "" : __t) +
            '</button>\n\t\t</div>\n\t</div>\n</div>\n\n<div class="mapConfigOverlay popup">\n\t<div class="header">' +
            (null == (__t = popupTitle) ? "" : __t) +
            '</div>\n\t<div class="explain">' +
            (null == (__t = popupExplain) ? "" : __t) +
            '</div>\n\t<div class="btns">\n\t\t<button type="button" class="btn btn-primary save">' +
            (null == (__t = popupSave) ? "" : __t) +
            '</button>\n\t\t<div style="margin-top:10px">\n\t\t\t<button type="button" class="btn btn-sm btn-naked reset">' +
            (null == (__t = btnReset) ? "" : __t) +
            '</button> |\n\t\t\t<button type="button" class="btn btn-sm btn-naked cancel">' +
            (null == (__t = btnCancel) ? "" : __t) +
            "</button>\n\t\t</div>\n\t</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/map/MapConfigOverlay",
    [],
    function () {}
  ),
  define(
    "text!lib-app/arcgis-dijit-table-of-contents/js/dijit/templates/TableOfContents.html",
    [],
    function () {
      return '<div class="${theme}" role="presentation">\r\n    <div class="${css.container}">\r\n          <div data-dojo-attach-point="_layersNode"></div>\r\n    </div>\r\n</div>';
    }
  ),
  define(
    "lib-app/arcgis-dijit-table-of-contents/js/TableOfContents",
    [
      "dojo/Evented",
      "dojo/_base/declare",
      "dojo/_base/lang",
      "dojo/has",
      "esri/kernel",
      "dijit/_WidgetBase",
      "dijit/_TemplatedMixin",
      "dojo/on",
      "text!./dijit/templates/TableOfContents.html",
      "dojo/dom-class",
      "dojo/dom-style",
      "dojo/dom-construct",
      "dojo/_base/event",
      "dojo/_base/array",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h) {
      var f = e([o, r, t], {
        declaredClass: "esri.dijit.TableOfContents",
        templateString: l,
        options: {
          theme: "TableOfContents",
          map: null,
          layers: null,
          visible: !0,
        },
        constructor: function (t, e) {
          var n = i.mixin({}, this.options, t);
          (this.domNode = e),
            this.set("map", n.map),
            this.set("layers", n.layers),
            this.set("theme", n.theme),
            this.set("visible", n.visible),
            this.watch("theme", this._updateThemeWatch),
            this.watch("visible", this._visible),
            this.watch("layers", this._refreshLayers),
            this.watch("map", this.refresh),
            (this.css = {
              container: "toc-container",
              layer: "toc-layer",
              firstLayer: "toc-first-layer",
              title: "toc-title",
              titleContainer: "toc-title-container",
              content: "toc-content",
              titleCheckbox: "toc-checkbox",
              checkboxCheck: "icon-check-1",
              titleText: "toc-text",
              accountText: "toc-account",
              visible: "toc-visible",
              settingsIcon: "icon-cog",
              settings: "toc-settings",
              actions: "toc-actions",
              account: "toc-account",
              clear: "clear",
            });
        },
        startup: function () {
          this.map ||
            (this.destroy(), console.log("TableOfContents::map required")),
            this.map.loaded
              ? this._init()
              : s.once(
                  this.map,
                  "load",
                  i.hitch(this, function () {
                    this._init();
                  })
                );
        },
        destroy: function () {
          this._removeEvents(), this.inherited(arguments);
        },
        show: function () {
          this.set("visible", !0);
        },
        hide: function () {
          this.set("visible", !1);
        },
        refresh: function () {
          this._createList();
        },
        _createList: function () {
          var t = this.get("layers");
          if (
            ((this._nodes = []),
            this._removeEvents(),
            (this._layersNode.innerHTML = ""),
            t && t.length)
          ) {
            for (var e = 0; e < t.length; e++) {
              var i = t[e],
                n =
                  i.layerObject ||
                  (i.featureCollection
                    ? i.featureCollection.layers[0].layerObject
                    : null);
              if (n) {
                var a = this.css.titleCheckbox,
                  o = this.css.layer;
                e === t.length - 1 && ((o += " "), (o += this.css.firstLayer)),
                  n.visible &&
                    ((o += " "),
                    (o += this.css.visible),
                    (a += " "),
                    (a += this.css.checkboxCheck));
                var r = c.create("div", { className: o });
                c.place(r, this._layersNode, "first");
                var s = c.create("div", { className: this.css.title });
                c.place(s, r, "last");
                var l = c.create("div", { className: this.css.titleContainer });
                c.place(l, s, "last");
                var d = c.create("div", { className: a });
                c.place(d, l, "last");
                var p = c.create("div", {
                  className: this.css.titleText,
                  title: i.title,
                  innerHTML: i.title,
                });
                c.place(p, l, "last");
                var u;
                i.account &&
                  ((u = c.create("a", {
                    className: this.css.accountText,
                    id: i.account,
                  })),
                  c.place(u, p, "last"));
                var h, f;
                i.settings &&
                  ((h = c.create("div", {
                    className: this.css.settings,
                    id: i.settings,
                  })),
                  c.place(h, l, "last"),
                  (f = c.create("div", { className: this.css.settingsIcon })),
                  c.place(f, h, "last"));
                var m = c.create("div", { className: this.css.clear });
                c.place(m, l, "last");
                var g = {
                  checkbox: d,
                  title: s,
                  titleContainer: l,
                  titleText: p,
                  accountText: u,
                  settingsIcon: f,
                  settingsDiv: h,
                  layer: r,
                };
                this._nodes.push(g), this._checkboxEvent(e);
              }
            }
            this._setLayerEvents();
          }
        },
        _refreshLayers: function () {
          this.refresh();
        },
        _removeEvents: function () {
          var t;
          if (this._checkEvents && this._checkEvents.length)
            for (t = 0; t < this._checkEvents.length; t++)
              this._checkEvents[t].remove();
          if (this._layerEvents && this._layerEvents.length)
            for (t = 0; t < this._layerEvents.length; t++)
              this._layerEvents[t].remove();
          (this._checkEvents = []), (this._layerEvents = []);
        },
        _toggleVisible: function (t, e) {
          d.toggle(this._nodes[t].layer, this.css.visible, e),
            d.toggle(this._nodes[t].checkbox, this.css.checkboxCheck, e),
            this.emit("toggle", { index: t, visible: e });
        },
        _layerEvent: function (t, e) {
          if (t) {
            var n = s(
              t,
              "visibility-change",
              i.hitch(this, function (t) {
                this._toggleVisible(e, t.visible);
              })
            );
            this._layerEvents.push(n);
          }
        },
        _featureCollectionVisible: function (t, e, i) {
          var n,
            a = t.visibleLayers,
            o = t.featureCollection.layers;
          (n =
            a && a.length
              ? h.every(a, function (t) {
                  return o[t].layerObject.visible === i;
                })
              : h.every(o, function (t) {
                  return t.layerObject.visible === i;
                })) && this._toggleVisible(e, i);
        },
        _createFeatureLayerEvent: function (t, e, n) {
          var a = t.featureCollection.layers,
            o = s(
              a[n].layerObject,
              "visibility-change",
              i.hitch(this, function (i) {
                var n = i.visible;
                this._featureCollectionVisible(t, e, n);
              })
            );
          this._layerEvents.push(o);
        },
        _featureLayerEvent: function (t, e) {
          var i = t.featureCollection.layers;
          if (i && i.length)
            for (var n = 0; n < i.length; n++)
              this._createFeatureLayerEvent(t, e, n);
        },
        _setLayerEvents: function () {
          var t,
            e = this.get("layers");
          if (e && e.length)
            for (var i = 0; i < e.length; i++) {
              var n = e[i];
              n.featureCollection &&
              n.featureCollection.layers &&
              n.featureCollection.layers.length
                ? this._featureLayerEvent(n, i)
                : ((t = n.layerObject), this._layerEvent(t, i));
            }
        },
        _getLayerVisibility: function (t) {
          if (this.layers && this.layers.length) {
            var e = this.layers[t],
              i = e.layerObject,
              n = e.featureCollection;
            if (n)
              return (
                (visibleLayers = e.visibleLayers),
                visibleLayers && visibleLayers.length
                  ? n.layers[visibleLayers[0]].layerObject.visible
                  : n.layers[0].layerObject.visible
              );
            if (i) return e.layerObject.visible;
          }
        },
        _toggleLayer: function (t, e) {
          if (this.layers && this.layers.length) {
            var i,
              n,
              a,
              o = this.layers[t],
              r = o.layerObject,
              s = o.featureCollection;
            if (s)
              if ((n = o.visibleLayers) && n.length)
                for (
                  i = !s.layers[n[0]].layerObject.visible,
                    i = void 0 !== e ? e : i,
                    a = 0;
                  a < n.length;
                  a++
                )
                  (r = s.layers[n[a]].layerObject), r.setVisibility(i);
              else
                for (
                  i = !s.layers[0].layerObject.visible,
                    i = void 0 !== e ? e : i,
                    a = 0;
                  a < s.layers.length;
                  a++
                )
                  (r = s.layers[a].layerObject), r.setVisibility(i);
            else
              r &&
                ((i = !o.layerObject.visible),
                (i = void 0 !== e ? e : i),
                r.setVisibility(i));
          }
        },
        _checkboxEvent: function (t) {
          var e = function (e) {
            if (e.ctrlKey) {
              var i = this.get("layers"),
                n = this._getLayerVisibility(t);
              if (i && i.length)
                for (var a = 0; a < i.length; a++) this._toggleLayer(a, !n);
              u.stop(e);
            } else this._toggleLayer(t), u.stop(e);
          };
          if (this._nodes[t]) {
            var n = s(this._nodes[t].checkbox, "click", i.hitch(this, e));
            this._checkEvents.push(n);
            var a = s(this._nodes[t].titleText, "click", i.hitch(this, e));
            this._checkEvents.push(a);
          }
        },
        _init: function () {
          this._visible(),
            this._createList(),
            this.set("loaded", !0),
            this.emit("load", {});
        },
        _updateThemeWatch: function () {
          var t = arguments[1],
            e = arguments[2];
          d.remove(this.domNode, t), d.add(this.domNode, e);
        },
        _visible: function () {
          this.get("visible")
            ? p.set(this.domNode, "display", "block")
            : p.set(this.domNode, "display", "none");
        },
      });
      return n("extend-esri") && i.setObject("dijit.TableOfContents", f, a), f;
    }
  ),
  define(
    "lib-build/css!lib-app/arcgis-dijit-table-of-contents/css/TableOfContents",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/map/MapConfigOverlay",
    [
      "lib-build/tpl!./MapConfigOverlay",
      "lib-build/css!./MapConfigOverlay",
      "dojo/i18n!commonResources/nls/webmap.js?v=" + app.version,
      "dojo/i18n!commonResources/nls/media.js?v=" + app.version,
      "lib-app/arcgis-dijit-table-of-contents/js/TableOfContents",
      "lib-build/css!lib-app/arcgis-dijit-table-of-contents/css/TableOfContents",
      "esri/geometry/Extent",
      "dojo/Deferred",
      "dojo/on",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o, r, s, l, d) {
      function p(t, e) {
        return (
          (I = new s()),
          (L = e),
          (O = !1),
          (N = !1),
          (P = app.map._params.extent),
          (D = app.map.extent),
          (M = !!e && !!e.extent),
          (R = l(app.map, "extent-change", m)),
          d.subscribe("CORE_UPDATE_EXTENT", f),
          $(".mainMediaContainer.active .mapControls").addClass("hidden"),
          (j = !1),
          (H = app.mapItem ? app.mapItem.itemData.operationalLayers : []),
          (W = !!e && !!e.layers),
          (z = H ? w() : []),
          C(),
          (O = M
            ? JSON.stringify(app.lastExtentSet) != JSON.stringify(e.extent)
            : JSON.stringify(app.lastExtentSet) !=
                JSON.stringify(app.map.mapJournalInitExtent) &&
              JSON.stringify(app.lastExtentSet) != JSON.stringify(P)),
          console.log(
            JSON.stringify(app.lastExtentSet) !=
              JSON.stringify(app.map.mapJournalInitExtent),
            JSON.stringify(app.lastExtentSet) != JSON.stringify(P),
            app.lastExtentSet,
            app.map.mapJournalInitExtent,
            P,
            M,
            W
          ),
          k(t),
          I
        );
      }
      function c() {
        $(".mainMediaContainer.active .mapControls").removeClass("hidden"),
          E(),
          R.remove();
        var t = w();
        I.resolve({
          extent: O ? app.map.extent : null,
          layers: t && t.length ? t : null,
          popup: T(),
        });
      }
      function u() {
        app.map.setExtent(P).then(function () {
          O = !1;
        });
      }
      function h() {
        (app.ignoreNextEvent = !0),
          (N = !0),
          app.map.setExtent(D).then(function () {
            (O = M), c();
          });
      }
      function f() {
        (N = !0), (O = !1);
      }
      function m() {
        N ? (N = !1) : (O = !0);
      }
      function g() {
        B && B.destroy(),
          $(".mainMediaContainer.active .mapContainer").hasClass(
            "has-geocoder"
          );
      }
      function b() {
        $.each(H, function (t, e) {
          e.layerObject
            ? e.layerObject.setVisibility(e.visibility)
            : e.featureCollection &&
              $.each(e.featureCollection.layers, function (t, i) {
                i.layerObject.setVisibility(e.visibility);
              });
        });
      }
      function v() {
        $.each(H, function (t, e) {
          var i =
              e.layerObject ||
              (e.featureCollection
                ? e.featureCollection.layers[0].layerObject
                : null),
            n = $(z).filter(function (t, e) {
              return e.id == i.id;
            }),
            a = n.length ? n[0].visibility : e.visibility;
          e.layerObject
            ? i.setVisibility(a)
            : e.featureCollection &&
              $.each(e.featureCollection.layers, function (t, e) {
                e.layerObject.setVisibility(a);
              });
        }),
          c();
      }
      function y() {
        j = w().length > 0;
      }
      function w() {
        var t = [];
        return (
          $.each(H, function (e, i) {
            var n =
              i.layerObject ||
              (i.featureCollection
                ? i.featureCollection.layers[0].layerObject
                : null);
            n &&
              i.visibility != n.visible &&
              t.push({ id: n.id, visibility: n.visible });
          }),
          t
        );
      }
      function C() {
        F && F.destroy(),
          A.find(".tocContainer").html('<div class="TableOfContents"></div>'),
          (F = new a(
            { map: app.map, layers: H },
            A.find(".TableOfContents")[0]
          )),
          (H && H.length) ||
            A.find(".TableOfContents").html(
              '<div style="margin-bottom: 10px;">' +
                i.commonWebmap.configure.tocNoData +
                "</div>"
            ),
          l(F, "toggle", y),
          l(F, "load", function () {
            A.find(".toc-checkbox").addClass("glyphicon glyphicon-unchecked");
          }),
          F.startup();
      }
      function _() {}
      function x() {}
      function S() {
        app.map.infoWindow.hide(), app.map.infoWindow.clearFeatures(), c();
      }
      function T() {
        var t = app.map.infoWindow.getSelectedFeature();
        if (!t) return null;
        var e = t.getLayer(),
          i = e.fields;
        if (!i) return null;
        var n;
        if (
          (e.objectIdField
            ? (n = [{ name: e.objectIdField }])
            : ((n = $.grep(i, function (t) {
                return "esriFieldTypeOID" == t.type;
              })),
              e &&
                i &&
                !n.length &&
                ((n = $.grep(i, function (t) {
                  return "OBJECTID" == t.name || "FID" == t.name;
                })),
                n.length ||
                  (n = $.grep(i, function (t) {
                    return "esriFieldTypeInteger" == t.type;
                  })))),
          n.length)
        ) {
          var a = n[0].name;
          return {
            layerId: e.id,
            fieldName: a,
            fieldValue: t.attributes[a],
            anchorPoint: app.map.infoWindow.location.toJson(),
          };
        }
        return null;
      }
      function k(t) {
        $("body").addClass("has-builder-mask"),
          $(".panelEditBtn").fadeOut(),
          "LOCATION" == t
            ? (A.find(".mapConfigOverlay.position").show(), g())
            : "CONTENT" == t
            ? A.find(".mapConfigOverlay.toc").show()
            : "POPUP" == t &&
              (A.find(".mapConfigOverlay.popup").show(),
              (U = [
                app.map.infoWindow.on("show", _),
                app.map.infoWindow.on("hide", x),
              ])),
          "LOCATION" != t &&
            (app.map.disableMapNavigation(),
            $(app.map.__container).parent().find(".esriSimpleSliderTL").hide());
      }
      function E() {
        $("body").removeClass("has-builder-mask"),
          $(".panelEditBtn").fadeIn(),
          A.find(".mapConfigOverlay").hide(),
          app.map.enableMapNavigation(),
          $(app.map.__container).parent().find(".esriSimpleSliderTL").show(),
          $(".mainMediaContainer.active .geocoder").hide(),
          U && (U[0].remove(), U[1].remove(), (U = null));
      }
      var A = $("#mainStagePanel"),
        I = null,
        L = null,
        P = null,
        D = null,
        M = null,
        O = null,
        R = null,
        N = null,
        B = null,
        F = null,
        W = null,
        j = null,
        H = null,
        z = null,
        U = null;
      return (
        A.append(
          t({
            btnReset: i.commonWebmap.configure.btnReset,
            btnCancel: i.commonWebmap.configure.btnCancel,
            tocTitle: i.commonWebmap.configure.tocTitle,
            tocExplain:
              i.commonWebmap.configure.tocExplain +
              " " +
              i.commonWebmap.configure.hintNavigation,
            tocSave: i.commonWebmap.configure.tocSave,
            tocHint: i.commonWebmap.configure.hintNavigation,
            extentTitle: i.commonWebmap.configure.extentTitle,
            extentExplain: i.commonWebmap.configure.extentExplain,
            extentSave: i.commonWebmap.configure.extentSave,
            popupTitle: i.commonWebmap.configure.popupTitle,
            popupExplain:
              i.commonWebmap.configure.popupExplain +
              " " +
              i.commonWebmap.configure.hintNavigation,
            popupSave: i.commonWebmap.configure.popupSave,
          })
        ),
        (function () {
          A.find(".position .save").click(c),
            A.find(".position .reset").click(u),
            A.find(".position .cancel").click(h),
            A.find(".toc .save").click(c),
            A.find(".toc .reset").click(b),
            A.find(".toc .cancel").click(v),
            A.find(".popup .save").click(c),
            A.find(".popup .reset").click(S),
            A.find(".popup .cancel").click(S);
        })(),
        { present: p }
      );
    }
  ),
  define(
    "storymaps/common/builder/media/map/MapViewerWrapperUtils",
    ["esri/arcgis/utils"],
    function (t) {
      return {
        isWhiteListedDomain: function () {
          return (
            document.location.host.match(/\.esri\.com$/) ||
            document.location.host.match(/\.arcgis\.com$/)
          );
        },
        getMapViewerLink: function (t) {
          return this.getMapViewerURL() + "?webmap=" + t;
        },
        getMapViewerURL: function () {
          return this.getPortalURL() + "/home/webmap/viewer.html";
        },
        getPortalURL: function () {
          var e = t.arcgisUrl.split("/sharing/")[0];
          return app.portal.allSSL && (e = e.replace("http:", "https:")), e;
        },
        getPortalDomain: function () {
          var t = document.createElement("a");
          return (
            t.setAttribute("href", this.getPortalURL()),
            t.protocol + "//" + t.hostname
          );
        },
        viewerIsSameDomain: function () {
          var t = this.getPortalURL().split("//").slice(-1)[0],
            e = t.split("."),
            i = document.location.host,
            n = i.split(".");
          return (
            t == i ||
            (t.split("/").length > 1 && t.split("/")[0] == i) ||
            (n.length < 3
              ? i == t
              : n.slice(1).join(".") == e.slice(-2).join("."))
          );
        },
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/map/ErrorDialog",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="modal-dialog">\n\t<div class="modal-content">\n\t\t<div class="modal-logo"></div>\n\t\t<div class="modal-header">\n\t\t\t<h4 class="modal-title"></h4>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<div class="error-msg"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t<span class="error"></span>\n\t\t\t<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">' +
            (null == (__t = btnClose) ? "" : __t) +
            "</button>\n\t\t</div>\n\t</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/map/ErrorDialog",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/map/ErrorDialog",
    [
      "lib-build/tpl!./ErrorDialog",
      "lib-build/css!./ErrorDialog",
      "dojo/topic",
    ],
    function (t, e, i) {
      return function (e) {
        e.html(t({ btnClose: i18n.commonCore.common.close })),
          (function () {
            e.on("show.bs.modal", function () {
              $("#addEditPopup .backdrop").show();
            }),
              e.on("hide.bs.modal", function () {
                $("#addEditPopup .backdrop").hide();
              });
          })(),
          (this.present = function (t) {
            var n = "";
            e
              .find(".modal-title")
              .html(
                t.newMap
                  ? i18n.commonWebmap.editor.newTitle
                  : i18n.commonWebmap.editor.editTitle
              ),
              "DOMAIN" == t.error
                ? (n += i18n.commonWebmap.editor.notavailable2.replace(
                    "%PRODUCT%",
                    t.isPortal ? "Portal for ArcGIS" : "ArcGIS Online"
                  ))
                : "PORTAL" == t.error
                ? (n += i18n.commonWebmap.editor.notavailable3)
                : "DEV_TOKEN" == t.error
                ? (n +=
                    "Sorry, creating or editing a map in development mode require some extra configuration.")
                : "DEV_FAIL" == t.error &&
                  (n +=
                    "Sorry, creating or editing a map is not supported in development environment."),
              "DEV_FAIL" != t.error &&
                "TOUCH_ONLY" != t.error &&
                (n += "<br /><br />"),
              "DEV_TOKEN" == t.error
                ? (n +=
                    "To enable the map editor, please read the instructions in <i>app/storymaps/common/builder/media/map/MapViewerWrapper.js</i>.")
                : "DEV_FAIL" == t.error
                ? (n += "")
                : t.newMap
                ? (n += i18n.commonWebmap.editor.notavailable4.replace(
                    "%MV%",
                    '<a href="' +
                      t.url +
                      '" target="_blank">' +
                      i18n.commonWebmap.editor.notavailable6 +
                      "</a>"
                  ))
                : (n += i18n.commonWebmap.editor.notavailable5
                    .replace(
                      "%MV%",
                      '<a href="' +
                        t.url +
                        '" target="_blank">' +
                        i18n.commonWebmap.editor.notavailable6 +
                        "</a>"
                    )
                    .replace(
                      "%apply%",
                      '<a class="map-reload">' +
                        i18n.commonWebmap.editor.notavailable7 +
                        "</a>"
                    )),
              e.find(".error-msg").html(n),
              e.find(".map-reload").click(function () {
                i.publish("ADDEDIT_RELOAD_CURRENT_WEBMAP");
              }),
              e.modal({ keyboard: !0 });
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/media/map/WebMapSelector",
    [
      "lib-build/tpl!./WebMapSelector",
      "lib-build/css!./WebMapSelector",
      "../../browse-dialog/js/BrowseIdDlg",
      "lib-build/css!../../browse-dialog/css/browse-dialog",
      "lib-build/css!../../browse-dialog/storymaps-override",
      "./MapConfigOverlay",
      "./MapViewerWrapperUtils",
      "./ErrorDialog",
      "storymaps/tpl/core/Helper",
      "esri/geometry/Extent",
      "dojo/Deferred",
      "dojo/topic",
      "dijit/registry",
      "dojo/on",
      "dojo/_base/lang",
      "dojo/has",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h, f, m) {
      return function (e, n, a, d) {
        function p(t, i) {
          e.find(".webmaps-list").empty();
          var n = app.appCfg.mapsUseTermSection
              ? i18n.commonWebmap.selector.sections
              : i18n.commonWebmap.selector.entries,
            a = app.appCfg.mapsUseTermSection
              ? i18n.commonWebmap.selector.section
              : i18n.commonWebmap.selector.entry;
          $.each(i, function (t, e) {
            var i =
                e.title ||
                '<span class="smallLoader titleLoader"></span><span style="text-transform: uppercase">' +
                  i18n.commonWebmap.selector.loadingTitle +
                  "</span>",
              o = e.sharing ? e.sharing : '<span class="smallLoader"></span>',
              r = "";
            e.entries &&
              e.entries.length &&
              (1 == e.entries.length
                ? (r += a + " " + e.entries[0])
                : (r += n + " " + e.entries.join(", "))),
              e.actions &&
                e.actions.length &&
                ((r += r ? " " + i18n.commonWebmap.selector.and + " " : ""),
                1 == e.actions.length
                  ? (r +=
                      i18n.commonWebmap.selector.action.toLowerCase() +
                      " " +
                      e.actions[0])
                  : (r +=
                      i18n.commonWebmap.selector.actions.toLowerCase() +
                      " " +
                      e.actions.join(", "))),
              e.entries ||
                e.actions ||
                (r = i18n.commonWebmap.selector.originalWebmap.replace(
                  "%TPL_NAME%",
                  app.cfg.TPL_NAME
                )),
              g("", e.id, i, r, o);
          }),
            g(
              "action-btn browse-webmap",
              "",
              i18n.commonWebmap.selector.browseMaps,
              ""
            ),
            g(
              "action-btn create-webmap",
              "",
              i18n.commonWebmap.selector.createMap,
              ""
            ),
            t
              ? (e
                  .find(".webmaps-list-btn-inner")
                  .data("webmap", t)
                  .html(
                    '<span class="title">' +
                      app.data.getWebmapTitle(t) +
                      '</span><span class="info">' +
                      i18n.commonWebmap.selector.current +
                      "</span>"
                  ),
                e
                  .find(".selected-map-sharing-status")
                  .html(app.data.getWebmapSharing(t)))
              : e
                  .find(".webmaps-list-btn-inner")
                  .html(i18n.commonWebmap.selector.select),
            e.find(".selected-map-edit").toggle(!!t),
            e.find(".webmaps-list li:not(.action-btn) a").click(function () {
              e
                .find(".webmaps-list-btn-inner")
                .data("webmap", $(this).find(".webmap-entry").data("webmap"))
                .html($(this).find(".title").eq(0).clone()),
                e
                  .find(".selected-map-sharing-status")
                  .html($(this).find(".sharing-status").html()),
                e.find(".map-cfg-row").fadeIn(),
                k(),
                (D = {});
            }),
            e.find(".browse-webmap a").click(function () {
              P.show();
            }),
            e.find(".create-webmap a").click(x);
        }
        function g(t, i, n, a, o) {
          e.find(".webmaps-list").append(
            '<li class="' +
              t +
              '"><a data-href="#"><span class="webmap-entry" data-webmap="' +
              i +
              '"><span class="title">' +
              n +
              '</span><span class="info">' +
              a +
              "</span>" +
              (o ? '<span class="sharing-status">' + o + "</span>" : "") +
              "</span></a></li>"
          );
        }
        function b(t) {
          var i = e.find(
            '.webmaps-list .webmap-entry[data-webmap="' + t.id + '"]'
          );
          i.find(".title").html(t.title),
            i.find(".sharing-status").html(t.sharing);
        }
        function v() {
          (P = new i({ portal: app.portal, galleryType: "webmap" })),
            h(P._grid, "onItemClick", function () {
              P.onClose();
            }),
            h(P, "close", function () {
              P.get("selected") &&
                y(P.get("selected").id, P.get("selected").title, !1);
            });
        }
        function y(t, i, n) {
          var a = n
            ? i18n.commonWebmap.selector.newCreatedMap
            : i18n.commonWebmap.selector.newMap;
          e
            .find(".webmaps-list-btn-inner")
            .data("webmap", t)
            .html(
              '<span class="title">' +
                i +
                '</span><span class="info">' +
                a +
                "</span>"
            ),
            e.find(".selected-map-edit").toggle(!0),
            (D = {}),
            k(),
            d &&
              d({ newMedia: { type: "webmap", webmap: { id: t, title: i } } }),
            I.postDisplay();
        }
        function w() {
          return e.find(".webmaps-list-btn-inner").data("webmap");
        }
        function C() {
          var t = w();
          return t && t.match(/^[A-Fa-f0-9]{32}$/);
        }
        function _() {
          return L.media && L.media.webmap && L.media.webmap.id == w();
        }
        function x() {
          T()
            ? M.present({
                newMap: !0,
                error: "TOUCH_ONLY",
                url: r.getMapViewerURL(),
                isPortal: app.isPortal,
              })
            : app.isPortal || r.isWhiteListedDomain() || !app.isProduction
            ? app.isPortal && !r.viewerIsSameDomain() && app.isProduction
              ? M.present({
                  newMap: !0,
                  error: "DOMAIN",
                  url: r.getMapViewerURL(),
                  isPortal: app.isPortal,
                })
              : app.isPortal && !app.portal.hasMyStories
              ? M.present({
                  newMap: !0,
                  error: "PORTAL",
                  url: r.getMapViewerURL(),
                  isPortal: app.isPortal,
                })
              : app.builder
                  .openMapViewer({
                    newMap: !0,
                    title: app.builder.getAddEditEntryTitle(),
                  })
                  .then(
                    function (t) {
                      t.newMap && y(t.newMapInfos.id, t.newMapInfos.title, !0);
                    },
                    function (t) {
                      ("DEV_TOKEN" != t && "DEV_FAIL" != t) ||
                        M.present({ newMap: !0, error: t });
                    }
                  )
            : M.present({
                newMap: !0,
                error: "DOMAIN",
                url: r.getMapViewerURL(),
                isPortal: app.isPortal,
              });
        }
        function S() {
          T()
            ? M.present({
                newMap: !1,
                error: "TOUCH_ONLY",
                url: r.getMapViewerLink(w()),
                isPortal: app.isPortal,
              })
            : app.isPortal || r.isWhiteListedDomain() || !app.isProduction
            ? app.isPortal && !r.viewerIsSameDomain() && app.isProduction
              ? M.present({
                  newMap: !1,
                  error: "DOMAIN",
                  url: r.getMapViewerLink(w()),
                  isPortal: app.isPortal,
                })
              : app.isPortal && !app.portal.hasMyStories
              ? M.present({
                  newMap: !1,
                  error: "PORTAL",
                  url: r.getMapViewerLink(w()),
                  isPortal: app.isPortal,
                })
              : app.builder.openMapViewer({ id: w() }).then(
                  function (t) {
                    t.newMap && y(t.newMapInfos.id, t.newMapInfos.title, !0);
                  },
                  function (t) {
                    ("DEV_TOKEN" != t && "DEV_FAIL" != t) ||
                      M.present({ newMap: !1, error: t });
                  }
                )
            : M.present({
                newMap: !1,
                error: "DOMAIN",
                url: r.getMapViewerLink(w()),
                isPortal: app.isPortal,
              });
        }
        function T() {
          return (
            m("touch") &&
            /Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(
              navigator.userAgent
            )
          );
        }
        function k(t, i, n) {
          var a = t || !!D.extent,
            o = i || !!D.layers,
            r = n || !!D.popup;
          e
            .find('.map-cfg .map-cfg-location .btn[data-value="default"]')
            .toggleClass("btn-primary", !a),
            e
              .find('.map-cfg .map-cfg-location .btn[data-value="custom"]')
              .toggleClass("btn-primary", a),
            e
              .find('.map-cfg .map-cfg-content .btn[data-value="default"]')
              .toggleClass("btn-primary", !o),
            e
              .find('.map-cfg .map-cfg-content .btn[data-value="custom"]')
              .toggleClass("btn-primary", o),
            e
              .find('.map-cfg .map-cfg-popup .btn[data-value="default"]')
              .toggleClass("btn-primary", !r),
            e
              .find('.map-cfg .map-cfg-popup .btn[data-value="custom"]')
              .toggleClass("btn-primary", r),
            e.find("textarea.alt-text").val(D.altText || ""),
            w() && e.find(".map-cfg-row").show(),
            d && d();
        }
        function E(t) {
          var i = w();
          if (
            (e.find(".map-cfg").addClass("disabled"),
            e.find(".map-cfg-info").hide().addClass("disabled"),
            e
              .find(".webmap-loading")
              .show()
              .html(i18n.commonCore.common.loading + "..."),
            i)
          )
            if (_() || -1 != $.inArray(i, L.webmaps)) {
              var n = c.subscribe("ADDEDIT_WEBMAP_DONE", function () {
                n.remove(), A(t, D);
              });
              c.publish("ADDEDIT_SHOW_WEBMAP", i);
            } else {
              var a, o;
              (a = c.subscribe("ADDEDIT_WEBMAP_DONE", function () {
                a.remove(), o.remove(), A(t, D);
              })),
                (o = c.subscribe("ADDEDIT_LOAD_WEBMAP_FAIL", function () {
                  a.remove(),
                    o.remove(),
                    k(),
                    e
                      .find(".webmap-loading")
                      .show()
                      .html(
                        '<div class="error">' +
                          i18n.viewer.errors.mapLoadingFail +
                          "</div>"
                      ),
                    setTimeout(function () {
                      e.find(".webmap-loading").hide(),
                        e.find(".map-cfg").removeClass("disabled");
                    }, 3e3);
                })),
                c.publish("ADDEDIT_LOAD_WEBMAP", i);
            }
        }
        function A(t, i) {
          n(),
            o.present(t, i || {}).then(function (i) {
              "LOCATION" == t
                ? (D.extent = i.extent
                    ? l.getLayoutExtent(i.extent, !0).toJson()
                    : null)
                : "CONTENT" == t
                ? (D.layers = i.layers)
                : "POPUP" == t && (D.popup = i.popup),
                k(),
                a(),
                e.find(".webmap-loading").hide(),
                e.find(".map-cfg").removeClass("disabled");
            });
        }
        var I = this,
          L = null,
          P = null,
          D = null,
          M = new s($("#mapErrorDialog"));
        e.append(
          t(
            f.mixin(
              {
                learn: i18n.commonMedia.mediaConfigure.learn,
                lblEdit: i18n.commonCore.common.edit,
                lblAltText: i18n.commonMedia.mediaConfigure.lblAltText,
                placeholderAltText:
                  i18n.commonMedia.mediaConfigure.placeholderAltText,
                tooltipAltText: i18n.commonMedia.mediaConfigure.tooltipAltText,
              },
              i18n.commonWebmap.selector
            )
          )
        ),
          (function () {
            e
              .find(".help")
              .tooltip({ trigger: "hover", container: e.parents(".modal")[0] }),
              c.subscribe("LOADED_WEBMAP_INFOS", b),
              e.find(".map-cfg-row .btn-group .btn").click(function () {
                $(this).parent().find(".btn").removeClass("btn-primary"),
                  $(this).addClass("btn-primary");
              }),
              e
                .find('.map-cfg-location .btn[data-value="custom"]')
                .click(function () {
                  E("LOCATION");
                }),
              e
                .find('.map-cfg-content .btn[data-value="custom"]')
                .click(function () {
                  E("CONTENT");
                }),
              e
                .find('.map-cfg-popup .btn[data-value="custom"]')
                .click(function () {
                  E("POPUP");
                }),
              e.find(".selected-map-edit").click(S);
          })(),
          (this.present = function (t) {
            var i = t.media && "webmap" == t.media.type;
            (t.options = t.options || {}),
              (L = t),
              (D = {}),
              i &&
                ((D = {
                  extent: t.media.webmap.extent,
                  layers: t.media.webmap.layers,
                  popup: t.media.webmap.popup,
                  legend: t.media.webmap.legend,
                  overview: t.media.webmap.overview,
                  altText: t.media.webmap.altText,
                }),
                "add" == t.mode
                  ? (D.extent = app.map
                      ? l.getLayoutExtent(app.map.extent, !0).toJson()
                      : null)
                  : t.fromAction &&
                    c.publish("story-perform-action-media", t.media)),
              e.find(".webmaps-list-btn-inner").data("webmap", ""),
              e.find(".selected-map-sharing-status").html(""),
              p(i ? t.media.webmap.id : "", t.webmaps),
              e
                .find(".map-cfg-row")
                .toggle(!!i && 0 !== app.data.getStoryLength());
            var n = !0;
            t.options.mapsSyncAppOption && (n = t.options.showLocationControl),
              e.find(".map-cfg-location .regular-control").toggle(n),
              e.find(".map-cfg-location .inherit-alt").toggle(!n);
            var a = !1,
              o = !1;
            i &&
              ((a =
                !!t.media.webmap.overview && t.media.webmap.overview.enable),
              (o = !!t.media.webmap.legend && t.media.webmap.legend.enable)),
              e.find(".opt-checkbox-overview").prop("checked", a),
              e.find(".opt-checkbox-legend").prop("checked", o),
              e
                .find(".map-cfg-controls-overview")
                .toggle(!t.options.hideOverview),
              e
                .find(".lbl-configure")
                .html(i18n.commonWebmap.selector.btnConfigure);
            var r = null,
              s = null,
              d = null;
            "edit" == L.mode &&
              _() &&
              ((r = !!L.media.webmap.extent),
              (s = !!L.media.webmap.layers),
              (d = !!L.media.webmap.popup)),
              e
                .find(".map-cfg-controls")
                .toggleClass("disable", !!L.disableMapExtras),
              k(r, s, d),
              u.byId("browse-id-dialog") &&
                (u.byId("browse-id-dialog").destroy(),
                u.byId("browse-id-search-box").destroy(),
                u.byId("gallery") && u.byId("gallery").destroy(),
                (P = null)),
              v(),
              this.postDisplay();
          }),
          (this.checkError = function () {
            var t = !C();
            return (
              e
                .find(".webmapIdFieldContainer")
                .toggleClass("has-feedback has-error", t),
              t
            );
          }),
          (this.getData = function () {
            var t = null,
              i = w(),
              n = e
                .find('.map-cfg .map-cfg-location .btn[data-value="custom"]')
                .hasClass("btn-primary"),
              a = e
                .find('.map-cfg .map-cfg-content .btn[data-value="custom"]')
                .hasClass("btn-primary"),
              o = e
                .find('.map-cfg .map-cfg-popup .btn[data-value="custom"]')
                .hasClass("btn-primary"),
              r = e
                .find("textarea.alt-text")
                .val()
                .replace(/[<>'']/g, "");
            return C()
              ? ((t = {
                  id: i,
                  extent: n && D ? D.extent : null,
                  layers: a && D ? D.layers : null,
                  popup: o && D ? D.popup : null,
                  legend: {
                    enable: e.find(".opt-checkbox-legend").prop("checked"),
                    openByDefault: !(!D || !D.legend) && D.legend.openByDefault,
                  },
                  altText: r,
                }),
                L.options.hideOverview ||
                  f.mixin(t, {
                    overview: {
                      enable: e.find(".opt-checkbox-overview").prop("checked"),
                      openByDefault:
                        !D || !D.overview || D.overview.openByDefault,
                    },
                  }),
                t)
              : null;
          }),
          (this.activate = function () {
            I.postDisplay();
          }),
          (this.postDisplay = function () {
            0 !== e.find(".webmapSelector").width() &&
              e
                .find(".selected-map-edit-container")
                .css("width", e.find(".selected-map-edit").width());
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/Selector",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="imageSelector">\n\t<div class="selectorView viewHomeContainer"></div>\n  <div class="selectorView viewUploadContainer"></div>\n\t<div class="selectorView viewFlickrContainer"></div>\n\t<div class="selectorView viewPicasaContainer"></div>\n\t<div class="selectorView mediaSelectorPickerContainer"></div>\n\t<div class="selectorView mediaSelectorConfigureContainer"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/image/Selector",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewHome",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p +=
            '<div class="imageSelectorHome">\n\t<table class="imageSelectorTable">\n\t\t<tr>\n\t\t\t<td class="btn-container btn-select-upload '),
            disableImageUpload && (__p += " disabled "),
            (__p +=
              '">\n\t\t\t\t<span class="fa fa-upload"></span>\n\t\t\t\t<span class="title">' +
              (null == (__t = lblUpload) ? "" : __t) +
              '</span>\n\t\t\t</td>\n\t\t\t<td class="btn-container btn-select-flickr">\n\t\t\t\t<span class="fa fa-flickr"></span>\n\t\t\t\t<span class="title">Flickr</span>\n\t\t\t</td>\n\t\t\t<td class="btn-container btn-select-picasa">\n\t\t\t\t<span class="fa fa-google"></span>\n\t\t\t\t<span class="title">Google+</span>\n\t\t\t</td>\n\t\t\t<td class="btn-container btn-select-url">\n\t\t\t\t<span class="fa fa-link"></span>\n\t\t\t\t<span class="title">' +
              (null == (__t = lblLink) ? "" : __t) +
              '</span>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n\t<div class="footnote">\n\t\t<span>' +
              (null == (__t = thirdPartyTerms) ? "" : __t) +
              '</span>\n\t\t<a href="' +
              (null == (__t = flickrTermsLink) ? "" : __t) +
              '" target="_blank" class="link">Flickr</a>\n\t</div>\n</div>\n');
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/image/ViewHome",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/image/ViewHome",
    [
      "lib-build/tpl!./ViewHome",
      "lib-build/css!./ViewHome",
      "storymaps/common/utils/CommonHelper",
      "dojo/has",
    ],
    function (t, e, i, n) {
      return function (e, a) {
        var o = null;
        e.append(
          t({
            disableImageUpload: app.appCfg.disableImageUpload,
            lblUpload: i18n.commonMedia.mediaSelector.lblUpload,
            lblLink: i18n.commonMedia.mediaSelector.lblLink,
            thirdPartyTerms: i18n.commonMedia.mediaSelector.thirdPartyTerms,
            flickrTermsLink: app.cfg.FLICKR_TERMS_LINK || "",
          })
        ),
          (function () {
            e.find(".btn-select-upload").click(function () {
              a("upload");
            }),
              e.find(".btn-select-flickr").click(function () {
                a("flickr");
              }),
              e.find(".btn-select-picasa").click(function () {
                a("picasa");
              }),
              e.find(".btn-select-url").click(function () {
                var t = o || {};
                "shortlist" != app.appCfg.mediaPickerConfigureForceMode &&
                  (t.fromService = !1),
                  (t.mode = "showURL"),
                  (t.media && t.media.image) ||
                    (t.media = { type: "image", image: {} }),
                  a("configure", t);
              }),
              app.cfg.AUTHORIZED_IMPORT_SOURCE.flickr ||
                e
                  .find(".btn-select-flickr")
                  .addClass("disabled")
                  .unbind("click"),
              app.cfg.AUTHORIZED_IMPORT_SOURCE.picasa ||
                e
                  .find(".btn-select-picasa")
                  .addClass("disabled")
                  .unbind("click"),
              n("touch") ||
                app.cfg.AUTHORIZED_IMPORT_SOURCE.flickr ||
                e
                  .find(".btn-select-flickr")
                  .tooltip({
                    trigger: "hover",
                    placement: "top",
                    html: !0,
                    title: i18n.commonCore.common.disabledAdmin,
                    container: "body",
                  }),
              n("touch") ||
                app.cfg.AUTHORIZED_IMPORT_SOURCE.picasa ||
                e
                  .find(".btn-select-picasa")
                  .tooltip({
                    trigger: "hover",
                    placement: "top",
                    html: !0,
                    title: i18n.commonCore.common.disabledAdmin,
                    container: "body",
                  });
          })(),
          (this.present = function (t) {
            $.isEmptyObject(t.media) || (o = t),
              e
                .find(".imageSelectorHome")
                .toggleClass("two-choices", "import" == t.mode),
              e.find(".btn-select-url").toggle("import" != t.mode),
              e
                .find(".btn-select-upload")
                .toggle(!(!i.getItemId() && !app.isDirectCreationFirstSave)),
              app.appCfg.disableImageImportUpload &&
                "import" == t.mode &&
                e.find(".btn-select-upload").toggle(!1),
              e.show();
          }),
          (this.updateParams = function (t) {
            o = t;
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewFlickr",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="imageSelectorFlickr">\n\t<form class="form-inline" role="form" onsubmit="return false;">\n\t\t<div class="form-group">\n\t\t\t<span class="icon fa fa-flickr"></span>\n\t\t\t<span class="title">Flickr</span>\n\t\t\t<input type="text" class="form-control userName" value="" placeholder="' +
            (null == (__t = fieldUserName) ? "" : __t) +
            '"/>\n\t\t</div>\n\t\t<button class="btn btn-primary btn-userLogin">' +
            (null == (__t = btnSearch) ? "" : __t) +
            '</button>\n\t\t<span class="loadingMsg"></span>\n\t</form>\n\t<div class="errorMsg"></div>\n\t<div class="sets"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/image/ViewFlickr",
    [],
    function () {}
  ),
  define(
    "storymaps/common/utils/connector/Flickr",
    ["dojo/Deferred", "dojo/_base/lang"],
    function (t, e) {
      return function (i) {
        function n() {
          return l("flickr.tags.getListUser", { user_id: d });
        }
        function a() {
          return l("flickr.photosets.getList", { user_id: d });
        }
        function o(i, n) {
          var a = new t();
          return (
            (n.photoSize = n.photoSize || "b"),
            (n.thumbSize = n.thumbSize || "m"),
            l(
              i,
              e.mixin({ extras: "geo,description" }, { user_id: d }, n)
            ).done(function (t) {
              (t && "ok" == t.stat) || a.reject();
              var e = [],
                i = [];
              t.photos
                ? (i = t.photos.photo)
                : t.photoset && (i = t.photoset.photo),
                $.each(i, function (t, i) {
                  e.push({
                    name: i.title || "",
                    description: i.description
                      ? i.description._content || ""
                      : "",
                    pic_url: s(i, n.photoSize),
                    thumb_url: s(i, n.thumbSize),
                    lat: i.latitude || "",
                    lng: i.longitude || "",
                    is_video: !1,
                  });
                }),
                a.resolve(e);
            }),
            a
          );
        }
        function r(t) {
          return (
            $.each(t, function (t, e) {
              e._thumbnail =
                "https://farm2.static.flickr.com/" +
                e.server +
                "/" +
                e.primary +
                "_" +
                e.secret +
                "_s.jpg";
            }),
            t
          );
        }
        function s(t, e) {
          return (
            "https://farm" +
            t.farm +
            ".static.flickr.com/" +
            t.server +
            "/" +
            t.id +
            "_" +
            t.secret +
            "_" +
            e +
            ".jpg"
          );
        }
        function l(t, e) {
          var n =
            "https://api.flickr.com/services/rest/?method=" +
            t +
            "&format=json&api_key=" +
            i +
            (e ? "&" + $.param(e) : "") +
            "&jsoncallback=?";
          return $.getJSON(n);
        }
        var d = null;
        if (!i)
          return void console.error(
            "Flickr initialization error - missing apiKey parameter"
          );
        (this.connect = function (e, i, o) {
          var s = new t();
          return (
            (i = !1 !== i),
            (o = !1 !== o),
            l("flickr.people.findByUsername", { username: e }).done(function (
              t
            ) {
              t && "ok" == t.stat
                ? ((d = t.user.id),
                  i && o
                    ? $.when(n(), a()).done(function (t, e) {
                        s.resolve({
                          tags: t[0].who.tags.tag,
                          sets: r(e[0].photosets.photoset),
                        });
                      })
                    : i
                    ? a().then(function (t) {
                        s.resolve({ sets: r(t.photosets.photoset) });
                      })
                    : o
                    ? n().then(function (t) {
                        s.resolve({ tags: t.who.tags.tag });
                      })
                    : s.resolve({}))
                : s.reject();
            }),
            s
          );
        }),
          (this.getPicturesInSet = function (t, i) {
            return o(
              "flickr.photosets.getPhotos",
              e.mixin({ photoset_id: t }, i)
            );
          }),
          (this.getPicturesByTag = function (t, i) {
            return o("flickr.photos.search", e.mixin({ tags: t }, i));
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewFlickrSet",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="set" data-id="' +
            (null == (__t = id) ? "" : __t) +
            '" style="' +
            (null == (__t = style) ? "" : __t) +
            '">\n\t<img src="' +
            (null == (__t = thumb) ? "" : __t) +
            '" />\n\t<div>' +
            (null == (__t = title) ? "" : __t) +
            " (" +
            (null == (__t = nb) ? "" : __t) +
            ")</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "storymaps/common/builder/media/image/ViewFlickr",
    [
      "lib-build/tpl!./ViewFlickr",
      "lib-build/css!./ViewFlickr",
      "storymaps/common/utils/connector/Flickr",
      "lib-build/tpl!./ViewFlickrSet",
    ],
    function (t, e, i, n) {
      return function (e, a) {
        function o() {
          var t = e.find(".userName").val(),
            i = e.parents(".smallSize").length ? 3 : 4;
          s(),
            l.connect(t, !0, !1).then(
              function (t) {
                var a = "";
                if (!t || !t.sets || !t.sets.length)
                  return (
                    e.find(".loadingMsg").html(""),
                    void e
                      .find(".errorMsg")
                      .show()
                      .html(i18n.commonMedia.mediaSelector.noData)
                  );
                $.each(t.sets, function (t, e) {
                  a += n({
                    id: e.id,
                    thumb: e._thumbnail,
                    title: e.title._content,
                    nb: e.photos,
                    style: t % i == 0 ? "clear:both" : "",
                  });
                }),
                  e.find(".sets").removeClass("disabled").show().html(a),
                  e.find(".sets").off("click").click(r),
                  e
                    .find(".loadingMsg")
                    .html('<span class="glyphicon glyphicon-ok"></span>');
              },
              function () {
                e.find(".loadingMsg").html(""),
                  e
                    .find(".errorMsg")
                    .show()
                    .html(i18n.commonMedia.imageSelectorFlickr.signInMsg2);
              }
            );
        }
        function r(t) {
          s(),
            e.find(".sets").addClass("disabled"),
            l
              .getPicturesInSet(
                $(t.target).data("id") ||
                  $(t.target).parents(".set").data("id"),
                { per_page: 500 }
              )
              .then(
                function (t) {
                  e.find(".loadingMsg").html(""),
                    e.find(".sets").removeClass("disabled"),
                    t.length && a("picker", { data: t });
                },
                function () {
                  e.find(".loadingMsg").html(""),
                    e
                      .find(".errorMsg")
                      .show()
                      .html(i18n.commonMedia.imageSelectorFlickr.loadingFailed);
                }
              );
        }
        function s() {
          e.find(".loadingMsg").html('<span class="smallLoader"></span>'),
            e.find(".errorMsg").hide();
        }
        var l = new i(app.cfg.FLICKR_API_KEY);
        e.append(
          t({
            fieldUserName: i18n.commonMedia.imageSelectorFlickr.userInputLbl,
            btnSearch: i18n.commonMedia.mediaSelector.userLookup,
          })
        ),
          (function () {
            e.find(".btn-userLogin").click(o),
              e
                .find(".userName")
                .bind("input propertychange", function () {
                  $(this).val()
                    ? e.find(".btn-userLogin").removeAttr("disabled")
                    : e.find(".btn-userLogin").attr("disabled", "disabled"),
                    e.find(".loadingMsg").html(""),
                    e.find(".errorMsg").hide(),
                    e.find(".sets").html("");
                })
                .keyup(function (t) {
                  13 == t.keyCode && $(this).val() && o();
                });
          })(),
          (this.present = function (t) {
            (t && t.isReturning) ||
              e.find(".userName").val() ||
              e.find(".btn-userLogin").attr("disabled", "disabled"),
              e.show();
            var i = e.find(".imageSelectorFlickr");
            if (i.width()) {
              var n = i.find(".userName");
              n.css(
                "width",
                i.width() -
                  (n.position().left - i.position().left) -
                  i.find(".btn-userLogin").outerWidth() -
                  30
              ).focus();
            }
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewPicasa",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="imageSelectorPicasa">\n\t<form class="form-inline" role="form" onsubmit="return false;">\n\t\t<div class="form-group">\n\t\t\t<span class="icon fa fa-google"></span>\n\t\t\t<span class="title">Google+</span>\n\t\t\t<input type="text" class="form-control userName" value="" placeholder="' +
            (null == (__t = fieldUserName) ? "" : __t) +
            '"/>\n\t\t</div>\n\t\t<button class="btn btn-primary btn-userLogin">' +
            (null == (__t = btnSearch) ? "" : __t) +
            '</button>\n\t\t<span class="loadingMsg"></span>\n\t</form>\n\t<div class="errorMsg"></div>\n\t<div class="albums"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/image/ViewPicasa",
    [],
    function () {}
  ),
  define(
    "storymaps/common/utils/connector/Picasa",
    ["dojo/Deferred"],
    function (t) {
      return function () {
        (this.getAlbums = function (e) {
          var i = new t(),
            n =
              document.location.protocol +
              "//picasaweb.google.com/data/feed/base/user/" +
              e +
              "?alt=json&access=public";
          return e
            ? ($.ajax({ url: n, dataType: "jsonp", timeout: 4e3 }).then(
                function (t) {
                  var e = [];
                  t &&
                    t.feed &&
                    t.feed.entry &&
                    $.each(t.feed.entry, function (t, i) {
                      e.push({
                        url: i.id.$t,
                        title: i.title.$t || "",
                        thumbnailUrl: i.media$group.media$thumbnail[0].url,
                      });
                    }),
                    i.resolve(e);
                },
                function () {
                  i.reject();
                }
              ),
              i)
            : (i.reject(), i);
        }),
          (this.getAlbum = function (e, i) {
            var n = new t(),
              a =
                e.replace("/data/entry/base/", "/data/feed/base/") +
                "&kind=photo&fields=title,subtitle,icon,entry(title,gphoto:numphotos,media:group(media:content,media:thumbnail,media:description),georss:where)";
            return e
              ? ((a += "&imgmax=1600"),
                (a += i ? "&max-results=" + i : ""),
                $.getJSON(a, function (t) {
                  var e = [];
                  $.each(t.feed.entry, function (t, i) {
                    var n = i.media$group.media$content[0].url || "",
                      a = i.media$group.media$thumbnail[2].url || "";
                    (n = n.replace("http://", "https://")),
                      (a = a.replace("http://", "https://"));
                    var o = {
                      name: i.media$group.media$description.$t || "",
                      description: "",
                      pic_url: n,
                      thumb_url: a,
                      lat: "",
                      lng: "",
                      is_video: !1,
                    };
                    i.georss$where &&
                      i.georss$where.gml$Point &&
                      i.georss$where.gml$Point.gml$pos &&
                      i.georss$where.gml$Point.gml$pos.$t &&
                      2 ==
                        i.georss$where.gml$Point.gml$pos.$t.split(" ").length &&
                      ((o.lat =
                        i.georss$where.gml$Point.gml$pos.$t.split(" ")[0]),
                      (o.lng =
                        i.georss$where.gml$Point.gml$pos.$t.split(" ")[1])),
                      e.push(o);
                  }),
                    n.resolve(e);
                }),
                n)
              : (n.reject(), n);
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/image/ViewPicasaAlbum",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="album" data-id="' +
            (null == (__t = id) ? "" : __t) +
            '" style="' +
            (null == (__t = style) ? "" : __t) +
            '">\n\t<img src="' +
            (null == (__t = thumb) ? "" : __t) +
            '" class="album-thumb" />\n\t<div>' +
            (null == (__t = title) ? "" : __t) +
            "</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "storymaps/common/builder/media/image/ViewPicasa",
    [
      "lib-build/tpl!./ViewPicasa",
      "lib-build/css!./ViewPicasa",
      "storymaps/common/utils/connector/Picasa",
      "lib-build/tpl!./ViewPicasaAlbum",
    ],
    function (t, e, i, n) {
      return function (e, a) {
        function o() {
          var t = e.find(".userName").val(),
            i = e.parents(".smallSize").length ? 3 : 4;
          s(),
            l.getAlbums(t).then(
              function (t) {
                var a = "";
                if (!t || !t.length)
                  return (
                    e.find(".loadingMsg").html(""),
                    void e
                      .find(".errorMsg")
                      .show()
                      .html(i18n.commonMedia.mediaSelector.noData)
                  );
                $.each(t, function (t, e) {
                  a += n({
                    id: e.url,
                    thumb: e.thumbnailUrl,
                    title: e.title,
                    style: t % i == 0 ? "clear:both" : "",
                  });
                }),
                  e.find(".albums").removeClass("disabled").show().html(a),
                  e.find(".albums").off("click").click(r),
                  e
                    .find(".loadingMsg")
                    .html('<span class="glyphicon glyphicon-ok"></span>');
              },
              function () {
                e.find(".loadingMsg").html(""),
                  e
                    .find(".errorMsg")
                    .show()
                    .html(i18n.commonMedia.imageSelectorPicasa.signInMsg2);
              }
            );
        }
        function r(t) {
          s(),
            e.find(".albums").addClass("disabled"),
            l.getAlbum($(t.target).parents(".album").data("id"), 200).then(
              function (t) {
                e.find(".loadingMsg").html(""),
                  e.find(".albums").removeClass("disabled"),
                  t.length && a("picker", { data: t });
              },
              function () {
                e.find(".loadingMsg").html(""),
                  e
                    .find(".errorMsg")
                    .show()
                    .html(i18n.commonMedia.imageSelectorFlickr.loadingFailed);
              }
            );
        }
        function s() {
          e.find(".loadingMsg").html('<span class="smallLoader"></span>'),
            e.find(".errorMsg").hide();
        }
        var l = new i(app.cfg.FLICKR_API_KEY);
        e.append(
          t({
            fieldUserName: i18n.commonMedia.imageSelectorPicasa.userInputLbl,
            btnSearch: i18n.commonMedia.mediaSelector.userLookup,
          })
        ),
          (function () {
            e.find(".btn-userLogin").click(o),
              e
                .find(".userName")
                .bind("input propertychange", function () {
                  $(this).val()
                    ? e.find(".btn-userLogin").removeAttr("disabled")
                    : e.find(".btn-userLogin").attr("disabled", "disabled"),
                    e.find(".loadingMsg").html(""),
                    e.find(".errorMsg").hide(),
                    e.find(".albums").html("");
                })
                .keyup(function (t) {
                  13 == t.keyCode && $(this).val() && o();
                });
          })(),
          (this.present = function (t) {
            (t && t.isReturning) ||
              e.find(".userName").val() ||
              e.find(".btn-userLogin").attr("disabled", "disabled"),
              e.show();
            var i = e.find(".imageSelectorPicasa");
            if (i.width()) {
              var n = i.find(".userName");
              n.css(
                "width",
                i.width() -
                  (n.position().left - i.position().left) -
                  i.find(".btn-userLogin").outerWidth() -
                  30
              ).focus();
            }
          });
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/ViewPicker",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/ViewPickerItem",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="mediaItem" data-id="' +
            (null == (__t = id) ? "" : __t) +
            '" style="' +
            (null == (__t = style) ? "" : __t) +
            '">\n\t<img class="mediaImg" src="' +
            (null == (__t = thumb) ? "" : __t) +
            '" />\n\t<div>' +
            (null == (__t = title) ? "" : __t) +
            "</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "storymaps/common/builder/media/ViewPicker",
    ["lib-build/css!./ViewPicker", "lib-build/tpl!./ViewPickerItem"],
    function (t, e) {
      return function (t, i, n) {
        var a = null;
        (this.present = function (o) {
          if (!o.isReturning) {
            var r = "";
            (a = o),
              $.each(o.data, function (t, i) {
                r += e({
                  id: t,
                  title: i.name,
                  thumb: i.thumb_url,
                  style: t % 2 == 0 ? "clear:both" : "",
                });
              }),
              t.html(r);
          }
          t.off("click"),
            t.find(".mediaItem").off("click"),
            "import" == o.mode
              ? ($(".opt-checkbox-select-all").attr("checked", !1),
                $(".opt-select-all-container").show(),
                t.find(".mediaItem").addClass("import"),
                $(".opt-checkbox-select-all")
                  .off("change")
                  .change(function () {
                    t
                      .find(".mediaItem")
                      .toggleClass("selected", $(this).is(":checked")),
                      n && n("import");
                  }),
                t.find(".mediaItem").on("click", function () {
                  $(this).toggleClass("selected"), n && n();
                }))
              : t.click(function (t) {
                  var e = $(t.target).parents(".mediaItem").index();
                  -1 != e &&
                    i("configure", {
                      mode: a.mode,
                      fromService: !0,
                      media: a.data[e],
                    });
                }),
            t.find(".mediaItem").removeClass("selected"),
            t.show();
        }),
          (this.getData = function () {
            var e = [];
            return (
              a &&
                a.data &&
                $.each(t.find(".mediaItem.selected"), function (t, i) {
                  e.push(a.data[$(i).data("id")]);
                }),
              e
            );
          }),
          (this.checkError = function () {
            return !t.find(".mediaItem.selected").length;
          });
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/ViewConfigure",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/ViewConfigure",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p +=
            '<div class="mediaSelectorConfigure">\n\t<form role="form">\n\t\t<div class="form-group">\n\t\t\t<label>' +
            (null == (__t = lblURL) ? "" : __t) +
            '\n\t\t\t\t<span class="configureHelp fa fa-info-circle" data-toggle="tooltip" data-title="' +
            (null == (__t = lblURLHelp) ? "" : __t) +
            '"></span>\n\t\t\t</label>\n\t\t\t<input type="text" class="form-control mediaURL" placeholder="' +
            (null == (__t = lblURLPHHTTPS) ? "" : __t) +
            '">\n\t\t\t<p class="mediaURLError">' +
            (null == (__t = lblURLError) ? "" : __t) +
            "</p>\n\t\t</div>\n\t\t"),
            "inlineText" == mode &&
              (__p +=
                '\n\t\t\t<div class="inline-image">\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label style="display: block">' +
                (null == (__t = lblLabel) ? "" : __t) +
                '</label>\n\t\t\t\t\t<textarea class="form-control mediaTitle" spellcheck="true" placeholder="' +
                (null == (__t = lblLabelPH) ? "" : __t) +
                '" style="height: 74px; margin-top: 5px;"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="form-group">\n\t\t\t\t\t<div class="checkbox">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type="checkbox" value="opt-maximize">\n\t\t\t\t\t\t\t' +
                (null == (__t = lblMaximize) ? "" : __t) +
                '\n\t\t\t\t\t\t\t<span class="configureHelp fa fa-info-circle" data-toggle="tooltip" data-title="' +
                (null == (__t = lblMaximizeHelp) ? "" : __t) +
                '"></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="inline-video">\n\t\t\t\t<label style="display: block; margin-bottom: 15px; margin-left: 122px;">' +
                (null == (__t = lblPosition) ? "" : __t) +
                '</label>\n\t\t\t\t<div style="text-align: center">\n\t\t\t\t\t<div class="media-configure-position" data-val="fit">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition3) ? "" : __t) +
                "</div>\n\t\t\t\t\t\t<div>" +
                (null == (__t = lblPosition3Explain2) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="custom">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-custom.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition5) ? "" : __t) +
                '</div>\n\t\t\t\t\t\t<div class="position-params">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<input type="text" class="form-control input-sm posCustomW" placeholder="' +
                (null == (__t = phWidth) ? "" : __t) +
                '" style="display: inline-block; width: 65px;">\n\t\t\t\t\t\t\t\t<a href="#" class="dimHelp" data-toggle="tooltip">\n\t\t\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png"/>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="margin-top: 2px;">\n\t\t\t\t\t\t\t\t<input type="text" class="form-control input-sm posCustomH" placeholder="' +
                (null == (__t = phHeight) ? "" : __t) +
                '" style="display: inline-block; width: 65px;">\n\t\t\t\t\t\t\t\t<a href="#" class="dimHelp2" data-toggle="tooltip">\n\t\t\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png"/>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!--\n\t\t\t<div class="form-group">\n\t\t\t\t<label style="display: block">Alignment</label>\n\t\t\t\t<label class="checkbox-inline" style="margin-left: -18px;">\n\t\t\t\t\t<input type="radio" name="mediaDisplay" value="none"> None\n\t\t\t\t</label>\n\t\t\t\t<label class="checkbox-inline">\n\t\t\t\t\t<input type="radio" name="mediaDisplay" value="left"> Left\n\t\t\t\t</label>\n\t\t\t\t<label class="checkbox-inline">\n\t\t\t\t\t<input type="radio" name="mediaDisplay" value="center"> Center\n\t\t\t\t</label>\n\t\t\t\t<label class="checkbox-inline">\n\t\t\t\t\t<input type="radio" name="mediaDisplay" value="right"> Right\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t--\x3e\n\t\t'),
            "mainMedia" == mode &&
              (__p +=
                '\n\t\t\t<div class="form-group position-image">\n\t\t\t\t<label style="display: block; margin-bottom: 15px;">' +
                (null == (__t = lblPosition) ? "" : __t) +
                '</label>\n\t\t\t\t<div>\n\t\t\t\t\t<div class="media-configure-position" data-val="fill">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-fill.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition2) ? "" : __t) +
                "</div>\n\t\t\t\t\t\t<div>" +
                (null == (__t = lblPosition2Explain) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="fit">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition3) ? "" : __t) +
                "</div>\n\t\t\t\t\t\t<div>" +
                (null == (__t = lblPosition3Explain) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="stretch">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-stretch.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition4) ? "" : __t) +
                "</div>\n\t\t\t\t\t\t<div>" +
                (null == (__t = lblPosition4Explain) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="center">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-center.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition1) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="form-group position-video">\n\t\t\t\t<label style="display: block; margin-bottom: 15px;">' +
                (null == (__t = lblPosition) ? "" : __t) +
                '</label>\n\t\t\t\t<div style="text-align: center">\n\t\t\t\t\t<div class="media-configure-position" data-val="stretch">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-stretch.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition2) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="fit">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition3) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="center">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-center.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition1) ? "" : __t) +
                '</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="media-configure-position" data-val="custom">\n\t\t\t\t\t\t<div class="position-selected"></div>\n\t\t\t\t\t\t<img class="position-img" src="resources/common/icons/media-configure-position-custom.png" />\n\t\t\t\t\t\t<div class="position-lbl">' +
                (null == (__t = lblPosition5) ? "" : __t) +
                '</div>\n\t\t\t\t\t\t<div class="position-params">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<input type="text" class="form-control input-sm posCustomW" placeholder="' +
                (null == (__t = phWidth) ? "" : __t) +
                '" style="display: inline-block; width: 65px;">\n\t\t\t\t\t\t\t\t<a href="#" class="dimHelp" data-toggle="tooltip">\n\t\t\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png"/>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="margin-top: 2px;">\n\t\t\t\t\t\t\t\t<input type="text" class="form-control input-sm posCustomH" placeholder="' +
                (null == (__t = phHeight) ? "" : __t) +
                '" style="display: inline-block; width: 65px;">\n\t\t\t\t\t\t\t\t<a href="#" class="dimHelp2" data-toggle="tooltip">\n\t\t\t\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png"/>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t'),
            "shortlist" == mode &&
              (__p +=
                '\n\t\t\t<div class="form-group">\n\t\t\t\t<label>' +
                (null == (__t = lblThumbURL) ? "" : __t) +
                '\n\t\t\t\t\t<span class="configureHelp fa fa-info-circle" data-toggle="tooltip" data-title="' +
                (null == (__t = lblThumbURLHelp) ? "" : __t) +
                '"></span>\n\t\t\t\t</label>\n\t\t\t\t<input type="text" class="form-control mediaThumbURL" placeholder="' +
                (null == (__t = lblURLPH) ? "" : __t) +
                '">\n\t\t\t\t<p class="mediaThumbURLError">' +
                (null == (__t = lblURLError) ? "" : __t) +
                "</p>\n\t\t\t</div>\n\t\t"),
            (__p +=
              '\n\n\t\t<div class="form-group mediaUnloadStrategy">\n\t\t\t<div class="checkbox">\n\t\t\t\t<label>\n\t\t\t\t\t<input type="checkbox" class="navigateOutUnload" />\n\t\t\t\t\t' +
              (null == (__t = unloadLbl) ? "" : __t) +
              '\n\t\t\t\t\t<a href="#" class="unloadHelp" data-toggle="tooltip" data-title="' +
              (null == (__t = unloadHelp) ? "" : __t) +
              '">\n\t\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png"/>\n\t\t\t\t\t</a>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="form-group embedProtocol">\n\t\t\t<div class="checkbox">\n\t\t\t\t<label>\n\t\t\t\t\t<input type="checkbox" class="embedProtocolSecure" />\n\t\t\t\t\t' +
              (null == (__t = embedProtocolLabel) ? "" : __t) +
              '\n\t\t\t\t</label>\n\t\t\t\t\x3c!-- note: if there\'s any space between an img link and its closing </a>, an underline will appear on hover --\x3e\n\t\t\t\t<a href="#" class="protocolHelp" data-toggle="tooltip" data-title="' +
              (null == (__t = embedProtocolInfo) ? "" : __t) +
              '"><img src="resources/tpl/builder/icons/builder-help.png"/></a>\n\t\t\t\t<a href="http://links.esri.com/storymaps/blogs_mixed_content/" target="_blank">' +
              (null == (__t = learn) ? "" : __t) +
              "</a>\n\t\t\t</div>\n\t\t</div>\n\t\t"),
            "shortlist" !== mode &&
              (__p +=
                '\n\t\t<div class="alt-text-wrapper">\n\t\t\t<div class="form-group">\n\t\t\t\t<label>' +
                (null == (__t = lblAltText) ? "" : __t) +
                '</label>\n\t\t\t\t<a href="#" class="altTextHelp help" data-toggle="tooltip" data-title="' +
                (null == (__t = tooltipAltText) ? "" : __t) +
                '">\n\t\t\t\t\t<img src="resources/tpl/builder/icons/builder-help.png"/>\n\t\t\t\t</a>\n\t\t\t\t<textarea class="form-control alt-text" spellcheck="true" placeholder="' +
                (null == (__t = placeholderAltText) ? "" : __t) +
                '"></textarea>\n\t\t\t</div>\n\t\t</div>\n\t\t'),
            (__p += "\n\t</form>\n</div>\n");
        return __p;
      };
    }
  ),
  define(
    "storymaps/common/builder/media/ViewConfigure",
    [
      "lib-build/css!./ViewConfigure",
      "lib-build/tpl!./ViewConfigure",
      "../../utils/CommonHelper",
      "dojo/_base/lang",
      "dojo/Deferred",
    ],
    function (t, e, i, n, a) {
      return function (t, o) {
        var r = ["center", "fill", "fit", "stretch", "custom"],
          s = null,
          l = null,
          d = null;
        app.appCfg.mediaPickerConfigureForceMode &&
          (o.mode = app.appCfg.mediaPickerConfigureForceMode);
        var p = n.mixin(
          {
            mode: o.mode,
            phWidth: i18n.commonCore.common.width,
            phHeight: i18n.commonCore.common.height,
            embedProtocolInfo:
              "https:" == location.protocol
                ? i18n.commonMedia.mediaConfigure.embedProtocolWarning1
                : i18n.commonMedia.mediaConfigure.embedProtocolWarning2,
          },
          i18n.commonMedia.mediaConfigure
        );
        "shortlist" === app.appCfg.mediaPickerConfigureForceMode &&
          n.mixin(p, {
            lblURLHelp: i18n.builder.detailPanelBuilder.imageSizeHelperUpdated,
            lblThumbURLHelp:
              i18n.builder.detailPanelBuilder.thumbnailHelp ||
              "The recommended thumbnail size & shape is 280 x 210 pixels (4:3 width:height ratio). Larger thumbnails can slow performance. 4:3 aspect ratio thumbnails fit into their tiles without being cropped.",
            lblThumbURL: i18n.builder.detailPanelBuilder.thumbnailLink,
          }),
          t.append(e(p)),
          (function () {
            t
              .find(".help")
              .tooltip({ trigger: "hover", container: t.parents(".modal")[0] }),
              t.find(".imageDetailsLbl").click(function () {
                t.find(".imageDetailsContainer").toggleClass("expanded");
              }),
              t
                .find(".media-configure-position")
                .off("click")
                .click(function () {
                  var e = $(this).data("val");
                  t.find(".media-configure-position").removeClass("selected"),
                    $(this).addClass("selected"),
                    t
                      .find('.media-configure-position[data-val="custom"]')
                      .find(".position-params")
                      .toggleClass("disabled", "custom" != e);
                }),
              t
                .find(".dimHelp")
                .tooltip("destroy")
                .tooltip({
                  title: i18n.commonMedia.mediaConfigure.tooltipDimension,
                  html: !0,
                  trigger: "hover",
                  container: t,
                }),
              t
                .find(".dimHelp2")
                .tooltip("destroy")
                .tooltip({
                  title: i18n.commonMedia.mediaConfigure.tooltipDimension2,
                  html: !0,
                  trigger: "hover",
                  container: t,
                }),
              t
                .find(".maximizeHelp, .unloadHelp, .configureHelp")
                .tooltip({
                  html: !0,
                  trigger: "hover",
                  container: t,
                  placement:
                    "shortlist" == app.appCfg.mediaPickerConfigureForceMode
                      ? "bottom"
                      : "top",
                });
          })(),
          (this.present = function (e) {
            var n = e.media;
            (this.imageSizes = null),
              e.media &&
                "shortlist" === app.appCfg.mediaPickerConfigureForceMode &&
                e.media.image &&
                (e.media.pic_url &&
                  (e.media.pic_url.indexOf("flickr") ||
                    e.media.pic_url.indexOf("googleusercontent")) &&
                  (e.fromService = !0),
                e.media.image &&
                  e.media.image.url &&
                  (e.media.image.url.indexOf("flickr") ||
                    e.media.image.url.indexOf("googleusercontent")) &&
                  (e.fromService = !0),
                e.media.thumb_url &&
                  (e.media.thumb_url.indexOf("flickr") ||
                    e.media.thumb_url.indexOf("googleusercontent")) &&
                  (e.fromService = !0)),
              e.fromService &&
                (e.media.is_video
                  ? (n = {
                      type: "video",
                      video: {
                        title: e.media.name,
                        titleDisplay: "caption",
                        url: e.media.pic_url,
                      },
                    })
                  : ((this.imageSizes = e.media.sizes),
                    (n = {
                      type: "image",
                      image: {
                        title: e.media.description || e.media.name,
                        titleDisplay: "caption",
                        url:
                          e.media.pic_url ||
                          (this.imageSizes
                            ? this.imageSizes[0].url
                            : e.media.picUrl) ||
                          e.media.image.url,
                        sizes: e.media.sizes,
                        thumb_url: e.media.thumb_url ? e.media.thumb_url : "",
                      },
                    }))),
              n &&
                "image" == n.type &&
                n.image &&
                ({
                  width: e.fromService ? null : n[n.type].width,
                  height: e.fromService ? null : n[n.type].height,
                },
                (n.image.activateFullScreen = e.media.activateFullScreen)),
              (l = n ? n.type : "image"),
              (s = n),
              (d = e);
            var a = n ? n[n.type].url : "";
            !a ||
              "shortlist" == app.appCfg.mediaPickerConfigureForceMode ||
              "showURL" != e.mode ||
              e.media.resourcesUrl ||
              e.media.pic_url ||
              ((a = ""), (d.fromService = !1)),
              a &&
                "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
                a.indexOf(!1) &&
                (a = i.possiblyAddToken(a)),
              t
                .find(".mediaURL")
                .val(a)
                .keyup(function () {
                  d.fromService &&
                    n &&
                    n.type &&
                    n[n.type].url != t.find(".mediaURL").val() &&
                    (d.fromService = !1),
                    "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
                      t.find(".mediaThumbURL").val().length &&
                      t
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .find(".modal-footer")
                        .find(".btnSubmit")
                        .attr("disabled", !1),
                    t.find(".mediaURLError").fadeOut();
                })
                .on("paste", function () {
                  d.fromService &&
                    n &&
                    n.type &&
                    n[n.type].url != t.find(".mediaURL").val() &&
                    (d.fromService = !1),
                    "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
                      t.find(".mediaThumbURL").val().length &&
                      t
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .find(".modal-footer")
                        .find(".btnSubmit")
                        .attr("disabled", !1),
                    t.find(".mediaURLError").fadeOut();
                })
                .parent()
                .toggle(
                  (!1 === e.fromService ||
                    ("shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
                      "showURL" == e.mode)) &&
                    "image" == l &&
                    "image" == l
                ),
              t.find(".mediaURLError").hide();
            var p = n ? n[n.type].thumb_url : "";
            p &&
              "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
              p.indexOf(!1) &&
              (p = i.possiblyAddToken(p)),
              t
                .find(".mediaThumbURL")
                .val(p)
                .keyup(function () {
                  d.fromService &&
                    n &&
                    n.type &&
                    n[n.type].thumb_url != t.find(".mediaThumbURL").val() &&
                    (d.fromService = !1),
                    "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
                      t.find(".mediaURL").val().length &&
                      t
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .find(".modal-footer")
                        .find(".btnSubmit")
                        .attr("disabled", !1),
                    t.find(".mediaThumbURLError").fadeOut();
                })
                .on("paste", function () {
                  d.fromService &&
                    n &&
                    n.type &&
                    n[n.type].thumb_url != t.find(".mediaThumbURL").val() &&
                    (d.fromService = !1),
                    "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
                      t.find(".mediaURL").val().length &&
                      t
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .parent()
                        .find(".modal-footer")
                        .find(".btnSubmit")
                        .attr("disabled", !1),
                    t.find(".mediaThumbURLError").fadeOut();
                }),
              "webpage" == l &&
                n[n.type].frameTag &&
                t.find(".mediaURL").val(n[n.type].frameTag),
              t.find(".position-image").toggle("image" == l),
              t.find(".position-video").toggle("video" == l || "webpage" == l),
              t.find(".media-configure-position").removeClass("selected");
            var c = "image" == l ? r[1] : r[3],
              u = null,
              h = null;
            if (e.media && e.media.type) {
              var f = e.media[e.media.type].display;
              (u = e.media[e.media.type].width),
                (h = e.media[e.media.type].height),
                -1 != $.inArray(f, r) && (c = f);
            }
            var m = "image" == l ? ".position-image" : ".position-video";
            if (
              ("inlineText" != o.mode ||
                ("video" != l && "webpage" != l) ||
                ((m = ".inline-video"), u || h || (c = "fit")),
              ("video" != l && "webpage" != l) ||
                ("fit" == c && ((u = ""), (h = ""))),
              t
                .find(m)
                .find(".media-configure-position[data-val=" + c + "]")
                .addClass("selected")
                .click(),
              t.find(".posCustomW").val(u || ""),
              t.find(".posCustomH").val(h || ""),
              t.find(".inline-image").toggle("image" == l),
              t.find(".inline-video").toggle("video" == l || "webpage" == l),
              t.find(".mediaTitle").val(n ? n[n.type].title : ""),
              t
                .find('[value="opt-maximize"]')
                .prop("checked", !!n && n[n.type].activateFullScreen),
              t.find("textarea.alt-text").val(n ? n[n.type].altText : ""),
              t.find(".mediaUnloadStrategy").toggle("webpage" == l),
              t
                .find(".navigateOutUnload")
                .prop(
                  "checked",
                  !e.media ||
                    !e.media[e.media.type] ||
                    void 0 === e.media[e.media.type].unload ||
                    e.media[e.media.type].unload
                ),
              "webpage" == l)
            ) {
              var g,
                b = "https:" == location.protocol;
              (g = n[n.type].url
                ? n[n.type].url.match(/https:\/\//)
                : $(n[n.type].frameTag)
                    .attr("src")
                    .match(/https:\/\//)),
                t
                  .find(".embedProtocol")
                  .find("label")
                  .toggleClass("disabled", b),
                t.find(".embedProtocolSecure").prop("checked", g);
            }
            t.find(".embedProtocol").toggle("webpage" == l),
              t.show(),
              t.find(".mediaURL").focus();
          }),
          (this.checkError = function (e) {
            if (
              (t.find(".mediaURLError, .mediaThumbURLError").fadeOut(),
              !1 === d.fromService && "image" == l)
            ) {
              var n = new a(),
                o = e.html();
              e.html(i18n.commonMedia.mediaConfigure.lblURLCheck);
              var r = null;
              if ("shortlist" == app.appCfg.mediaPickerConfigureForceMode) {
                var s = i.prependURLHTTP(t.find(".mediaURL").val().trim()),
                  p = i.prependURLHTTP(t.find(".mediaThumbURL").val().trim());
                (r = new Image()),
                  (r.src = s),
                  (r.onload = function () {
                    var i = new Image();
                    (i.src = p),
                      (i.onload = function () {
                        e.html(o), n.resolve(!1);
                      }),
                      (i.onerror = function () {
                        p && t.find(".mediaThumbURLError").fadeIn(),
                          e.html(o),
                          n.resolve(!0);
                      });
                  }),
                  (r.onerror = function () {
                    t.find(".mediaURLError").fadeIn();
                    var i = new Image();
                    (i.src = p),
                      (i.onload = function () {
                        e.html(o), n.resolve(!0);
                      }),
                      (i.onerror = function () {
                        t.find(".mediaThumbURLError").fadeIn(),
                          e.html(o),
                          n.resolve(!0);
                      });
                  });
              } else
                (r = new Image()),
                  (r.src = i.prependURLHTTP(t.find(".mediaURL").val().trim())),
                  (r.onload = function () {
                    e.html(o), n.resolve(!1);
                  }),
                  (r.onerror = function () {
                    t.find(".mediaURLError").fadeIn(), e.html(o), n.resolve(!0);
                  });
              return n;
            }
            return !1;
          }),
          (this.getData = function () {
            var e = t.find(".media-configure-position.selected").data("val"),
              a = t.find("textarea.alt-text").val() || "",
              r = {
                url: t.find(".mediaURL").val().trim(),
                type: l,
                altText: a.replace(/[<>'']/g, ""),
              };
            if (
              (this.imageSizes && n.mixin(r, { sizes: this.imageSizes }),
              "inlineText" == o.mode
                ? "image" == l
                  ? n.mixin(r, {
                      title: t.find(".mediaTitle").val(),
                      width: t.find(".imgActualWidth").val(),
                      height: t.find(".imgActualHeight").val(),
                      type: l,
                      activateFullScreen: t
                        .find('[value="opt-maximize"]')
                        .prop("checked"),
                    })
                  : (n.mixin(r, { display: e }),
                    "custom" == e &&
                      n.mixin(r, {
                        width: t.find(".inline-video .posCustomW").val(),
                        height: t.find(".inline-video .posCustomH").val(),
                      }))
                : "shortlist" == app.appCfg.mediaPickerConfigureForceMode
                ? n.mixin(r, { thumb_url: t.find(".mediaThumbURL").val() })
                : (n.mixin(r, { display: e }),
                  "custom" == e &&
                    n.mixin(r, {
                      width: t.find(".position-video .posCustomW").val(),
                      height: t.find(".position-video .posCustomH").val(),
                    })),
              "webpage" == l &&
                (r.unload = t.find(".navigateOutUnload").prop("checked")),
              "webpage" == l && s.webpage.frameTag)
            ) {
              var d = r.url,
                p = $(d);
              t.find(".embedProtocolSecure").prop("checked")
                ? p.attr("src", i.convertURLHTTPS(p.attr("src")))
                : p.attr("src", i.convertURLHTTP(p.attr("src"))),
                (r.frameTag = p
                  .prop("outerHTML")
                  .replace(/ xmlns="[^"]*"/, "")),
                (r.url = ""),
                (r.ts = new Date().getTime());
            } else
              "webpage" == l
                ? t.find(".embedProtocolSecure").prop("checked")
                  ? (r.url = i.convertURLHTTPS(r.url))
                  : (r.url = i.convertURLHTTP(r.url))
                : ((r.url = i.prependURLHTTP(r.url)),
                  r.thumb_url && (r.thumb_url = i.prependURLHTTP(r.thumb_url)));
            return r;
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/media/image/Selector",
    [
      "lib-build/tpl!./Selector",
      "lib-build/css!./Selector",
      "./ViewHome",
      "./ViewUpload",
      "./ViewFlickr",
      "./ViewPicasa",
      "../ViewPicker",
      "../ViewConfigure",
    ],
    function (t, e, i, n, a, o, r, s) {
      return function (e, l, d, p) {
        function c(t, i, n) {
          v[t] &&
            ((i = i || {}),
            (i.mode = i.mode || b),
            (b = i.mode),
            "home" == t ? (g = !1) : "configure" != t && (m = t),
            n || f.push({ name: u, params: h }),
            (u = t),
            (h = i),
            p.toggle("home" != u),
            "home" != t &&
              (v.home.updateParams(i),
              p.off("click").click(function () {
                var t = f.pop() || { name: "home" };
                c(t.name || "home", t.params, !0);
              })),
            e.find(".selectorView").hide(),
            (h &&
              h.fromService &&
              app.appCfg.mediaPickerSkipConfigure &&
              "showURL" != h.mode) ||
              v[t].present(i),
            "shortlist" == app.appCfg.mediaPickerConfigureForceMode &&
              ("picker" == t && "import" == b
                ? $(".opt-select-all-container").show()
                : $(".opt-select-all-container").hide(),
              e
                .parents(".modal-content")
                .find(".modal-footer .btnSubmit")
                .toggle("configure" == t || "import" == b)),
            d && d(b));
        }
        e.append(
          t({
            lblStep1: i18n.commonMedia.imageSelector.lblStep1,
            lblStep2: i18n.commonMedia.imageSelector.lblStep2,
            lblStep3: i18n.commonMedia.imageSelector.lblStep3,
          })
        );
        var u = null,
          h = null,
          f = null,
          m = null,
          g = !1,
          b = null,
          v = {
            home: new i(e.find(".viewHomeContainer"), c),
            upload: new n(e.find(".viewUploadContainer"), c),
            flickr: new a(e.find(".viewFlickrContainer"), c),
            picasa: new o(e.find(".viewPicasaContainer"), c),
            picker: new r(e.find(".mediaSelectorPickerContainer"), c, d),
            configure: new s(
              e.find(".mediaSelectorConfigureContainer"),
              l.configure,
              c
            ),
          };
        (this.present = function (t) {
          (f = []),
            (u = null),
            (h = null),
            (b = t.mode),
            v.home.updateParams({}),
            "edit" == t.mode && t.media && "image" == t.media.type
              ? c("configure", { mode: t.mode, media: t.media })
              : t.keepLastDataSource && g && null != m
              ? ((t.isReturning = !0), c(m, t))
              : c("home", t);
        }),
          (this.checkError = function (t) {
            var i = !1;
            return (
              (i =
                "configure" == u
                  ? (!h.fromService || !app.appCfg.mediaPickerSkipConfigure) &&
                    v[u].checkError(t)
                  : "import" != b || v[u].checkError(t)),
              e.toggleClass("error", i),
              (g = !i),
              i
            );
          }),
          (this.getData = function () {
            return "configure" == u
              ? h.fromService && app.appCfg.mediaPickerSkipConfigure
                ? ((h.media.url = h.media.pic_url), h.media)
                : v[u].getData()
              : "picker" == u && "import" == b
              ? v[u].getData()
              : null;
          }),
          (this.activate = function () {
            p.toggle("home" != u),
              "home" != u &&
                p.off("click").click(function () {
                  var t = f.pop() || { name: "home" };
                  c(t.name || "home", t.params, !0);
                });
          }),
          (this.deactivate = function () {
            p.hide().off("click");
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/video/Selector",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="videoSelector">\n\t<div class="selectorView viewHomeContainer"></div>\n\t<div class="selectorView viewYoutubeContainer"></div>\n\t<div class="selectorView viewVimeoContainer"></div>\n\t<div class="selectorView viewOtherContainer"></div>\n\t<div class="selectorView mediaSelectorPickerContainer"></div>\n\t<div class="selectorView mediaSelectorConfigureContainer"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/video/Selector",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/video/ViewHome",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="videoSelectorHome">\n\t<table class="videoSelectorTable">\n\t\t<tr>\n\t\t\t<td class="btn-container btn-select-youtube">\n\t\t\t\t<span class="fa fa-youtube"></span>\n\t\t\t\t<span class="title">YouTube</span>\n\t\t\t</td>\n\t\t\t<td class="btn-container btn-select-vimeo">\n\t\t\t\t<span class="fa fa-vimeo"></span>\n\t\t\t\t<span class="title">Vimeo</span>\n\t\t\t</td>\n\t\t\t<td class="btn-container btn-select-other">\n\t\t\t\t<span class="fa fa-link"></span>\n\t\t\t\t<span class="title">' +
            (null == (__t = lblLink) ? "" : __t) +
            '</span>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n\t<div class="footnote">\n\t\t<span>' +
            (null == (__t = thirdPartyTerms) ? "" : __t) +
            '</span>\n\t\t<a href="' +
            (null == (__t = youtubeTermsLink) ? "" : __t) +
            '" target="_blank" class="link">YouTube</a>,\n\t\t<a href="' +
            (null == (__t = vimeoTermsLink) ? "" : __t) +
            '" target="_blank" class="link">Vimeo</a>\n\t</div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/video/ViewHome",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/video/ViewHome",
    ["lib-build/tpl!./ViewHome", "lib-build/css!./ViewHome"],
    function (t) {
      return function (e, i) {
        e.append(
          t({
            lblLink: i18n.commonMedia.mediaSelector.lblLink,
            lblOther: i18n.commonMedia.videoSelectorHome.other,
            thirdPartyTerms: i18n.commonMedia.mediaSelector.thirdPartyTerms,
            youtubeTermsLink: app.cfg.YOUTUBE_TERMS_LINK || "",
            vimeoTermsLink: app.cfg.VIMEO_TERMS_LINK || "",
          })
        ),
          (function () {
            e.find(".btn-select-youtube").click(function () {
              i("youtube");
            }),
              e.find(".btn-select-vimeo").click(function () {
                i("vimeo");
              }),
              e.find(".btn-select-other").click(function () {
                i("other");
              });
          })(),
          (this.present = function () {
            e.show();
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/video/ViewVideoCommon",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="videoSelectorView">\n\t<form class="form-inline" role="form" onsubmit="return false;">\n\t\t<div class="form-group">\n\t\t\t<span class="icon fa fa-' +
            (null == (__t = faIcon) ? "" : __t) +
            '"></span>\n\t\t\t<span class="title">' +
            (null == (__t = serviceName) ? "" : __t) +
            '</span>\n\t\t\t<input type="text" class="form-control url" value="" placeholder="' +
            (null == (__t = fieldUrl) ? "" : __t) +
            '"/>\n\t\t</div>\n\t\t<button class="btn btn-primary btn-check">' +
            (null == (__t = btnCheck) ? "" : __t) +
            '</button>\n\t\t<span class="loadingMsg"></span>\n\t</form>\n\t<div class="errorMsg"></div>\n\t<div class="result-container">\n\t\t<div class="video-detail-container"></div>\n\t</div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/video/ViewVideoCommon",
    [],
    function () {}
  ),
  define(
    "storymaps/common/utils/connector/Youtube",
    ["dojo/Deferred"],
    function (t) {
      return function () {
        function e(e) {
          var i = new t(),
            n =
              "https://www.googleapis.com/youtube/v3/videos?part=snippet&id=" +
              e +
              "&key=" +
              app.cfg.YOUTUBE_API_KEY;
          return (
            $.ajax({ dataType: "json", url: n, timeout: 4e3 }).then(
              function (t) {
                t && t.items && t.items.length
                  ? i.resolve(t.items[0].snippet)
                  : i.reject();
              },
              function (t) {
                i.reject(t);
              }
            ),
            i
          );
        }
        function i(t) {
          var e =
            /(youtube\.com\/(watch\?v\=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/.exec(
              t
            );
          return e && 4 == e.length ? e[3] : null;
        }
        function n(t) {
          return "//www.youtube.com/embed/" + t + "?wmode=opaque&rel=0";
        }
        this.checkVideoUrl = function (a, o) {
          var r = new t(),
            s = i(a);
          return (
            s
              ? o
                ? e(s).then(
                    function (t) {
                      t
                        ? r.resolve({
                            title: t.title,
                            description: t.description,
                            user: t.channelTitle,
                            thumbUrl: t.thumbnails.default.url,
                            embedUrl: n(s),
                            viewCount: null,
                            likeCount: null,
                          })
                        : r.reject();
                    },
                    function (t) {
                      t && 403 == t.status
                        ? r.reject("NOT_AUTHORIZED")
                        : r.reject("NOT_FOUND");
                    }
                  )
                : r.resolve({
                    title: "",
                    description: "",
                    user: "",
                    thumbUrl: "",
                    embedUrl: n(s),
                    viewCount: null,
                    likeCount: null,
                    fetchVideoSnippet: !1,
                  })
              : r.reject("INVALID_URL"),
            r
          );
        };
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/video/ViewVideoCommonDetail",
    [],
    function () {
      return function (obj) {
        function print() {
          __p += __j.call(arguments, "");
        }
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape,
          __j = Array.prototype.join;
        with (obj)
          (__p += '<div class="video-detail">\n\t'),
            "undefined" == typeof fetchVideoSnippet || fetchVideoSnippet
              ? (__p +=
                  '\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td><img src="' +
                  (null == (__t = thumbUrl) ? "" : __t) +
                  '" /></td>\n\t\t\t\t<td style="padding-left: 10px">\n\t\t\t\t\t<strong>\n\t\t\t\t\t\t' +
                  (null == (__t = title) ? "" : __t) +
                  '\n\t\t\t\t\t</strong>\n\t\t\t\t\t<div style="max-height: 100px; overflow-y: auto; word-wrap: break-word; word-break: break-word;">\n\t\t\t\t\t\t' +
                  (null == (__t = description) ? "" : __t) +
                  "\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t")
              : (__p +=
                  '\n\t\t<div style="font-style: italic; margin: 15px 0 25px 0;">' +
                  (null == (__t = videoNotChecked) ? "" : __t) +
                  "</div>\n\t"),
            (__p +=
              '\n\t<div style="text-align: center; margin-top: 10px;">\n\t\t<button class="btn btn-primary btn-select-video">' +
              (null == (__t = btnSelect) ? "" : __t) +
              "</button>\n\t</div>\n</div>\n");
        return __p;
      };
    }
  ),
  define(
    "storymaps/common/builder/media/video/ViewYoutube",
    [
      "lib-build/tpl!./ViewVideoCommon",
      "lib-build/css!./ViewVideoCommon",
      "storymaps/common/utils/connector/Youtube",
      "lib-build/tpl!./ViewVideoCommonDetail",
    ],
    function (t, e, i, n) {
      return function (e, a) {
        function o() {
          var t = e.find(".url").val(),
            i = !(app.isPortal && app.cfg.YOUTUBE_DISABLE_ON_PORTAL);
          r(),
            s.checkVideoUrl(t, i).then(
              function (t) {
                e
                  .find(".loadingMsg")
                  .html('<span class="glyphicon glyphicon-ok"></span>'),
                  e
                    .find(".video-detail-container")
                    .fadeIn()
                    .html(
                      n({
                        fetchVideoSnippet: i,
                        thumbUrl: t.thumbUrl,
                        title: t.title,
                        description: t.description,
                        btnSelect: i18n.commonMedia.videoSelectorCommon.select,
                        videoNotChecked:
                          i18n.commonMedia.videoSelectorYoutube.videoNotChecked,
                      })
                    ),
                  e.find(".btn-select-video").click(function () {
                    a("configure", {
                      mode: "add",
                      fromService: !0,
                      media: {
                        name: t.title || "",
                        description: t.description || "",
                        pic_url: t.embedUrl,
                        thumb_url: t.thumbUrl,
                        lat: "",
                        lng: "",
                        is_video: !0,
                      },
                    });
                  });
              },
              function (t) {
                e.find(".loadingMsg").html(""),
                  "NOT_AUTHORIZED" == t
                    ? e
                        .find(".errorMsg")
                        .show()
                        .html(
                          i18n.commonMedia.videoSelectorYoutube.checkFailedAPI
                        )
                    : e
                        .find(".errorMsg")
                        .show()
                        .html(i18n.commonMedia.videoSelectorCommon.notFound);
              }
            );
        }
        function r() {
          e.find(".loadingMsg").html('<span class="smallLoader"></span>'),
            e.find(".errorMsg").hide(),
            e.find(".btn-check").attr("disabled", "disabled");
        }
        var s = new i();
        e.append(
          t({
            faIcon: "youtube",
            serviceName: "YouTube",
            fieldUrl: i18n.commonMedia.videoSelectorYoutube.url + "...",
            btnCheck: i18n.commonMedia.videoSelectorCommon.check,
          })
        ),
          (function () {
            e.find(".btn-check").click(o),
              e
                .find(".url")
                .bind("input propertychange", function () {
                  $(this).val()
                    ? e.find(".btn-check").removeAttr("disabled")
                    : e.find(".btn-check").attr("disabled", "disabled"),
                    e.find(".loadingMsg").html(""),
                    e.find(".errorMsg").hide(),
                    e.find(".video-detail-container").fadeOut().empty();
                })
                .keyup(function (t) {
                  13 == t.keyCode && $(this).val() && o();
                });
          })(),
          (this.present = function (t) {
            (t && t.isReturning) ||
              e.find(".url").val() ||
              e.find(".btn-check").attr("disabled", "disabled"),
              e.show();
            var i = e.find(".videoSelectorView");
            if (i.width()) {
              var n = i.find(".url");
              n.css(
                "width",
                i.width() -
                  (n.position().left - i.position().left) -
                  i.find(".btn-check").outerWidth() -
                  30
              ).focus();
            }
          });
      };
    }
  ),
  define(
    "storymaps/common/utils/connector/Vimeo",
    ["dojo/Deferred"],
    function (t) {
      return function () {
        function e(e) {
          var i = new t(),
            n = "//vimeo.com/api/v2/video/" + e + ".json";
          return (
            $.ajax({
              type: "GET",
              url: n,
              jsonp: "callback",
              dataType: "jsonp",
              timeout: 4e3,
            }).then(
              function (t) {
                t && t[0] ? i.resolve(t[0]) : i.reject();
              },
              function () {
                i.reject();
              }
            ),
            i
          );
        }
        function i(t) {
          return "//player.vimeo.com/video/" + t + "?transparent=0";
        }
        this.checkVideoUrl = function (n) {
          var a = new t(),
            o =
              /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/.exec(
                n
              );
          if (o && 6 == o.length) {
            var r = o[5];
            e(r).then(
              function (t) {
                t
                  ? a.resolve({
                      title: t.title,
                      description: t.description,
                      user: t.user_name,
                      thumbUrl: t.thumbnail_small,
                      embedUrl: i(r),
                      viewCount: t.stats_number_of_plays,
                      likeCount: t.stats_number_of_likes,
                    })
                  : a.reject();
              },
              function () {
                a.reject("NOT_FOUND");
              }
            );
          } else a.reject("INVALID_URL");
          return a;
        };
      };
    }
  ),
  define(
    "storymaps/common/builder/media/video/ViewVimeo",
    [
      "lib-build/tpl!./ViewVideoCommon",
      "lib-build/css!./ViewVideoCommon",
      "storymaps/common/utils/connector/Vimeo",
      "lib-build/tpl!./ViewVideoCommonDetail",
    ],
    function (t, e, i, n) {
      return function (e, a) {
        function o() {
          var t = e.find(".url").val();
          r(),
            s.checkVideoUrl(t).then(
              function (t) {
                e
                  .find(".loadingMsg")
                  .html('<span class="glyphicon glyphicon-ok"></span>'),
                  e
                    .find(".video-detail-container")
                    .fadeIn()
                    .html(
                      n({
                        thumbUrl: t.thumbUrl,
                        title: t.title,
                        description: t.description,
                        btnSelect: i18n.commonMedia.videoSelectorCommon.select,
                      })
                    ),
                  e.find(".btn-select-video").click(function () {
                    a("configure", {
                      mode: "add",
                      fromService: !0,
                      media: {
                        name: t.title || "",
                        description: t.description || "",
                        pic_url: t.embedUrl,
                        thumb_url: t.thumbUrl,
                        lat: "",
                        lng: "",
                        is_video: !0,
                      },
                    });
                  });
              },
              function () {
                e.find(".loadingMsg").html(""),
                  e
                    .find(".errorMsg")
                    .show()
                    .html(i18n.commonMedia.videoSelectorCommon.notFound);
              }
            );
        }
        function r() {
          e.find(".loadingMsg").html('<span class="smallLoader"></span>'),
            e.find(".errorMsg").hide(),
            e.find(".btn-check").attr("disabled", "disabled");
        }
        var s = new i();
        e.append(
          t({
            serviceName: "vimeo",
            faIcon: "vimeo",
            fieldUrl: i18n.commonMedia.videoSelectorVimeo.url + "...",
            btnCheck: i18n.commonMedia.videoSelectorCommon.check,
          })
        ),
          (function () {
            e.find(".btn-check").click(o),
              e
                .find(".url")
                .bind("input propertychange", function () {
                  $(this).val()
                    ? e.find(".btn-check").removeAttr("disabled")
                    : e.find(".btn-check").attr("disabled", "disabled"),
                    e.find(".loadingMsg").html(""),
                    e.find(".errorMsg").hide(),
                    e.find(".video-detail-container").fadeOut().empty();
                })
                .keyup(function (t) {
                  13 == t.keyCode && $(this).val() && o();
                });
          })(),
          (this.present = function (t) {
            (t && t.isReturning) ||
              e.find(".url").val() ||
              e.find(".btn-check").attr("disabled", "disabled"),
              e.show();
            var i = e.find(".videoSelectorView");
            if (i.width()) {
              var n = i.find(".url");
              n.css(
                "width",
                i.width() -
                  (n.position().left - i.position().left) -
                  i.find(".btn-check").outerWidth() -
                  30
              ).focus();
            }
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/video/ViewOther",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="videoSelectorOther">\n\t<div class="explain">' +
            (null == (__t = explain) ? "" : __t) +
            "</div>\n</div>\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/video/ViewOther",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/video/ViewOther",
    ["lib-build/tpl!./ViewOther", "lib-build/css!./ViewOther"],
    function (t) {
      return function (e) {
        e.append(
          t({
            explain:
              i18n.commonMedia.videoSelectorOther.explain1 +
              " " +
              i18n.commonMedia.videoSelectorOther.explain2.replace(
                "%WEBPAGE%",
                "<strong>" +
                  i18n.commonMedia.videoSelectorOther.webpage +
                  "</strong>"
              ) +
              '<div style="width: 100%; text-align: center; margin: 5px 0 15px 0"><div class="media-video-help-embed-dailymotion"></div></div>' +
              i18n.commonMedia.videoSelectorOther.explain3
                .replace(
                  "%WEBPAGE%",
                  "<strong>" +
                    i18n.commonMedia.videoSelectorOther.webpage +
                    "</strong>"
                )
                .replace(
                  "%EXAMPLE%",
                  '<a href="https://developerscorner.storymaps.arcgis.com/a-simple-way-to-host-videos-for-story-maps-2b73874289e4/" target="_blank">Video.js</a>'
                ),
          })
        ),
          (this.present = function () {
            e.show();
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/media/video/Selector",
    [
      "lib-build/tpl!./Selector",
      "lib-build/css!./Selector",
      "./ViewHome",
      "./ViewYoutube",
      "./ViewVimeo",
      "./ViewOther",
      "../ViewConfigure",
    ],
    function (t, e, i, n, a, o, r) {
      return function (e, s, l, d) {
        function p(t, i, n) {
          g[t] &&
            ("home" == t ? (m = !1) : "configure" != t && (f = t),
            n || h.push({ name: c, params: u }),
            (c = t),
            (u = i),
            d.toggle("home" != c),
            "home" != t &&
              d.off("click").click(function () {
                var t = h.pop() || { name: "home" };
                p(t.name || "home", t.params, !0);
              }),
            e.find(".selectorView").hide(),
            g[t].present(i),
            l && l());
        }
        e.append(t({}));
        var c = null,
          u = null,
          h = null,
          f = null,
          m = !1,
          g = {
            home: new i(e.find(".viewHomeContainer"), p),
            youtube: new n(e.find(".viewYoutubeContainer"), p),
            vimeo: new a(e.find(".viewVimeoContainer"), p),
            other: new o(e.find(".viewOtherContainer"), p),
            configure: new r(
              e.find(".mediaSelectorConfigureContainer"),
              s.configure,
              p
            ),
          };
        (this.present = function (t) {
          (h = []),
            (c = null),
            (u = null),
            "edit" == t.mode && t.media && "video" == t.media.type
              ? p("configure", { mode: t.mode, media: t.media })
              : t.keepLastDataSource && m && null != f
              ? p(f, { isReturning: !0 })
              : p("home");
        }),
          (this.checkError = function () {
            var t = !1;
            return (
              (t = "configure" != c || g[c].checkError()),
              e.toggleClass("error", t),
              (m = !t),
              t
            );
          }),
          (this.getData = function () {
            return "configure" == c ? g[c].getData() : null;
          }),
          (this.activate = function () {
            d.toggle("home" != c),
              "home" != c &&
                d.off("click").click(function () {
                  var t = h.pop() || { name: "home" };
                  p(t.name || "home", t.params, !0);
                });
          }),
          (this.deactivate = function () {
            d.hide().off("click");
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/webpage/Selector",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="videoSelector">\n\t<div class="selectorView viewHomeContainer"></div>\n\t<div class="selectorView mediaSelectorConfigureContainer"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/webpage/Selector",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/common/builder/media/webpage/ViewHome",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="webpageSelectorHome">\n\t<div class="form-group">\n\t\t<label>' +
            (null == (__t = lblUrl) ? "" : __t) +
            '</label>\n\t\t<input type="text" class="form-control url" placeholder="' +
            (null == (__t = phURL) ? "" : __t) +
            '"/>\n\t\t<button class="btn btn-primary btn-cfg btn-cfg-url">' +
            (null == (__t = btnConfigure) ? "" : __t) +
            '</button>\n\t</div>\n\n\t<div class="separator">\n\t\t<span class="solidline"></span>\n\t\t' +
            (null == (__t = lblOR) ? "" : __t) +
            '\n\t\t<span class="solidline"></span>\n\t</div>\n\n\t<div class="form-group">\n\t\t<label>' +
            (null == (__t = lblEmbed) ? "" : __t) +
            '</label>\n\t\t<textarea class="form-control textarea" placeholder="' +
            (null == (__t = phEmbed) ? "" : __t) +
            '"></textarea>\n\t\t<button class="btn btn-primary btn-cfg btn-cfg-embed">' +
            (null == (__t = btnConfigure) ? "" : __t) +
            '</button>\n\t</div>\n\n\t<div class="form-note">\n\t\t<label>' +
            (null == (__t = lblMustUseHTTPS) ? "" : __t) +
            '</label>\n\t</div>\n\n\t<div class="error"></div>\n</div>\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/common/builder/media/webpage/ViewHome",
    [],
    function () {}
  ),
  define(
    "storymaps/common/builder/media/webpage/ViewHome",
    [
      "lib-build/tpl!./ViewHome",
      "lib-build/css!./ViewHome",
      "storymaps/common/utils/CommonHelper",
    ],
    function (t, e, i) {
      return function (e, n) {
        function a() {
          var t = o(),
            i = r();
          return (
            e
              .find(".error")
              .toggle(t && i)
              .html(i18n.commonMedia.webpageSelectorHome.lblError1),
            (t && i) || (!t && !i)
          );
        }
        function o() {
          return !!e.find(".url").val();
        }
        function r() {
          return !!e.find(".textarea").val();
        }
        function s() {
          if (a()) return null;
          var t = e.find(".url").val(),
            n = e.find(".textarea").val();
          if (t) t = i.convertURLHTTPS(t);
          else {
            var o = $(n.trim());
            o.attr("src", i.convertURLHTTPS(o.attr("src"))),
              (n = o.prop("outerHTML").replace(/ xmlns="[^"]*"/, ""));
          }
          return d
            ? ((d.url = t), (d.frameTag = n), d)
            : { url: t, frameTag: n };
        }
        function l() {
          e.find(".btn-cfg-url").attr("disabled", !o() || r()),
            e.find(".btn-cfg-embed").attr("disabled", !r() || o()),
            a();
        }
        var d = null;
        e.append(
          t({
            lblUrl: i18n.commonMedia.webpageSelectorHome.lblUrl,
            lblEmbed: i18n.commonMedia.webpageSelectorHome.lblEmbed,
            lblMustUseHTTPS:
              i18n.commonMedia.webpageSelectorHome.lblMustUseHTTPS,
            phURL: "https://www.example.com",
            phEmbed:
              "<iframe width=&quot;100%&quot; height=&quot;600px&quot; src=&quot;https://www.example.com&quot;></iframe>",
            lblOR: i18n.commonMedia.webpageSelectorHome.lblOR,
            btnConfigure: i18n.commonMedia.webpageSelectorHome.configure,
          })
        ),
          (function () {
            e.find(".url").bind("input propertychange", l),
              e.find(".textarea").bind("input propertychange", l),
              e.find(".btn-cfg-url").click(function () {
                n("configure", { media: { type: "webpage", webpage: s() } });
              }),
              e.find(".btn-cfg-embed").click(function () {
                var t = e.find(".textarea").val().trim();
                if (
                  !t.match(/^<iframe.*<\/iframe>$/) ||
                  t.match(/<iframe/g).length > 2
                )
                  return void e
                    .find(".error")
                    .show()
                    .html(
                      i18n.commonMedia.webpageSelectorHome.lblError2.replace(
                        "%IFRAMETAG%",
                        '"&lt;iframe&gt;"'
                      )
                    );
                n("configure", { media: { type: "webpage", webpage: s() } });
              });
          })(),
          (this.present = function (t) {
            e.show(),
              t && "edit" == t.mode && t.media && "webpage" == t.media.type
                ? (e.find(".url").val(t.media.webpage.url || ""),
                  e.find(".textarea").val(t.media.webpage.frameTag || ""),
                  (d = t.media.webpage))
                : (e.find(".url").val(""),
                  e.find(".textarea").val(""),
                  (d = null)),
              l(),
              this.postDisplay();
          }),
          (this.postDisplay = function () {
            e.find(".webpageSelectorHome").width() &&
              e
                .find(".url, .textarea")
                .css(
                  "width",
                  e.find(".webpageSelectorHome").width() -
                    5 -
                    e.find(".btn-cfg").outerWidth()
                ),
              e.find(e.find(".textarea").val() ? ".textarea" : ".url").focus();
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/media/webpage/Selector",
    [
      "lib-build/tpl!./Selector",
      "lib-build/css!./Selector",
      "./ViewHome",
      "../ViewConfigure",
    ],
    function (t, e, i, n) {
      return function (e, a, o, r) {
        function s(t, i, n) {
          h[t] &&
            ("home" == t ? (u = !1) : "configure" != t && (c = t),
            n || p.push({ name: l, params: d }),
            (l = t),
            (d = i),
            r.toggle("home" != l),
            "home" != t &&
              r.off("click").click(function () {
                var t = p.pop() || { name: "home" };
                s(t.name || "home", t.params, !0);
              }),
            e.find(".selectorView").hide(),
            h[t].present(i),
            o && o());
        }
        e.append(t({}));
        var l = null,
          d = null,
          p = null,
          c = null,
          u = !1,
          h = {
            home: new i(e.find(".viewHomeContainer"), s),
            configure: new n(
              e.find(".mediaSelectorConfigureContainer"),
              a.configure,
              s
            ),
          };
        (this.present = function (t) {
          (p = []),
            (l = null),
            (d = null),
            "edit" == t.mode && t.media && "webpage" == t.media.type
              ? (s("home", { mode: t.mode, media: t.media }),
                s("configure", { mode: t.mode, media: t.media }))
              : t.keepLastDataSource && u && null != c
              ? s(c, { isReturning: !0 })
              : s("home");
        }),
          (this.checkError = function () {
            var t = !1;
            return (
              (t = "configure" != l || h[l].checkError()),
              e.toggleClass("error", t),
              (u = !t),
              t
            );
          }),
          (this.getData = function () {
            return "configure" == l ? h[l].getData() : null;
          }),
          (this.activate = function () {
            r.toggle("home" != l),
              "home" != l
                ? r.off("click").click(function () {
                    var t = p.pop() || { name: "home" };
                    s(t.name || "home", t.params, !0);
                  })
                : h[l].postDisplay();
          }),
          (this.deactivate = function () {
            r.hide().off("click");
          });
      };
    }
  ),
  define(
    "storymaps/common/builder/media/MediaSelector",
    [
      "lib-build/tpl!./MediaSelector",
      "lib-build/css!./MediaSelector",
      "./map/WebMapSelector",
      "./image/Selector",
      "./video/Selector",
      "./webpage/Selector",
    ],
    function (t, e, i, n, a, o) {
      return function (e, r, s, l, d) {
        function p() {
          e.find(".media-type")
            .eq(m ? 0 : 1)
            .click()
            .focus()
            .click();
        }
        function c(t) {
          var i = $.inArray(t.media.type, [
            "webmap",
            "image",
            "video",
            "frame",
          ]);
          e.find(".media-type").eq(i).click().focus().click();
        }
        e.append(
          t({
            hasMap: !!r,
            lblMap: i18n.commonMedia.mediaSelector.lblMap,
            lblImage: i18n.commonMedia.mediaSelector.lblImage,
            lblVideo: i18n.commonMedia.mediaSelector.lblVideo,
            lblExternal: i18n.commonMedia.mediaSelector.lblExternal,
            lblSelect: s
              ? i18n.commonMedia.mediaSelector.lblSelect1
              : i18n.commonMedia.mediaSelector.lblSelect2,
            notImplemented: i18n.commonMedia.mediaSelector.notImplemented,
            hasVideo: !app.appCfg.mediaPickerDisableVideo,
            hasWebPage: !app.appCfg.mediaPickerDisableWebPage,
          })
        );
        var u = this,
          h = ["webmap", "image", "video", "webpage"],
          f = null,
          m = null,
          g = null,
          b = new n(
            e.find(".imageMediaContainer"),
            { configure: { mode: r ? "mainMedia" : "inlineText" } },
            l,
            d
          ),
          v = new a(
            e.find(".videoMediaContainer"),
            { configure: { mode: r ? "mainMedia" : "inlineText" } },
            l,
            d
          ),
          y = new o(
            e.find(".webpageMediaContainer"),
            { configure: { mode: r ? "mainMedia" : "inlineText" } },
            l,
            d
          );
        r &&
          (m = new i(
            e.find(".mapMediaContainer"),
            r.onOpenConfigure,
            r.onCloseConfigure,
            l
          )),
          e.find(".mediaSelector").toggleClass("smallSize", s),
          (function () {
            e.find(".media-type").click(function () {
              (f = h[$(this).parents(".media-type-wrapper").index()]),
                e.find(".media-type-wrapper").removeClass("current"),
                $(this).parents(".media-type-wrapper").addClass("current"),
                e
                  .find(".mainMediaTypeContainer")
                  .hide()
                  .removeClass("current")
                  .eq($(this).parents(".media-type-wrapper").index())
                  .addClass("current")
                  .show(),
                u.activate(),
                l && l(f);
            });
          })(),
          (this.present = function (t) {
            m && (m.present(t), m.activate()),
              b.present(t),
              v.present(t),
              y.present(t),
              (g = t.mode),
              e
                .find(".lblSelect, .media-types")
                .toggle(
                  !(
                    !r &&
                    app.appCfg.mediaPickerDisableVideo &&
                    app.appCfg.mediaPickerDisableWebPage
                  )
                ),
              "add" == t.mode || "import" == t.mode ? p() : c(t);
          }),
          (this.getData = function () {
            var t = e.find(".mainMediaTypeContainer.current").index();
            return 0 === t
              ? { media: { type: "webmap", webmap: m.getData() } }
              : 1 == t && "import" == g
              ? b.getData()
              : 1 == t
              ? { media: { type: "image", image: b.getData() } }
              : 2 == t
              ? { media: { type: "video", video: v.getData() } }
              : 3 == t
              ? { media: { type: "webpage", webpage: y.getData() } }
              : {};
          }),
          (this.checkError = function (t) {
            var i = e.find(".mainMediaTypeContainer.current").index();
            return 0 === i
              ? m.checkError()
              : 1 == i
              ? b.checkError(t)
              : 2 == i
              ? v.checkError()
              : 3 != i || y.checkError();
          }),
          (this.activate = function () {
            b.deactivate(),
              v.deactivate(),
              y.deactivate(),
              "webmap" == f && (m.activate(), setTimeout(m.activate, 0)),
              "image" == f
                ? b.activate()
                : "video" == f
                ? v.activate()
                : "webpage" == f && y.activate();
          }),
          (this.postDisplay = function () {
            m.postDisplay();
          });
      };
    }
  ),
  define(
    "storymaps/tpl/builder/media/Popup",
    [
      "lib-build/tpl!./Popup",
      "lib-build/css!./Popup",
      "storymaps/common/builder/media/MediaSelector",
      "dojo/Deferred",
    ],
    function (t, e, i, n) {
      return function (e) {
        function a(t) {
          t && "image" != t && (l = t),
            "none" == $(e).find(".opt-select-all-container").css("display") &&
              "none" ==
                $(e).find(".mediaSelectorConfigureContainer").css("display") &&
              (l = "add");
          var i = !1,
            n = d.getData();
          n &&
          n.media &&
          n.media.image &&
          n.media.image.url &&
          n.media.image.thumb_url
            ? (i = !0)
            : n && n.length && (i = !0),
            e.find(".btnSubmit").attr("disabled", !i),
            i && "add" == l && o();
        }
        function o() {
          var t = d.checkError(e.find(".btnSubmit")),
            i = function () {
              var t = d.getData();
              "import" == l ? s.resolve(t) : s.resolve(t.media[t.media.type]),
                e.modal("toggle");
            };
          t instanceof n
            ? t.then(function (t) {
                t || i();
              })
            : t || i();
        }
        e.append(
          t({
            lblTitle: "",
            btnCancel: i18n.commonCore.common.cancel,
            btnBack: i18n.commonCore.common.back,
            selectAll: i18n.builder.detailPanelBuilder.selectAll,
          })
        );
        var r = null,
          s = null,
          l = null,
          d = new i(
            e.find(".viewMediaSelectorContainer"),
            null,
            !0,
            a,
            e.find(".btn-back")
          );
        !(function () {
          e.find(".btnSubmit").click(o);
        })(),
          (this.present = function (t, i) {
            return (
              (r = t),
              (s = new n()),
              (l = r.mode),
              "import" == l
                ? (e
                    .find(".modal-title")
                    .text(i18n.builder.detailPanelBuilder.importImages),
                  e
                    .find(".btnSubmit")
                    .html(i18n.builder.detailPanelBuilder.import)
                    .show(),
                  e.find(".btnCancel").show())
                : "add" == l &&
                  (e
                    .find(".modal-title")
                    .text(i18n.builder.detailPanelBuilder.chooseImage),
                  e
                    .find(".btnSubmit")
                    .html(i18n.builder.addEditPopup.add)
                    .hide(),
                  e.find(".btnCancel").hide(),
                  e.find(".opt-select-all-container").hide()),
              d.present(
                {
                  mode: t.mode,
                  webmaps: null,
                  media: "edit" == t.mode ? t.edit.media : t.media,
                  keepLastDataSource: !0,
                },
                function () {}
              ),
              e.find(".modal-content").css("min-height", i),
              e.modal({ keyboard: !0 }),
              s
            );
          }),
          (this.initLocalization = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/addedit/Popup", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="backdrop"></div>\r\n<div class="modal-dialog">\r\n\t<div class="modal-content">\r\n\t\t<div class="modal-logo"></div>\r\n\t\t<div class="modal-header">\r\n\t\t\t<h4 class="modal-title">' +
          (null == (__t = editTab) ? "" : __t) +
          '</h4>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-body">\r\n\t\t\t\x3c!-- Title field --\x3e\r\n\t\t\t<div class="form-group titleContainer">\r\n\t\t\t\t<input type="text" class="form-control title clear" placeholder="" spellcheck="true"/>\r\n\t\t\t\t<span class="glyphicon glyphicon-remove form-control-feedback"></span>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class="tab-pane viewMediaSelectorContainer">\r\n\t\t\t\t<table class="tab-cfg">\r\n\t\t\t\t\t<tr class="tab-cfg-row ">\r\n\t\t\t\t\t\t<td class="tab-cfg-title" style="outline: none;">\r\n\t\t\t\t\t\t\t' +
          (null == (__t = themeColor) ? "" : __t) +
          '\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class="tab-cfg-btns">\r\n\t\t\t\t\t\t\t<div class="color-control">\r\n\t\t\t\t\t\t\t\t<input type="text" id="colorpicker" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr class="tab-cfg-row tab-cfg-location">\r\n\t\t\t\t\t\t<td class="tab-cfg-title" style="outline: none;">\r\n\t\t\t\t\t\t\t' +
          (null == (__t = location) ? "" : __t) +
          '\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class="tab-cfg-btns">\r\n\t\t\t\t\t\t\t<div class="regular-control" style="display: block;">\r\n\t\t\t\t\t\t\t\t<span class="btn-group">\r\n\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs btn-primary" data-value="default" style="">\r\n\t\t\t\t\t\t\t\t\t\t' +
          (null == (__t = auto) ? "" : __t) +
          '\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs" data-value="custom" data-toggle="tooltip" title="Lets you display a specific map location when this tab is selected">\r\n\t\t\t\t\t\t\t\t\t\t' +
          (null == (__t = customConfig) ? "" : __t) +
          ' &nbsp;\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-footer">\r\n\t\t\t<span class="modal-footer-left"><button class="btn btn-back btn-naked">< ' +
          (null == (__t = btnBack) ? "" : __t) +
          '</button></span>\r\n\t\t\t<span class="btnSubmitWrapper" data-toggle="tooltip"">\r\n\t\t\t\t<button class="btnSubmit btn btn-primary" ></button>\r\n\t\t\t</span>\r\n\t\t\t<button class="btnCancel btn btn-naked btn-close">' +
          (null == (__t = btnCancel) ? "" : __t) +
          '</button>\r\n\t\t\t<div class="btnSubmitTooltipContainer"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n';
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/builder/addedit/Popup",
    [],
    function () {}
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/addedit/ColorPickerStyle",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/addedit/Popup",
    [
      "lib-build/tpl!./Popup",
      "lib-build/css!./Popup",
      "lib-build/css!./ColorPickerStyle",
      "lib-build/css!lib-app/spectrum/spectrum",
      "lib-app/spectrum/spectrum",
      "../../../common/builder/media/map/MapConfigOverlay",
      "../../core/WebApplicationData",
      "esri/geometry/Extent",
      "dojo/Deferred",
      "dojo/topic",
    ],
    function (t, e, i, n, a, o, r, s, l, d) {
      return function (e, i) {
        function n() {
          p(),
            o.present("LOCATION", !1).then(function () {
              p(),
                r.setTabs(app.data.getStory()),
                e.find(".webmap-loading").hide(),
                e.find(".map-cfg").removeClass("disabled");
            });
        }
        function a() {
          b.updateShortlistExtent();
        }
        function s() {
          u();
        }
        function p() {
          e.hasClass("in")
            ? ((g = !0), e.addClass("temporaryHide"))
            : e.removeClass("temporaryHide"),
            e.modal("toggle");
        }
        function c() {
          var t = e
              .find(".title")
              .val()
              .replace(/<\/?script>/g, ""),
            i = "#" + $("#colorpicker").spectrum("get").toHex(),
            n = $(".entry.active").index();
          if (i != app.data.getStory()[n].color) {
            $.each(app.layerCurrent.graphics, function (t, e) {
              b.addMapIcon(e, i, !0);
            });
            app.map.getLayer(app.data.getShortlistLayerId()).redraw();
          }
          $('.tab-cfg-location .btn[data-value="default"]').hasClass(
            "btn-primary"
          ) && a(),
            app.data.getWebAppData().getIsExternalData()
              ? app.data.setStory(n, null, i, null, t)
              : app.data.setStory(n, t, i),
            app.data.getWebAppData().setTabs(app.data.getStory());
          var o = {
            header: app.data.getWebAppData().getThemeOptions().headerColor,
            tabText: "#d8d8d8",
            tab: "#666",
            tabTextActive: "#fff",
            tabActive: i,
            tabTextHover: "#fff",
            tabHover: "#666",
          };
          if (app.data.getWebAppData().getIsExternalData()) {
            var s = [];
            $.each(app.data.getStory(), function (t) {
              var e = !1;
              $.grep(
                app.map.getLayer(app.data.getShortlistLayerId()).graphics,
                function (i) {
                  i.attributes.tab_id == app.data.getStory()[t].id &&
                    (e || s.push(app.data.getStory()[t]), (e = !0));
                }
              );
            }),
              app.ui.navBar.init(s, n, o, r);
          } else app.ui.navBar.init(app.data.getStory(), n, o, r);
          app.map.getLayer(app.data.getShortlistLayerId()).redraw(),
            $(".num").css("background-color", i),
            $("#contentPanel").css("border-top-color", i),
            $(".detailContainer")
              .eq(n)
              .find(".detailFeatureNum")
              .css("background-color", i),
            d.publish("BUILDER_INCREMENT_COUNTER", 1),
            (app.layerCurrent.color = i),
            e.modal("hide");
        }
        function u(t) {
          m.attr("disabled", t);
        }
        e.append(
          t({
            btnCancel: i18n.commonCore.common.cancel,
            btnBack: i18n.commonCore.common.back,
            editTab: i18n.builder.addEditPopup.editTab,
            themeColor: i18n.builder.addEditPopup.themeColor,
            location: i18n.builder.addEditPopup.location,
            auto: i18n.builder.settings.auto,
            customConfig: i18n.commonWebmap.selector.customCfg,
          })
        );
        var h = null,
          f = null,
          m = e.find(".btnSubmit"),
          g = null,
          b = i;
        !(function () {
          e.find(".btnCancel").click(function () {
            e.modal("hide");
          }),
            e.on("shown.bs.modal", function () {
              s();
            }),
            $('.tab-cfg-location .btn[data-value="custom"]').click(function () {
              $('.tab-cfg-location .btn[data-value="custom"]').addClass(
                "btn-primary"
              ),
                $('.tab-cfg-location .btn[data-value="default"]').removeClass(
                  "btn-primary"
                ),
                n();
            }),
            $('.tab-cfg-location .btn[data-value="default"]').click(
              function () {
                $('.tab-cfg-location .btn[data-value="default"]').addClass(
                  "btn-primary"
                ),
                  $('.tab-cfg-location .btn[data-value="custom"]').removeClass(
                    "btn-primary"
                  );
              }
            ),
            m.click(c);
        })(),
          (this.present = function (t) {
            (h = new l()),
              (f = t),
              (app.isAddEditInProgress = !0),
              $("#colorpicker").spectrum() &&
                $("#colorpicker").spectrum("destroy"),
              $("#colorpicker").spectrum({
                color: t.entry.color,
                showPalette: !0,
                showInput: !0,
                palette: [
                  "#425dac",
                  "#b82323",
                  "#37921e",
                  "#874094",
                  "#000000",
                  "#dc6800",
                  "#dab70c",
                  "#A67455",
                ],
                preferredFormat: "hex",
                chooseText: i18n.builder.settings.choose,
                cancelText: i18n.builder.detailPanelBuilder.cancel,
              }),
              e.find(".titleContainer input").on({
                change: function () {
                  e.find(".titleContainer input").val().length
                    ? (u(!1),
                      e
                        .find(".titleContainer input")
                        .css("border-color", "#ccc"))
                    : (u(!0),
                      e
                        .find(".titleContainer input")
                        .css("border-color", "red"));
                },
              }),
              "add" == t.mode
                ? (e.find(".modal-logo").removeClass("edit"),
                  e
                    .find(".modal-title")
                    .html(i18n.builder.addEditPopup.titleAdd),
                  m.html(i18n.commonCore.common.add))
                : (e.find(".modal-logo").addClass("edit"),
                  e
                    .find(".modal-title")
                    .html(i18n.builder.addEditPopup.titleEdit),
                  m.html(i18n.commonCore.common.save)),
              e.toggleClass("isAdding", "add" == t.mode),
              e.toggleClass("isEditing", "add" != t.mode),
              u();
            var i = t.entry.title;
            return (
              e
                .find(".titleContainer")
                .removeClass("has-feedback has-error")
                .find(".title")
                .val(
                  "edit" == t.mode && i[0] ? $.parseHTML(i)[0].wholeText : ""
                ),
              app.data.getWebAppData().getIsExternalData() &&
                (e.find(".titleContainer .title").addClass("title-disabled"),
                e.find(".titleContainer .title").attr("disabled", !0)),
              e.modal({ keyboard: !0 }),
              h
            );
          }),
          (this.close = function () {
            e.modal("hide"), h.reject();
          }),
          (this.initLocalization = function () {});
      };
    }
  ),
  define("lib-build/tpl!storymaps/tpl/builder/OrganizePopup", [], function () {
    return function (obj) {
      obj || (obj = {});
      var __t,
        __p = "",
        __e = _.escape;
      with (obj)
        __p +=
          '<div class="modal-dialog">\r\n\t<div class="modal-content">\r\n\t\t<div class="modal-logo"></div>\r\n\t\t<div class="modal-header">\r\n\t\t\t<h4 class="modal-title">' +
          (null == (__t = title) ? "" : __t) +
          '</h4>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-body">\r\n\t\t\t<div class="organizeHeader"></div>\r\n\r\n\t\t\t<div class="organizeTableContainer">\r\n\t\t\t\t<table class="organizeTable table table-striped">\r\n\t\t\t\t\t<thead>\r\n\t\t\t\t\t<tr style="height: 39px">\r\n\t\t\t\t\t\t<th class="moverHeader">&nbsp;</th>\r\n\t\t\t\t\t\t<th>' +
          (null == (__t = lblColTitle) ? "" : __t) +
          '</th>\r\n\t\t\t\t\t\t<th style="width: 44px;"></th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t</thead>\r\n\t\t\t\t\t<tbody class="rows">\r\n\t\t\t\t\t\t\x3c!-- rows --\x3e\r\n\t\t\t\t\t</tbody>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-footer">\r\n\t\t\t<button type="button" class="btn btnApply btn-primary"></button>\r\n\t\t\t<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">' +
          (null == (__t = btnCancel) ? "" : __t) +
          "</button>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n";
      return __p;
    };
  }),
  define(
    "lib-build/css!storymaps/tpl/builder/OrganizePopup",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/OrganizePopupEntry",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<tr class="sectionRow ui-state-highlight" data-index="' +
            (null == (__t = index) ? "" : __t) +
            '">\r\n\t<td class="mover"></td>\r\n\t<td class="entryTitle">' +
            (null == (__t = title) ? "" : __t) +
            '</td>\r\n\t<td>\r\n\t\t<button type="button" class="btn btn-default btn-md glyphicon glyphicon-trash deleteSectionBtn" data-toggle="tooltip" title="' +
            (null == (__t = helpDelete) ? "" : __t) +
            '"></button>\r\n\t</td>\r\n</tr>\r\n';
        return __p;
      };
    }
  ),
  (function (t) {
    function e(t, e) {
      if (!(t.originalEvent.touches.length > 1)) {
        t.preventDefault();
        var i = t.originalEvent.changedTouches[0],
          n = document.createEvent("MouseEvents");
        n.initMouseEvent(
          e,
          !0,
          !0,
          window,
          1,
          i.screenX,
          i.screenY,
          i.clientX,
          i.clientY,
          !1,
          !1,
          !1,
          !1,
          0,
          null
        ),
          t.target.dispatchEvent(n);
      }
    }
    if (((t.support.touch = "ontouchend" in document), t.support.touch)) {
      var i,
        n = t.ui.mouse.prototype,
        a = n._mouseInit,
        o = n._mouseDestroy;
      (n._touchStart = function (t) {
        var n = this;
        !i &&
          n._mouseCapture(t.originalEvent.changedTouches[0]) &&
          ((i = !0),
          (n._touchMoved = !1),
          e(t, "mouseover"),
          e(t, "mousemove"),
          e(t, "mousedown"));
      }),
        (n._touchMove = function (t) {
          i && ((this._touchMoved = !0), e(t, "mousemove"));
        }),
        (n._touchEnd = function (t) {
          i &&
            (e(t, "mouseup"),
            e(t, "mouseout"),
            this._touchMoved || e(t, "click"),
            (i = !1));
        }),
        (n._mouseInit = function () {
          var e = this;
          e.element.bind({
            touchstart: t.proxy(e, "_touchStart"),
            touchmove: t.proxy(e, "_touchMove"),
            touchend: t.proxy(e, "_touchEnd"),
          }),
            a.call(e);
        }),
        (n._mouseDestroy = function () {
          var e = this;
          e.element.unbind({
            touchstart: t.proxy(e, "_touchStart"),
            touchmove: t.proxy(e, "_touchMove"),
            touchend: t.proxy(e, "_touchEnd"),
          }),
            o.call(e);
        });
    }
  })(jQuery),
  define("lib-app/jquery.ui.touch-punch", function () {}),
  define(
    "storymaps/tpl/builder/OrganizePopup",
    [
      "lib-build/tpl!./OrganizePopup",
      "lib-build/css!./OrganizePopup",
      "lib-build/tpl!./OrganizePopupEntry",
      "lib-app/jquery.ui.touch-punch",
      "dojo/Deferred",
    ],
    function (t, e, i, n, a) {
      return function (e) {
        function n() {
          var t = $(this).closest("tr").first();
          return (
            t.fadeOut("fast", function () {
              t.remove(), c++, s();
            }),
            2 == e.find(".sectionRow").get().length &&
              e.find(".deleteSectionBtn").attr("disabled", !0),
            !1
          );
        }
        function o() {
          var t = [],
            i = 0,
            n = e.find(".sectionRow").get();
          $.each($(n), function (e, n) {
            var a = $(n),
              o = a.data("index"),
              r = a.find(".status-list-btn").data("value"),
              s = p.entries[o];
            (s.status = r), t.push(s), o === p.sectionIndex && (i = e);
          }),
            d.resolve({ entries: t, sectionIndex: i }),
            $(".builder-content-panel .builder-organize").toggleClass("active"),
            e.modal("hide");
        }
        function r() {
          e.find(".btnApply").click(o),
            e.on("hide.bs.modal", function () {
              $(".builder-content-panel .builder-organize").toggleClass(
                "active"
              ),
                d.reject();
            }),
            (l = !0);
        }
        function s() {
          c
            ? e
                .find(".btnApply")
                .html(
                  i18n.builder.addEditPopup.confirmDeletion +
                    "%NB% %LBL_LAYOUT%"
                      .replace("%NB%", c)
                      .replace("%LBL_LAYOUT%", c > 1 ? "tabs" : "tab")
                )
                .removeClass("btn-primary")
                .addClass("btn-danger")
            : e
                .find(".btnApply")
                .html(i18n.commonCore.common.apply)
                .removeClass("btn-danger")
                .addClass("btn-primary");
        }
        var l = !1,
          d = null,
          p = null,
          c = null;
        e.append(
          t({
            title: i18n.builder.addEditPopup.organizeTabs,
            lblColTitle: i18n.builder.organizePopup.lblColTitle,
            lblColStatus: i18n.builder.organizePopup.lblColStatus,
            btnCancel: i18n.commonCore.common.cancel,
          })
        ),
          (this.present = function (t) {
            var o = "";
            if (
              ((d = new a()),
              (p = t),
              !t || !t.entries || null == t.sectionIndex)
            )
              return d.reject();
            if (
              ((c = 0),
              l || r(),
              e
                .find(".organizeHeader")
                .html(i18n.builder.organizePopup.dragNDrop),
              $.each(p.entries, function (t, e) {
                var n = e.title;
                o += i({
                  index: t,
                  title: n,
                  statusVal: "",
                  statusLbl: "",
                  helpDelete: i18n.builder.addFeatureBar.deleteFeature,
                });
              }),
              e.find(".rows").html(o),
              e.find(".deleteSectionBtn").attr("disabled", !1),
              e.find("*[data-toggle=tooltip]").tooltip({ trigger: "hover" }),
              e.find(".deleteSectionBtn").click(n),
              e.find(".rows").toggleClass("noreorder", p.entries.length <= 1),
              Object.keys(p.entries).length > 1)
            )
              e.find(".organizeTable tbody").sortable({
                axis: "y",
                opacity: "0.4",
                cursor: "move",
                helper: function (t, e) {
                  var i = e.children(),
                    n = e.clone();
                  return (
                    n.children().each(function (t) {
                      $(this).outerWidth(i.eq(t).outerWidth());
                    }),
                    n
                  );
                },
              });
            else
              try {
                e.find(".organizeTable tbody").sortable("destroy");
              } catch (t) {}
            return s(), e.modal({ keyboard: !0 }), d;
          }),
          (this.close = function () {
            e.modal("hide"),
              $(".builder-content-panel .builder-organize").toggleClass(
                "active"
              ),
              d.reject();
          });
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/shortlistMigration/Migration",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="backdrop"></div>\r\n<div class="modal-dialog">\r\n\t<div class="modal-content">\r\n\t\t<div class="modal-logo edit"></div>\r\n\t\t<div class="modal-header">\r\n\t\t\t<h4 class="modal-title">' +
            (null == (__t = welcome) ? "" : __t) +
            '</h4>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-body">\r\n\r\n\t\t\t<div class="tab-pane viewMigrationSelectorContainer">\r\n\t\t\t\t<div class="importQuestion">' +
            (null == (__t = importQuestion) ? "" : __t) +
            '</div>\r\n\r\n\t\t\t\t<div class="radio">\r\n\t\t\t\t\t<label class="opt-radio-import">\r\n\t\t\t\t\t\t<input type="radio" name="optradio" value="import" checked=true/>\r\n\t\t\t\t\t\t' +
            (null == (__t = importOption) ? "" : __t) +
            '\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<div class="importExplain">' +
            (null == (__t = importExplainYes) ? "" : __t) +
            '</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="radio">\r\n\t\t\t\t\t<label class="opt-radio-import">\r\n\t\t\t\t\t\t<input type="radio" name="optradio" value="as-is" />\r\n\t\t\t\t\t\t' +
            (null == (__t = asIsOption) ? "" : __t) +
            '\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<div class="importExplain">' +
            (null == (__t = asIsText) ? "" : __t) +
            '</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="radio">\r\n\t\t\t\t\t<label class="opt-radio-import">\r\n\t\t\t\t\t\t<input type="radio" name="optradio" value="0" />\r\n\t\t\t\t\t\t' +
            (null == (__t = no) ? "" : __t) +
            '\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<div class="importExplain">' +
            (null == (__t = importExplainNo) ? "" : __t) +
            '</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class="modal-footer">\r\n\t\t\t<span class="modal-footer-left"><button class="btn btn-back btn-naked">< ' +
            (null == (__t = btnBack) ? "" : __t) +
            '</button></span>\r\n\t\t\t<span class="btnSubmitWrapper" data-toggle="tooltip"">\r\n\t\t\t\t<button class="btnSubmit btn btn-primary" ></button>\r\n\t\t\t</span>\r\n\t\t\t<div class="btnSubmitTooltipContainer"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n';
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/shortlistMigration/Migration",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/shortlistMigration/layerPicker",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="tab-pane viewMigrationLayerSelectorContainer">\r\n\t<div class="importQuestion">' +
            (null == (__t = pointLayers) ? "" : __t) +
            '</div>\r\n\r\n\t<div class="checkbox opt-container layer-picker" >\r\n\r\n\t</div>\r\n\r\n\t<div class="layer-info">' +
            (null == (__t = layerInfo) ? "" : __t) +
            "</div>\r\n\r\n</div>\r\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/shortlistMigration/layerPicker",
    [],
    function () {}
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/shortlistMigration/tabFieldPicker",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="tab-pane viewMigrationTabFieldSelectorContainer">\r\n\t<div class="layer-info">' +
            (null == (__t = tabField) ? "" : __t) +
            '</div>\r\n\r\n\t<div class="tab-field-picker">\r\n\t\t<select id="tabFieldSelect">\r\n\t\t\t<option value="none">' +
            (null == (__t = none) ? "" : __t) +
            "</option>\r\n\t\t</select>\r\n\t</div>\r\n</div>\r\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/tpl!storymaps/tpl/builder/shortlistMigration/fieldPicker",
    [],
    function () {
      return function (obj) {
        obj || (obj = {});
        var __t,
          __p = "",
          __e = _.escape;
        with (obj)
          __p +=
            '<div class="tab-pane viewMigrationFieldSelectorContainer">\r\n\r\n\t<div class="inset field-name">\r\n\t\t' +
            (null == (__t = nameField) ? "" : __t) +
            '\r\n\t\t<div class="tab-field-name-picker">\r\n\t\t\t<select id="fieldNameSelect">\r\n\t\t\t\t<option value="none">' +
            (null == (__t = none) ? "" : __t) +
            '</option>\r\n\t\t\t</select>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class="inset description-info">\r\n\t\t' +
            (null == (__t = descriptionField) ? "" : __t) +
            '\r\n\t</div>\r\n\t<div class="opt-container description-picker" >\r\n\r\n\t</div>\r\n\r\n\t<div class="inset url-info">\r\n\t\t' +
            (null == (__t = urlField) ? "" : __t) +
            '\r\n\t</div>\r\n\t<div class="tab-field-url-picker">\r\n\t\t<select id="fieldUrlSelect">\r\n\t\t\t<option value="none">' +
            (null == (__t = none) ? "" : __t) +
            '</option>\r\n\t\t</select>\r\n\t</div>\r\n\r\n\t<div class="inset pic-info">\r\n\t\t' +
            (null == (__t = imageFields) ? "" : __t) +
            '\r\n\t</div>\r\n\t<div class="tab-field-photo-picker">\r\n\t\t' +
            (null == (__t = mainImageField) ? "" : __t) +
            '\r\n\t\t<select class="photoSelect" id="fieldPicUrlSelect">\r\n\t\t\t<option value="none">' +
            (null == (__t = none) ? "" : __t) +
            '</option>\r\n\t\t</select>\r\n\t</div>\r\n\t<div class="tab-field-photo-picker">\r\n\t\t' +
            (null == (__t = thumbImageField) ? "" : __t) +
            '\r\n\t\t<select class="photoSelect" id="fieldThumbUrlSelect">\r\n\t\t\t<option value="none">' +
            (null == (__t = none) ? "" : __t) +
            '</option>\r\n\t\t</select>\r\n\t</div>\r\n\t<div class="inset imagesOptional">\r\n\t\t' +
            (null == (__t = noImageFields) ? "" : __t) +
            "\r\n\t</div>\r\n</div>\r\n";
        return __p;
      };
    }
  ),
  define(
    "lib-build/css!storymaps/tpl/builder/shortlistMigration/fieldPicker",
    [],
    function () {}
  ),
  define(
    "storymaps/tpl/builder/shortlistMigration/Migration",
    [
      "lib-build/tpl!./Migration",
      "lib-build/css!./Migration",
      "lib-build/tpl!./layerPicker",
      "lib-build/css!./layerPicker",
      "lib-build/tpl!./tabFieldPicker",
      "lib-build/tpl!./fieldPicker",
      "lib-build/css!./fieldPicker",
      "../../core/Helper",
      "../MapExtentSave",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/graphic",
      "esri/layers/FeatureLayer",
      "dojo/topic",
      "dojo/Deferred",
    ],
    function (t, e, i, n, a, o, r, s, l, d, p, c, u, h) {
      return function (e, n, r, l, c) {
        function f() {
          C();
        }
        function m() {
          setTimeout(function () {
            e.find(".modal-body").addClass("migrateWebmap"),
              e.find(".modal-body").removeClass("layerSelector"),
              e.find(".modal-body").removeClass("migrationQuestion"),
              e.find(".modal-body").removeClass("tabFieldSelector");
          }, 500);
          var t = [];
          if (
            (e
              .find(".layer-picker .opt-checkbox:checkbox:checked")
              .each(function () {
                t.push($(this).attr("name"));
              }),
            (P = []),
            (O = []),
            $.each(t, function (t, e) {
              var i = $.grep(L, function (t) {
                return t.id == e;
              });
              P.push(i[0]);
            }),
            (M = []),
            $.each(L, function (t, e) {
              $.grep(P, function (t) {
                return t.id == e.id;
              })[0] || M.push(e);
            }),
            P.length > 1)
          ) {
            var i = [];
            $.each(P[0].graphics[0].attributes, function (t) {
              i.push(t);
            }),
              $.each(P, function (t, e) {
                var n = [];
                $.each(i, function (t, a) {
                  var o = [];
                  if (
                    ($.each(e.graphics[0].attributes, function (t) {
                      o.push(t);
                    }),
                    !$.grep(o, function (t) {
                      return t.toLowerCase() === a.toLowerCase();
                    }).length)
                  ) {
                    var r = i.indexOf(a);
                    n.push(r);
                  }
                }),
                  $.each(n, function (t, e) {
                    i.splice(e, 1);
                  });
              }),
              $.each(i, function (t, e) {
                "__OBJECTID" != e &&
                  (O.push(e),
                  $("#fieldSelect").append(
                    $("<option></option>").attr("value", e).text(e)
                  ));
              });
          } else if (
            ($.each(P[0].graphics[0].attributes, function (t) {
              "__OBJECTID" != t &&
                (O.push(t),
                $("#fieldSelect").append(
                  $("<option></option>").attr("value", t).text(t)
                ));
            }),
            1 ==
              e.find(".layer-picker .opt-checkbox:checkbox:checked").length &&
              "none" != e.find("#tabFieldSelect").val())
          ) {
            var n = e.find("#tabFieldSelect").val(),
              a = [],
              r = [];
            $.each(P[0].graphics, function (t, e) {
              r.indexOf(e.attributes[n]) < 0 &&
                (r.push(e.attributes[n]),
                a.push({
                  name: e.attributes[n],
                  graphics: [],
                  alias: e.attributes[n],
                }));
            }),
              $.each(P[0].graphics, function (t, e) {
                var i = $.grep(r, function (t) {
                  return t == e.attributes[n];
                });
                $.map(a, function (t, n) {
                  t.name == i[0] && a[n].graphics.push(e);
                });
              }),
              (P = a);
          }
          e
            .find(".modal-title")
            .text(i18n.builder.migration.migrationPattern.chooseFields),
            e.find(".viewMigrationLayerSelectorContainer").hide(),
            $(".viewMigrationFieldSelectorContainer").length
              ? $(".viewMigrationFieldSelectorContainer").show()
              : (e
                  .find(".modal-body")
                  .append(
                    o({
                      nameField: i18n.builder.migration.fieldPicker.nameField,
                      descriptionField:
                        i18n.builder.migration.fieldPicker.descriptionField,
                      urlField: i18n.builder.migration.fieldPicker.urlField,
                      none: i18n.builder.migration.fieldPicker.none,
                      imageFields:
                        i18n.builder.migration.fieldPicker.imageFields,
                      mainImageField:
                        i18n.builder.migration.fieldPicker.mainImageField,
                      thumbImageField:
                        i18n.builder.migration.fieldPicker.thumbImageField,
                      noImageFields:
                        i18n.builder.migration.fieldPicker.noImageFields,
                      tabField: i18n.builder.migration.fieldPicker.tabField,
                    })
                  ),
                e
                  .find(".viewMigrationFieldSelector fieldNameSelect")
                  .on("change", function () {
                    C();
                  })),
            $("#fieldNameSelect").empty(),
            $("#fieldUrlSelect").empty(),
            $("#fieldPicUrlSelect").empty(),
            $("#fieldThumbUrlSelect").empty(),
            e.find(".description-picker").empty(),
            $("#fieldNameSelect").append(
              $("<option></option>")
                .attr("value", "none")
                .text(i18n.builder.migration.fieldPicker.none)
            ),
            $("#fieldUrlSelect").append(
              $("<option></option>")
                .attr("value", "none")
                .text(i18n.builder.migration.fieldPicker.none)
            ),
            $("#fieldPicUrlSelect").append(
              $("<option></option>")
                .attr("value", "none")
                .text(i18n.builder.migration.fieldPicker.none)
            ),
            $("#fieldThumbUrlSelect").append(
              $("<option></option>")
                .attr("value", "none")
                .text(i18n.builder.migration.fieldPicker.none)
            );
          var s = !1;
          $.each(O, function (t, i) {
            $("#fieldNameSelect").append(
              $("<option></option>").attr("value", i).text(i)
            ),
              $("#fieldUrlSelect").append(
                $("<option></option>").attr("value", i).text(i)
              ),
              $("#fieldPicUrlSelect").append(
                $("<option></option>").attr("value", i).text(i)
              ),
              $("#fieldThumbUrlSelect").append(
                $("<option></option>").attr("value", i).text(i)
              );
            var n = null;
            "short_desc" == i.toLowerCase() && (n = 1),
              "desc1" == i.toLowerCase() && (n = 2),
              "description" == i.toLowerCase() && (n = 2),
              "caption" == i.toLowerCase() && (n = 2),
              "desc2" == i.toLowerCase() && (n = 3),
              "desc3" == i.toLowerCase() && (n = 4),
              "desc4" == i.toLowerCase() && (n = 5),
              "desc5" == i.toLowerCase() && (n = 6),
              "address" == i.toLowerCase() && (n = 7),
              "hours" == i.toLowerCase() && (n = 8),
              n
                ? (e
                    .find(".description-picker")
                    .append(
                      '<div class="checkbox"><label><input type="checkbox" class="opt-checkbox" value=' +
                        n +
                        "/>" +
                        i +
                        "</label></div>"
                    ),
                  (s = !0))
                : e
                    .find(".description-picker")
                    .append(
                      '<div class="checkbox"><label><input type="checkbox" class="opt-checkbox" />' +
                        i +
                        "</label></div>"
                    );
          }),
            s &&
              e
                .find(".description-picker .checkbox")
                .sort(function (t, e) {
                  var i = $(t).find(":checkbox"),
                    n = $(e).find(":checkbox");
                  return i.val() < n.val() ? -1 : i.val() > n.val() ? 1 : 0;
                })
                .appendTo(".description-picker"),
            g();
        }
        function g() {
          $.each($("#fieldNameSelect option"), function (t, e) {
            if ("name" == e.value.toLowerCase())
              return $(this).prop("selected", !0), !1;
            "title" == e.value.toLowerCase() && $(this).prop("selected", !0);
          }),
            $.each(
              e.find(".description-picker .opt-checkbox"),
              function (t, e) {
                "short_desc" == $(e).parent().text().toLowerCase() &&
                  $(this).prop("checked", !0),
                  "desc1" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "description" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "caption" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "desc2" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "desc3" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "desc4" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "desc5" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "hours" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0),
                  "address" == $(e).parent().text().toLowerCase() &&
                    $(this).prop("checked", !0);
              }
            ),
            $.each($("#fieldUrlSelect option"), function (t, e) {
              if ("website" == e.value.toLowerCase())
                return $(this).prop("selected", !0), !1;
            }),
            $.each($("#fieldPicUrlSelect option"), function (t, e) {
              if ("pic_url" == e.value.toLowerCase())
                return $(this).prop("selected", !0), !1;
              "picture" == e.value.toLowerCase() &&
                $(this).prop("selected", !0),
                "image_url" == e.value.toLowerCase() &&
                  $(this).prop("selected", !0);
            }),
            $.each($("#fieldThumbUrlSelect option"), function (t, e) {
              if ("thumb_url" == e.value.toLowerCase())
                return $(this).prop("selected", !0), !1;
              "pic_url" == e.value.toLowerCase() &&
                $(this).prop("selected", !0),
                "picture" == e.value.toLowerCase() &&
                  $(this).prop("selected", !0),
                "image_url" == e.value.toLowerCase() &&
                  $(this).prop("selected", !0);
            }),
            setTimeout(function () {
              C();
            }, 500),
            e
              .find(".description-picker .opt-checkbox")
              .on("click", function () {
                C();
              }),
            e.find("#fieldNameSelect").on("change", function () {
              C();
            }),
            $(".description-picker").sortable();
        }
        function b() {
          var t = $(
            "input[name=optradio]:checked",
            ".viewMigrationSelectorContainer"
          ).val();
          0 == t && (t = parseInt(t));
          var n = {};
          if (
            ((n.migrate = t),
            (n.pointLayers = L),
            (n.layers = D),
            n.migrate && "as-is" != n.migrate)
          ) {
            if (
              (e
                .find(".modal-title")
                .text(i18n.builder.migration.migrationPattern.selectPtData),
              N.show(),
              e.find(".viewMigrationSelectorContainer").hide(),
              $(".viewMigrationLayerSelectorContainer").length)
            )
              return (
                $(".viewMigrationLayerSelectorContainer").show(),
                void setTimeout(function () {
                  e.find(".modal-body").addClass("layerSelector"),
                    e.find(".modal-body").removeClass("migrateWebmap"),
                    e.find(".modal-body").removeClass("migrationQuestion");
                }, 500)
              );
            e
              .find(".modal-body")
              .append(
                i({
                  pointLayers: i18n.builder.migration.layerPicker.pointLayers,
                  layerInfo: i18n.builder.migration.layerPicker.layerInfo,
                })
              ),
              L.reverse(),
              1 == L.length && $(".layer-info").hide();
            var a = [];
            $.each(L, function (t, e) {
              e.graphics.length && a.push(e);
            }),
              (L = a),
              $.each(L, function (t, i) {
                var n,
                  a = $.grep(
                    app.data.getWebMap().itemData.operationalLayers,
                    function (t) {
                      return t.id == i.id.slice(0, -2);
                    }
                  );
                (n = i.layerType ? i.layerType : i.type),
                  !i.url ||
                    ("ArcGISFeatureLayer" !== n && "Feature Layer" !== n) ||
                    i.id.match(/^csv_/) ||
                    (a = $.grep(
                      app.data.getWebMap().itemData.operationalLayers,
                      function (t) {
                        return t.id == i.id;
                      }
                    )),
                  (a = a[0] ? a[0].title : i.id),
                  (i.alias = a),
                  e
                    .find(".layer-picker")
                    .append(
                      '<div class="checkbox"><label><input type="checkbox" class="opt-checkbox" name=' +
                        i.id +
                        " />" +
                        a +
                        "</label></div>"
                    );
              }),
              e.find(".layer-picker .opt-checkbox").eq(0).prop("checked", !0);
          } else I.resolve(n), e.modal("hide");
          e.find(".layer-picker .opt-checkbox").on("change", function () {
            C();
          }),
            setTimeout(function () {
              C();
            }, 500);
        }
        function v() {
          e
            .find(".modal-title")
            .text(i18n.builder.migration.migrationPattern.multipleThemes),
            $(".viewMigrationTabFieldSelectorContainer").length ||
              e
                .find(".modal-body")
                .append(
                  a({
                    tabField: i18n.builder.migration.fieldPicker.tabField,
                    none: i18n.builder.migration.fieldPicker.none,
                  })
                ),
            $(".viewMigrationTabFieldSelectorContainer").show(),
            e.find(".modal-body").addClass("tabFieldSelector");
          var t = $(".layer-picker .opt-checkbox:checkbox:checked").attr(
              "name"
            ),
            i = $.grep(L, function (e) {
              return e.id == t;
            });
          $("#tabFieldSelect").empty(),
            $("#tabFieldSelect").append(
              $("<option></option>")
                .attr("value", "none")
                .text(i18n.builder.migration.fieldPicker.none)
            ),
            $.each(i[0].graphics[0].attributes, function (t) {
              "__OBJECTID" != t &&
                $("#tabFieldSelect").append(
                  $("<option></option>").attr("value", t).text(t)
                );
            }),
            $.each($("#tabFieldSelect option"), function (t, e) {
              return "tabname" == e.value.toLowerCase() ||
                "tab_name" == e.value.toLowerCase()
                ? ($(this).prop("selected", !0), !1)
                : "tabname" == e.value.toLowerCase() ||
                  "tab_id" == e.value.toLowerCase()
                ? ($(this).prop("selected", !0), !1)
                : void 0;
            }),
            setTimeout(function () {
              e.find(".modal-body").removeClass("layerSelector"),
                e.find(".modal-body").removeClass("migrateWebmap"),
                e.find(".modal-body").removeClass("migrationQuestion"),
                e.find(".modal-body").addClass("fieldSelector"),
                C();
            }, 500);
        }
        function y(t, i, a, o, r) {
          e.modal("hide"),
            (app.isGalleryCreation = !0),
            E.buildAddFeatureBar(),
            app.data.getWebAppData().setDefaultGeneralOptions();
          var s = E.buildWebMap();
          if (
            (app.data.getWebAppData().setTitle(app.data.getWebAppItem().title),
            (s.item.title =
              app.data.getResponse().itemInfo.item.title +
              " - Shortlist builder"),
            (app.data.getResponse().itemInfo.item.title = s.item.title),
            app.data.getWebAppItem().description ||
              app.data.getWebAppItem().snippet)
          ) {
            var l = app.data.getWebAppItem().snippet
              ? app.data.getWebAppItem().snippet
              : app.data.getWebAppItem().description;
            app.data.getWebAppData().setSubtitle(l), (s.item.description = l);
          } else if (
            app.data.getResponse().itemInfo.item.description ||
            app.data.getResponse().itemInfo.item.snippet
          ) {
            var l = app.data.getResponse().itemInfo.item.snippet
              ? app.data.getResponse().itemInfo.item.snippet
              : app.data.getResponse().itemInfo.item.description;
            app.data.getWebAppData().setSubtitle(l), (s.item.description = l);
          }
          if (
            (app.ui.headerDesktop.setTitleAndSubtitle(
              app.data.getWebAppData().getTitle(),
              app.data.getWebAppData().getSubtitle()
            ),
            (s.item.extent = app.data.getResponse().itemInfo.item.extent),
            (s.itemData.spatialReference =
              app.data.getResponse().itemInfo.itemData.spatialReference),
            (s.itemData.baseMap =
              app.data.getResponse().itemInfo.itemData.baseMap),
            (app.mapItem = app.data.getResponse().itemInfo),
            app.data.getResponse().itemInfo.itemData.bookmarks &&
              app.data.getResponse().itemInfo.itemData.bookmarks.length &&
              (s.itemData.bookmarks =
                app.data.getResponse().itemInfo.itemData.bookmarks),
            "none" != a)
          ) {
            var d = app.data.getWebAppData().getGeneralOptions();
            (d.moreInfoLink = !0),
              app.data.getWebAppData().setGeneralOptions(d);
          }
          app.data
            .getWebAppData()
            .setOriginalWebmap(app.data.getWebAppData().getWebmap()),
            app.map.destroy(),
            (app.map = null);
          var p = k.loadWebmap(s, "map");
          p.then(function (e) {
            app.data.setResponse(e), (app.map = p.results[0].map);
            var s = app.data.getWebAppData().getGeneralOptions();
            (s.extentMode = "customHome"),
              app.data.getWebAppData().setGeneralOptions(s);
            var l = e.itemInfo.item.id ? e.itemInfo.item.id : e.map.id;
            app.maps[l] = k.getMapConfig(e);
            var d = new esri.layers.GraphicsLayer();
            (d.id = "tempIconLayer"),
              app.map.addLayer(d),
              app.map.reorderLayer(d, app.map.graphicsLayerIds.length - 1),
              E.storyDataReady();
            var c = app.cfg.COLOR_ORDER.split(","),
              h = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                return t.name == c[0];
              });
            $("#contentPanel").css("border-top-color", h[0].color);
            var f = {
                header: app.data.getWebAppData().getThemeOptions().headerColor,
                tabText: "#d8d8d8",
                tab: "#666",
                tabTextActive: "#fff",
                tabActive: h[0].color,
                tabTextHover: "#fff",
                tabHover: "#666",
              },
              m = {};
            (m.title = "Tab 1"),
              app.ui.navBar.init([m], 0, f, app.data.getWebAppData());
            var g = [];
            $.each(D, function (t, e) {
              var i,
                n = $.grep(
                  app.data.getWebMap().itemData.operationalLayers,
                  function (t) {
                    return t.id == e.id.slice(0, -2);
                  }
                );
              (i = e.layerType ? e.layerType : e.type),
                e.url &&
                  ("ArcGISFeatureLayer" === i ||
                    "Feature Layer" === i ||
                    e.tileMap ||
                    e.tileInfo) &&
                  !e.id.match(/^csv_/) &&
                  (n = $.grep(
                    app.data.getWebMap().itemData.operationalLayers,
                    function (t) {
                      return t.id == e.id;
                    }
                  )),
                n[0] && (g.push(n[0]), app.map.addLayer(e));
            }),
              $.each(M, function (t, e) {
                var i,
                  n = $.grep(
                    app.data.getWebMap().itemData.operationalLayers,
                    function (t) {
                      return t.id == e.id.slice(0, -2);
                    }
                  );
                (i = e.layerType ? e.layerType : e.type),
                  !e.url ||
                    ("ArcGISFeatureLayer" !== i && "Feature Layer" !== i) ||
                    e.id.match(/^csv_/) ||
                    (n = $.grep(
                      app.data.getWebMap().itemData.operationalLayers,
                      function (t) {
                        return t.id == e.id;
                      }
                    )),
                  n[0] && (g.push(n[0]), app.map.addLayer(e));
              }),
              app.data.setWebMap(p.results[0].itemInfo),
              app.addFeatureBar.addLayer(!0),
              $.each(g, function (t, e) {
                app.data.getWebMap().itemData.operationalLayers.push(e);
              }),
              E.updateUI(),
              T.appInitComplete(A);
            var b = app.map.getLayer(app.data.getShortlistLayerId()),
              v = !1,
              y = app.map.getLayer(
                app.data.getWebMap().itemData.baseMap.baseMapLayers[0].id
              );
            if (
              (y.tileIndexUrl && y.loaded && (w(b, t, i, a, o, r), (v = !0)),
              y.on("update-end", function () {
                v || ((v = !0), w(b, t, i, a, o, r));
              }),
              $("#loadingIndicator").show(),
              app.data.getResponse().itemInfo.itemData.bookmarks &&
                app.data.getResponse().itemInfo.itemData.bookmarks.length)
            ) {
              var C = {
                extentMode: "customHome",
                numberedIcons: !1,
                filterByExtent: !0,
                bookmarks: !0,
                bookmarksAlias: app.cfg.BOOKMARKS_ALIAS,
                locateButton: !1,
                geocoder: !1,
              };
              app.data.getWebAppData().setGeneralOptions(C),
                app.ui.navBar.initBookmarks();
            }
            setTimeout(function () {
              app.detailPanelBuilder.buildAllSlides(),
                $("body").removeClass("loadingPlaces"),
                n.displayApp(),
                k.activateLayer(0),
                app.map.setExtent(app.map._params.extent, !0),
                u.publish("BUILDER_INCREMENT_COUNTER", 1),
                app.data
                  .getWebAppItem()
                  .typeKeywords.push("Shortlist-migration");
              var t = app.map.graphicsLayerIds.length - 1;
              app.map.reorderLayer(b, t);
            }, 800);
          });
        }
        function w(t, e, i, n, a, o) {
          $.each(P, function (r, s) {
            $("body").addClass("loadingPlaces"),
              0 === r &&
                ($(".entryLbl").eq(0).text(s.alias),
                app.data.setStory(0, s.alias),
                app.data.getWebAppData().setTabs(app.data.getStory())),
              r > 0 && app.ui.navBar.onClickAdd(null, s.alias),
              $.each(s.graphics, function (s, l) {
                var c =
                    l.geometry && l.geometry.x && l.geometry.y
                      ? parseInt(1)
                      : 0,
                  u = {
                    __OBJECTID: t.graphics.length + 1,
                    name: "",
                    description: "",
                    pic_url: "",
                    thumb_url: "",
                    shortlist_id: t.graphics.length + 1,
                    number: s + 1,
                    tab_id: r,
                    locationSet: c,
                  },
                  h = [];
                $.each(l._layer.fields, function (t, e) {
                  "esriFieldTypeDate" == e.type && h.push(e.name);
                }),
                  $.each(h, function (t, e) {
                    if (l.attributes[e]) {
                      var i = [
                          "January",
                          "February",
                          "March",
                          "April",
                          "May",
                          "June",
                          "July",
                          "August",
                          "September",
                          "October",
                          "November",
                          "December",
                        ],
                        n = new Date(l.attributes[e]),
                        a =
                          i[n.getMonth()] +
                          " " +
                          n.getDate() +
                          ", " +
                          n.getFullYear();
                      l.attributes[e] = a;
                    }
                  }),
                  l.attributes.number && (u.number = l.attributes.number),
                  l.attributes.Number && (u.number = l.attributes.Number),
                  l.attributes.NUMBER && (u.number = l.attributes.NUMBER),
                  l.attributes.PLACENUMSL &&
                    (u.number = l.attributes.PLACENUMSL),
                  (u.name = l.attributes[e]),
                  $.each(i, function (t, e) {
                    l.attributes[e] &&
                      (u.description += "<p>" + l.attributes[e] + "</p>");
                  }),
                  "none" != n &&
                    l.attributes[n] &&
                    (u.description +=
                      "<p><a href=" +
                      l.attributes[n] +
                      ' target="_blank">More info</a></p>'),
                  "none" != a && (u.pic_url = encodeURI(l.attributes[a])),
                  "none" != o && (u.thumb_url = encodeURI(l.attributes[o])),
                  "none" == o &&
                    "none" != a &&
                    (u.thumb_url = encodeURI(l.attributes[a])),
                  null == l.geometry && (u.locationSet = 0);
                var f = new d(),
                  m = new p(l.geometry, f, u),
                  g = E.addMapIcon(m, app.data.getStory()[r].color);
                t.add(g);
              });
          });
        }
        function C() {
          var t = !0;
          e.find(
            "input[name=optradio]:checked",
            ".viewMigrationSelectorContainer"
          ).length &&
            "none" !=
              e.find(".viewMigrationSelectorContainer").css("display") &&
            ((t = !1),
            e.find(".modal-body").addClass("migrationQuestion"),
            e.find(".modal-body").removeClass("layerSelector"),
            e.find(".modal-body").removeClass("tabFieldSelector"),
            e.find(".modal-body").removeClass("fieldSelector"),
            e.find(".modal-body").removeClass("migrateWebmap")),
            e.find(".layer-picker .opt-checkbox:checkbox:checked").length > 0 &&
              "none" !=
                e.find(".viewMigrationLayerSelectorContainer").css("display") &&
              ((t = !1),
              e.find(".modal-body").addClass("layerSelector"),
              e.find(".modal-body").removeClass("tabFieldSelector"),
              e.find(".modal-body").removeClass("fieldSelector"),
              e.find(".modal-body").removeClass("migrateWebmap"),
              e.find(".modal-body").removeClass("migrationQuestion")),
            "none" != e.find("#fieldNameSelect").val() &&
              "block" ==
                e.find(".viewMigrationFieldSelectorContainer").css("display") &&
              ((t = !1),
              e.find(".modal-body").addClass("migrateWebmap"),
              e.find(".modal-body").removeClass("layerSelector"),
              e.find(".modal-body").removeClass("tabFieldSelector"),
              e.find(".modal-body").removeClass("migrationQuestion")),
            e.find(".modal-body").hasClass("tabFieldSelector") && (t = !1),
            R.html(i18n.commonCore.common.next),
            R.attr("disabled", t);
        }
        function _() {
          if (e.find(".modal-body").hasClass("migrationQuestion"))
            return (
              b(),
              void (
                e.find(".layer-picker .opt-checkbox:checkbox:checked").length ||
                C()
              )
            );
          if (e.find(".modal-body").hasClass("layerSelector"))
            return (
              e.find(".viewMigrationLayerSelectorContainer").hide(),
              void (1 ==
              e.find(".layer-picker .opt-checkbox:checkbox:checked").length
                ? (v(),
                  setTimeout(function () {
                    C();
                  }, 50))
                : (m(),
                  setTimeout(function () {
                    C();
                  }, 50)))
            );
          if (e.find(".modal-body").hasClass("tabFieldSelector"))
            return (
              e.find(".viewMigrationTabFieldSelectorContainer").hide(),
              m(),
              void setTimeout(function () {
                C();
              }, 50)
            );
          if (e.find(".modal-body").hasClass("migrateWebmap")) {
            var t = e.find("#fieldNameSelect").val(),
              i = [];
            $.each(
              e.find(".description-picker .opt-checkbox:checkbox:checked"),
              function (t, e) {
                i.push($(e).parent().text());
              }
            );
            var n = e.find("#fieldUrlSelect").val(),
              a = e.find("#fieldPicUrlSelect").val(),
              o = e.find("#fieldThumbUrlSelect").val();
            y(t, i, n, a, o);
          }
        }
        function x() {
          e.find(".modal-body").hasClass("layerSelector") &&
            (e.find(".modal-body").removeClass("layerSelector"),
            e.find(".modal-body").addClass("migrationQuestion"),
            e.find(".viewMigrationLayerSelectorContainer").hide(),
            e.find(".viewMigrationSelectorContainer").show(),
            N.hide(),
            C()),
            e.find(".modal-body").hasClass("tabFieldSelector") &&
              ($(".viewMigrationTabFieldSelectorContainer").hide(),
              e.find(".modal-body").removeClass("tabFieldSelector"),
              b(),
              C()),
            e.find(".modal-body").hasClass("migrateWebmap") &&
              ($(".viewMigrationFieldSelectorContainer").hide(),
              1 == e.find(".layer-picker .opt-checkbox:checkbox:checked").length
                ? v()
                : b(),
              C());
        }
        var S =
          '  (<a href="http://links.esri.com/storymaps/shortlist_layer_template" target="_blank" download="">' +
          i18n.builder.migration.migrationPattern.downloadTemplate +
          "</a>)";
        e.append(
          t({
            welcome: i18n.builder.migration.migrationPattern.welcome,
            importQuestion:
              i18n.builder.migration.migrationPattern.importQuestion,
            importExplainYes:
              i18n.builder.migration.migrationPattern.importExplainYes,
            importExplainNo:
              i18n.builder.migration.migrationPattern.importExplainNo,
            no: i18n.builder.migration.migrationPattern.no,
            importOption: i18n.builder.migration.migrationPattern.importOption,
            asIsOption: i18n.builder.migration.migrationPattern.asIsOption,
            asIsText: i18n.builder.migration.migrationPattern.asIsText + S,
            btnCancel: i18n.commonCore.common.cancel,
            btnBack: i18n.commonCore.common.back,
          })
        );
        var T = n,
          k = r,
          E = l,
          A = c,
          I = null,
          L = null,
          P = null,
          D = null,
          M = null,
          O = [],
          R = e.find(".btnSubmit"),
          N = e.find(".btn-back");
        new s();
        !(function () {
          e.find(".btnCancel").click(function () {
            e.modal("hide"), I.reject();
          }),
            e.on("shown.bs.modal", function () {
              f();
            }),
            R.click(_),
            N.click(x),
            e
              .find(".viewMigrationSelectorContainer input")
              .on("change", function () {
                C();
              });
        })(),
          (this.present = function (t, i) {
            return (
              (I = new h()),
              (L = t),
              (D = i),
              $.isEmptyObject(app.data.getWebAppData().getThemeOptions()) &&
                app.data.getWebAppData().setDefaultThemeOptions(),
              C(),
              e.modal({ keyboard: !0 }),
              I
            );
          }),
          (this.close = function () {
            e.modal("hide"), I.reject();
          }),
          (this.initLocalization = function () {});
      };
    }
  ),
  function () {
    function t(t) {
      return !!t.exifdata;
    }
    function e(t, e) {
      (e = e || t.match(/^data\:([^\;]+)\;base64,/im)[1] || ""),
        (t = t.replace(/^data\:([^\;]+)\;base64,/gim, ""));
      for (
        var i = atob(t),
          n = i.length,
          a = new ArrayBuffer(n),
          o = new Uint8Array(a),
          r = 0;
        r < n;
        r++
      )
        o[r] = i.charCodeAt(r);
      return a;
    }
    function i(t, e) {
      var i = new XMLHttpRequest();
      i.open("GET", t, !0),
        (i.responseType = "blob"),
        (i.onload = function (t) {
          (200 != this.status && 0 !== this.status) || e(this.response);
        }),
        i.send();
    }
    function a(t, n) {
      function a(e) {
        var i = o(e),
          a = r(e);
        (t.exifdata = i || {}), (t.iptcdata = a || {}), n && n.call(t);
      }
      if (t.src)
        if (/^data\:/i.test(t.src)) {
          var s = e(t.src);
          a(s);
        } else if (/^blob\:/i.test(t.src)) {
          var l = new FileReader();
          (l.onload = function (t) {
            a(t.target.result);
          }),
            i(t.src, function (t) {
              l.readAsArrayBuffer(t);
            });
        } else {
          var d = new XMLHttpRequest();
          (d.onload = function () {
            if (200 != this.status && 0 !== this.status)
              throw "Could not load image";
            a(d.response), (d = null);
          }),
            d.open("GET", t.src, !0),
            (d.responseType = "arraybuffer"),
            d.send(null);
        }
      else if (
        window.FileReader &&
        (t instanceof window.Blob || t instanceof window.File)
      ) {
        var l = new FileReader();
        (l.onload = function (t) {
          u && console.log("Got file of length " + t.target.result.byteLength),
            a(t.target.result);
        }),
          l.readAsArrayBuffer(t);
      }
    }
    function o(t) {
      var e = new DataView(t);
      if (
        (u && console.log("Got file of length " + t.byteLength),
        255 != e.getUint8(0) || 216 != e.getUint8(1))
      )
        return u && console.log("Not a valid JPEG"), !1;
      for (var i, n = 2, a = t.byteLength; n < a; ) {
        if (255 != e.getUint8(n))
          return (
            u &&
              console.log(
                "Not a valid marker at offset " +
                  n +
                  ", found: " +
                  e.getUint8(n)
              ),
            !1
          );
        if (((i = e.getUint8(n + 1)), u && console.log(i), 225 == i))
          return (
            u && console.log("Found 0xFFE1 marker"),
            c(e, n + 4, e.getUint16(n + 2))
          );
        n += 2 + e.getUint16(n + 2);
      }
    }
    function r(t) {
      var e = new DataView(t);
      if (
        (u && console.log("Got file of length " + t.byteLength),
        255 != e.getUint8(0) || 216 != e.getUint8(1))
      )
        return u && console.log("Not a valid JPEG"), !1;
      for (var i = 2, n = t.byteLength; i < n; ) {
        if (
          (function (t, e) {
            return (
              56 === t.getUint8(e) &&
              66 === t.getUint8(e + 1) &&
              73 === t.getUint8(e + 2) &&
              77 === t.getUint8(e + 3) &&
              4 === t.getUint8(e + 4) &&
              4 === t.getUint8(e + 5)
            );
          })(e, i)
        ) {
          var a = e.getUint8(i + 7);
          a % 2 != 0 && (a += 1), 0 === a && (a = 4);
          return s(t, i + 8 + a, e.getUint16(i + 6 + a));
        }
        i++;
      }
    }
    function s(t, e, i) {
      for (var n, a, o, r, s = new DataView(t), l = {}, d = e; d < e + i; )
        28 === s.getUint8(d) &&
          2 === s.getUint8(d + 1) &&
          (r = s.getUint8(d + 2)) in y &&
          ((o = s.getInt16(d + 3)),
          o + 5,
          (a = y[r]),
          (n = p(s, d + 5, o)),
          l.hasOwnProperty(a)
            ? l[a] instanceof Array
              ? l[a].push(n)
              : (l[a] = [l[a], n])
            : (l[a] = n)),
          d++;
      return l;
    }
    function l(t, e, i, n, a) {
      var o,
        r,
        s,
        l = t.getUint16(i, !a),
        p = {};
      for (s = 0; s < l; s++)
        (o = i + 12 * s + 2),
          (r = n[t.getUint16(o, !a)]),
          !r && u && console.log("Unknown tag: " + t.getUint16(o, !a)),
          (p[r] = d(t, o, e, i, a));
      return p;
    }
    function d(t, e, i, n, a) {
      var o,
        r,
        s,
        l,
        d,
        c,
        u = t.getUint16(e + 2, !a),
        h = t.getUint32(e + 4, !a),
        f = t.getUint32(e + 8, !a) + i;
      switch (u) {
        case 1:
        case 7:
          if (1 == h) return t.getUint8(e + 8, !a);
          for (o = h > 4 ? f : e + 8, r = [], l = 0; l < h; l++)
            r[l] = t.getUint8(o + l);
          return r;
        case 2:
          return (o = h > 4 ? f : e + 8), p(t, o, h - 1);
        case 3:
          if (1 == h) return t.getUint16(e + 8, !a);
          for (o = h > 2 ? f : e + 8, r = [], l = 0; l < h; l++)
            r[l] = t.getUint16(o + 2 * l, !a);
          return r;
        case 4:
          if (1 == h) return t.getUint32(e + 8, !a);
          for (r = [], l = 0; l < h; l++) r[l] = t.getUint32(f + 4 * l, !a);
          return r;
        case 5:
          if (1 == h)
            return (
              (d = t.getUint32(f, !a)),
              (c = t.getUint32(f + 4, !a)),
              (s = new Number(d / c)),
              (s.numerator = d),
              (s.denominator = c),
              s
            );
          for (r = [], l = 0; l < h; l++)
            (d = t.getUint32(f + 8 * l, !a)),
              (c = t.getUint32(f + 4 + 8 * l, !a)),
              (r[l] = new Number(d / c)),
              (r[l].numerator = d),
              (r[l].denominator = c);
          return r;
        case 9:
          if (1 == h) return t.getInt32(e + 8, !a);
          for (r = [], l = 0; l < h; l++) r[l] = t.getInt32(f + 4 * l, !a);
          return r;
        case 10:
          if (1 == h) return t.getInt32(f, !a) / t.getInt32(f + 4, !a);
          for (r = [], l = 0; l < h; l++)
            r[l] = t.getInt32(f + 8 * l, !a) / t.getInt32(f + 4 + 8 * l, !a);
          return r;
      }
    }
    function p(t, e, i) {
      var a = "";
      for (n = e; n < e + i; n++) a += String.fromCharCode(t.getUint8(n));
      return a;
    }
    function c(t, e) {
      if ("Exif" != p(t, e, 4))
        return u && console.log("Not valid EXIF data! " + p(t, e, 4)), !1;
      var i,
        n,
        a,
        o,
        r,
        s = e + 6;
      if (18761 == t.getUint16(s)) i = !1;
      else {
        if (19789 != t.getUint16(s))
          return (
            u && console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"), !1
          );
        i = !0;
      }
      if (42 != t.getUint16(s + 2, !i))
        return u && console.log("Not valid TIFF data! (no 0x002A)"), !1;
      var d = t.getUint32(s + 4, !i);
      if (d < 8)
        return (
          u &&
            console.log(
              "Not valid TIFF data! (First offset less than 8)",
              t.getUint32(s + 4, !i)
            ),
          !1
        );
      if (((n = l(t, s, s + d, g, i)), n.ExifIFDPointer)) {
        o = l(t, s, s + n.ExifIFDPointer, m, i);
        for (a in o) {
          switch (a) {
            case "LightSource":
            case "Flash":
            case "MeteringMode":
            case "ExposureProgram":
            case "SensingMethod":
            case "SceneCaptureType":
            case "SceneType":
            case "CustomRendered":
            case "WhiteBalance":
            case "GainControl":
            case "Contrast":
            case "Saturation":
            case "Sharpness":
            case "SubjectDistanceRange":
            case "FileSource":
              o[a] = v[a][o[a]];
              break;
            case "ExifVersion":
            case "FlashpixVersion":
              o[a] = String.fromCharCode(o[a][0], o[a][1], o[a][2], o[a][3]);
              break;
            case "ComponentsConfiguration":
              o[a] =
                v.Components[o[a][0]] +
                v.Components[o[a][1]] +
                v.Components[o[a][2]] +
                v.Components[o[a][3]];
          }
          n[a] = o[a];
        }
      }
      if (n.GPSInfoIFDPointer) {
        r = l(t, s, s + n.GPSInfoIFDPointer, b, i);
        for (a in r) {
          switch (a) {
            case "GPSVersionID":
              r[a] = r[a][0] + "." + r[a][1] + "." + r[a][2] + "." + r[a][3];
          }
          n[a] = r[a];
        }
      }
      return n;
    }
    var u = !1,
      h = this,
      f = function (t) {
        return t instanceof f
          ? t
          : this instanceof f
          ? void (this.EXIFwrapped = t)
          : new f(t);
      };
    "undefined" != typeof exports
      ? ("undefined" != typeof module &&
          module.exports &&
          (exports = module.exports = f),
        (exports.EXIF = f))
      : (h.EXIF = f);
    var m = (f.Tags = {
        36864: "ExifVersion",
        40960: "FlashpixVersion",
        40961: "ColorSpace",
        40962: "PixelXDimension",
        40963: "PixelYDimension",
        37121: "ComponentsConfiguration",
        37122: "CompressedBitsPerPixel",
        37500: "MakerNote",
        37510: "UserComment",
        40964: "RelatedSoundFile",
        36867: "DateTimeOriginal",
        36868: "DateTimeDigitized",
        37520: "SubsecTime",
        37521: "SubsecTimeOriginal",
        37522: "SubsecTimeDigitized",
        33434: "ExposureTime",
        33437: "FNumber",
        34850: "ExposureProgram",
        34852: "SpectralSensitivity",
        34855: "ISOSpeedRatings",
        34856: "OECF",
        37377: "ShutterSpeedValue",
        37378: "ApertureValue",
        37379: "BrightnessValue",
        37380: "ExposureBias",
        37381: "MaxApertureValue",
        37382: "SubjectDistance",
        37383: "MeteringMode",
        37384: "LightSource",
        37385: "Flash",
        37396: "SubjectArea",
        37386: "FocalLength",
        41483: "FlashEnergy",
        41484: "SpatialFrequencyResponse",
        41486: "FocalPlaneXResolution",
        41487: "FocalPlaneYResolution",
        41488: "FocalPlaneResolutionUnit",
        41492: "SubjectLocation",
        41493: "ExposureIndex",
        41495: "SensingMethod",
        41728: "FileSource",
        41729: "SceneType",
        41730: "CFAPattern",
        41985: "CustomRendered",
        41986: "ExposureMode",
        41987: "WhiteBalance",
        41988: "DigitalZoomRation",
        41989: "FocalLengthIn35mmFilm",
        41990: "SceneCaptureType",
        41991: "GainControl",
        41992: "Contrast",
        41993: "Saturation",
        41994: "Sharpness",
        41995: "DeviceSettingDescription",
        41996: "SubjectDistanceRange",
        40965: "InteroperabilityIFDPointer",
        42016: "ImageUniqueID",
      }),
      g = (f.TiffTags = {
        256: "ImageWidth",
        257: "ImageHeight",
        34665: "ExifIFDPointer",
        34853: "GPSInfoIFDPointer",
        40965: "InteroperabilityIFDPointer",
        258: "BitsPerSample",
        259: "Compression",
        262: "PhotometricInterpretation",
        274: "Orientation",
        277: "SamplesPerPixel",
        284: "PlanarConfiguration",
        530: "YCbCrSubSampling",
        531: "YCbCrPositioning",
        282: "XResolution",
        283: "YResolution",
        296: "ResolutionUnit",
        273: "StripOffsets",
        278: "RowsPerStrip",
        279: "StripByteCounts",
        513: "JPEGInterchangeFormat",
        514: "JPEGInterchangeFormatLength",
        301: "TransferFunction",
        318: "WhitePoint",
        319: "PrimaryChromaticities",
        529: "YCbCrCoefficients",
        532: "ReferenceBlackWhite",
        306: "DateTime",
        270: "ImageDescription",
        271: "Make",
        272: "Model",
        305: "Software",
        315: "Artist",
        33432: "Copyright",
      }),
      b = (f.GPSTags = {
        0: "GPSVersionID",
        1: "GPSLatitudeRef",
        2: "GPSLatitude",
        3: "GPSLongitudeRef",
        4: "GPSLongitude",
        5: "GPSAltitudeRef",
        6: "GPSAltitude",
        7: "GPSTimeStamp",
        8: "GPSSatellites",
        9: "GPSStatus",
        10: "GPSMeasureMode",
        11: "GPSDOP",
        12: "GPSSpeedRef",
        13: "GPSSpeed",
        14: "GPSTrackRef",
        15: "GPSTrack",
        16: "GPSImgDirectionRef",
        17: "GPSImgDirection",
        18: "GPSMapDatum",
        19: "GPSDestLatitudeRef",
        20: "GPSDestLatitude",
        21: "GPSDestLongitudeRef",
        22: "GPSDestLongitude",
        23: "GPSDestBearingRef",
        24: "GPSDestBearing",
        25: "GPSDestDistanceRef",
        26: "GPSDestDistance",
        27: "GPSProcessingMethod",
        28: "GPSAreaInformation",
        29: "GPSDateStamp",
        30: "GPSDifferential",
      }),
      v = (f.StringValues = {
        ExposureProgram: {
          0: "Not defined",
          1: "Manual",
          2: "Normal program",
          3: "Aperture priority",
          4: "Shutter priority",
          5: "Creative program",
          6: "Action program",
          7: "Portrait mode",
          8: "Landscape mode",
        },
        MeteringMode: {
          0: "Unknown",
          1: "Average",
          2: "CenterWeightedAverage",
          3: "Spot",
          4: "MultiSpot",
          5: "Pattern",
          6: "Partial",
          255: "Other",
        },
        LightSource: {
          0: "Unknown",
          1: "Daylight",
          2: "Fluorescent",
          3: "Tungsten (incandescent light)",
          4: "Flash",
          9: "Fine weather",
          10: "Cloudy weather",
          11: "Shade",
          12: "Daylight fluorescent (D 5700 - 7100K)",
          13: "Day white fluorescent (N 4600 - 5400K)",
          14: "Cool white fluorescent (W 3900 - 4500K)",
          15: "White fluorescent (WW 3200 - 3700K)",
          17: "Standard light A",
          18: "Standard light B",
          19: "Standard light C",
          20: "D55",
          21: "D65",
          22: "D75",
          23: "D50",
          24: "ISO studio tungsten",
          255: "Other",
        },
        Flash: {
          0: "Flash did not fire",
          1: "Flash fired",
          5: "Strobe return light not detected",
          7: "Strobe return light detected",
          9: "Flash fired, compulsory flash mode",
          13: "Flash fired, compulsory flash mode, return light not detected",
          15: "Flash fired, compulsory flash mode, return light detected",
          16: "Flash did not fire, compulsory flash mode",
          24: "Flash did not fire, auto mode",
          25: "Flash fired, auto mode",
          29: "Flash fired, auto mode, return light not detected",
          31: "Flash fired, auto mode, return light detected",
          32: "No flash function",
          65: "Flash fired, red-eye reduction mode",
          69: "Flash fired, red-eye reduction mode, return light not detected",
          71: "Flash fired, red-eye reduction mode, return light detected",
          73: "Flash fired, compulsory flash mode, red-eye reduction mode",
          77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
          79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
          89: "Flash fired, auto mode, red-eye reduction mode",
          93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
          95: "Flash fired, auto mode, return light detected, red-eye reduction mode",
        },
        SensingMethod: {
          1: "Not defined",
          2: "One-chip color area sensor",
          3: "Two-chip color area sensor",
          4: "Three-chip color area sensor",
          5: "Color sequential area sensor",
          7: "Trilinear sensor",
          8: "Color sequential linear sensor",
        },
        SceneCaptureType: {
          0: "Standard",
          1: "Landscape",
          2: "Portrait",
          3: "Night scene",
        },
        SceneType: { 1: "Directly photographed" },
        CustomRendered: { 0: "Normal process", 1: "Custom process" },
        WhiteBalance: { 0: "Auto white balance", 1: "Manual white balance" },
        GainControl: {
          0: "None",
          1: "Low gain up",
          2: "High gain up",
          3: "Low gain down",
          4: "High gain down",
        },
        Contrast: { 0: "Normal", 1: "Soft", 2: "Hard" },
        Saturation: { 0: "Normal", 1: "Low saturation", 2: "High saturation" },
        Sharpness: { 0: "Normal", 1: "Soft", 2: "Hard" },
        SubjectDistanceRange: {
          0: "Unknown",
          1: "Macro",
          2: "Close view",
          3: "Distant view",
        },
        FileSource: { 3: "DSC" },
        Components: { 0: "", 1: "Y", 2: "Cb", 3: "Cr", 4: "R", 5: "G", 6: "B" },
      }),
      y = {
        120: "caption",
        110: "credit",
        25: "keywords",
        55: "dateCreated",
        80: "byline",
        85: "bylineTitle",
        122: "captionWriter",
        105: "headline",
        116: "copyright",
        15: "category",
      };
    (f.getData = function (e, i) {
      return (
        !(
          (e instanceof Image || e instanceof HTMLImageElement) &&
          !e.complete
        ) && (t(e) ? i && i.call(e) : a(e, i), !0)
      );
    }),
      (f.getTag = function (e, i) {
        if (t(e)) return e.exifdata[i];
      }),
      (f.getIptcTag = function (e, i) {
        if (t(e)) return e.iptcdata[i];
      }),
      (f.getAllTags = function (e) {
        if (!t(e)) return {};
        var i,
          n = e.exifdata,
          a = {};
        for (i in n) n.hasOwnProperty(i) && (a[i] = n[i]);
        return a;
      }),
      (f.getAllIptcTags = function (e) {
        if (!t(e)) return {};
        var i,
          n = e.iptcdata,
          a = {};
        for (i in n) n.hasOwnProperty(i) && (a[i] = n[i]);
        return a;
      }),
      (f.pretty = function (e) {
        if (!t(e)) return "";
        var i,
          n = e.exifdata,
          a = "";
        for (i in n)
          n.hasOwnProperty(i) &&
            ("object" == typeof n[i]
              ? n[i] instanceof Number
                ? (a +=
                    i +
                    " : " +
                    n[i] +
                    " [" +
                    n[i].numerator +
                    "/" +
                    n[i].denominator +
                    "]\r\n")
                : (a += i + " : [" + n[i].length + " values]\r\n")
              : (a += i + " : " + n[i] + "\r\n"));
        return a;
      }),
      (f.readFromBinaryFile = function (t) {
        return o(t);
      }),
      "function" == typeof define &&
        define.amd &&
        define("exif-js", [], function () {
          return f;
        });
  }.call(this),
  define("lib-app/exif-js/exif", function () {}),
  define(
    "storymaps/tpl/builder/BuilderView",
    [
      "lib-build/tpl!./BuilderView",
      "lib-build/css!./BuilderView",
      "lib-build/css!./Common",
      "../core/WebApplicationData",
      "storymaps/common/builder/settings/SettingsPopup",
      "storymaps/common/builder/Landing",
      "./Help",
      "./InitPopup",
      "storymaps/common/builder/SharePopup",
      "../core/Helper",
      "storymaps/common/utils/CommonHelper",
      "storymaps/common/builder/media/image/FileUploadHelper",
      "./BuilderHelper",
      "storymaps/common/utils/WebMapHelper",
      "esri/arcgis/utils",
      "esri/dijit/BasemapGallery",
      "storymaps/common/builder/browse-dialog/js/BrowseIdDlg",
      "lib-build/css!../../common/builder/browse-dialog/css/browse-dialog",
      "lib-build/css!../../common/builder/browse-dialog/storymaps-override",
      "./settings/ViewGeneralOptions",
      "./settings/ViewMapOptions",
      "./settings/ViewThemeOptions",
      "storymaps/common/builder/settings/ViewHeader",
      "./MapExtentSave",
      "./Workflow",
      "./AddFeatureBar",
      "./DetailPanelBuilder",
      "./media/Popup",
      "./addedit/Popup",
      "./OrganizePopup",
      "./shortlistMigration/Migration",
      "lib-app/exif-js/exif",
      "esri/graphicsUtils",
      "esri/layers/GraphicsLayer",
      "esri/geometry/webMercatorUtils",
      "esri/geometry/Extent",
      "esri/SpatialReference",
      "esri/config",
      "dojo/Deferred",
      "dojo/topic",
      "dojo/has",
      "dojo/on",
      "dojo/_base/lang",
    ],
    function (
      t,
      e,
      i,
      n,
      a,
      o,
      r,
      s,
      l,
      d,
      p,
      c,
      u,
      h,
      f,
      m,
      g,
      b,
      v,
      y,
      w,
      C,
      _,
      x,
      S,
      T,
      k,
      E,
      A,
      I,
      L,
      P,
      D,
      M,
      O,
      R,
      N,
      B,
      F,
      W,
      j,
      H,
      z
    ) {
      return function (e) {
        function i(t) {
          for (
            var e, i, n = /(AND|OR)?\W*([a-z]+):/gi, a = {}, o = n.exec(t);
            o;

          )
            (e = o && o[2]),
              (i = o ? o.index + o[0].length : -1),
              (o = n.exec(t)),
              (a[e] = t
                .substring(i, o ? o.index : t.length)
                .replace(/^\s+|\s+$/g, "")
                .replace(/\"/g, ""));
          return a;
        }
        function a() {
          if (!app.data.getWebAppData().getIsExternalData()) {
            var t = [],
              e = [];
            $.each(
              app.map.getLayer(app.data.getWebAppData().getShortlistLayerId())
                .graphics,
              function (e, i) {
                i.attributes.pic_url.indexOf("sharing/rest/content/items") > -1
                  ? t.push(i.attributes.resource)
                  : i.attributes.thumb_url.indexOf(
                      "sharing/rest/content/items"
                    ) > -1 && t.push(i.attributes.resource);
              }
            ),
              t.length &&
                c.getStoryResources().then(function (i) {
                  $.each(i, function (i, n) {
                    var a = n.picUrl ? n.picUrl : n.sizes[0].url,
                      o = $.grep(t, function (t) {
                        var e = t.picUrl ? t.picUrl : t.sizes[0].url;
                        return (
                          e.indexOf("%20") || (e = decodeURI(e)),
                          e.slice(e.lastIndexOf("/")) ==
                            a.slice(a.lastIndexOf("/"))
                        );
                      }),
                      r = n.thumbFile,
                      s = $.grep(t, function (t) {
                        var e = t.thumbUrl;
                        return (
                          e.indexOf("%20") || (e = decodeURI(e)),
                          e.slice(e.lastIndexOf("/")) ==
                            r.slice(r.lastIndexOf("/"))
                        );
                      });
                    o.length || s.length || e.push(n);
                  }),
                    $.each(e, function (t, e) {
                      c.removeResources(e);
                    });
                });
          }
        }
        function g(t) {
          if (
            (at.updateUI(),
            t && n.setTitle(t),
            W.publish("CORE_UPDATE_UI"),
            b(),
            rt && app.isDirectCreationFirstSave)
          ) {
            $.isEmptyObject(app.data.getWebAppData().getThemeOptions()) &&
              app.data.getWebAppData().setDefaultThemeOptions();
            var e = app.cfg.COLOR_ORDER.split(","),
              i = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                return t.name == e[0];
              });
            $("#contentPanel").css("border-top-color", i[0].color);
            var a = {
                header: app.data.getWebAppData().getThemeOptions().headerColor,
                tabText: "#d8d8d8",
                tab: "#666",
                tabTextActive: "#fff",
                tabActive: i[0].color,
                tabTextHover: "#fff",
                tabHover: "#666",
              },
              o = {};
            (o.title = "Tab 1"),
              app.ui.navBar.init([o], 0, a, n),
              (app.data.getWebMap().item.extent = p.serializeExtentToItem(
                app.map.extent
              )),
              (app.map._params.extent = new R(
                JSON.parse(JSON.stringify(app.map.extent.toJson()))
              )),
              st && ((st = !1), at.appInitComplete());
          }
        }
        function b() {
          at.updateUI(),
            $("body").removeClass("isBuilderLanding"),
            (app.isInitializing = !1),
            W.publish("BUILDER_INCREMENT_COUNTER", 1);
        }
        function v() {
          $(".builder-add").toggleClass("disabled", !1).tooltip("destroy");
        }
        function P(t) {
          var e = new F();
          return (
            ht.present({
              mode: "edit",
              displayTab: t.displayTab,
              entry: app.data.getStoryByIndex(t.entryIndex),
              entryIndex: t.entryIndex,
            }),
            e
          );
        }
        function H() {
          $(".builder-organize").hasClass("disabled") ||
            ($(".builder-organize").addClass("active"),
            mt
              .present({
                entries: app.data.getStory(),
                sectionIndex: $(".entry.active").index(),
              })
              .then(
                function (t) {
                  console.log("builder.BuilderView.openOrganizePopup:", t),
                    $(".builder-organize").removeClass("active"),
                    mt.close();
                  var e = {
                    header: app.data.getWebAppData().getThemeOptions()
                      .headerColor,
                    tabText: "#d8d8d8",
                    tab: "#666",
                    tabTextActive: "#fff",
                    tabActive: t.entries[t.sectionIndex].color,
                    tabTextHover: "#fff",
                    tabHover: "#666",
                  };
                  app.ui.navBar.init(t.entries, t.sectionIndex, e, n),
                    app.detailPanelBuilder.updateThemeSwipers(t),
                    at.updateAllFeatures(t),
                    app.detailPanelBuilder.buildAllSlides(),
                    Z.activateLayer(t.sectionIndex),
                    W.publish("story-update-entries"),
                    W.publish("BUILDER_INCREMENT_COUNTER", 1);
                },
                function () {}
              ));
        }
        function U(t, e) {
          var i = at.buildWebMap();
          if (
            (app.data.getWebAppData().setTitle(app.data.getWebAppItem().title),
            (i.item.title =
              app.data.getResponse().itemInfo.item.title +
              " - Shortlist builder"),
            (app.data.getResponse().itemInfo.item.title = i.item.title),
            app.data.getWebAppItem().description ||
              app.data.getWebAppItem().snippet)
          ) {
            var n = app.data.getWebAppItem().snippet
              ? app.data.getWebAppItem().snippet
              : app.data.getWebAppItem().description;
            app.data.getWebAppData().setSubtitle(n), (i.item.description = n);
          } else if (
            app.data.getResponse().itemInfo.item.description ||
            app.data.getResponse().itemInfo.item.snippet
          ) {
            var n = app.data.getResponse().itemInfo.item.snippet
              ? app.data.getResponse().itemInfo.item.snippet
              : app.data.getResponse().itemInfo.item.description;
            app.data.getWebAppData().setSubtitle(n), (i.item.description = n);
          }
          app.ui.headerDesktop.setTitleAndSubtitle(
            app.data.getWebAppData().getTitle(),
            app.data.getWebAppData().getSubtitle()
          ),
            (i.item.extent = app.data.getResponse().itemInfo.item.extent),
            (i.itemData.spatialReference =
              app.data.getResponse().itemInfo.itemData.spatialReference),
            (i.itemData.baseMap =
              app.data.getResponse().itemInfo.itemData.baseMap),
            (app.mapItem = app.data.getResponse().itemInfo),
            app.data.getResponse().itemInfo.itemData.bookmarks &&
              app.data.getResponse().itemInfo.itemData.bookmarks.length &&
              (i.itemData.bookmarks =
                app.data.getResponse().itemInfo.itemData.bookmarks),
            app.data
              .getWebAppData()
              .setOriginalWebmap(app.data.getWebAppData().getWebmap()),
            app.map.destroy(),
            (app.map = null);
          var a = Z.loadWebmap(i, "map");
          a.then(function (i) {
            app.data.setResponse(i), (app.map = a.results[0].map);
            var n = app.data.getWebAppData().getGeneralOptions();
            (n.extentMode = "customHome"),
              app.data.getWebAppData().setGeneralOptions(n),
              at.storyDataReady();
            var o = app.cfg.COLOR_ORDER.split(","),
              r = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                return t.name == o[0];
              });
            $("#contentPanel").css("border-top-color", r[0].color);
            var s = {
                header: app.data.getWebAppData().getThemeOptions().headerColor,
                tabText: "#d8d8d8",
                tab: "#666",
                tabTextActive: "#fff",
                tabActive: r[0].color,
                tabTextHover: "#fff",
                tabHover: "#666",
              },
              l = {};
            (l.title = "Tab 1"),
              app.ui.navBar.init([l], 0, s, app.data.getWebAppData());
            var d = [];
            $.each(e, function (t, e) {
              var i,
                n = $.grep(
                  app.data.getWebMap().itemData.operationalLayers,
                  function (t) {
                    return t.id == e.id.slice(0, -2);
                  }
                );
              (i = e.layerType ? e.layerType : e.type),
                e.url &&
                  ("ArcGISFeatureLayer" === i ||
                    "Feature Layer" === i ||
                    e.tileMap ||
                    e.tileInfo) &&
                  !e.id.match(/^csv_/) &&
                  (n = $.grep(
                    app.data.getWebMap().itemData.operationalLayers,
                    function (t) {
                      return t.id == e.id;
                    }
                  )),
                n[0] && (d.push(n[0]), app.map.addLayer(e));
            }),
              $.each(t, function (t, e) {
                var i,
                  n = $.grep(
                    app.data.getWebMap().itemData.operationalLayers,
                    function (t) {
                      return t.id == e.id.slice(0, -2);
                    }
                  );
                (i = e.layerType ? e.layerType : e.type),
                  !e.url ||
                    ("ArcGISFeatureLayer" !== i && "Feature Layer" !== i) ||
                    e.id.match(/^csv_/) ||
                    (n = $.grep(
                      app.data.getWebMap().itemData.operationalLayers,
                      function (t) {
                        return t.id == e.id;
                      }
                    )),
                  n[0] && (d.push(n[0]), app.map.addLayer(e));
              }),
              t.reverse(),
              app.data.setWebMap(a.results[0].itemInfo),
              app.addFeatureBar.addLayer(!0),
              $.each(d, function (t, e) {
                app.data.getWebMap().itemData.operationalLayers.push(e);
              });
            var p = app.data.getWebMap();
            z.mixin(p.item, {
              uploaded: Date.now(),
              modified: Date.now(),
              owner: app.data.getWebAppItem().owner,
              access: "private",
            }),
              at.updateUI(),
              ot.appInitComplete(app.data.getWebAppData());
            var c = app.map.getLayer(app.data.getShortlistLayerId()),
              u = !1;
            if (
              (app.map
                .getLayer(
                  app.data.getWebMap().itemData.baseMap.baseMapLayers[0].id
                )
                .on("update-end", function () {
                  u || (u = !0);
                }),
              $("#loadingIndicator").show(),
              app.data.getResponse().itemInfo.itemData.bookmarks &&
                app.data.getResponse().itemInfo.itemData.bookmarks.length)
            ) {
              var h = {
                extentMode: "customHome",
                numberedIcons: !1,
                filterByExtent: !0,
                bookmarks: !0,
                bookmarksAlias: app.cfg.BOOKMARKS_ALIAS,
              };
              app.data.getWebAppData().setGeneralOptions(h),
                app.ui.navBar.initBookmarks();
            }
            setTimeout(function () {
              ot.displayApp(),
                Z.activateLayer(0),
                app.map.setExtent(app.map._params.extent, !0),
                W.publish("BUILDER_INCREMENT_COUNTER", 1),
                app.data
                  .getWebAppItem()
                  .typeKeywords.push("Shortlist-migration"),
                (app.maps[i.itemInfo.item.id] = Z.getMapConfig(i)),
                app.map.reorderLayer(c, app.map.graphicsLayerIds.length - 1);
            }, 800);
          });
        }
        function G(t, e) {
          var i = 4 * e,
            n = t.data;
          return [n[i], n[i + 1], n[i + 2], n[i + 3]];
        }
        function V(t) {
          var e = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
          t = t.replace(e, function (t, e, i, n) {
            return e + e + i + i + n + n;
          });
          var i = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);
          return i
            ? {
                r: parseInt(i[1], 16),
                g: parseInt(i[2], 16),
                b: parseInt(i[3], 16),
              }
            : null;
        }
        function q(t, e) {
          return new esri.symbol.PictureMarkerSymbol(
            t.toDataURL(),
            e.getWidth(),
            e.getHeight()
          ).setOffset(e.getOffsetX(), e.getOffsetY());
        }
        function K() {
          $(".builder-title-mask").hide(),
            $("#builderQuotes").css("display", "none", "!important"),
            $("#builderLanding").css("display", "none", "!important");
        }
        function Y(t) {
          var e =
              t.settings[1].extentMode !=
              app.data.getWebAppData().getGeneralOptions().extentMode,
            i =
              t.settings[0].numberedIcons !=
              app.data.getWebAppData().getGeneralOptions().numberedIcons,
            n =
              t.settings[1].locateButton !=
              app.data.getWebAppData().getGeneralOptions().locateButton,
            a =
              t.settings[1].geocoder !=
              app.data.getWebAppData().getGeneralOptions().geocoder,
            o =
              t.settings[1].bookmarks !=
              app.data.getWebAppData().getGeneralOptions().bookmarks,
            r =
              t.settings[1].bookmarksAlias !=
              app.data.getWebAppData().getGeneralOptions().bookmarksAlias,
            s = t.settings[0];
          $.extend(s, t.settings[1]),
            app.data.getWebAppData().setGeneralOptions(t.settings[0]),
            app.data.getWebAppData().setThemeOptions(t.settings[2]),
            app.data.getWebAppData().setHeader(t.settings[3]),
            e && W.publish("UPDATE_EXTENT_MODE", t.settings[1].extentMode),
            i &&
              setTimeout(function () {
                at.updateAllFeatures(),
                  app.data.getWebAppData().getIsExternalData() ||
                    app.detailPanelBuilder.buildAllSlides(),
                  Z.activateLayer($(".entry.active").index()),
                  setTimeout(function () {
                    app.ui.mainView.selected &&
                      ((app.ui.mainView.selected = null),
                      app.mapTips && app.mapTips.clean(!0));
                  }, 50);
              }, 50),
            n &&
              (!app.maps[app.data.getWebAppData().getWebmap()] &&
              app.maps[app.data.getWebAppData().getOriginalWebmap()]
                ? app.maps[
                    app.data.getWebAppData().getOriginalWebmap()
                  ].mapCommand.enableLocationButton(t.settings[1].locateButton)
                : app.maps[
                    app.data.getWebAppData().getWebmap()
                  ].mapCommand.enableLocationButton(
                    t.settings[1].locateButton
                  )),
            a &&
              (!app.maps[app.data.getWebAppData().getWebmap()] &&
              app.maps[app.data.getWebAppData().getOriginalWebmap()]
                ? app.maps[
                    app.data.getWebAppData().getOriginalWebmap()
                  ].geocoder.toggle(t.settings[1].geocoder)
                : app.maps[app.data.getWebAppData().getWebmap()]
                ? app.maps[
                    app.data.getWebAppData().getWebmap()
                  ].geocoder.toggle(t.settings[1].geocoder)
                : app.maps.map.geocoder.toggle(t.settings[1].geocoder)),
            o &&
              (!app.ui.navBar.bookmarksLoaded && t.settings[1].bookmarks
                ? app.ui.navBar.initBookmarks()
                : app.ui.navBar.bookmarksLoaded && t.settings[1].bookmarks
                ? app.ui.navBar.showBookmarks()
                : app.ui.navBar.hideBookmarks()),
            r &&
              app.ui.navBar.updateBookmarksAlias(t.settings[1].bookmarksAlias),
            W.publish("BUILDER_INCREMENT_COUNTER", 1),
            W.publish("CORE_UPDATE_UI"),
            W.publish("CORE_RESIZE"),
            v();
        }
        function Q(t) {
          ut.present(t, e.getHeaderUserCfg()),
            t &&
              app.isDirectCreationFirstSave &&
              ((app.maps[app.data.getWebAppData().getWebmap()] = Z.getMapConfig(
                app.data.getResponse()
              )),
              $.each(
                $(".esriSimpleSliderIncrementButton .mapCommandHomeBtn"),
                function (t, e) {
                  0 !== t && $(e).parent().remove();
                }
              ));
        }
        function X(t) {
          var e = app.data.getWebAppData().getGeneralOptions();
          (e.extentMode = t),
            app.data.getWebAppData().setGeneralOptions(e),
            "default" == t &&
              ((app.appCfg.mapExtentFit = !0),
              gt.initDone && gt.hideAlways(),
              at.updateShortlistExtent(),
              $(".tab-cfg-location").hide()),
            "customHome" == t &&
              ((app.appCfg.mapExtentFit = !0),
              gt.initDone || at.initMapExtentSave(),
              gt.reinit(),
              $(".tab-cfg-location").hide()),
            "customTheme" == t &&
              (gt.initDone && gt.hideAlways(), $(".tab-cfg-location").show());
        }
        function J() {
          $("#headerDesktop").find(".title").text().length &&
            $("#headerDesktop").find(".title").removeClass("titleEmpty");
        }
        $("#builder-views").append(t({}));
        var Z,
          tt,
          et,
          it,
          nt,
          at = this,
          ot = e,
          rt = !0,
          st = !0,
          lt = !1,
          dt = null,
          pt = new o($("#builderLanding"), g, function () {
            alert("TODO");
          }),
          ct = (new s($("#initPopup")), new r($("#builderHelp"))),
          ut = new l($("#sharePopup")),
          ht = (new d(), new A($("#addEditPopup"), at)),
          ft = new E($("#editorDialogInlineMedia")),
          mt = new I($("#organizePopup")),
          gt = (new S($("#initPopup")), new x($("#map_zoom_slider"), at));
        (app.detailPanelBuilder = new k($("#contentPanel"), ft)),
          (app.addFeatureBar = new T($("#contentPanel"), ft)),
          (app.initScreenIsOpen = !0),
          (this.init = function (t) {
            var e = navigator.appVersion.indexOf("Edge") > 0;
            if (app.isInBuilder && e) return ot.initError("noBuilderEdge"), !1;
            (dt = t),
              (Z = app.ui.mainView),
              (tt = new L($("#migrationPopup"), ot, Z, at, n)),
              W.subscribe("SETTINGS_POPUP_SAVE", Y),
              W.subscribe("OPEN_HELP", function () {
                ct.present();
              }),
              W.subscribe("HEADER_EDITED", J),
              W.subscribe("UPDATE_EXTENT_MODE", X),
              W.subscribe("DIRECT_CREATION_SAVE", K),
              (app.builder.openSharePopup = Q),
              (app.builder.openEditPopup = P),
              $(".builder-add")
                .click(function () {
                  $(this).hasClass("disabled") || b();
                })
                .find(".builder-lbl")
                .html(i18n.builder.addEditPopup.lblAdd),
              $(".builder-organize")
                .click(H)
                .find(".builder-lbl")
                .html(i18n.builder.addEditPopup.organizeTabs),
              (it = document.createElement("canvas")),
              (nt = it.getContext("2d")),
              (et = new Image()),
              (et.src = app.cfg.ICON_SRC),
              (et.onload = function () {
                nt.drawImage(et, 0, 0), (nt.font = it.width / 2 + "pt");
              }),
              at.showInitPopup();
          }),
          (this.appInitComplete = function () {
            app.isProduction || "add" != p.getUrlParams().debug || b(),
              app.isProduction || "organize" != p.getUrlParams().debug || H(),
              app.isProduction ||
                "settings" != p.getUrlParams().debug ||
                this.openSettingPopup(),
              app.isProduction ||
                "edit" != p.getUrlParams().debug ||
                P({
                  displayTab: p.getUrlParams().debugView || "content",
                  sectionIndex: p.getUrlParams().debugIndex || 0,
                }),
              app.data.getWebAppData().getIsExternalData() &&
                ($(".tab-cfg-extent-mode").remove(),
                $(".settings-mapoptions").css("margin-top", "40px"),
                $(".bookmarkTooltip").css({ top: "102px" })),
              v();
          }),
          (this.storyDataReady = function () {
            app.initScreenIsOpen = !1;
            var t = dijit.byId("basemapGallery");
            t && t.destroyRecursive(!0);
            var e = {
                map: app.map,
                portalUrl: f.arcgisUrl.split("/sharing/")[0],
                bingMapsKey: app.portal.bingKey,
              },
              n = app.portal.basemapGalleryGroupQuery;
            app.portal.hasOwnProperty("useVectorBasemaps") &&
              !0 === app.portal.useVectorBasemaps &&
              app.portal.vectorBasemapGalleryGroupQuery &&
              (n = app.portal.vectorBasemapGalleryGroupQuery);
            var a = i(n);
            (e.basemapsGroup = null),
              a.id
                ? (e.basemapsGroup = { id: a.id })
                : a.title && a.owner
                ? (e.basemapsGroup = { title: a.title, owner: a.owner })
                : (e.showArcGISBasemaps = !0),
              (t = new m(e, "basemapGallery")),
              t.startup(),
              $("#basemapChooser .dijitTitlePaneTextNode").text(
                i18n.builder.settings.changeBasemap
              ),
              $("#basemapChooser").show();
            var o = app.map.extent;
            t.on("selection-change", function () {
              o = app.map.extent;
              var e = t.getSelected(),
                i = [];
              $.each(e.layers, function (t, n) {
                var a = {
                  id: e.id + "_" + t,
                  opacity: 1,
                  visibility: !0,
                  url: n.url,
                };
                "reference" == n.type
                  ? (a.isReference = !0)
                  : "OpenStreetMap" == n.type
                  ? (delete a.url, (a.type = "OpenStreetMap"))
                  : "VectorTileLayer" == n.type
                  ? (delete a.url,
                    (a.type = "VectorTileLayer"),
                    (a.layerType = "VectorTileLayer"),
                    (a.title = e.title),
                    (a.styleUrl = n.styleUrl),
                    (a.itemId = e.itemId))
                  : "WebTiledLayer" == n.type &&
                    (delete a.url,
                    (a.templateUrl = n.templateUrl),
                    (a.copyright = n.copyright),
                    (a.fullExtent = n.fullExtent),
                    (a.subDomains = n.subDomains),
                    (a.title = e.title),
                    (a.type = "WebTiledLayer"),
                    (a.layerType = "WebTiledLayer")),
                  i.push(a);
              }),
                (app.data.getWebMap().itemData.baseMap = {
                  baseMapLayers: i,
                  title: e.title,
                }),
                (app.basemapChanged = !0),
                W.publish("BUILDER_INCREMENT_COUNTER", 1),
                $("#basemapChooser").find(".dijitTitlePaneTitle").click(),
                setTimeout(function () {
                  app.map.setExtent(o);
                }, 500);
            }),
              g(),
              (rt = !1);
            app.initScreenIsOpen = !0;
          }),
          (this.updateUI = function (t) {
            var e = t || app.data.getStoryLength();
            $(".builder-add, .builder-organize").removeClass("active"),
              !e && app.isDirectCreation && st
                ? (pt.toggle(!e),
                  $(".builder-content-panel").toggle(!!e),
                  $(".builder-title-mask").show(),
                  (app.isWebMapFirstSave = !0),
                  at.initPopupComplete())
                : at.initPopupComplete(),
              app.data.getWebAppData().getIsExternalData() &&
                ($("#myList").height($("#paneLeft").height() - 48),
                $(".builder-organize").remove(),
                $(".builder-add").remove()),
              $("#search").hide();
          }),
          (this.preWebmapSave = function () {
            var t = app.map.getLayer(app.data.getShortlistLayerId()),
              e = $.grep(
                app.data.getWebMap().itemData.operationalLayers,
                function (t) {
                  return (
                    t.id ==
                      n
                        .getShortlistLayerId()
                        .split("_")
                        .slice(0, -1)
                        .join("_") ||
                    t.id ==
                      app.data
                        .getShortlistLayerId()
                        .split("_")
                        .slice(0, -1)
                        .join("_")
                  );
                }
              );
            e[0] ||
              (e = $.grep(
                app.data.getWebMap().itemData.operationalLayers,
                function (t) {
                  return (
                    t.id == n.getShortlistLayerId() ||
                    t.id == app.data.getShortlistLayerId()
                  );
                }
              )),
              (e[0].featureCollection =
                h.serializeGraphicsLayerToFeatureCollection(t)),
              app.isWebMapFirstSave && app.ui.mainView.activateLayer(0),
              a();
          }),
          (this.buildWebMap = function () {
            return u.getBlankWebmapJSON();
          }),
          (this.getSettingsTab = function () {
            return [
              new y(),
              new w(),
              new C(),
              new _({ smallSizeOpt: app.appCfg.headerCompactOpt }),
            ];
          }),
          (this.openSettingPopup = function () {
            if (!app.data.getWebAppData().getHeader().compactSize) {
              var t = app.data.getWebAppData().getHeader();
              (t.compactSize = app.appCfg.headerCompactByDefault),
                n.setHeader(t);
            }
            dt.present(
              [
                n.getGeneralOptions(),
                n.getGeneralOptions(),
                n.getThemeOptions(),
                n.getHeader(),
              ],
              null
            );
          }),
          (this.openMigrationPopup = function (t, e) {
            tt.present(t, e).then(function (t) {
              if (t.migrate && "as-is" != t.migrate) app.isWebMapFirstSave = !0;
              else if (
                ((app.maps[app.data.getResponse().itemInfo.item.id] =
                  Z.getMapConfig(app.data.getResponse())),
                "as-is" == t.migrate &&
                  (app.data.getWebAppData().setIsExternalData(!0),
                  (app.isGalleryCreation = !1)),
                app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo
                  .item.owner == app.data.getWebAppItem().owner ||
                  app.data.getWebAppData().getIsExternalData())
              ) {
                var e =
                    app.maps[app.data.getWebAppData().getWebmap()].response
                      .itemInfo.item,
                  i = e.snippet ? e.snippet : e.description;
                if (
                  (app.ui.headerDesktop.setTitleAndSubtitle(
                    app.data.getWebAppItem().title,
                    i
                  ),
                  app.data
                    .getWebAppData()
                    .setTitle(app.data.getWebAppItem().title),
                  i && app.data.getWebAppData().setSubtitle(i),
                  app.data.getResponse().itemInfo.itemData.bookmarks &&
                    app.data.getResponse().itemInfo.itemData.bookmarks.length)
                ) {
                  var a = {
                    extentMode: "customHome",
                    numberedIcons: !1,
                    filterByExtent: !0,
                    bookmarks: !0,
                    bookmarksAlias: app.cfg.BOOKMARKS_ALIAS,
                  };
                  app.data.getWebAppData().setGeneralOptions(a),
                    app.ui.navBar.initBookmarks();
                }
                at.storyDataReady(),
                  t.migrate
                    ? (app.data.getWebAppData().getShortlistLayerId() &&
                        app.map.removeLayer(
                          app.map.getLayer(
                            app.data.getWebAppData().getShortlistLayerId()
                          )
                        ),
                      app.data.getWebAppData().clearTabs(),
                      $(".tab-cfg-extent-mode").remove(),
                      $(".settings-mapoptions").css("margin-top", "40px"),
                      $(".bookmarkTooltip").css({ top: "102px" }),
                      at.openNoDataEditMode())
                    : ((app.isWebMapFirstSave = !0),
                      app.addFeatureBar.addLayer(),
                      ot.appInitComplete(n),
                      ot.displayApp(),
                      app.detailPanelBuilder.init(app.ui.mainView, at));
              } else
                U(t.pointLayers, t.layers),
                  app.detailPanelBuilder.init(app.ui.mainView, at);
            });
          }),
          (this.openNoDataEditMode = function () {
            $("#addFeatureBar").remove(),
              $("#myList").height($("#paneLeft").height() - 48),
              $(".builder-organize").remove(),
              $(".builder-add").remove(),
              Z.processExternalData();
          }),
          (this.updateAllFeatures = function (t) {
            var e = 0,
              i = app.map.getLayer(app.data.getShortlistLayerId()),
              a = i.graphics,
              o = {};
            if (
              ($.each(a, function (t, e) {
                e.attributes.tab_id in o ||
                  (o[e.attributes.tab_id] = e.attributes.tab_id);
              }),
              t)
            ) {
              $.each(t.entries, function (t, e) {
                delete o[e.id];
              });
              var r = a.slice(0);
              $.each(r, function (t, e) {
                e.attributes.tab_id in o && i.remove(e);
              });
              var s = [];
              $.each(t.entries, function (t, e) {
                s.push(
                  $.grep(a, function (t) {
                    return t.attributes.tab_id == e.id;
                  })
                );
              }),
                $.each(s, function (t, e) {
                  $.each(e, function (e, i) {
                    i.attributes.tab_id = t;
                  }),
                    (e.id = t);
                });
            }
            var l = [],
              d = $("#nav-bar").find(".nav-tabs > li:not(.dropdown)");
            $.each(d, function () {
              l.push([]);
            }),
              $.each(a, function (t, e) {
                parseInt(e.attributes.tab_id) > -1 &&
                  l[parseInt(e.attributes.tab_id)].push(e);
              });
            var p = [],
              c = [],
              u = null;
            if (app.data.getWebAppData().getIsExternalData()) {
              app.data.getWebAppData().getGeneralOptions().numberedIcons
                ? ($(".detailFeatureTitle").removeClass("notNumbered"),
                  $(".detailFeatureTitle").css("margin-top", "-45px"))
                : $(".detailFeatureTitle").addClass("notNumbered");
              var h = i.fields;
              $.each(h, function (t, e) {
                ("number" != e.name.toLowerCase() &&
                  "placenumsl" != e.name.toLowerCase()) ||
                  (u = e.name);
              });
            }
            $.each(l, function (i, n) {
              n.sort(function (t, e) {
                var i =
                    t.attributes[
                      $.grep(Object.keys(t.attributes), function (t) {
                        return "number" == t.toLowerCase();
                      })[0]
                    ],
                  n =
                    e.attributes[
                      $.grep(Object.keys(e.attributes), function (t) {
                        return "number" == t.toLowerCase();
                      })[0]
                    ];
                return parseInt(i) - parseInt(n);
              });
              var a =
                  t && t.entries[i].color
                    ? t.entries[i].color
                    : app.data.getStory()[i].color,
                o =
                  t && t.entries[i].title
                    ? t.entries[i].title
                    : app.data.getStory()[i].title;
              app.data.getWebAppData().getIsExternalData()
                ? ($.each(n, function (t, e) {
                    e.attributes.number = u ? e.attributes[u] : t + 1;
                    var i = at.addMapIcon(e, a);
                    e.symbol = i.symbol;
                  }),
                  $.each(
                    $("#detailView" + i + " .swiper-slide"),
                    function (t, e) {
                      $(e)
                        .find(".detailFeatureNum")
                        .text(t + 1),
                        $(e)
                          .find(".detailFeatureNum")
                          .css("background-color", a),
                        $(e)
                          .find(".detailFeatureNum")
                          .toggle(
                            app.data.getWebAppData().getGeneralOptions()
                              .numberedIcons
                          );
                    }
                  ))
                : $.each(n, function (t, i) {
                    (i.attributes.shortlist_id = e),
                      (i.attributes.number = t + 1);
                    var n = at.addMapIcon(i, a);
                    (i.symbol = n.symbol), e++;
                  }),
                p.push(o),
                c.push(a);
            }),
              app.data.clearStory(),
              $.each(l, function (t) {
                app.data.setStory(t, p[t], c[t]);
              }),
              n.setTabs(app.data.getStory());
            $(".entry.active").index();
            t && t.sectionIndex,
              app.ui.tilePanel.buildTilePanel(),
              i.redraw(),
              n.getTitle() && W.publish("BUILDER_INCREMENT_COUNTER");
          }),
          (this.addMapIcon = function (t, e, i) {
            var a,
              o = app.ui.mainView.lutIconSpecs.tiny,
              r = e,
              s = document.createElement("canvas");
            (s.width = et.width), (s.height = et.height);
            var l = s.getContext("2d");
            if (
              ((l.font = s.width / 3.8 + "pt open_sanssemibold, sans-serif"),
              l.drawImage(it, 0, 0),
              !a)
            ) {
              var d = l.getImageData(0, 0, it.width, it.height),
                p = G(d, 4804);
              if (p[0] != V(r).r || p[1] != V(r).g || p[2] != V(r).b) {
                for (var c = 0; c < d.data.length; c += 4)
                  d.data[c] == p[0] &&
                    d.data[c + 1] == p[1] &&
                    d.data[c + 2] == p[2] &&
                    ((d.data[c] = V(r).r),
                    (d.data[c + 1] = V(r).g),
                    (d.data[c + 2] = V(r).b));
                l.putImageData(d, 0, 0);
              }
              a = d;
            }
            if (
              (l.putImageData(a, 0, 0), n.getGeneralOptions().numberedIcons)
            ) {
              var u = t.attributes.PLACENUMSL
                ? t.attributes.PLACENUMSL
                : t.attributes.number;
              (l.textAlign = "center"),
                (l.fillStyle = "white"),
                l.fillText(u, s.width / 3.2, s.height / 2);
            }
            if (!i) {
              return new esri.Graphic(
                new esri.geometry.Point(t.geometry),
                q(s, o),
                t.attributes
              );
            }
            t.setSymbol(q(s, o));
          }),
          (this.showInitPopup = function () {
            e.initPopupPrepare(), j("touch") || pt.focus();
          }),
          (this.initPopupComplete = function (t) {
            if (!lt || app.isGalleryCreation) {
              if (((lt = !0), t && t.pickWebmap))
                e.initPopupComplete(),
                  $("#browse-id-dialog").css({ top: "25%", left: "25%" }),
                  $("#browse-id-dialog").show();
              else {
                if (
                  (e.initPopupComplete(),
                  app.data.getWebAppData().setDefaultLayoutOptions(),
                  at.buildAddFeatureBar(),
                  app.isDirectCreationFirstSave &&
                    (app.addFeatureBar.addLayer(),
                    app.data.getWebAppData().setDefaultGeneralOptions(),
                    app.map.centerAndZoom([0, 0], 3),
                    setTimeout(function () {
                      (app.data.getWebMap().item.extent =
                        p.serializeExtentToItem(app.map.extent)),
                        (app.map._params.extent = new R(
                          JSON.parse(JSON.stringify(app.map.extent.toJson()))
                        )),
                        app.data.getWebAppData().setMapExtent(app.map.extent);
                    }, 500)),
                  app.isGalleryCreation)
                ) {
                  var i = app.cfg.COLOR_ORDER.split(","),
                    a = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                      return t.name == i[0];
                    });
                  $("#contentPanel").css("border-top-color", a[0].color);
                  var o = {
                      header: app.data.getWebAppData().getThemeOptions()
                        .headerColor,
                      tabText: "#d8d8d8",
                      tab: "#666",
                      tabTextActive: "#fff",
                      tabActive: a[0].color,
                      tabTextHover: "#fff",
                      tabHover: "#666",
                    },
                    r = 0,
                    s = {};
                  (s.title = "Tab 1"),
                    app.ui.navBar.init([s], r, o, n),
                    "map" == app.data.getWebAppData().getWebmap() &&
                      (app.addFeatureBar.addLayer(),
                      app.data.getWebAppData().setDefaultGeneralOptions(),
                      app.map.centerAndZoom([0, 0], 3),
                      setTimeout(function () {
                        (app.data.getWebMap().item.extent =
                          p.serializeExtentToItem(app.map.extent)),
                          (app.map._params.extent = new R(
                            JSON.parse(JSON.stringify(app.map.extent.toJson()))
                          )),
                          app.ui.headerDesktop.setTitleAndSubtitle(
                            app.data.getWebAppItem().title,
                            app.data.getWebAppItem().description
                          ),
                          app.data
                            .getWebAppData()
                            .setTitle(app.data.getWebAppItem().title),
                          app.data.getWebAppItem().description &&
                            app.data
                              .getWebAppData()
                              .setSubtitle(
                                app.data.getWebAppItem().description
                              ),
                          W.publish("BUILDER_INCREMENT_COUNTER", 1);
                      }, 500));
                } else {
                  st = !1;
                  var l = $.grep(app.map.graphicsLayerIds, function (t) {
                    return t.split("_").slice(0, -1).join("_") ==
                      n.getShortlistLayerId()
                      ? t
                      : t == n.getShortlistLayerId() && t;
                  });
                  if (!l.length) {
                    var i = app.cfg.COLOR_ORDER.split(","),
                      a = $.grep(app.cfg.COLOR_SCHEMES, function (t) {
                        return t.name == i[0];
                      });
                    $("#contentPanel").css("border-top-color", a[0].color);
                    var o = {
                        header: app.data.getWebAppData().getThemeOptions()
                          .headerColor,
                        tabText: "#d8d8d8",
                        tab: "#666",
                        tabTextActive: "#fff",
                        tabActive: a[0].color,
                        tabTextHover: "#fff",
                        tabHover: "#666",
                      },
                      r = 0,
                      s = {};
                    return (
                      (s.title = "Tab 1"),
                      app.ui.navBar.init([s], r, o, n),
                      app.addFeatureBar.addLayer(!0),
                      app.data.getWebAppData().getGeneralOptions() ||
                        app.data.getWebAppData().getGeneralOptions()
                          .bookmarks ||
                        app.data.getWebAppData().setDefaultGeneralOptions(),
                      void setTimeout(function () {
                        at.initMapExtentSave();
                      }, 2500)
                    );
                  }
                  app.data.setShortlistLayerId(l[0]);
                  var d = app.map.getLayer(app.data.getShortlistLayerId());
                  app.data.getWebAppData().getIsExternalData(),
                    d.on("mouse-over", Z.layer_onMouseOver),
                    d.on("mouse-out", Z.layer_onMouseOut),
                    d.on("click", Z.layer_onClick);
                }
                W.publish("CORE_UPDATE_UI"),
                  app.map.on("pan-start", function () {
                    app.ui.mainView.mapIsPanning = !0;
                  }),
                  app.map.on("pan-end", function () {
                    setTimeout(function () {
                      app.ui.mainView.mapIsPanning = !1;
                    }, 800);
                  }),
                  app.map.on("zoom-start", function () {
                    app.ui.mainView.mapIsZooming = !0;
                  }),
                  app.map.on("zoom-end", function () {
                    setTimeout(function () {
                      app.ui.mainView.mapIsZooming = !1;
                    }, 800);
                  }),
                  $("body").addClass("switchLayout"),
                  e.appInitComplete(n),
                  "customHome" ==
                    app.data.getWebAppData().getGeneralOptions().extentMode &&
                    setTimeout(function () {
                      gt.initDone || at.initMapExtentSave();
                    }, 500);
              }
              app.detailPanelBuilder.init(Z, at);
            }
          }),
          (this.initMapExtentSave = function () {
            gt.init();
          }),
          (this.buildAddFeatureBar = function () {
            app.addFeatureBar.loaded ||
              app.data.getWebAppData().getIsExternalData() ||
              app.addFeatureBar.init(Z, at);
          }),
          (this.updateShortlistExtent = function () {
            if (
              1 ==
              app.map.getLayer(app.data.getWebAppData().getShortlistLayerId())
                .graphics.length
            ) {
              var t = app.map.getLayer(
                app.data.getWebAppData().getShortlistLayerId()
              ).graphics[0].geometry;
              4326 != app.map.spatialReference.wkid &&
                (t = O.webMercatorToGeographic(t)),
                app.map.centerAndZoom([t.x, t.y], 13);
            }
            var e = new M();
            $.each(
              app.map.getLayer(app.data.getWebAppData().getShortlistLayerId())
                .graphics,
              function (t, i) {
                i.attributes.locationSet && e.graphics.push(i);
              }
            );
            var i, a;
            if (
              (e.graphics.length > 1
                ? ((i = D.graphicsExtent(e.graphics)),
                  app.map.getLayer(app.data.getShortlistLayerId()).redraw(),
                  (a = new R(JSON.parse(JSON.stringify(i.toJson())))))
                : 1 == e.graphics.length &&
                  (a = new R(
                    JSON.parse(JSON.stringify(app.map.extent.toJson()))
                  )),
              "default" ==
                app.data.getWebAppData().getGeneralOptions().extentMode &&
                ((app.appCfg.mapExtentFit = !0),
                $.each(app.data.getStory(), function (t) {
                  app.data.setStory(t, null, null, a);
                }),
                at.serializeExtentToItem(i),
                (app.map._params.extent = a),
                app.data.getWebAppData().setTabs(app.data.getStory()),
                app.data.getWebAppData().setMapExtent(i)),
              "customTheme" ==
                app.data.getWebAppData().getGeneralOptions().extentMode)
            ) {
              app.appCfg.mapExtentFit = !0;
              var o = $(".entry.active").index();
              app.data.setStory(o, null, null, a),
                n.setTabs(app.data.getStory());
            }
          }),
          (this.serializeExtentToItem = function (t) {
            if (!t || !t.spatialReference) return null;
            var e =
              4326 == t.spatialReference.wkid
                ? t
                : O.webMercatorToGeographic(t);
            if (
              4326 != t.spatialReference.wkid &&
              102100 != t.spatialReference.wkid
            ) {
              var i = new N(4326);
              B.defaults.geometryService.project([t], i).then(function (t) {
                (e = t[0]),
                  (app.data.getWebMap().item.extent = [
                    [e.xmin, e.ymin],
                    [e.xmax, e.ymax],
                  ]);
              });
            } else
              app.data.getWebMap().item.extent = [
                [e.xmin, e.ymin],
                [e.xmax, e.ymax],
              ];
          }),
          (this.resize = function (t) {
            ut.updateMyStoriesPosition();
          }),
          (this.initLocalization = function () {
            dt.initLocalization();
          });
      };
    }
  ),
  require([
    "storymaps/common/Core",
    "storymaps/common/ui/header/Desktop",
    "storymaps/tpl/core/MainView",
    "storymaps/common/builder/Builder",
    "storymaps/tpl/builder/BuilderView",
  ], function () {}),
  define("storymaps/tpl/BuildConfigBuilder", function () {});
